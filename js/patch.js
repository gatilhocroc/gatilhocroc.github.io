var CABLES=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"base64Chars",(function(){return h})),i.d(s,"base64lookup",(function(){return l})),i.d(s,"b64encTypesArray",(function(){return c})),i.d(s,"b64decTypedArray",(function(){return u}));var r={};i.r(r),i.d(r,"shuffleArray",(function(){return d})),i.d(r,"shortId",(function(){return E})),i.d(r,"uuid",(function(){return A})),i.d(r,"generateUUID",(function(){return b})),i.d(r,"simpleId",(function(){return v})),i.d(r,"smoothStep",(function(){return x})),i.d(r,"smootherStep",(function(){return I})),i.d(r,"clamp",(function(){return O})),i.d(r,"map",(function(){return R})),i.d(r,"cacheBust",(function(){return P})),i.d(r,"copyArray",(function(){return S})),i.d(r,"basename",(function(){return N})),i.d(r,"jsonp",(function(){return C})),i.d(r,"ajaxSync",(function(){return M})),i.d(r,"ajax",(function(){return w})),i.d(r,"request",(function(){return U})),i.d(r,"UTILS",(function(){return g}));var n={};i.r(n),i.d(n,"easeExpoIn",(function(){return G})),i.d(n,"easeExpoOut",(function(){return H})),i.d(n,"easeExpoInOut",(function(){return Y})),i.d(n,"easeCubicIn",(function(){return z})),i.d(n,"easeCubicOut",(function(){return W})),i.d(n,"easeCubicInOut",(function(){return X})),i.d(n,"ANIM",(function(){return V})),i.d(n,"Anim",(function(){return K})),i.d(n,"TL",(function(){return j}));var o={};i.r(o),i.d(o,"PatchConnectionReceiver",(function(){return Lt})),i.d(o,"PatchConnectionSender",(function(){return Bt})),i.d(o,"PatchConnectorBroadcastChannel",(function(){return kt}));const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(256);for(let t=0;t<h.length;t++)a[h.charCodeAt(t)]=t;const l=a,c=function(t){t.buffer&&(t=t.buffer);let e,i=new Uint8Array(t),s=i.length,r="";for(e=0;e<s;e+=3)r+=h[i[e]>>2],r+=h[(3&i[e])<<4|i[e+1]>>4],r+=h[(15&i[e+1])<<2|i[e+2]>>6],r+=h[63&i[e+2]];return s%3==2?r=r.substring(0,r.length-1)+"=":s%3==1&&(r=r.substring(0,r.length-2)+"=="),r},u=function(t){let e,i,s,r,n,o=.75*t.length,h=t.length,a=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);let c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<h;e+=4)i=l[t.charCodeAt(e)],s=l[t.charCodeAt(e+1)],r=l[t.charCodeAt(e+2)],n=l[t.charCodeAt(e+3)],u[a++]=i<<2|s>>4,u[a++]=(15&s)<<4|r>>2,u[a++]=(3&r)<<6|63&n;return c};class _{constructor(t){this._logs=[],this.initiator=t}stack(t){console.error("["+this.initiator+"] ",t),console.log((new Error).stack)}groupCollapsed(t){console.groupCollapsed("["+this.initiator+"] "+t)}table(t){console.table(t)}groupEnd(){console.groupEnd()}error(t){console.error("["+this.initiator+"]",...arguments)}info(t){console.error("["+this.initiator+"]",...arguments)}warn(t){console.warn("["+this.initiator+"]",...arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments)}log(t){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments)}userInteraction(t){}}const p=function(){this._log=new _("eventtaget"),this._eventCallbacks={},this._logName="",this._logEvents=!1,this._listeners={},this.addEventListener=this.on=function(t,e,i){const s={id:(i||"")+CABLES.uuid(),name:t,cb:e};return this._eventCallbacks[t]?this._eventCallbacks[t].push(s):this._eventCallbacks[t]=[s],this._listeners[s.id]=s,s.id},this.hasEventListener=function(t,e){if(t&&!e)return!!this._listeners[t];if(this._log.warn("old eventtarget function haseventlistener!"),t&&e&&this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}},this.removeEventListener=this.off=function(t,e){if(null==t)return;if(!e){const e=this._listeners[t];if(!e)return;let i=!0;for(;i;){i=!1;let s=-1;for(let r=0;r<this._eventCallbacks[e.name].length;r++)0===this._eventCallbacks[e.name][r].id.indexOf(t)&&(i=!0,s=r);-1!==s&&(this._eventCallbacks[e.name].splice(s,1),delete this._listeners[t])}return}this._log.stack(" old function signature: removeEventListener! use listener id");let i=null;for(let s=0;s<this._eventCallbacks[t].length;s++)this._eventCallbacks[t][s].cb==e&&(i=s);null!==i?delete this._eventCallbacks[i]:this._log.warn("removeEventListener not found "+t)},this.logEvents=function(t,e){this._logEvents=t,this._logName=e},this.emitEvent=function(t,e,i,s,r,n,o){if(this._logEvents&&console.log("[event] ",this._logName,t,this._eventCallbacks),this._eventCallbacks[t])for(let h=0;h<this._eventCallbacks[t].length;h++)this._eventCallbacks[t][h]&&this._eventCallbacks[t][h].cb(e,i,s,r,n,o);else this._logEvents&&console.log("[event] has no event callback",t,this._eventCallbacks)}},g={float32Concat:function(t,e){t instanceof Float32Array||(t=new Float32Array(t)),e instanceof Float32Array||(e=new Float32Array(e));const i=new Float32Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}},d=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},f={},m=function(){let t=Math.random().toString(36).substr(2,9);return f.hasOwnProperty(t)&&(t=m()),f[t]=!0,t},E=m,T=function(){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})},A=T,b=T;let y=0;const v=function(){return y++,y},x=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*(3-2*e)},I=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*e*(e*(6*e-15)+10)},O=function(t,e,i){return Math.min(Math.max(t,e),i)},R=function(t,e,i,s,r,n){if(t>=i)return r;if(t<=e)return s;let o=!1;const h=Math.min(e,i),a=Math.max(e,i);h!=e&&(o=!0);let l=!1;const c=Math.min(s,r),u=Math.max(s,r);c!=s&&(l=!0);let _=0,p=0;return _=o?(a-t)*(u-c)/(a-h):(t-h)*(u-c)/(a-h),p=l?u-_:_+c,n?1==n?s+(t=Math.max(0,Math.min(1,(p-s)/(r-s))))*t*(3-2*t)*(r-s):2==n?s+(t=Math.max(0,Math.min(1,(p-s)/(r-s))))*t*t*(t*(6*t-15)+10)*(r-s):p:p};Math.randomSeed=1,Math.seededRandom=function(t,e){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),t=t||1,e=e||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return e+Math.randomSeed/233280*(t-e)},g.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},g.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},g.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(t){return 0===this.indexOf(t)},String.prototype.endsWith=function(t){return this.match(t+"$")==t};const P=function(t){return t.indexOf("?")>-1?t+="&":t+="?",t+"cb="+CABLES.uuid()},S=function(t,e){if(!t)return null;(e=e||[]).length=t.length;for(let i=0;i<t.length;i++)e[i]=t[i];return e},N=function(t){let e="";if(!t)return"";const i=(t+"").split("/");if(i.length>0){let t=i[i.length-1].split("?");e=t[0],t=e.split("."),e=t[0]}return e};let F=null;const C=function(t,e){F=F||0,F++;const i=F;CABLES["jsonpFunc"+i]=function(t){e(!1,t)};let s="?";t.indexOf(s)>-1&&(s="&");const r=document.createElement("script");r.setAttribute("src",t+s+"callback=CABLES.jsonpFunc"+i),document.body.appendChild(r)},M=function(t,e,i,s,r){U({url:t,cb:e,method:i,data:s,contenttype:r,sync:!0})},w=function(t,e,i,s,r,n,o={}){U({url:t,cb:e,method:i,data:s,contenttype:r,sync:!1,jsonP:n,headers:o})},U=function(t){let e;t.hasOwnProperty("asynch")||(t.asynch=!0);try{e=new XMLHttpRequest}catch(t){}if(e.onreadystatechange=function(){4==e.readyState&&t.cb&&(200==e.status||0==e.status?t.cb(!1,e.responseText,e):t.cb(!0,e.responseText,e))},e.addEventListener("progress",t=>{}),e.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync),"object"==typeof t.headers){const i=Object.keys(t.headers);for(let s=0;s<i.length;s++){const r=i[s],n=t.headers[r];e.setRequestHeader(r,n)}}t.post||t.data?(e.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded"),e.send(t.data||t.post)):e.send()};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};const L={EASINGS:["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out"],EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27},B={OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},k={PORT_DIR_IN:0,PORT_DIR_OUT:1},D={PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10},V={Key:function(t){this.time=0,this.value=0,this.ui=null,this.onChange=null,this._easing=0,this.bezTangIn=0,this.bezTangOut=0,this.cb=null,this.cbTriggered=!1;this.setEasing(L.EASING_LINEAR),this.set(t)}};V.Key.cubicSpline=function(t,e,i){let s=t*t,r=s*t;return(2*r-3*s+1)*e.value+(r-2*s+t)*e.bezTangOut+(-2*r+3*s)*i.value+(r-s)*i.bezTangIn},V.Key.easeCubicSpline=function(t,e){return V.Key.cubicSpline(t,this,e)},V.Key.linear=function(t,e,i){return parseFloat(e.value)+parseFloat(i.value-e.value)*t},V.Key.easeLinear=function(t,e){return V.Key.linear(t,this,e)},V.Key.easeAbsolute=function(t,e){return this.value};const G=function(t){return Math.pow(2,10*(t-1))};V.Key.easeExpoIn=function(t,e){return t=G(t),V.Key.linear(t,this,e)};const H=function(t){return t=1-Math.pow(2,-10*t)};V.Key.easeExpoOut=function(t,e){return t=H(t),V.Key.linear(t,this,e)};const Y=function(t){return(t*=2)<1?t=.5*Math.pow(2,10*(t-1)):(t--,t=.5*(2-Math.pow(2,-10*t))),t};V.Key.easeExpoInOut=function(t,e){return t=Y(t),V.Key.linear(t,this,e)},V.Key.easeSinIn=function(t,e){return t=-1*Math.cos(t*Math.PI/2)+1,V.Key.linear(t,this,e)},V.Key.easeSinOut=function(t,e){return t=Math.sin(t*Math.PI/2),V.Key.linear(t,this,e)},V.Key.easeSinInOut=function(t,e){return t=-.5*(Math.cos(Math.PI*t)-1),V.Key.linear(t,this,e)};const z=function(t){return t*=t*t};V.Key.easeCubicIn=function(t,e){return t=z(t),V.Key.linear(t,this,e)},V.Key.easeInQuint=function(t,e){return t*=t*t*t*t,V.Key.linear(t,this,e)},V.Key.easeOutQuint=function(t,e){return t=(t-=1)*t*t*t*t+1,V.Key.linear(t,this,e)},V.Key.easeInOutQuint=function(t,e){return(t/=.5)<1?t*=.5*t*t*t*t:t=.5*((t-=2)*t*t*t*t+2),V.Key.linear(t,this,e)},V.Key.easeInQuart=function(t,e){return t*=t*t*t,V.Key.linear(t,this,e)},V.Key.easeOutQuart=function(t,e){return t=-1*((t-=1)*t*t*t-1),V.Key.linear(t,this,e)},V.Key.easeInOutQuart=function(t,e){return(t/=.5)<1?t*=.5*t*t*t:t=-.5*((t-=2)*t*t*t-2),V.Key.linear(t,this,e)},V.Key.bounce=function(t){return(t/=1)<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,t},V.Key.easeInBounce=function(t,e){return V.Key.linear(V.Key.bounce(t),this,e)},V.Key.easeOutBounce=function(t,e){return V.Key.linear(V.Key.bounce(t),this,e)},V.Key.easeInElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=-r*Math.pow(2,10*(t-=1))*Math.sin((1*t-i)*(2*Math.PI)/s)+0),V.Key.linear(t,this,e)},V.Key.easeOutElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=r*Math.pow(2,-10*t)*Math.sin((1*t-i)*(2*Math.PI)/s)+1+0),V.Key.linear(t,this,e)},V.Key.easeInBack=function(t,e){const i=1.70158;return t=t*t*((i+1)*t-i),V.Key.linear(t,this,e)},V.Key.easeOutBack=function(t,e){const i=1.70158;return t=(t=t/1-1)*t*((i+1)*t+i)+1,V.Key.linear(t,this,e)},V.Key.easeInOutBack=function(t,e){let i=1.70158;return t=(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2),V.Key.linear(t,this,e)};const W=function(t){return t=--t*t*t+1};V.Key.easeCubicOut=function(t,e){return t=W(t),V.Key.linear(t,this,e)};const X=function(t){return(t*=2)<1?t*=.5*t*t:t=.5*((t-=2)*t*t+2),t};V.Key.easeCubicInOut=function(t,e){return t=X(t),V.Key.linear(t,this,e)},V.Key.easeSmoothStep=function(t,e){const i=Math.max(0,Math.min(1,t));return t=i*i*(3-2*i),V.Key.linear(t,this,e)},V.Key.easeSmootherStep=function(t,e){const i=Math.max(0,Math.min(1,(t-0)/1));return t=i*i*i*(i*(6*i-15)+10),V.Key.linear(t,this,e)},V.Key.prototype.setEasing=function(t){this._easing=t,this._easing==L.EASING_LINEAR?this.ease=V.Key.easeLinear:this._easing==L.EASING_ABSOLUTE?this.ease=V.Key.easeAbsolute:this._easing==L.EASING_SMOOTHSTEP?this.ease=V.Key.easeSmoothStep:this._easing==L.EASING_SMOOTHERSTEP?this.ease=V.Key.easeSmootherStep:this._easing==L.EASING_CUBIC_IN?this.ease=V.Key.easeCubicIn:this._easing==L.EASING_CUBIC_OUT?this.ease=V.Key.easeCubicOut:this._easing==L.EASING_CUBIC_INOUT?this.ease=V.Key.easeCubicInOut:this._easing==L.EASING_EXPO_IN?this.ease=V.Key.easeExpoIn:this._easing==L.EASING_EXPO_OUT?this.ease=V.Key.easeExpoOut:this._easing==L.EASING_EXPO_INOUT?this.ease=V.Key.easeExpoInOut:this._easing==L.EASING_SIN_IN?this.ease=V.Key.easeSinIn:this._easing==L.EASING_SIN_OUT?this.ease=V.Key.easeSinOut:this._easing==L.EASING_SIN_INOUT?this.ease=V.Key.easeSinInOut:this._easing==L.EASING_BACK_OUT?this.ease=V.Key.easeOutBack:this._easing==L.EASING_BACK_IN?this.ease=V.Key.easeInBack:this._easing==L.EASING_BACK_INOUT?this.ease=V.Key.easeInOutBack:this._easing==L.EASING_ELASTIC_IN?this.ease=V.Key.easeInElastic:this._easing==L.EASING_ELASTIC_OUT?this.ease=V.Key.easeOutElastic:this._easing==L.EASING_ELASTIC_INOUT?this.ease=V.Key.easeElasticInOut:this._easing==L.EASING_BOUNCE_IN?this.ease=V.Key.easeInBounce:this._easing==L.EASING_BOUNCE_OUT?this.ease=V.Key.easeOutBounce:this._easing==L.EASING_QUART_OUT?this.ease=V.Key.easeOutQuart:this._easing==L.EASING_QUART_IN?this.ease=V.Key.easeInQuart:this._easing==L.EASING_QUART_INOUT?this.ease=V.Key.easeInOutQuart:this._easing==L.EASING_QUINT_OUT?this.ease=V.Key.easeOutQuint:this._easing==L.EASING_QUINT_IN?this.ease=V.Key.easeInQuint:this._easing==L.EASING_QUINT_INOUT?this.ease=V.Key.easeInOutQuint:this._easing==L.EASING_CUBICSPLINE?this.ease=V.Key.easeCubicSpline:(this._easing=L.EASING_LINEAR,this.ease=V.Key.easeLinear)},V.Key.prototype.trigger=function(){this.cb(),this.cbTriggered=!0},V.Key.prototype.setValue=function(t){this.value=t,null!==this.onChange&&this.onChange()},V.Key.prototype.set=function(t){t&&(t.e&&this.setEasing(t.e),t.cb&&(this.cb=t.cb,this.cbTriggered=!1),t.b,t.hasOwnProperty("t")&&(this.time=t.t),t.hasOwnProperty("time")&&(this.time=t.time),t.hasOwnProperty("v")?this.value=t.v:t.hasOwnProperty("value")&&(this.value=t.value)),null!==this.onChange&&this.onChange()},V.Key.prototype.getSerialized=function(){const t={};return t.t=this.time,t.v=this.value,t.e=this._easing,t},V.Key.prototype.getEasing=function(){return this._easing};const K=function(t){t=t||{},this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this._log=new _("Anim"),this.defaultEasing=t.defaultEasing||L.EASING_LINEAR,this.onLooped=null,this._timesLooped=0,this._needsSort=!1};K.prototype.forceChangeCallback=function(){null!==this.onChange&&this.onChange()},K.prototype.hasEnded=function(t){return 0===this.keys.length||this.keys[this.keys.length-1].time<=t},K.prototype.isRising=function(t){if(this.hasEnded(t))return!1;const e=this.getKeyIndex(t);return this.keys[e].value<this.keys[e+1].value},K.prototype.clearBefore=function(t){const e=this.getValue(t),i=this.getKeyIndex(t);this.setValue(t,e),i>1&&this.keys.splice(0,i)},K.prototype.clear=function(t){let e=0;t&&(e=this.getValue(t)),this.keys.length=0,t&&this.setValue(t,e),null!==this.onChange&&this.onChange()},K.prototype.sortKeys=function(){this.keys.sort((t,e)=>parseFloat(t.time)-parseFloat(e.time)),this._needsSort=!1},K.prototype.getLength=function(){return 0===this.keys.length?0:this.keys[this.keys.length-1].time},K.prototype.getKeyIndex=function(t){let e=0;for(let i=0;i<this.keys.length;i++)if(t>=this.keys[i].time&&(e=i),this.keys[i].time>t)return e;return e},K.prototype.setValue=function(t,e,i){let s=null;for(const r in this.keys)if(this.keys[r].time==t){s=this.keys[r],this.keys[r].setValue(e),this.keys[r].cb=i;break}return s||(s=new V.Key({time:t,value:e,e:this.defaultEasing,cb:i}),this.keys.push(s)),this.onChange&&this.onChange(),this._needsSort=!0,s},K.prototype.getSerialized=function(){const t={keys:[]};t.loop=this.loop;for(const e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},K.prototype.getKey=function(t){const e=this.getKeyIndex(t);return this.keys[e]},K.prototype.getNextKey=function(t){let e=this.getKeyIndex(t)+1;return e>=this.keys.length&&(e=this.keys.length-1),this.keys[e]},K.prototype.isFinished=function(t){return this.keys.length<=0||t>this.keys[this.keys.length-1].time},K.prototype.isStarted=function(t){return!(this.keys.length<=0)&&t>=this.keys[0].time},K.prototype.getValue=function(t){if(0===this.keys.length)return 0;if(this._needsSort&&this.sortKeys(),t<this.keys[0].time)return this.keys[0].value;const e=this.keys.length-1;if(this.loop&&t>this.keys[e].time){t/this.keys[e].time>this._timesLooped&&(this._timesLooped++,this.onLooped&&this.onLooped()),t=(t-this.keys[0].time)%(this.keys[e].time-this.keys[0].time),t+=this.keys[0].time}const i=this.getKeyIndex(t);if(i>=e)return this.keys[e].cb&&!this.keys[e].cbTriggered&&this.keys[e].trigger(),this.keys[e].value;const s=parseInt(i,10)+1,r=this.keys[i],n=this.keys[s];if(r.cb&&!r.cbTriggered&&r.trigger(),!n)return-1;const o=(t-r.time)/(n.time-r.time);return r.ease||this.log._warn("has no ease",r,n),r.ease(o,n)},K.prototype.addKey=function(t){void 0===t.time?this.log.warn("key time undefined, ignoring!"):(this.keys.push(t),null!==this.onChange&&this.onChange())},K.prototype.easingFromString=function(t){return"linear"==t?L.EASING_LINEAR:"absolute"==t?L.EASING_ABSOLUTE:"smoothstep"==t?L.EASING_SMOOTHSTEP:"smootherstep"==t?L.EASING_SMOOTHERSTEP:"Cubic In"==t?L.EASING_CUBIC_IN:"Cubic Out"==t?L.EASING_CUBIC_OUT:"Cubic In Out"==t?L.EASING_CUBIC_INOUT:"Expo In"==t?L.EASING_EXPO_IN:"Expo Out"==t?L.EASING_EXPO_OUT:"Expo In Out"==t?L.EASING_EXPO_INOUT:"Sin In"==t?L.EASING_SIN_IN:"Sin Out"==t?L.EASING_SIN_OUT:"Sin In Out"==t?L.EASING_SIN_INOUT:"Back In"==t?L.EASING_BACK_IN:"Back Out"==t?L.EASING_BACK_OUT:"Back In Out"==t?L.EASING_BACK_INOUT:"Elastic In"==t?L.EASING_ELASTIC_IN:"Elastic Out"==t?L.EASING_ELASTIC_OUT:"Bounce In"==t?L.EASING_BOUNCE_IN:"Bounce Out"==t?L.EASING_BOUNCE_OUT:"Quart Out"==t?L.EASING_QUART_OUT:"Quart In"==t?L.EASING_QUART_IN:"Quart In Out"==t?L.EASING_QUART_INOUT:"Quint Out"==t?L.EASING_QUINT_OUT:"Quint In"==t?L.EASING_QUINT_IN:"Quint In Out"==t?L.EASING_QUINT_INOUT:void 0},K.prototype.createPort=function(t,e,i){const s=t.inDropDown(e,L.EASINGS);return s.set("linear"),s.defaultValue="linear",s.onChange=function(){this.defaultEasing=this.easingFromString(s.get()),i&&i()}.bind(this),s},K.slerpQuaternion=function(t,e,i,s,r,n){K.slerpQuaternion.q1||(K.slerpQuaternion.q1=quat.create(),K.slerpQuaternion.q2=quat.create());const o=i.getKeyIndex(t);let h=o+1;if(h>=i.keys.length&&(h=i.keys.length-1),o==h)quat.set(e,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value);else{const a=i.keys[o].time,l=(t-a)/(i.keys[h].time-a);quat.set(K.slerpQuaternion.q1,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value),quat.set(K.slerpQuaternion.q2,i.keys[h].value,s.keys[h].value,r.keys[h].value,n.keys[h].value),quat.slerp(e,K.slerpQuaternion.q1,K.slerpQuaternion.q2,l)}return e};const j=V;j.Anim=K;const Q=function(t){p.apply(this),this.id=CABLES.uuid(),this.portIn=null,this.portOut=null,this.scene=t,this.activityCounter=0,this.ignoreInSerialize=!1};Q.prototype.setValue=function(t){void 0===t?this._setValue():this.portIn.set(t)},Q.prototype.activity=function(){this.activityCounter++},Q.prototype._setValue=function(){if(!this.portOut)return void this.remove();const t=this.portOut.get();t==t&&(this.portIn.type!=B.OP_PORT_TYPE_FUNCTION&&this.activity(),(this.portIn.get()!==t||this.portIn.changeAlways)&&this.portIn.set(t))},Q.prototype.getOtherPort=function(t){return t==this.portIn?this.portOut:this.portIn},Q.prototype.remove=function(){this.portIn&&this.portIn.removeLink(this),this.portOut&&this.portOut.removeLink(this),this.scene&&this.scene.emitEvent("onUnLink",this.portIn,this.portOut,this),!this.portIn||this.portIn.type!=B.OP_PORT_TYPE_OBJECT&&this.portIn.type!=B.OP_PORT_TYPE_ARRAY||(this.portIn.set(null),this.portIn.links.length>0&&this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())),this.portIn&&this.portIn.parent._checkLinksNeededToWork(),this.portOut&&this.portOut.parent._checkLinksNeededToWork(),this.portIn=null,this.portOut=null,this.scene=null},Q.prototype.link=function(t,e){if(!Q.canLink(t,e))return console.warn("[core_link] cannot link ports!",t,e),!1;t.direction==k.PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),this.setValue(),t.onLink&&t.onLink(this),e.onLink&&e.onLink(this),t.parent._checkLinksNeededToWork(),e.parent._checkLinksNeededToWork()},Q.prototype.getSerialized=function(){const t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t},Q.canLinkText=function(t,e){if(t.direction==e.direction){let t="(out)";return e.direction==k.PORT_DIR_IN&&(t="(in)"),"can not link: same direction "+t}return t.parent==e.parent?"can not link: same op":t.type!=B.OP_PORT_TYPE_DYNAMIC&&e.type!=B.OP_PORT_TYPE_DYNAMIC&&t.type!=e.type?"can not link: different type":t?e?t.direction==k.PORT_DIR_IN&&t.isAnimated()||e.direction==k.PORT_DIR_IN&&e.isAnimated()?"can not link: is animated":t.isLinkedTo(e)?"ports already linked":t.canLink&&!t.canLink(e)||e.canLink&&!e.canLink(t)?"Incompatible":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},Q.canLink=function(t,e){return!!t&&(!!e&&((t.direction!=k.PORT_DIR_IN||!t.isAnimated())&&((e.direction!=k.PORT_DIR_IN||!e.isAnimated())&&(!t.isHidden()&&!e.isHidden()&&(!t.isLinkedTo(e)&&(t.direction!=e.direction&&((t.type==e.type||t.type==B.OP_PORT_TYPE_DYNAMIC||e.type==B.OP_PORT_TYPE_DYNAMIC)&&(t.type==B.OP_PORT_TYPE_DYNAMIC||e.type==B.OP_PORT_TYPE_DYNAMIC||t.parent!=e.parent&&(!(t.canLink&&!t.canLink(e))&&!(e.canLink&&!e.canLink(t)))))))))))};const q=function(t,e,i,s){p.apply(this),this.data={},this._log=new _("core_port"),this.direction=k.PORT_DIR_IN,this.id=b(),this.parent=t,this.links=[],this.value=0,this.name=e,this.type=i||B.OP_PORT_TYPE_VALUE,this.uiAttribs=s||{},this.anim=null,this._oldAnimVal=-5711,this.defaultValue=null,this._uiActiveState=!0,this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.crashed=!1,this._valueBeforeLink=null,this._lastAnimFrame=-1,this._animated=!1,this.onValueChanged=null,this.onTriggered=null,this.onUiActiveStateChange=null,this.changeAlways=!1,this._warnedDeprecated=!1,this._useVariableName=null,this.activityCounter=0,this._tempLastUiValue=null,Object.defineProperty(this,"val",{get(){return this._log.warn("val getter deprecated!",this),this._log.stack("val getter deprecated"),this._warnedDeprecated=!0,this.get()},set(t){this._log.warn("val setter deprecated!",this),this._log.stack("val setter deprecated"),this.setValue(t),this._warnedDeprecated=!0}})};q.prototype.getValueForDisplay=function(){let t=String(this.value);return t.length>100&&(t=t.substring(0,100)),t},q.prototype.onAnimToggle=function(){},q.prototype._onAnimToggle=function(){this.onAnimToggle()},q.prototype.remove=function(){this.removeLinks(),this.parent.removePort(this)},q.prototype.setUiAttribs=function(t){let e=!1;this.uiAttribs||(this.uiAttribs={});for(const i in t)this.uiAttribs[i]!=t[i]&&(e=!0),this.uiAttribs[i]=t[i],"group"==i&&this.indexPort&&this.indexPort.setUiAttribs({group:t[i]});e&&this.emitEvent("onUiAttrChange",t)},q.prototype.getUiAttribs=function(){return this.uiAttribs},q.prototype.getUiAttrib=function(t){return this.uiAttribs&&this.uiAttribs.hasOwnProperty(t)?this.uiAttribs[t]:null},q.prototype.get=function(){return this._animated&&this._lastAnimFrame!=this.parent.patch.getFrameNum()&&(this._lastAnimFrame=this.parent.patch.getFrameNum(),this.value=this.anim.getValue(this.parent.patch.timer.getTime()),this._oldAnimVal=this.value,this.forceChange()),this.value},q.prototype.set=q.prototype.setValue=function(t){if(void 0!==t&&this.parent.enabled&&!this.crashed&&(t!==this.value||this.changeAlways||this.type==B.OP_PORT_TYPE_TEXTURE||this.type==B.OP_PORT_TYPE_ARRAY)){if(this._animated)this.anim.setValue(this.parent.patch.timer.getTime(),t);else{try{this.value=t,this.forceChange()}catch(t){this.crashed=!0,this.setValue=function(t){},this.onTriggered=function(){},this._log.error("onvaluechanged exception cought",t),this._log.error(t.stack),this._log.warn("exception in: "+this.parent.name),this.parent.patch.isEditorMode()&&gui.showOpCrash(this.parent),this.parent.patch.emitEvent("exception".ex,this.parent),this.parent.onError&&this.parent.onError(t)}this.parent&&this.parent.patch&&this.parent.patch.isEditorMode()&&this.type==B.OP_PORT_TYPE_TEXTURE&&gui.texturePreview().updateTexturePort(this)}if(this.direction==k.PORT_DIR_OUT)for(let t=0;t<this.links.length;++t)this.links[t].setValue()}},q.prototype.updateAnim=function(){this._animated&&(this.value=this.get(),(this._oldAnimVal!=this.value||this.changeAlways)&&(this._oldAnimVal=this.value,this.forceChange()),this._oldAnimVal=this.value)},q.args=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},q.prototype.forceChange=function(){this.onValueChanged||this.onChange,this._activity(),this.emitEvent("change",this.value,this),this.onChange?this.onChange(this,this.value):this.onValueChanged&&this.onValueChanged(this,this.value)},q.prototype.getTypeString=function(){return this.type==B.OP_PORT_TYPE_VALUE?"Number":this.type==B.OP_PORT_TYPE_FUNCTION?"Trigger":this.type==B.OP_PORT_TYPE_OBJECT?"Object":this.type==B.OP_PORT_TYPE_DYNAMIC?"Dynamic":this.type==B.OP_PORT_TYPE_ARRAY?"Array":this.type==B.OP_PORT_TYPE_STRING?"String":"Unknown"},q.prototype.deSerializeSettings=function(t){if(t&&(t.animated&&this.setAnimated(t.animated),t.useVariable&&this.setVariableName(t.useVariable),t.anim)){this.anim||(this.anim=new K),t.anim.loop&&(this.anim.loop=t.anim.loop);for(const e in t.anim.keys)this.anim.keys.push(new V.Key(t.anim.keys[e]))}},q.prototype.getSerialized=function(){const t={};if(t.name=this.getName(),this.ignoreValueSerialize||0!==this.links.length||this.type==B.OP_PORT_TYPE_OBJECT&&this.value&&this.value.tex||(t.value=this.value),this._useVariableName&&(t.useVariable=this._useVariableName),this._animated&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),"file"==this.uiAttribs.display&&(t.display=this.uiAttribs.display),this.direction==k.PORT_DIR_OUT&&this.links.length>0){t.links=[];for(const e in this.links)!this.links[e].ignoreInSerialize&&this.links[e].portIn&&this.links[e].portOut&&t.links.push(this.links[e].getSerialized())}return t},q.prototype.shouldLink=function(){return!0},q.prototype.removeLinks=function(){let t=0;for(;this.links.length>0;){if(t++,t>5e3){this._log.warn("could not delete links... / infinite loop"),this.links.length=0;break}this.links[0].remove()}},q.prototype.removeLink=function(t){for(const e in this.links)this.links[e]==t&&this.links.splice(e,1);this.direction==k.PORT_DIR_IN&&(this.type==B.OP_PORT_TYPE_VALUE?this.setValue(this._valueBeforeLink||0):this.setValue(this._valueBeforeLink||null)),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},q.prototype.getName=function(){return this.name},q.prototype.addLink=function(t){this._valueBeforeLink=this.value,this.links.push(t),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},q.prototype.getLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]},q.prototype.removeLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e].remove(),this.onLinkChanged&&this.onLinkChanged(),void this.emitEvent("onLinkChanged")},q.prototype.isLinkedTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},q.prototype._activity=function(){this.activityCounter++},q.prototype.trigger=function(){if(this._activity(),0===this.links.length)return;if(!this.parent.enabled)return;let t=null;try{for(let e=0;e<this.links.length;++e)this.links[e].portIn&&(t=this.links[e].portIn,t.parent.patch.pushTriggerStack(t),t._onTriggered(),t.parent.patch.popTriggerStack()),this.links[e]&&this.links[e].activity()}catch(e){this.parent.enabled=!1,this.parent.patch.isEditorMode()&&(this.parent.patch.emitEvent("exception",e,t.parent),this.parent.patch.emitEvent("opcrash",t),t.parent.onError&&t.parent.onError(e)),this._log.warn("exception!"),this._log.error("ontriggered exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+t.parent.name)}},q.prototype.call=function(){this._log.warn("call deprecated - use trigger() "),this.trigger()},q.prototype.execute=function(){this._log.warn("### execute port: "+this.getName(),this.goals.length)},q.prototype.setVariableName=function(t){this._useVariableName=t},q.prototype.getVariableName=function(){return this._useVariableName},q.prototype.setVariable=function(t){this.setAnimated(!1);const e={useVariable:!1};this._variableIn&&(this._variableIn.removeListener(this.set.bind(this)),this._variableIn=null),t?(this._variableIn=this.parent.patch.getVar(t),this._variableIn?(this.type==B.OP_PORT_TYPE_OBJECT?this._variableIn.addListener(()=>{this.set(null),this.set(this._variableIn.getValue())}):this._variableIn.addListener(this.set.bind(this)),this.set(this._variableIn.getValue())):this._log.warn("PORT VAR NOT FOUND!!!",t),this._useVariableName=t,e.useVariable=!0,e.variableName=this._useVariableName):(e.variableName=this._useVariableName=null,e.useVariable=!1),this.setUiAttribs(e)},q.prototype._handleNoTriggerOpAnimUpdates=function(t){let e=!1;for(let t=0;t<this.parent.portsIn.length;t++)if(this.parent.portsIn.type==B.OP_PORT_TYPE_FUNCTION){e=!0;break}e||(t?this._notriggerAnimUpdate=this.parent.patch.on("onRenderFrame",()=>{this.updateAnim()}):this.parent.patch.removeEventListener(this._notriggerAnimUpdate))},q.prototype.setAnimated=function(t){this._animated!=t&&(this._animated=t,this._animated&&!this.anim&&(this.anim=new K),this._onAnimToggle()),this._handleNoTriggerOpAnimUpdates(t),this.setUiAttribs({isAnimated:this._animated})},q.prototype.toggleAnim=function(t){this._animated=!this._animated,this._animated&&!this.anim&&(this.anim=new K),this.setAnimated(this._animated),this._onAnimToggle(),this.setUiAttribs({isAnimated:this._animated})},q.prototype.getType=function(){return this.type},q.prototype.isLinked=function(){return this.links.length>0},q.prototype.isBoundToVar=function(){return null!=this._useVariableName},q.prototype.isAnimated=function(){return this._animated},q.prototype.isHidden=function(){return this.uiAttribs.hidePort},q.prototype._onTriggered=function(t){this._activity(),this.parent.updateAnims(),this.parent.enabled&&this.onTriggered&&this.onTriggered(t)},q.prototype._onSetProfiling=function(t){this.parent.patch.profiler.add("port",this),this.setValue(t),this.parent.patch.profiler.add("port",null)},q.prototype._onTriggeredProfiling=function(){this.parent.enabled&&this.onTriggered&&(this.parent.patch.profiler.add("port",this),this.onTriggered(),this.parent.patch.profiler.add("port",null))},q.prototype.onValueChange=function(t){this.onChange=t},q.prototype.getUiActiveState=function(){return this._uiActiveState},q.prototype.setUiActiveState=function(t){this._uiActiveState=t,this.onUiActiveStateChange&&this.onUiActiveStateChange()},q.prototype.hidePort=function(){this._log.warn("op.hideport() is deprecated, do not use it!")},q.portTypeNumberToString=function(t){return t==B.OP_PORT_TYPE_VALUE?"value":t==B.OP_PORT_TYPE_FUNCTION?"function":t==B.OP_PORT_TYPE_OBJECT?"object":t==B.OP_PORT_TYPE_ARRAY?"array":t==B.OP_PORT_TYPE_STRING?"string":t==B.OP_PORT_TYPE_DYNAMIC?"dynamic":"unknown"};class J extends q{constructor(t,e,i,s,r){super(t,e,i,s),this.indexPort=r,this.indexPort.set=t=>{const e=s.values;if(!e)return;let i=Math.floor(t);i=Math.min(i,e.length-1),i=Math.max(i,0),this.indexPort.setValue(i),this.set(e[i]),this.parent.patch.isEditorMode()&&window.gui&&gui.patchView.isCurrentOp(this.parent)&&gui.opParams.show(this.parent)}}setUiAttribs(t){const e=t.hidePort;t.hidePort=!0,super.setUiAttribs(t),void 0!==e&&this.indexPort.setUiAttribs({hidePort:e})}}class Z extends J{setUiAttribs(t){if(this.indexPort.isLinked())for(const e in t)"greyout"!=e||t[e]||(t[e]="true");super.setUiAttribs(t)}}const $=function(){if(p.apply(this),this._log=new _("core_op"),this.data={},this.storage={},this.objName="",this.portsOut=[],this.portsIn=[],this.portsInData=[],this.opId="",this.uiAttribs={},this.enabled=!0,this.patch=arguments[0],this.name=arguments[1],this._needsLinkedToWork=[],this._needsParentOp=null,this._shortOpName="",this.hasUiErrors=!1,this._uiErrors={},arguments[1]){if(this._shortOpName=arguments[1].split(".")[arguments[1].split(".").length-1],this._shortOpName.indexOf(B.OP_VERSION_PREFIX)>0){const t=this._shortOpName.split(B.OP_VERSION_PREFIX)[1];this._shortOpName=this._shortOpName.substring(0,this._shortOpName.length-(B.OP_VERSION_PREFIX+t).length)}this.uiAttribs.title=this._shortOpName}this.id=arguments[2]||A(),this.onAddPort=null,this.onCreate=null,this.onResize=null,this.onLoaded=null,this.onDelete=null,this.onUiAttrChange=null,this.onError=null,this._eventCallbacks={},this._instances=null,this.preRender=null,this.init=null};{$.prototype.clearUiAttrib=function(t){const e={name:null};this.uiAttrib(e)},$.prototype.getTitle=function(){return this.uiAttribs&&this.uiAttribs.title||this.name},$.prototype.setTitle=function(t){const e=this.name!=t;this.name=t,this.uiAttr({title:t}),e&&this.fireEvent("onTitleChange",t)};const t=function(t){if(t){(t.error||t.warning||t.hint)&&this._log.warn("old ui error/warning attribute in "+this.name+", use op.setUiError !",t),"object"!=typeof t&&this._log.error("op.uiAttrib attribs are not of type object"),this.uiAttribs||(this.uiAttribs={});for(const e in t)this.uiAttribs[e]=t[e];t.title&&t.title!=this.name&&this.setTitle(t.title),this.fireEvent("onUiAttribsChange",t),this.patch.emitEvent("onUiAttribsChange",this)}};$.prototype.setUiAttribs=$.prototype.setUiAttrib=$.prototype.uiAttr=t,$.prototype.getName=function(){return this.uiAttribs.name?this.uiAttribs.name:this.objName.split(".")},$.prototype.addOutPort=function(t){return t.direction=k.PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),this.fireEvent("onPortAdd",t),t},$.prototype.hasDynamicPort=function(){let t=0;for(t=0;t<this.portsIn.length;t++){if(this.portsIn[t].type==B.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsIn[t].getName())return!0}for(t=0;t<this.portsOut.length;t++){if(this.portsOut[t].type==B.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsOut[t].getName())return!0}return!1},$.prototype.addInPort=function(t){if(!(t instanceof q))throw new Error("parameter is not a port!");return t.direction=k.PORT_DIR_IN,t.parent=this,this.portsIn.push(t),this.fireEvent("onPortAdd",t),t},$.prototype.inFunction=$.prototype.inTrigger=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},$.prototype.inFunctionButton=$.prototype.inTriggerButton=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_FUNCTION,{display:"button"}));return void 0!==e&&i.set(e),i},$.prototype.inFunctionButton=$.prototype.inUiTriggerButtons=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_FUNCTION,{display:"buttons"}));return void 0!==e&&i.set(e),i},$.prototype.inValueFloat=$.prototype.inValue=$.prototype.inFloat=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE));return void 0!==e&&(i.set(e),i.defaultValue=e),i},$.prototype.inValueBool=$.prototype.inBool=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e&&(i.set(e),i.defaultValue=i.get()),i},$.prototype.inValueString=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{type:"string"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},$.prototype.inString=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_STRING,{type:"string"}));return e=e||"",i.value=e,i.set(e),i.defaultValue=e,i},$.prototype.inValueText=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},$.prototype.inTextarea=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_STRING,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},$.prototype.inStringEditor=function(t,e,i,s=!0){const r=this.addInPort(new q(this,t,B.OP_PORT_TYPE_STRING,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},$.prototype.inValueEditor=function(t,e,i,s=!0){const r=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},$.prototype.inValueSelect=$.prototype.inDropDown=function(t,e,i,s){let r=null;if(s){const i=new q(this,t,B.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new q(this,t+" index",B.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new Z(this,t,B.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e},n);if(o.indexPort=s,s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},$.prototype.inSwitch=function(t,e,i,s){let r=null;if(s){const i=new q(this,t,B.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new q(this,t+" index",B.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new J(this,t,B.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e},n);if(s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},$.prototype.inValueInt=$.prototype.inInt=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{increment:"integer"}));return void 0!==e&&(i.set(e),i.defaultValue=e),i},$.prototype.inFile=function(t,e,i){const s=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},$.prototype.inUrl=function(t,e,i){const s=this.addInPort(new q(this,t,B.OP_PORT_TYPE_STRING,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},$.prototype.inTexture=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_OBJECT,{display:"texture",objType:"texture",preview:!0}));return void 0!==e&&i.set(e),i},$.prototype.inObject=function(t,e,i){const s=this.addInPort(new q(this,t,B.OP_PORT_TYPE_OBJECT,{objType:i}));return void 0!==e&&s.set(e),s},$.prototype.inGradient=function(t,e){const i=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{display:"gradient",hidePort:!0}));return void 0!==e&&i.set(e),i},$.prototype.inArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addInPort(new q(this,t,B.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s},$.prototype.inValueSlider=$.prototype.inFloatSlider=function(t,e,i,s){const r={display:"range"};null!=i&&null!=s&&(r.min=i,r.max=s);const n=this.addInPort(new q(this,t,B.OP_PORT_TYPE_VALUE,r));return void 0!==e&&(n.set(e),n.defaultValue=e),n},$.prototype.outFunction=$.prototype.outTrigger=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},$.prototype.outValue=$.prototype.outNumber=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_VALUE));return void 0!==e&&i.set(e),i},$.prototype.outValueBool=$.prototype.outBool=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e?i.set(e):i.set(0),i},$.prototype.outValueString=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_VALUE,{type:"string"}));return void 0!==e&&i.set(e),i},$.prototype.outString=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_STRING,{type:"string"}));return void 0!==e?i.set(e):i.set(""),i},$.prototype.outObject=function(t,e,i){const s=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_OBJECT,{objType:i||null}));return void 0!==e&&s.set(e),s.ignoreValueSerialize=!0,s},$.prototype.outArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s.ignoreValueSerialize=!0,s},$.prototype.outTexture=function(t,e){const i=this.addOutPort(new q(this,t,B.OP_PORT_TYPE_OBJECT,{preview:!0,objType:"texture"}));return void 0!==e&&i.set(e),i.ignoreValueSerialize=!0,i},$.prototype.inDynamic=function(t,e,i,s){const r=new q(this,t,B.OP_PORT_TYPE_DYNAMIC,i);return r.shouldLink=function(t,i){if(e&&g.isArray(e)){for(let s=0;s<e.length;s++){if(t==this&&i.type===e[s])return!0;if(i==this&&t.type===e[s])return!0}return!1}return!0},this.addInPort(r),void 0!==s&&(r.set(s),r.defaultValue=s),r},$.prototype.printInfo=function(){for(let t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(const t in this.portsOut)console.log("out: "+this.portsOut[t].getName())},$.prototype.getOutChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].type==B.OP_PORT_TYPE_FUNCTION&&t.push(this.portsOut[e].links[i].portIn.parent);return t},$.prototype.markChilds=function(){this.marked=!0;for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.marked=!0,this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.markChilds()},$.prototype.selectChilds=function(){this.setUiAttrib({selected:!0});for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.setUiAttrib({selected:!0}),this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.selectChilds()},$.prototype.deleteChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].links[i].portIn.parent!=this&&(this.portsOut[e].parent!=this&&t.push(this.portsOut[e].parent),t.push(this.portsOut[e].links[i].portIn.parent),this.portsOut[e].links[i].portIn.parent.deleteChilds());for(const e in t)this.patch.deleteOp(t[e].id)},$.prototype.removeLinks=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks()},$.prototype.countFittingPorts=function(t){let e=0;for(const i in this.portsOut)Q.canLink(t,this.portsOut[i])&&e++;for(const i in this.portsIn)Q.canLink(t,this.portsIn[i])&&e++;return e},$.prototype.findFittingPort=function(t,e=!1){if(e){for(const e in this.portsIn)if(Q.canLink(t,this.portsIn[e]))return this.portsIn[e];for(const e in this.portsOut)if(Q.canLink(t,this.portsOut[e]))return this.portsOut[e]}else{for(const e in this.portsOut)if(Q.canLink(t,this.portsOut[e]))return this.portsOut[e];for(const e in this.portsIn)if(Q.canLink(t,this.portsIn[e]))return this.portsIn[e]}},$.prototype.getSerialized=function(t){const e={};this.opId&&(e.opId=this.opId),e.objName=this.objName,e.id=this.id,e.uiAttribs=this.uiAttribs,e.storage=this.storage,this.uiAttribs.title==this._shortOpName&&delete this.uiAttribs.title,this.uiAttribs.hasOwnProperty("working")&&1==this.uiAttribs.working&&delete this.uiAttribs.working,t&&this.uiAttribs.hasOwnProperty("uierrors")&&delete this.uiAttribs.uierrors,e.portsIn=[],e.portsOut=[];for(let t=0;t<this.portsIn.length;t++)e.portsIn.push(this.portsIn[t].getSerialized());for(const t in this.portsOut)e.portsOut.push(this.portsOut[t].getSerialized());return e},$.prototype.getFirstOutPortByType=function(t){for(const e in this.portsOut)if(this.portsOut[e].type==t)return this.portsOut[e]},$.prototype.getPort=$.prototype.getPortByName=function(t,e){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t)return this.portsOut[e]}},$.prototype.getPortById=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]},$.prototype.updateAnims=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].updateAnim()},$.prototype.log=function(){const t="op "+this.objName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["[op "+this._shortOpName+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.log,[console,e])},$.prototype.error=$.prototype.logError=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.error,[console,t])},$.prototype.warn=$.prototype.logWarn=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.warn,[console,t])},$.prototype.verbose=$.prototype.logVerbose=function(){const t="op "+this._shortOpName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["["+t+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.info,[console,e])},$.prototype.unLink=function(){for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks();for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks()},$.prototype.profile=function(t){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t]._onTriggered=this.portsIn[t]._onTriggeredProfiling,this.portsIn[t].set=this.portsIn[t]._onSetProfiling},$.prototype.findParent=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].isLinked()){if(this.portsIn[e].links[0].portOut.parent.objName==t)return this.portsIn[e].links[0].portOut.parent;let i=null;if(i=this.portsIn[e].links[0].portOut.parent.findParent(t),i)return i}return null},$.prototype.cleanUp=function(){if(this._instances){for(let t=0;t<this._instances.length;t++)this._instances[t].onDelete&&this._instances[t].onDelete();this._instances.length=0}},$.prototype.instanced=function(t){if(console.log("instanced",this.patch.instancing.numCycles()),0===this.patch.instancing.numCycles())return!1;let e=0,i=0;if(!this._instances||this._instances.length!=this.patch.instancing.numCycles()){for(this._instances||(this._instances=[]),this._.log("creating instances of ",this.objName,this.patch.instancing.numCycles(),this._instances.length),this._instances.length=this.patch.instancing.numCycles(),e=0;e<this._instances.length;e++){this._instances[e]=this.patch.createOp(this.objName,!0),this._instances[e].instanced=function(){return!1},this._instances[e].uiAttr(this.uiAttribs);for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].type==B.OP_PORT_TYPE_FUNCTION&&(this._instances[e].getPortByName(this.portsOut[t].name).trigger=this.portsOut[t].trigger.bind(this.portsOut[t]))}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].onChange=null,this.portsIn[i].onValueChanged=null}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].type!=B.OP_PORT_TYPE_VALUE&&this.portsIn[i].type!=B.OP_PORT_TYPE_ARRAY||this._instances[this.patch.instancing.index()].portsIn[i].set(this.portsIn[i].get()),this.portsIn[i].type,B.OP_PORT_TYPE_FUNCTION;for(i=0;i<this.portsOut.length;i++)this.portsOut[i].type==B.OP_PORT_TYPE_VALUE&&this.portsOut[i].set(this._instances[this.patch.instancing.index()].portsOut[i].get());return!0},$.prototype.initInstancable=function(){},$.prototype.setValues=function(t){for(const e in t){const i=this.getPortByName(e);i?i.set(t[e]):this._log.warn("op.setValues: port not found:",e)}},$.prototype.setUiError=function(t,e,i){if(!e&&!this.hasUiErrors)return;if(!e&&!this._uiErrors.hasOwnProperty(t))return;if(this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e)return;t.indexOf(" ")>-1&&this._log.warn("setuierror id cant have spaces!"),!e&&this._uiErrors.hasOwnProperty(t)?delete this._uiErrors[t]:!e||this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e||(null==i&&(i=2),this._uiErrors[t]={txt:e,level:i,id:t});const s=[];for(const t in this._uiErrors)s.push(this._uiErrors[t]);this.uiAttr({uierrors:s}),this.hasUiErrors=Object.keys(this._uiErrors).length},$.prototype.setError=function(t,e){this._log.warn("old error message op.error() - use op.setUiError()")},$.prototype.addListener=$.prototype.addEventListener=function(t,e){this._eventCallbacks[t]?this._eventCallbacks[t].push(e):this._eventCallbacks[t]=[e]},$.prototype.hasEventListener=function(t,e){if(t&&e){if(this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}}else this._log.warn("hasListener: missing parameters")},$.prototype.removeEventListener=function(t,e){if(this._eventCallbacks[t]){const i=this._eventCallbacks[t].indexOf(e);-1==i?this._log.warn("eventlistener "+t+" not found..."):this._eventCallbacks[t].slice(i)}},$.prototype.fireEvent=function(t,e){if(this._eventCallbacks[t])for(let i=0;i<this._eventCallbacks[t].length;i++)this._eventCallbacks[t][i]&&this._eventCallbacks[t][i].cb(e);this.onUiAttrChange&&"onUiAttribsChange"==t&&this.onUiAttrChange(e)},$.prototype.setEnabled=function(t){this.enabled=t,this.fireEvent("onEnabledChange",t)},$.prototype.setPortGroup=function(t,e){for(let i=0;i<e.length;i++)e[i]&&e[i].setUiAttribs?e[i].setUiAttribs({group:t}):this._log.error("setPortGroup: invalid port!")},$.prototype.setUiAxisPorts=function(t,e,i){t&&t.setUiAttribs({axis:"X"}),e&&e.setUiAttribs({axis:"Y"}),i&&i.setUiAttribs({axis:"Z"})},$.prototype.removePort=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e]==t)return this.portsIn.splice(e,1),this.fireEvent("onUiAttribsChange",{}),void this.fireEvent("onPortRemoved",{})},$.prototype._checkLinksNeededToWork=function(){},$.prototype.toWorkNeedsParent=function(t){this.patch.isEditorMode()&&(this._needsParentOp=t)},$.prototype.toWorkPortsNeedToBeLinked=function(){if(this.patch.isEditorMode())for(let t=0;t<arguments.length;t++)-1==this._needsLinkedToWork.indexOf(arguments[t])&&this._needsLinkedToWork.push(arguments[t])},$.prototype.toWorkPortsNeedToBeLinkedReset=function(){this.patch.isEditorMode()&&(this._needsLinkedToWork.length=0,this.checkLinkTimeWarnings&&this.checkLinkTimeWarnings())},$.prototype.initVarPorts=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].getVariableName()&&this.portsIn[t].setVariable(this.portsIn[t].getVariableName())},$.prototype.refreshParams=function(){this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp()&&gui.opParams.show(this)},$.prototype.isCurrentUiOp=function(){if(this.patch.isEditorMode())return gui.patchView.isCurrentOp(this)}}$.getNamespaceClassName=function(t){return t?t.startsWith("Ops.Gl")?"gl":t.startsWith("Ops.WebAudio")?"audio":t.startsWith("Ops.Devices")?"devices":t.startsWith("Ops.Html")||t.startsWith("Ops.Sidebar")?"html":t.startsWith("Ops.Math")?"math":t.startsWith("Ops.User")?"user":"default":"default"},$.isSubpatchOp=function(t){return"Ops.Ui.Patch"==t||"Ops.Ui.SubPatch"==t};const tt=function(t,e){if(!t)throw new Error("no cgl");this._log=new _("cgl_texture"),this._cgl=t,this.tex=this._cgl.gl.createTexture(),this.id=A(),this.width=0,this.height=0,this.loading=!1,this.flip=!0,this.flipped=!1,this.shadowMap=!1,this.deleted=!1,this.image=null,this.anisotropic=0,this.filter=tt.FILTER_NEAREST,this.wrap=tt.WRAP_CLAMP_TO_EDGE,this.texTarget=this._cgl.gl.TEXTURE_2D,e&&e.type&&(this.texTarget=e.type),this.textureType=tt.TYPE_DEFAULT,this.unpackAlpha=!0,this._fromData=!0,this.name="unknown",e?(this.name=e.name||this.name,e.isDepthTexture&&(this.textureType=tt.TYPE_DEPTH),e.isFloatingPointTexture&&(this.textureType=tt.TYPE_FLOAT),"textureType"in e&&(this.textureType=e.textureType),"filter"in e&&(this.filter=e.filter),"wrap"in e&&(this.wrap=e.wrap),"unpackAlpha"in e&&(this.unpackAlpha=e.unpackAlpha),"flip"in e&&(this.flip=e.flip),"shadowMap"in e&&(this.shadowMap=e.shadowMap),"anisotropic"in e&&(this.anisotropic=e.anisotropic)):e={},e.width||(e.width=8),e.height||(e.height=8),this._cgl.profileData.profileTextureNew++,this._cgl.profileData.addHeavyEvent("texture created",this.name,e.width+"x"+e.height),this.setSize(e.width,e.height),this.getInfoOneLine()};tt.prototype.isFloatingPoint=function(){return this.textureType==tt.TYPE_FLOAT},tt.prototype.compareSettings=function(t){return!!t&&(t.width==this.width&&t.height==this.height&&t.filter==this.filter&&t.wrap==this.wrap&&t.textureType==this.textureType&&t.unpackAlpha==this.unpackAlpha&&t.anisotropic==this.anisotropic&&t.shadowMap==this.shadowMap&&t.texTarget==this.texTarget&&t.flip==this.flip)},tt.prototype.clone=function(){const t=new tt(this._cgl,{name:this.name,filter:this.filter,wrap:this.wrap,textureType:this.textureType,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});return this.compareSettings(t)||(this._log.error("Cloned texture settings do not compare!"),this._log.error(this),this._log.error(t)),t},tt.prototype.setSize=function(t,e){if((t!=t||t<=0||!t)&&(t=8),(e!=e||e<=0||!e)&&(e=8),(t>this._cgl.maxTexSize||e>this._cgl.maxTexSize)&&this._log.error("texture size too big! "+t+"x"+e+" / max: "+this._cgl.maxTexSize),t=Math.min(t,this._cgl.maxTexSize),e=Math.min(e,this._cgl.maxTexSize),t=Math.floor(t),e=Math.floor(e),this.width==t&&this.height==e)return;this.width=t,this.height=e,this.deleted=!1,this.shortInfoString=this.getInfoOneLine(),this._cgl.gl.bindTexture(this.texTarget,this.tex),this._cgl.profileData.profileTextureResize++;if(this.textureType!=tt.TYPE_FLOAT||this.filter!=tt.FILTER_LINEAR||this._cgl.gl.getExtension("OES_texture_float_linear")||(console.warn("this graphics card does not support floating point texture linear interpolation! using NEAREST"),this.filter=tt.FILTER_NEAREST),this.textureType==tt.TYPE_FLOAT)if(1==this._cgl.glVersion)if(this._cgl.glUseHalfFloatTex){const i=this._cgl.gl.getExtension("OES_texture_half_float");if(1==this._cgl.glVersion&&!i)throw new Error("no half float texture extension");this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,i.HALF_FLOAT_OES,null)}else{this._cgl.gl.getExtension("OES_texture_float");this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null)}else this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this.textureType==tt.TYPE_DEPTH)if(1==this._cgl.glVersion){const i=this._cgl.gl.DEPTH_COMPONENT;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.UNSIGNED_SHORT,null)}else{const i=this._cgl.gl.DEPTH_COMPONENT32F;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.FLOAT,null)}else this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,null);this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null)},tt.prototype.initFromData=function(t,e,i,s,r){this.filter=s,this.wrap=r,null==s&&(this.filter=tt.FILTER_LINEAR),null==r&&(this.wrap=tt.CLAMP_TO_EDGE),this.width=e,this.height=i,this._fromData=!0,this.deleted=!1,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip),this._cgl.gl.bindTexture(this.texTarget,this.tex),this.textureType==tt.TYPE_FLOAT?this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,t):this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this._cgl.gl.bindTexture(this.texTarget,null)},tt.prototype.updateMipMap=function(){2!=this._cgl.glVersion&&!this.isPowerOfTwo()||this.filter!=tt.FILTER_MIPMAP||(this._cgl.gl.generateMipmap(this.texTarget),this._cgl.profileData.profileGenMipMap++)},tt.prototype.initTexture=function(t,e){this._cgl.checkFrameStarted("texture inittexture"),this._fromData=!1,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),t.width&&(this.width=t.width),t.height&&(this.height=t.height),e&&(this.filter=e),t.width>this._cgl.maxTexSize&&this._log.error("[cgl_texture] texture size to big!!!",t.width,this._cgl.maxTexSize),t.height>this._cgl.maxTexSize&&this._log.error("[cgl_texture] texture size to big!!!",t.height,this._cgl.maxTexSize),this._cgl.gl.bindTexture(this.texTarget,this.tex),this.deleted=!1,this.flipped=!this.flip,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null),this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.getInfoOneLine()},tt.prototype.delete=function(){this.loading||(this.deleted=!0,this.width=0,this.height=0,this._cgl.profileData.profileTextureDelete++,this._cgl.gl.deleteTexture(this.tex),this.image=null,this.tex=null)},tt.prototype.isPowerOfTwo=function(){return tt.isPowerOfTwo(this.width)&&tt.isPowerOfTwo(this.height)},tt.prototype.printInfo=function(){console.log(this.getInfo())},tt.prototype.getInfoReadable=function(){const t=this.getInfo();let e="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const i in t)e+="* "+i+":  **"+t[i]+"**\n";return e},tt.prototype.getInfoOneLine=function(){let t=this.width+"x"+this.height;return this.textureType===CGL.Texture.TYPE_FLOAT&&(t+=" HDR"),this.filter===CGL.Texture.FILTER_NEAREST&&(t+=" nearest"),this.filter===CGL.Texture.FILTER_LINEAR&&(t+=" linear"),this.filter===CGL.Texture.FILTER_MIPMAP&&(t+=" mipmap"),this.wrap===CGL.Texture.WRAP_CLAMP_TO_EDGE&&(t+=" clamp"),this.wrap===CGL.Texture.WRAP_REPEAT&&(t+=" repeat"),this.wrap===CGL.Texture.WRAP_MIRRORED_REPEAT&&(t+=" repeatmir"),this.shortInfoString=t,t},tt.prototype.getInfo=function(){const t={};t.name=this.name,t["power of two"]=this.isPowerOfTwo(),t.size=this.width+" x "+this.height;let e=this.texTarget;return this.texTarget==this._cgl.gl.TEXTURE_2D&&(e="TEXTURE_2D"),t.target=e,t.unpackAlpha=this.unpackAlpha,this.textureType==tt.TYPE_FLOAT?t.textureType="TYPE_FLOAT":this.textureType==tt.TYPE_DEPTH?t.textureType="TYPE_DEPTH":this.textureType==tt.TYPE_DEFAULT?t.textureType="TYPE_DEFAULT":t.textureType="UNKNOWN",this.wrap==tt.WRAP_CLAMP_TO_EDGE?t.wrap="CLAMP_TO_EDGE":this.wrap==tt.WRAP_REPEAT?t.wrap="WRAP_REPEAT":this.wrap==tt.WRAP_MIRRORED_REPEAT?t.wrap="WRAP_MIRRORED_REPEAT":t.wrap="UNKNOWN",this.filter==tt.FILTER_NEAREST?t.filter="FILTER_NEAREST":this.filter==tt.FILTER_LINEAR?t.filter="FILTER_LINEAR":this.filter==tt.FILTER_MIPMAP?t.filter="FILTER_MIPMAP":t.filter="UNKNOWN",t},tt.prototype._setFilter=function(){if(this._fromData||this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),this.shadowMap&&(this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE),this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)),this.textureType==tt.TYPE_FLOAT&&this.filter==tt.FILTER_MIPMAP&&(this.filter=tt.FILTER_LINEAR,this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")),1!=this._cgl.glVersion||this.isPowerOfTwo()){if(this.wrap==tt.WRAP_CLAMP_TO_EDGE?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)):this.wrap==tt.WRAP_REPEAT?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)):this.wrap==tt.WRAP_MIRRORED_REPEAT&&(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)),this.filter==tt.FILTER_NEAREST)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);else if(this.filter==tt.FILTER_LINEAR)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);else{if(this.filter!=tt.FILTER_MIPMAP)throw this._log.log("unknown texture filter!",this.filter),new Error("unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}if(this.anisotropic){const t=this._cgl.gl.getExtension("EXT_texture_filter_anisotropic");if(t){const e=this._cgl.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this.anisotropic))}}}else this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE),this.filter=tt.FILTER_NEAREST,this.wrap=tt.WRAP_CLAMP_TO_EDGE;this.getInfoOneLine()},tt.load=function(t,e,i,s){if(!e)return i({error:!0});let r=null;t.patch.loading.existByName(e)||(r=t.patch.loading.start("texture",e));const n=new tt(t);return n.name=e,t.patch.isEditorMode()&&gui.jobs().start({id:"loadtexture"+r,title:"loading texture "+CABLES.basename(e)}),n.image=new Image,n.image.crossOrigin="anonymous",n.loading=!0,s&&s.hasOwnProperty("filter")&&(n.filter=s.filter),s&&s.hasOwnProperty("flip")&&(n.flip=s.flip),s&&s.hasOwnProperty("wrap")&&(n.wrap=s.wrap),s&&s.hasOwnProperty("anisotropic")&&(n.anisotropic=s.anisotropic),s&&s.hasOwnProperty("unpackAlpha")&&(n.unpackAlpha=s.unpackAlpha),n.image.onabort=n.image.onerror=s=>{console.warn("[cgl.texture.load] error loading texture",e,s),n.loading=!1,r&&t.patch.loading.finished(r);i&&i({error:!0},n),t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r)},n.image.onload=function(e){t.addNextFrameOnceCallback(()=>{n.initTexture(n.image),r&&t.patch.loading.finished(r),n.loading=!1,t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r),i&&i(null,n)})},n.image.src=e,n},tt.getTempTexture=function(t){return t||console.error("[getTempTexture] no cgl!"),t.tempTexture||(t.tempTexture=tt.getTemporaryTexture(t,256,tt.FILTER_LINEAR,tt.REPEAT)),t.tempTexture},tt.getEmptyTexture=function(t){if(t||console.error("[getEmptyTexture] no cgl!"),t.tempTextureEmpty)return t.tempTextureEmpty;t.tempTextureEmpty=new tt(t,{name:"emptyTexture"});const e=new Uint8Array(256);return t.tempTextureEmpty.initFromData(e,8,8,tt.FILTER_NEAREST,tt.WRAP_REPEAT),t.tempTextureEmpty},tt.getRandomTexture=function(t){if(t||console.error("[getRandomTexture] no cgl!"),t.randomTexture)return t.randomTexture;const e=new Uint8Array(262144);for(let t=0;t<65536;t++)e[4*t+0]=255*Math.random(),e[4*t+1]=255*Math.random(),e[4*t+2]=255*Math.random(),e[4*t+3]=255;return t.randomTexture=new tt(t),t.randomTexture.initFromData(e,256,256,tt.FILTER_NEAREST,tt.WRAP_REPEAT),t.randomTexture},tt.getBlackTexture=function(t){if(t||this._log.error("[getBlackTexture] no cgl!"),t.blackTexture)return t.blackTexture;const e=new Uint8Array(256);for(let t=0;t<64;t++)e[4*t+0]=e[4*t+1]=e[4*t+2]=0,e[4*t+3]=255;return t.blackTexture=new tt(t),t.blackTexture.initFromData(e,8,8,tt.FILTER_NEAREST,tt.WRAP_REPEAT),t.blackTexture},tt.getEmptyCubemapTexture=function(t){const e=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],i=t.gl.createTexture(),s=t.gl.TEXTURE_CUBE_MAP,r=tt.FILTER_NEAREST,n=tt.WRAP_CLAMP_TO_EDGE;t.profileData.profileTextureNew++,t.gl.bindTexture(s,i),t.profileData.profileTextureResize++;for(let i=0;i<6;i+=1){const r=new Uint8Array(256);t.gl.texImage2D(e[i],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,r),t.gl.texParameteri(s,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}return t.gl.bindTexture(s,null),{id:CABLES.uuid(),tex:i,cubemap:i,width:8,height:8,filter:r,wrap:n,unpackAlpha:!0,flip:!0,_fromData:!0,name:"emptyCubemapTexture",anisotropic:0}},tt.getTempGradientTexture=function(t){if(t||console.error("[getTempGradientTexture] no cgl!"),t.tempTextureGradient)return t.tempTextureGradient;const e=new tt(t),i=new Uint8Array(262144);for(let t=0;t<256;t++)for(let e=0;e<256;e++)i[4*(e+256*t)+0]=i[4*(e+256*t)+1]=i[4*(e+256*t)+2]=255-t,i[4*(e+256*t)+3]=255;return e.initFromData(i,256,256,tt.FILTER_NEAREST,tt.WRAP_REPEAT),t.tempTextureGradient=e,e},tt.getTemporaryTexture=function(t,e,i,s){const r=new tt(t),n=[];for(let t=0;t<e;t++)for(let i=0;i<e;i++)(i+t)%64<32?(n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25)):(n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25)),n.push(255);const o=new Uint8Array(n);return r.initFromData(o,e,e,i,s),r},tt.createFromImage=function(t,e,i){const s=new tt(t,i=i||{});return s.flip=!1,s.image=e,s.width=e.width,s.height=e.height,s.initTexture(e,i.filter),s},tt.fromImage=function(t,e,i,s){console.error("deprecated texture from image...");const r=new tt(t);return r.flip=!1,i&&(r.filter=i),s&&(r.wrap=s),r.image=e,r.initTexture(e),r},tt.isPowerOfTwo=function(t){return 1==t||2==t||4==t||8==t||16==t||32==t||64==t||128==t||256==t||512==t||1024==t||2048==t||4096==t||8192==t||16384==t},tt.FILTER_NEAREST=0,tt.FILTER_LINEAR=1,tt.FILTER_MIPMAP=2,tt.WRAP_REPEAT=0,tt.WRAP_MIRRORED_REPEAT=1,tt.WRAP_CLAMP_TO_EDGE=2,tt.TYPE_DEFAULT=0,tt.TYPE_DEPTH=1,tt.TYPE_FLOAT=2;const et=function(t,e,i,s){this._log=new _("cgl_framebuffer2"),this.Framebuffer2DrawTargetsDefault=null,this.Framebuffer2BlittingFramebuffer=null,this.Framebuffer2FinalFramebuffer=null,this._cgl=t,this._width=0,this._height=0,this._depthRenderbuffer=null,this._frameBuffer=null,this._textureFrameBuffer=null,this._colorRenderbuffers=[],this._drawTargetArray=[],this.Framebuffer2BlittingFramebuffer||(this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2FinalFramebuffer||(this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2DrawTargetsDefault||(this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0]),this._options=s||{isFloatingPointTexture:!1},this.name=this._options.name||"unknown",this._cgl.profileData.addHeavyEvent("framebuffer create",this.name),this._options.hasOwnProperty("numRenderBuffers")||(this._options.numRenderBuffers=1),this._options.hasOwnProperty("depth")||(this._options.depth=!0),this._options.hasOwnProperty("clear")||(this._options.clear=!0),this._options.hasOwnProperty("multisampling")||(this._options.multisampling=!1,this._options.multisamplingSamples=0),this._options.multisamplingSamples&&(this._cgl.glSlowRenderer&&(this._options.multisamplingSamples=0),this._cgl.gl.MAX_SAMPLES?this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples):this._options.multisamplingSamples=0),this._options.hasOwnProperty("filter")||(this._options.filter=tt.FILTER_LINEAR),this._options.hasOwnProperty("wrap")||(this._options.wrap=tt.WRAP_REPEAT),this._numRenderBuffers=this._options.numRenderBuffers,this._colorTextures=[];for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e]=new tt(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,filter:this._options.filter,wrap:this._options.wrap});let r=tt.FILTER_NEAREST;this._options.shadowMap&&(r=tt.FILTER_LINEAR);this._options.depth&&(this._textureDepth=new tt(t,{name:"fb2 depth "+this.name,isDepthTexture:!0,filter:r,shadowMap:this._options.shadowMap||!1,width:e||512,height:i||512})),t.aborted||this.setSize(e||512,i||512)};et.prototype.getWidth=function(){return this._width},et.prototype.getHeight=function(){return this._height},et.prototype.getGlFrameBuffer=function(){return this._frameBuffer},et.prototype.getDepthRenderBuffer=function(){return this._depthRenderbuffer},et.prototype.getTextureColor=function(){return this._colorTextures[0]},et.prototype.getTextureColorNum=function(t){return this._colorTextures[t]},et.prototype.getTextureDepth=function(){return this._textureDepth},et.prototype.setFilter=function(t){for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].filter=t,this._colorTextures[e].setSize(this._width,this._height)},et.prototype.delete=et.prototype.dispose=function(){let t=0;for(t=0;t<this._numRenderBuffers;t++)this._colorTextures[t].delete();for(this._textureDepth&&this._textureDepth.delete(),t=0;t<this._numRenderBuffers;t++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[t]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)},et.prototype.setSize=function(t,e){this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;if(this._width=Math.floor(t),this._height=Math.floor(e),this._width=Math.min(this._width,this._cgl.maxTexSize),this._height=Math.min(this._height,this._cgl.maxTexSize),this._cgl.profileData.profileFrameBuffercreate++,this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer(),this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const s=this._options.depth;for(i=0;i<this._numRenderBuffers;i++)this._colorTextures[i].setSize(this._width,this._height);for(i=0;i<this._numRenderBuffers;i++){const t=this._cgl.gl.createRenderbuffer();this._cgl.gl.getExtension("EXT_color_buffer_float");this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,t),this._options.isFloatingPointTexture?this._options.multisampling&&this._options.multisamplingSamples?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA32F,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA32F,this._width,this._height):this._options.multisampling&&this._options.multisamplingSamples?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA8,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA8,this._width,this._height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,t),this._colorRenderbuffers[i]=t}for(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer),i=0;i<this._numRenderBuffers;i++)this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0);this._options.depth&&this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;for(this._cgl.glSlowRenderer&&(r=this._cgl.gl.DEPTH_COMPONENT16),s&&(this._textureDepth.setSize(this._width,this._height),this._depthRenderbuffer=this._cgl.gl.createRenderbuffer(),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._options.isFloatingPointTexture,this._options.multisampling?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)),this._drawTargetArray.length=0,i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);this._cgl.gl.isFramebuffer(this._textureFrameBuffer)||this._this._log.warn("invalid framebuffer");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(n!=this._cgl.gl.FRAMEBUFFER_COMPLETE)switch(this._log.error("framebuffer incomplete: "+this.name,this),n){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw this._log.warn("incomplete framebuffer",n),new Error("Incomplete framebuffer: "+n)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)},et.prototype.renderStart=function(){this._cgl.checkFrameStarted("fb2 renderstart"),this._cgl.pushModelMatrix(),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.pushGlFrameBuffer(this._frameBuffer),this._cgl.pushFrameBuffer(this),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this._width,this._height),this._cgl.gl.drawBuffers(this._drawTargetArray),this._options.clear&&(this._cgl.gl.clearColor(0,0,0,0),this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT))},et.prototype.renderEnd=function(){if(this._cgl.popPMatrix(),this._cgl.profileData.profileFramebuffer++,this._numRenderBuffers<=1)this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST);else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);let e=this._cgl.gl.COLOR_BUFFER_BIT;0==t&&(e|=this._cgl.gl.DEPTH_BUFFER_BIT),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}if(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.popFrameBuffer(),this._cgl.popModelMatrix(),this._cgl.resetViewPort(),this._colorTextures[0].filter==tt.FILTER_MIPMAP)for(let t=0;t<this._numRenderBuffers;t++)this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex),this._colorTextures[t].updateMipMap(),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)};class it{constructor(t){this._init(),this._first=!0,this._wireMesh=null,t&&this.apply(t)}_init(){this._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],this._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this._center=[0,0,0],this._size=[0,0,0],this._maxAxis=0,this._first=!0}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(t,e){if(t){if(t instanceof it){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ),this.applyPos(e.minX,e.minY,e.minZ)}else for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);this.calcCenterSize()}}copy(){return new it(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(t,e,i){if(t!=Number.MAX_VALUE&&t!=-Number.MAX_VALUE&&e!=Number.MAX_VALUE&&e!=-Number.MAX_VALUE&&i!=Number.MAX_VALUE&&i!=-Number.MAX_VALUE&&CABLES.UTILS.isNumeric(t)&&CABLES.UTILS.isNumeric(e)&&CABLES.UTILS.isNumeric(i)){if(this._first)return this._max[0]=t,this._max[1]=e,this._max[2]=i,this._min[0]=t,this._min[1]=e,this._min[2]=i,void(this._first=!1);this._max[0]=Math.max(this._max[0],t),this._max[1]=Math.max(this._max[1],e),this._max[2]=Math.max(this._max[2],i),this._min[0]=Math.min(this._min[0],t),this._min[1]=Math.min(this._min[1],e),this._min[2]=Math.min(this._min[2],i)}}calcCenterSize(){this._first||(this._size[0]=this._max[0]-this._min[0],this._size[1]=this._max[1]-this._min[1],this._size[2]=this._max[2]-this._min[2],this._center[0]=(this._min[0]+this._max[0])/2,this._center[1]=(this._min[1]+this._max[1])/2,this._center[2]=(this._min[2]+this._max[2])/2,this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1])))}mulMat4(t){this._first&&(this._max[0]=0,this._max[1]=0,this._max[2]=0,this._min[0]=0,this._min[1]=0,this._min[2]=0,this._first=!1),vec3.transformMat4(this._max,this._max,t),vec3.transformMat4(this._min,this._min,t),this.calcCenterSize()}render(t,e){this._wireMesh||(this._wireMesh=new CGL.WireCube(t)),t.pushModelMatrix(),mat4.translate(t.mMatrix,t.mMatrix,this._center),this._wireMesh.render(t,this._size[0]/2,this._size[1]/2,this._size[2]/2),t.popModelMatrix()}}const st=function(t){this.name=t||"unknown",this._log=new _("cgl_geometry"),this.faceVertCount=3,this._vertices=[],this.verticesIndices=[],this.texCoords=new Float32Array,this.texCoordsIndices=[],this.vertexNormals=[],this.tangents=[],this.biTangents=[],this.barycentrics=[],this.morphTargets=[],this.vertexColors=[],this._attributes={},this.glPrimitive=null,Object.defineProperty(this,"vertices",{get(){return this._vertices},set(t){this.setVertices(t)}})};st.prototype.clear=function(){this.vertices=new Float32Array([]),this.verticesIndices.length=0,this.texCoords=new Float32Array([]),this.texCoordsIndices.length=0,this.vertexNormals=new Float32Array([])},st.prototype.getAttributes=function(){return this._attributes},st.prototype.getAttribute=function(t){for(const e in this._attributes)if(this._attributes[e].name==t)return this._attributes[e];return null},st.prototype.setAttribute=function(t,e,i){let s="";1==i?s="float":2==i?s="vec2":3==i?s="vec3":4==i&&(s="vec4");const r={name:t,data:e,itemSize:i,type:s};this._attributes[t]=r},st.prototype.setVertices=function(t){t instanceof Float32Array?this._vertices=t:this._vertices=new Float32Array(t)},st.prototype.setTexCoords=function(t){t instanceof Float32Array?this.texCoords=t:this.texCoords=new Float32Array(t)},st.prototype.calcNormals=function(t){t||this.unIndex(),this.calculateNormals({})},st.prototype.setPointVertices=function(t){if(t.length%3==0){t instanceof Float32Array?this.vertices=t:this.vertices=new Float32Array(t),this.texCoords instanceof Float32Array||(this.texCoords=new Float32Array(t.length/3*2)),this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++)this.verticesIndices[e]=e,this.texCoords[2*e]=0,this.texCoords[2*e+1]=0}else this._log.error("SetPointVertices: Array must be multiple of three.")},st.prototype.merge=function(t){if(!t)return;const e=this.verticesIndices.length,i=this.vertices.length/3;this.verticesIndices.length=this.verticesIndices.length+t.verticesIndices.length;for(let s=0;s<t.verticesIndices.length;s++)this.verticesIndices[e+s]=t.verticesIndices[s]+i;this.vertices=g.float32Concat(this.vertices,t.vertices),this.texCoords=g.float32Concat(this.texCoords,t.texCoords),this.vertexNormals=g.float32Concat(this.vertexNormals,t.vertexNormals),this.tangents=g.float32Concat(this.tangents,t.tangents),this.biTangents=g.float32Concat(this.biTangents,t.biTangents)},st.prototype.copy=function(){let t=0;const e=new st(this.name+" copy");if(e.faceVertCount=this.faceVertCount,e.setVertices(this._vertices.slice(0)),this.verticesIndices)for(e.verticesIndices.length=this.verticesIndices.length,t=0;t<this.verticesIndices.length;t++)e.verticesIndices[t]=this.verticesIndices[t];for(e.texCoords=new Float32Array(this.texCoords.length),t=0;t<this.texCoords.length;t++)e.texCoords[t]=this.texCoords[t];for(e.texCoordsIndices.length=this.texCoordsIndices.length,t=0;t<this.texCoordsIndices.length;t++)e.texCoordsIndices[t]=this.texCoordsIndices[t];for(e.vertexNormals=new Float32Array(this.vertexNormals.length),t=0;t<this.vertexNormals.length;t++)e.vertexNormals[t]=this.vertexNormals[t];if(this.tangents)for(e.tangents=[],e.tangents.length=this.tangents.length,t=0;t<this.tangents.length;t++)e.tangents[t]=this.tangents[t];if(this.biTangents)for(e.biTangents=[],e.biTangents.length=this.biTangents.length,t=0;t<this.biTangents.length;t++)e.biTangents[t]=this.biTangents[t];for(e.barycentrics.length=this.barycentrics.length,t=0;t<this.barycentrics.length;t++)e.barycentrics[t]=this.barycentrics[t];for(e.morphTargets.length=this.morphTargets.length,t=0;t<this.morphTargets.length;t++)e.morphTargets[t]=this.morphTargets[t];for(e.vertexColors.length=this.vertexColors.length,t=0;t<this.vertexColors.length;t++)e.vertexColors[t]=this.vertexColors[t];return e},st.prototype.calculateNormals=function(t){const e=vec3.create(),i=vec3.create(),s=vec3.create();function r(r){return vec3.subtract(e,r[0],r[1]),vec3.subtract(i,r[0],r[2]),vec3.cross(s,e,i),vec3.normalize(s,s),t&&t.forceZUp&&s[2]<0&&(s[0]*=-1,s[1]*=-1,s[2]*=-1),s}this.getVertexVec=function(t){const e=[0,0,0];return e[0]=this.vertices[3*t+0],e[1]=this.vertices[3*t+1],e[2]=this.vertices[3*t+2],e},this.vertexNormals instanceof Float32Array&&this.vertexNormals.length==this.vertices.length||(this.vertexNormals=new Float32Array(this.vertices.length));for(let t=0;t<this.vertices.length;t++)this.vertexNormals[t]=0;if(this.isIndexed()){const t=[];t.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const i=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];t[e/3]=r(i),this.vertexNormals[3*this.verticesIndices[e+0]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+0]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+0]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+1]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+1]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+1]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+2]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+2]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+2]+2]+=t[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3)for(let e=0;e<3;e++){const i=[this.vertexNormals[3*this.verticesIndices[t+e]+0],this.vertexNormals[3*this.verticesIndices[t+e]+1],this.vertexNormals[3*this.verticesIndices[t+e]+2]];vec3.normalize(i,i),this.vertexNormals[3*this.verticesIndices[t+e]+0]=i[0],this.vertexNormals[3*this.verticesIndices[t+e]+1]=i[1],this.vertexNormals[3*this.verticesIndices[t+e]+2]=i[2]}}else{const t=[];for(let e=0;e<this.vertices.length;e+=9){const i=r([[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]]);t.push(i[0],i[1],i[2],i[0],i[1],i[2],i[0],i[1],i[2])}this.vertexNormals=t}},st.prototype.calcTangentsBitangents=function(){if(!this.vertices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertices.");if(!this.vertexNormals.length)return void this._log.error("Cannot calculate tangents/bitangents without normals.");if(!this.texCoords.length){const t=this.vertices.length/3*2;this.texCoords=new Float32Array(t);for(let e=0;e<t;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertex indices.");if(this.verticesIndices.length%3!=0)return void this._log.error("Vertex indices mismatch!");const t=this.verticesIndices.length/3,e=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length),this.biTangents=new Float32Array(this.vertexNormals.length);const i=[];i.length=2*e;const s=vec3.create(),r=vec3.create(),n=vec3.create(),o=vec2.create(),h=vec2.create(),a=vec2.create(),l=vec3.create(),c=vec3.create();for(let u=0;u<t;u+=1){const t=this.verticesIndices[3*u],_=this.verticesIndices[3*u+1],p=this.verticesIndices[3*u+2];vec3.set(s,this.vertices[3*t],this.vertices[3*t+1],this.vertices[3*t+2]),vec3.set(r,this.vertices[3*_],this.vertices[3*_+1],this.vertices[3*_+2]),vec3.set(n,this.vertices[3*p],this.vertices[3*p+1],this.vertices[3*p+2]),vec2.set(o,this.texCoords[2*t],this.texCoords[2*t+1]),vec2.set(h,this.texCoords[2*_],this.texCoords[2*_+1]),vec2.set(a,this.texCoords[2*p],this.texCoords[2*p+1]);const g=r[0]-s[0],d=n[0]-s[0],f=r[1]-s[1],m=n[1]-s[1],E=r[2]-s[2],T=n[2]-s[2],A=h[0]-o[0],b=a[0]-o[0],y=h[1]-o[1],v=a[1]-o[1],x=1/(A*v-b*y);vec3.set(l,(v*g-y*d)*x,(v*f-y*m)*x,(v*E-y*T)*x),vec3.set(c,(A*d-b*g)*x,(A*m-b*f)*x,(A*T-b*E)*x),i[t]=l,i[_]=l,i[p]=l,i[t+e]=c,i[_+e]=c,i[p+e]=c}const u=vec3.create(),_=vec3.create(),p=vec3.create(),g=vec3.create(),d=vec3.create(),f=vec3.create(),m=vec3.create(),E=vec3.create();for(let t=0;t<e;t+=1){if(!i[t])continue;vec3.set(u,this.vertexNormals[3*t],this.vertexNormals[3*t+1],this.vertexNormals[3*t+2]),vec3.set(_,i[t][0],i[t][1],i[t][2]);const s=vec3.dot(u,_);vec3.scale(d,u,s),vec3.subtract(f,_,d),vec3.normalize(E,f),vec3.cross(m,u,_);vec3.dot(m,i[t+e]);const r=1;vec3.scale(p,E,1/r),vec3.cross(g,u,p),this.tangents[3*t+0]=p[0],this.tangents[3*t+1]=p[1],this.tangents[3*t+2]=p[2],this.biTangents[3*t+0]=g[0],this.biTangents[3*t+1]=g[1],this.biTangents[3*t+2]=g[2]}},st.prototype.isIndexed=function(){return 0!=this.verticesIndices.length},st.prototype.unIndex=function(t,e){const i=[],s=[],r=[],n=[],o=[],h=[];let a=0,l=0;for(l=0;l<this.verticesIndices.length;l+=3)i.push(this.vertices[3*this.verticesIndices[l+0]+0],this.vertices[3*this.verticesIndices[l+0]+1],this.vertices[3*this.verticesIndices[l+0]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+0]+0],this.vertexNormals[3*this.verticesIndices[l+0]+1],this.vertexNormals[3*this.verticesIndices[l+0]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+0]+0],this.tangents[3*this.verticesIndices[l+0]+1],this.tangents[3*this.verticesIndices[l+0]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+0]+0],this.biTangents[3*this.verticesIndices[l+0]+1],this.biTangents[3*this.verticesIndices[l+0]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+0]+0],this.texCoords[2*this.verticesIndices[l+0]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+1]+0],this.vertices[3*this.verticesIndices[l+1]+1],this.vertices[3*this.verticesIndices[l+1]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+1]+0],this.vertexNormals[3*this.verticesIndices[l+1]+1],this.vertexNormals[3*this.verticesIndices[l+1]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+1]+0],this.tangents[3*this.verticesIndices[l+1]+1],this.tangents[3*this.verticesIndices[l+1]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+1]+0],this.biTangents[3*this.verticesIndices[l+1]+1],this.biTangents[3*this.verticesIndices[l+1]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+1]+0],this.texCoords[2*this.verticesIndices[l+1]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+2]+0],this.vertices[3*this.verticesIndices[l+2]+1],this.vertices[3*this.verticesIndices[l+2]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+2]+0],this.vertexNormals[3*this.verticesIndices[l+2]+1],this.vertexNormals[3*this.verticesIndices[l+2]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+2]+0],this.tangents[3*this.verticesIndices[l+2]+1],this.tangents[3*this.verticesIndices[l+2]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+2]+0],this.biTangents[3*this.verticesIndices[l+2]+1],this.biTangents[3*this.verticesIndices[l+2]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+2]+0],this.texCoords[2*this.verticesIndices[l+2]+1]):r.push(0,0),s.push(a),a++;this.vertices=i,this.texCoords=r,this.vertexNormals=n,o.length>0&&(this.tangents=o),h.length>0&&(this.biTangents=h),this.verticesIndices.length=0,t&&(this.verticesIndices=s),e||this.calculateNormals()},st.prototype.calcBarycentric=function(){this.barycentrics.length=this.vertices.length;let t=0;for(t=0;t<this.vertices.length;t++)this.barycentrics[t]=0;let e=0;for(t=0;t<this.vertices.length;t+=3)this.barycentrics[t+e]=1,e++,3==e&&(e=0)},st.prototype.getBounds=function(){return new it(this)},st.prototype.center=function(t,e,i){void 0===t&&(t=!0,e=!0,i=!0);let s=0;const r=this.getBounds(),n=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(s=0;s<this.vertices.length;s+=3)this.vertices[s+0]==this.vertices[s+0]&&(t&&(this.vertices[s+0]-=n[0]),e&&(this.vertices[s+1]-=n[1]),i&&(this.vertices[s+2]-=n[2]));return n},st.prototype.mapTexCoords2d=function(){const t=this.getBounds(),e=this.vertices.length/3;this.texCoords=new Float32Array(2*e);for(let i=0;i<e;i++){const e=this.vertices[3*i+0],s=this.vertices[3*i+1];this.texCoords[2*i+0]=e/(t.maxX-t.minX)+.5,this.texCoords[2*i+1]=1-s/(t.maxY-t.minY)+.5}},st.buildFromFaces=function(t,e){const i=[],s=[];for(let e=0;e<t.length;e+=3){const r=t[e+0],n=t[e+1],o=t[e+2],h=[-1,-1,-1];for(let t=0;t<i;t+=3)i[t+0]==r[0]&&i[t+1]==r[1]&&i[t+2]==r[2]&&(h[0]=t/3),i[t+0]==n[0]&&i[t+1]==n[1]&&i[t+2]==n[2]&&(h[1]=t/3),i[t+0]==o[0]&&i[t+1]==o[1]&&i[t+2]==o[2]&&(h[2]=t/3);-1==h[0]&&(i.push(r[0],r[1],r[2]),h[0]=(i.length-1)/3),-1==h[1]&&(i.push(n[0],n[1],n[2]),h[1]=(i.length-1)/3),-1==h[2]&&(i.push(o[0],o[1],o[2]),h[2]=(i.length-1)/3),s.push(parseInt(h[0],10)),s.push(parseInt(h[1],10)),s.push(parseInt(h[2],10))}const r=new st(this.name);return r.name=e,r.vertices=i,r.verticesIndices=s,r},st.json2geom=function(t){const e=new st("jsonMeshGeom");if(e.verticesIndices=[],e.vertices=t.vertices||[],e.vertexNormals=t.normals||[],e.vertexColors=t.colors||[],e.tangents=t.tangents||[],e.biTangents=t.bitangents||[],t.texturecoords&&e.setTexCoords(t.texturecoords[0]),t.vertices_b64&&(e.vertices=new Float32Array(u(t.vertices_b64))),t.normals_b64&&(e.vertexNormals=new Float32Array(u(t.normals_b64))),t.tangents_b64&&(e.tangents=new Float32Array(u(t.tangents_b64))),t.bitangents_b64&&(e.biTangents=new Float32Array(u(t.bitangents_b64))),t.texturecoords_b64&&e.setTexCoords(new Float32Array(u(t.texturecoords_b64[0]))),t.faces_b64)e.verticesIndices=new Uint32Array(u(t.faces_b64));else{e.verticesIndices.length=3*t.faces.length;for(let i=0;i<t.faces.length;i++)e.verticesIndices[3*i]=t.faces[i][0],e.verticesIndices[3*i+1]=t.faces[i][1],e.verticesIndices[3*i+2]=t.faces[i][2]}return e};const rt=function(t,e,i,s,r,n,o,h,a,l){if(this._loc=-1,this._log=new _("cgl_uniform"),this._type=e,this._cgl=t._cgl,this._name=i,this._shader=t,this._value=1e-5,this._oldValue=null,this._port=null,this._structName=a,this._structUniformName=h,this._propertyName=l,this._shader._addUniform(this),this.needsUpdate=!0,this.shaderType=null,this.comment=null,"f"==e)this.set=this.setValue=this.setValueF.bind(this),this.updateValue=this.updateValueF.bind(this);else if("f[]"==e)this.set=this.setValue=this.setValueArrayF.bind(this),this.updateValue=this.updateValueArrayF.bind(this);else if("2f[]"==e)this.set=this.setValue=this.setValueArray2F.bind(this),this.updateValue=this.updateValueArray2F.bind(this);else if("3f[]"==e)this.set=this.setValue=this.setValueArray3F.bind(this),this.updateValue=this.updateValueArray3F.bind(this);else if("4f[]"==e)this.set=this.setValue=this.setValueArray4F.bind(this),this.updateValue=this.updateValueArray4F.bind(this);else if("i"==e)this.set=this.setValue=this.setValueI.bind(this),this.updateValue=this.updateValueI.bind(this);else if("2i"==e)this.set=this.setValue=this.setValue2I.bind(this),this.updateValue=this.updateValue2I.bind(this);else if("3i"==e)this.set=this.setValue=this.setValue3I.bind(this),this.updateValue=this.updateValue3I.bind(this);else if("4i"==e)this.set=this.setValue=this.setValue4I.bind(this),this.updateValue=this.updateValue4I.bind(this);else if("b"==e)this.set=this.setValue=this.setValueBool.bind(this),this.updateValue=this.updateValueBool.bind(this);else if("4f"==e)this.set=this.setValue=this.setValue4F.bind(this),this.updateValue=this.updateValue4F.bind(this);else if("3f"==e)this.set=this.setValue=this.setValue3F.bind(this),this.updateValue=this.updateValue3F.bind(this);else if("2f"==e)this.set=this.setValue=this.setValue2F.bind(this),this.updateValue=this.updateValue2F.bind(this);else if("t"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("tc"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("t[]"==e)this.set=this.setValue=this.setValueArrayT.bind(this),this.updateValue=this.updateValueArrayT.bind(this);else{if("m4"!=e&&"m4[]"!=e)throw new Error("Unknown uniform type");this.set=this.setValue=this.setValueM4.bind(this),this.updateValue=this.updateValueM4.bind(this)}"object"==typeof s&&s instanceof q?(this._port=s,this._value=this._port.get(),r&&n&&o?(r instanceof q&&n instanceof q&&o instanceof q||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0,0],this._port2=r,this._port3=n,this._port4=o,this._port.on("change",this.updateFromPort4f.bind(this)),this._port2.on("change",this.updateFromPort4f.bind(this)),this._port3.on("change",this.updateFromPort4f.bind(this)),this._port4.on("change",this.updateFromPort4f.bind(this)),this.updateFromPort4f()):r&&n?(r instanceof q&&n instanceof q||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0],this._port2=r,this._port3=n,this._port.on("change",this.updateFromPort3f.bind(this)),this._port2.on("change",this.updateFromPort3f.bind(this)),this._port3.on("change",this.updateFromPort3f.bind(this)),this.updateFromPort3f()):r?(r instanceof q||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0],this._port2=r,this._port.on("change",this.updateFromPort2f.bind(this)),this._port2.on("change",this.updateFromPort2f.bind(this)),this.updateFromPort2f()):this._port.on("change",this.updateFromPort.bind(this))):this._value=s,this.setValue(this._value),this.needsUpdate=!0};rt.prototype.copy=function(t){const e=new rt(t,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);return e.shaderType=this.shaderType,e},rt.prototype.getGlslTypeString=function(){return"f"==this._type?"float":"i"==this._type?"int":"2i"==this._type?"ivec2":"2f"==this._type?"vec2":"3f"==this._type?"vec3":"4f"==this._type?"vec4":"m4"==this._type?"mat4":"t"==this._type?"sampler2D":"tc"==this._type?"samplerCube":"3f[]"==this._type||"m4[]"==this._type?null:void this._log.warn("[CGL UNIFORM] unknown glsl type string ",this._type)},rt.prototype._isValidLoc=function(){return-1!=this._loc},rt.prototype.getType=function(){return this._type},rt.prototype.getName=function(){return this._name},rt.prototype.getValue=function(){return this._value},rt.prototype.getShaderType=function(){return this.shaderType},rt.prototype.isStructMember=function(){return!!this._structName},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){return this._value},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){},rt.prototype.getLoc=function(){return this._loc},rt.prototype.updateFromPort4f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this._value[3]=this._port4.get(),this.setValue(this._value)},rt.prototype.updateFromPort3f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this.setValue(this._value)},rt.prototype.updateFromPort2f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this.setValue(this._value)},rt.prototype.updateFromPort=function(){this.setValue(this._port.get())},rt.prototype.updateValueF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1f(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueF=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.updateValueI=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.updateValue2I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue3I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue4I=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueI=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValue2I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue3I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue4I=function(t){this.needsUpdate=!0,this._value=t||vec4.create()},rt.prototype.updateValueBool=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueBool=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValueArray4F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray4F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform4fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray3F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray3F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform3fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray2F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray2F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform2fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayF=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArrayF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayT=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValue3F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue3F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue2F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue2F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue4F=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||(this._log.warn("no value for uniform",this._name,this),this._value=[0,0,0,0]),this.needsUpdate=!1,this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValue4F=function(t){"number"==typeof this.value&&(this.value=vec4.create()),t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]&&t[3]==this._oldValue[3]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2,3],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValueM4=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||console.log("this.name",this.name,this._value),this._shader.getCgl().gl.uniformMatrix4fv(this._loc,!1,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueM4=function(t){this.needsUpdate=!0,this._value=t||mat4.create()},rt.prototype.updateValueArrayT=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1iv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValueT=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._cgl.profileData.profileUniformCount++,this._shader.getCgl().gl.uniform1i(this._loc,this._value),this.needsUpdate=!1},rt.prototype.setValueT=function(t){this.needsUpdate=!0,this._value=t};const nt=180/Math.PI,ot={MATH:{DEG2RAD:Math.PI/180,RAD2DEG:nt},SHADER:{SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_VIEWPOS:"camPos"},BLEND_MODES:{BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4}};const ht={lastMesh:null},at=function(t,e,i){this._cgl=t,this._log=new _("cgl_mesh"),this._bufVertexAttrib=null,this._bufVerticesIndizes=this._cgl.gl.createBuffer(),this._attributes=[],this._attribLocs={},this._geom=null,this._lastShader=null,this._numInstances=0,this._glPrimitive=i,this._preWireframeGeom=null,this.addVertexNumbers=!1,this.feedBackAttributes=[],this.setGeom(e),this._feedBacks=[],this._feedBacksChanged=!1,this._transformFeedBackLoc=-1,this._lastAttrUpdate=0,this._name="unknown",this._cgl.profileData.addHeavyEvent("mesh constructed",this._name),this._queryExt=null,Object.defineProperty(this,"numInstances",{get(){return this._numInstances},set(t){this.setNumInstances(t)}})};at.prototype.updateVertices=function(t){this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_POSITION,t.vertices,3),this._numVerts=t.vertices.length/3},at.prototype.setAttributePointer=function(t,e,i,s){for(let r=0;r<this._attributes.length;r++)this._attributes[r].name==t&&(this._attributes[r].pointer||(this._attributes[r].pointer=[]),this._attributes[r].pointer.push({loc:-1,name:e,stride:i,offset:s,instanced:t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX}))},at.prototype.getAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]},at.prototype.setAttributeRange=function(t,e,i,s){t&&(i||s)&&(t.name||(console.log(t),this._log.stack("no attrname?!")),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,t.buffer),this._cgl.profileData.profileMeshAttributes+=s-i||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]=this._cgl.profileData.profileSingleMeshAttribute[this._name]||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]+=s-i||0,t.numItems<e.length/t.itemSize&&this._resizeAttr(e,t),s>=e.length-1&&this._log.log(this._cgl.canvas.id+" "+t.name+" buffersubdata out of bounds ?",e.length,s,i,t),1==this._cgl.glVersion?this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,0,e):this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,4*i,e,i,s-i))},at.prototype._resizeAttr=function(t,e){e.buffer&&this._cgl.gl.deleteBuffer(e.buffer),e.buffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,e.buffer),this._bufferArray(t,e),e.numItems=t.length/e.itemSize},at.prototype._bufferArray=function(t,e){let i=null;t&&(this._cgl.debugOneFrame&&console.log("_bufferArray",t.length,e.name),t instanceof Float32Array?i=t:e&&i&&i.length==t.length?i.set(t):(i=new Float32Array(t),this._cgl.debugOneFrame&&console.log("_bufferArray create new float32array",t.length,e.name),this._cgl.profileData.profileNonTypedAttrib++,this._cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+e.name+")"),e.arrayLength=i.length,this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,i,this._cgl.gl.DYNAMIC_DRAW))},at.prototype.addAttribute=at.prototype.updateAttribute=at.prototype.setAttribute=function(t,e,i,s){if(!e)throw this._log.error("mesh addAttribute - no array given! "+t),new Error;let r=null,n=!1,o=0;const h=e.length/i;for(this._cgl.profileData.profileMeshAttributes+=h||0,"function"==typeof s&&(r=s),"object"==typeof s&&(s.cb&&(r=s.cb),s.instanced&&(n=s.instanced)),t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX&&(n=!0),o=0;o<this._attributes.length;o++){const i=this._attributes[o];if(i.name==t)return i.numItems===h||this._resizeAttr(e,i),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,i.buffer),this._bufferArray(e,i),i}const a=this._cgl.gl.createBuffer();this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,a);let l=this._cgl.gl.FLOAT;s&&s.type&&(l=s.type);const c={buffer:a,name:t,cb:r,itemSize:i,numItems:h,startItem:0,instanced:n,type:l};return this._bufferArray(e,c),t==ot.SHADER.SHADERVAR_VERTEX_POSITION&&(this._bufVertexAttrib=c),this._attributes.push(c),this._attribLocs={},c},at.prototype.getAttributes=function(){return this._attributes},at.prototype.updateTexCoords=function(t){if(t.texCoords&&t.texCoords.length>0)this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,t.texCoords,2);else{const e=new Float32Array(Math.round(t.vertices.length/3*2));this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,e,2)}},at.prototype.updateNormals=function(t){if(t.vertexNormals&&t.vertexNormals.length>0)this.setAttribute("attrVertNormal",t.vertexNormals,3);else{const e=new Float32Array(Math.round(t.vertices.length));this.setAttribute("attrVertNormal",e,3)}},at.prototype._setVertexNumbers=function(t){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||t){if(t)this._verticesNumbers=t;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let t=0;t<this._numVerts;t++)this._verticesNumbers[t]=t}this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(t,e,i)=>{i.uniformNumVertices||(i.uniformNumVertices=new rt(i,"f","numVertices",this._numVerts)),i.uniformNumVertices.setValue(this._numVerts)})}},at.prototype.setVertexIndices=function(t){if(this._bufVerticesIndizes)if(t.length>0){for(let e=0;e<t.length;e++)if(t[e]>=this._numVerts)return void this._log.warn("invalid index in "+this._name);this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes),t instanceof Uint16Array?this.vertIndicesTyped=t:this.vertIndicesTyped=new Uint16Array(t),this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this._cgl.gl.DYNAMIC_DRAW),this._bufVerticesIndizes.itemSize=1,this._bufVerticesIndizes.numItems=t.length}else this._bufVerticesIndizes.numItems=0;else this._log.warn("no bufVerticesIndizes")},at.prototype.setGeom=function(t,e){this._geom=t,null!=t.glPrimitive&&(this._glPrimitive=t.glPrimitive),this._geom&&this._geom.name&&(this._name="mesh "+this._geom.name),ht.lastMesh=null,this._cgl.profileData.profileMeshSetGeom++,this._disposeAttributes(),this.updateVertices(this._geom),this.setVertexIndices(this._geom.verticesIndices),this.updateTexCoords(this._geom),this.updateNormals(this._geom),this._geom.hasOwnProperty("tangents")&&this._geom.tangents&&this._geom.tangents.length>0&&this.setAttribute("attrTangent",this._geom.tangents,3),this._geom.hasOwnProperty("biTangents")&&this._geom.biTangents&&this._geom.biTangents.length>0&&this.setAttribute("attrBiTangent",this._geom.biTangents,3),this._geom.vertexColors.length>0&&(this._geom.vertexColors.flat&&this._geom.vertexColors.flat(100),this.setAttribute("attrVertColor",this._geom.vertexColors,4)),this.addVertexNumbers&&this._setVertexNumbers();const i=this._geom.getAttributes();for(const t in i)this.setAttribute(t,i[t].data,i[t].itemSize);e&&(this._geom=null)},at.prototype._preBind=function(t){for(let e=0;e<this._attributes.length;e++)this._attributes[e].cb&&this._attributes[e].cb(this._attributes[e],this._geom,t)},at.prototype._checkAttrLengths=function(){for(let t=0;t<this._attributes.length;t++)if(this._attributes[t].arrayLength/this._attributes[t].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let t="unknown";this._geom&&(t=this._geom.name)}},at.prototype._bind=function(t){if(!t.isValid())return;let e=[];if(this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,this._lastShader=t,t.lastCompile>this._lastAttrUpdate||e.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let t=0;t<this._attributes.length;t++)e[t]=-1}for(let i=0;i<this._attributes.length;i++){const s=this._attributes[i];if(-1==e[i]&&s._attrLocationLastShaderTime!=t.lastCompile&&(s._attrLocationLastShaderTime=t.lastCompile,e[i]=this._cgl.glGetAttribLocation(t.getProgram(),s.name),this._cgl.profileData.profileAttrLoc++),-1!=e[i])if(this._cgl.gl.enableVertexAttribArray(e[i]),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.buffer),s.instanced)if(s.itemSize<=4)s.itemSize&&0!=s.itemSize||this._log.warn("instanced attrib itemsize error",this._geom.name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),this._cgl.gl.vertexAttribDivisor(e[i],1);else if(16==s.itemSize){const t=64;this._cgl.gl.vertexAttribPointer(e[i],4,s.type,!1,t,0),this._cgl.gl.enableVertexAttribArray(e[i]+1),this._cgl.gl.vertexAttribPointer(e[i]+1,4,s.type,!1,t,16),this._cgl.gl.enableVertexAttribArray(e[i]+2),this._cgl.gl.vertexAttribPointer(e[i]+2,4,s.type,!1,t,32),this._cgl.gl.enableVertexAttribArray(e[i]+3),this._cgl.gl.vertexAttribPointer(e[i]+3,4,s.type,!1,t,48),this._cgl.gl.vertexAttribDivisor(e[i],1),this._cgl.gl.vertexAttribDivisor(e[i]+1,1),this._cgl.gl.vertexAttribDivisor(e[i]+2,1),this._cgl.gl.vertexAttribDivisor(e[i]+3,1)}else this._log.warn("unknown instance attrib size",s.name);else{if(s.itemSize&&0!=s.itemSize||this._log.warn("attrib itemsize error",this._name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),s.pointer)for(let e=0;e<s.pointer.length;e++){const i=s.pointer[e];-1==i.loc&&(i.loc=this._cgl.glGetAttribLocation(t.getProgram(),i.name)),this._cgl.profileData.profileAttrLoc++,this._cgl.gl.enableVertexAttribArray(i.loc),this._cgl.gl.vertexAttribPointer(i.loc,s.itemSize,s.type,!1,i.stride,i.offset)}this.bindFeedback(s)}}0!==this._bufVerticesIndizes.numItems&&this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes)},at.prototype.unBind=function(){const t=this._lastShader;if(this._lastShader=null,!t)return;let e=[];this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,ht.lastMesh=null;for(let t=0;t<this._attributes.length;t++)this._attributes[t].instanced&&(this._attributes[t].itemSize<=4?(-1!=e[t]&&this._cgl.gl.vertexAttribDivisor(e[t],0),e[t]>=0&&this._cgl.gl.disableVertexAttribArray(e[t])):(this._cgl.gl.vertexAttribDivisor(e[t],0),this._cgl.gl.vertexAttribDivisor(e[t]+1,0),this._cgl.gl.vertexAttribDivisor(e[t]+2,0),this._cgl.gl.vertexAttribDivisor(e[t]+3,0),this._cgl.gl.disableVertexAttribArray(e[t]+1),this._cgl.gl.disableVertexAttribArray(e[t]+2),this._cgl.gl.disableVertexAttribArray(e[t]+3))),-1!=e[t]&&this._cgl.gl.disableVertexAttribArray(e[t])},at.prototype.meshChanged=function(){return this._cgl.lastMesh&&this._cgl.lastMesh!=this},at.prototype.printDebug=function(t){console.log("--attributes");for(let t=0;t<this._attributes.length;t++)console.log("attribute "+t+" "+this._attributes[t].name)},at.prototype.setNumVertices=function(t){this._bufVertexAttrib.numItems=t},at.prototype.getNumVertices=function(){return this._bufVertexAttrib.numItems},at.prototype.render=function(t){if(!t||!t.isValid())return;this._checkAttrLengths(),this._geom&&(t.wireframe||this._geom.isIndexed()||!this._preWireframeGeom||this.setGeom(this._preWireframeGeom),t.wireframe&&this._geom.isIndexed()&&(this._preWireframeGeom=this._geom,this._geom=this._geom.copy(),this._geom.unIndex(),this._geom.calcBarycentric(),this.setGeom(this._geom),this.setAttribute("attrBarycentric",this._geom.barycentrics,3)));let e=!1;ht.lastMesh!=this&&(ht.lastMesh&&ht.lastMesh.unBind(),e=!0),e&&this._preBind(t),t.bind(),t.bindTextures&&t.bindTextures(),this._bind(t),this.addVertexNumbers&&this._setVertexNumbers(),ht.lastMesh=this;let i=this._cgl.gl.TRIANGLES;void 0!==this._glPrimitive&&(i=this._glPrimitive),null!==t.glPrimitive&&(i=t.glPrimitive);let s=1,r=this._cgl.profileData.doProfileGlQuery,n=!1;if(r){let e=this._name+" "+t.getName()+" #"+t.id;this._numInstances&&(e+=" instanced "+this._numInstances+"x");let i=this._cgl.profileData.glQueryData[e];if(i||(i={id:e,num:0},this._cgl.profileData.glQueryData[e]=i),this._queryExt||(this._queryExt=this._cgl.gl.getExtension("EXT_disjoint_timer_query_webgl2")),this._queryExt){if(i._drawQuery){if(this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT_AVAILABLE)){const t=this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT)/1e6;i._times+=t,i._numcount++,i.when=performance.now(),i._drawQuery=null,i.queryStarted=!1}}i.queryStarted||(i._drawQuery=this._cgl.gl.createQuery(),this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,i._drawQuery),n=i.queryStarted=!0)}}if(this.hasFeedbacks()?this.drawFeedbacks(t,i):0===this._bufVerticesIndizes.numItems?(i==this._cgl.gl.TRIANGLES&&(s=3),0===this._numInstances?this._cgl.gl.drawArrays(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem):this._cgl.gl.drawArraysInstanced(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)):0===this._numInstances?this._cgl.gl.drawElements(i,this._bufVerticesIndizes.numItems,this._cgl.gl.UNSIGNED_SHORT,0):this._cgl.gl.drawElementsInstanced(i,this._bufVerticesIndizes.numItems,this._cgl.gl.UNSIGNED_SHORT,0,this._numInstances),this._cgl.debugOneFrame&&this._cgl.gl.getError()!=this._cgl.gl.NO_ERROR){this._log.error("mesh draw gl error"),this._log.error("mesh",this),this._log.error("shader",t);for(let e=0;e<this._cgl.gl.getProgramParameter(t.getProgram(),this._cgl.gl.ACTIVE_ATTRIBUTES);e++){const i=this._cgl.gl.getActiveAttrib(t.getProgram(),e).name;this._log.error("attrib ",i)}}this._cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/s*(this._numInstances||1),this._cgl.profileData.profileMeshDraw++,r&&n&&this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT),this.unBind()},at.prototype.setNumInstances=function(t){if(t=Math.max(0,t),this._numInstances!=t){this._numInstances=t;const e=new Float32Array(t);for(let i=0;i<t;i++)e[i]=i;this.setAttribute("instanceIndex",e,1,{instanced:!0})}},at.prototype._disposeAttributes=function(){if(this._attributes){for(let t=0;t<this._attributes.length;t++)this._attributes[t].buffer&&(this._cgl.gl.deleteBuffer(this._attributes[t].buffer),this._attributes[t].buffer=null);this._attributes.length=0}},at.prototype.dispose=function(){this._bufVertexAttrib&&this._bufVertexAttrib.buffer&&this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer),this._bufVerticesIndizes&&this._cgl.gl.deleteBuffer(this._bufVerticesIndizes),this._disposeAttributes()},function(t){t.prototype.hasFeedbacks=function(){return this._feedBacks.length>0},t.prototype.removeFeedbacks=function(t){this._feedbacks&&(this._feedbacks.length=0,this._feedBacksChanged=!0)},t.prototype.setAttributeFeedback=function(){},t.prototype.setFeedback=function(t,e,i){let s={nameOut:e},r=!1;this.unBindFeedbacks();for(let t=0;t<this._feedBacks.length;t++)this._feedBacks[t].nameOut==e&&(s=this._feedBacks[t],r=!0);return r||(this._feedBacksChanged=!0),s.initialArr=i,s.attrib=t,s.outBuffer&&this._cgl.gl.deleteBuffer(s.outBuffer),s.outBuffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.outBuffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.attrib.buffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),r||this._feedBacks.push(s),s},t.prototype.bindFeedback=function(t){if(!this._feedBacks||0===this._feedBacks.length)return;-1==this._transformFeedBackLoc&&(this._transformFeedBackLoc=this._cgl.gl.createTransformFeedback()),this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc);let e=!1;for(let i=0;i<this._feedBacks.length;i++){const s=this._feedBacks[i];s.attrib==t&&(e=!0,this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,i,s.outBuffer))}},t.prototype.drawFeedbacks=function(t,e){let i=0;if(this._feedBacksChanged){const e=[];for(this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc),i=0;i<this._feedBacks.length;i++)e.push(this._feedBacks[i].nameOut);return t.setFeedbackNames(e),console.log("feedbacknames",e),t.compile(),this._feedBacksChanged=!1,this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null),void console.log("changed finished")}this._cgl.gl.beginTransformFeedback(this.glPrimitive),this._cgl.gl.drawArrays(e,0,this._feedBacks[0].attrib.numItems),this._cgl.gl.endTransformFeedback(),this.unBindFeedbacks(),this.feedBacksSwapBuffers()},t.prototype.unBindFeedbacks=function(){for(let t=0;t<this._feedBacks.length;t++)this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,t,null);this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null)},t.prototype.feedBacksSwapBuffers=function(){for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t].attrib.buffer;this._feedBacks[t].attrib.buffer=this._feedBacks[t].outBuffer,this._feedBacks[t].outBuffer=e}}}(at);const lt={getSimpleRect:function(t,e){const i=new st(e);return i.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],i.texCoords=[1,1,0,1,1,0,0,0],i.verticesIndices=[0,1,2,2,1,3],i.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0],new at(t,i)}},ct=function(t,e){this._cgl=t,this._log=new _("cgl_TextureEffect"),t.TextureEffectMesh||this.createMesh(),this._textureSource=null,this._options=e,this._textureTarget=null,this._frameBuf=this._cgl.gl.createFramebuffer(),this._frameBuf2=this._cgl.gl.createFramebuffer(),this._renderbuffer=this._cgl.gl.createRenderbuffer(),this._renderbuffer2=this._cgl.gl.createRenderbuffer(),this.switched=!1,this.depth=!1};ct.prototype.getWidth=function(){return this._textureSource.width},ct.prototype.getHeight=function(){return this._textureSource.height},ct.prototype.setSourceTexture=function(t){t.textureType==tt.TYPE_FLOAT&&this._cgl.gl.getExtension("EXT_color_buffer_float"),null===t?(this._textureSource=new tt(this._cgl),this._textureSource.setSize(16,16)):this._textureSource=t,this._textureSource.compareSettings(this._textureTarget)||(this._textureTarget&&this._textureTarget.delete(),this._textureTarget=this._textureSource.clone(),this._cgl.profileData.profileEffectBuffercreate++,this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null))},ct.prototype.continueEffect=function(){this._cgl.pushDepthTest(!1),this._cgl.pushModelMatrix(),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height),mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100),this._cgl.pushPMatrix(),mat4.identity(this._cgl.pMatrix),this._cgl.pushViewMatrix(),mat4.identity(this._cgl.vMatrix),this._cgl.pushModelMatrix(),mat4.identity(this._cgl.mvMatrix)},ct.prototype.startEffect=function(t){this._textureTarget?(this.switched=!1,this.continueEffect(),t&&(this._bgTex=t),this._countEffects=0):this._log.warn("effect has no target")},ct.prototype.endEffect=function(){this._cgl.popDepthTest(),this._cgl.popModelMatrix(),this._cgl.popPMatrix(),this._cgl.popModelMatrix(),this._cgl.popViewMatrix(),this._cgl.popPMatrix(),this._cgl.resetViewPort()},ct.prototype.bind=function(){null!==this._textureSource?this.switched?(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.pushGlFrameBuffer(this._frameBuf2)):(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.pushGlFrameBuffer(this._frameBuf)):this._log.warn("no base texture set!")},ct.prototype.finish=function(){null!==this._textureSource?(this._cgl.TextureEffectMesh.render(this._cgl.getShader()),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.profileData.profileTextureEffect++,this._textureTarget.filter==tt.FILTER_MIPMAP&&(this.switched?(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex),this._textureSource.updateMipMap()):(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex),this._textureTarget.updateMipMap()),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)),this.switched=!this.switched,this._countEffects++):this._log.warn("no base texture set!")},ct.prototype.getCurrentTargetTexture=function(){return this.switched?this._textureSource:this._textureTarget},ct.prototype.getCurrentSourceTexture=function(){return 0==this._countEffects&&this._bgTex?this._bgTex:this.switched?this._textureTarget:this._textureSource},ct.prototype.delete=function(){this._textureTarget&&this._textureTarget.delete(),this._textureSource&&this._textureSource.delete(),this._cgl.gl.deleteRenderbuffer(this._renderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuf)},ct.prototype.createMesh=function(){this._cgl.TextureEffectMesh=lt.getSimpleRect(this._cgl,"texEffectRect")},ct.checkOpNotInTextureEffect=function(t){return t.uiAttribs.error&&!t.patch.cgl.currentTextureEffect?(t.setUiError("textureeffect",null),!0):!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect&&!t.uiAttribs.error?(t.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0),!1):!t.patch.cgl.currentTextureEffect)},ct.checkOpInEffect=function(t){return t.patch.cgl.currentTextureEffect&&t.uiAttribs.uierrors?(t.setUiError("texeffect",null),!0):!!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect||t.uiAttribs.uierrors&&0!=t.uiAttribs.uierrors.length?!!t.patch.cgl.currentTextureEffect:(t.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://docs.cables.gl/image_composition/image_composition.html" target="_blank">here</a>.',1),!1))},ct.getBlendCode=function(){return"".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBSTRACT".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl()+"vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}"},ct.onChangeBlendSelect=function(t,e){"normal"==e?t.define("BM_NORMAL"):t.removeDefine("BM_NORMAL"),"multiply"==e?t.define("BM_MULTIPLY"):t.removeDefine("BM_MULTIPLY"),"multiply invert"==e?t.define("BM_MULTIPLY_INV"):t.removeDefine("BM_MULTIPLY_INV"),"average"==e?t.define("BM_AVERAGE"):t.removeDefine("BM_AVERAGE"),"add"==e?t.define("BM_ADD"):t.removeDefine("BM_ADD"),"substract"==e?t.define("BM_SUBSTRACT"):t.removeDefine("BM_SUBSTRACT"),"difference"==e?t.define("BM_DIFFERENCE"):t.removeDefine("BM_DIFFERENCE"),"negation"==e?t.define("BM_NEGATION"):t.removeDefine("BM_NEGATION"),"exclusion"==e?t.define("BM_EXCLUSION"):t.removeDefine("BM_EXCLUSION"),"lighten"==e?t.define("BM_LIGHTEN"):t.removeDefine("BM_LIGHTEN"),"darken"==e?t.define("BM_DARKEN"):t.removeDefine("BM_DARKEN"),"overlay"==e?t.define("BM_OVERLAY"):t.removeDefine("BM_OVERLAY"),"screen"==e?t.define("BM_SCREEN"):t.removeDefine("BM_SCREEN"),"softlight"==e?t.define("BM_SOFTLIGHT"):t.removeDefine("BM_SOFTLIGHT"),"hardlight"==e?t.define("BM_HARDLIGHT"):t.removeDefine("BM_HARDLIGHT"),"color dodge"==e?t.define("BM_COLORDODGE"):t.removeDefine("BM_COLORDODGE"),"color burn"==e?t.define("BM_COLORBURN"):t.removeDefine("BM_COLORBURN")},ct.AddBlendSelect=function(t,e,i){return t.inValueSelect(e,["normal","lighten","darken","multiply","multiply invert","average","add","substract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight"],i||"normal")},ct.setupBlending=function(t,e,i,s){t.setPortGroup("Blending",[i,s]),i.onChange=()=>{ct.onChangeBlendSelect(e,i.get());let s=i.get();"normal"==s?s=null:"multiply"==s?s="mul":"multiply invert"==s?s="mulinv":"lighten"==s?s="light":"darken"==s?s="darken":"average"==s?s="avg":"substract"==s?s="sub":"difference"==s?s="diff":"negation"==s||"negation"==s||"negation"==s?s="neg":"exclusion"==s?s="exc":"overlay"==s?s="ovl":"color dodge"==s?s="dodge":"color burn"==s?s="burn":"softlight"==s?s="soft":"hardlight"==s&&(s="hard"),t.setUiAttrib({extendTitle:s})},ct.onChangeBlendSelect(e,i.get())};const ut={"CGL.BLENDMODES":function(){this.name="blendmodes",this.srcHeadFrag=ct.getBlendCode()},"CGL.RANDOM_OLD":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex",this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}",this.initUniforms=function(t){return[new rt(t,"t","CGLRNDTEX",7)]},this.onBind=function(t,e){tt.getRandomTexture(t),t.setTexture(7,tt.getRandomTexture(t).tex)}}},_t=function(){return window.performance.now()},pt=function(){return _t()},gt=function(){CABLES.EventTarget.apply(this),this._timeStart=_t(),this._timeOffset=0,this._currentTime=0,this._lastTime=0,this._paused=!0,this._delay=0,this._eventsPaused=!1,this.overwriteTime=-1,this.cbPlayPause=[],this.cbTimeChange=[]};gt.prototype._getTime=function(){return this._lastTime=(_t()-this._timeStart)/1e3,this._lastTime+this._timeOffset},gt.prototype._eventPlayPause=function(){if(this.emitEvent("playPause"),!this._eventsPaused)for(const t in this.cbPlayPause)this.cbPlayPause[t]()},gt.prototype._eventTimeChange=function(){if(!this._eventsPaused)for(const t in this.cbTimeChange)this.cbTimeChange[t]()},gt.prototype.setDelay=function(t){this._delay=t,this._eventTimeChange()},gt.prototype.isPlaying=function(){return!this._paused},gt.prototype.update=function(){if(!this._paused)return this._currentTime=this._getTime(),this._currentTime},gt.prototype.getMillis=function(){return 1e3*this.get()},gt.prototype.get=gt.prototype.getTime=function(){return this.overwriteTime>=0?this.overwriteTime-this._delay:this._currentTime-this._delay},gt.prototype.togglePlay=function(){this._paused?this.play():this.pause()},gt.prototype.setTime=function(t){t<0&&(t=0),this._timeStart=_t(),this._timeOffset=t,this._currentTime=t,this._eventTimeChange()},gt.prototype.setOffset=function(t){this._currentTime+t<0?(this._timeStart=_t(),this._timeOffset=0,this._currentTime=0):(this._timeOffset+=t,this._currentTime=this._lastTime+this._timeOffset),this._eventTimeChange()},gt.prototype.play=function(){this._timeStart=_t(),this._paused=!1,this._eventPlayPause()},gt.prototype.pause=function(){this._timeOffset=this._currentTime,this._paused=!0,this._eventPlayPause()},gt.prototype.pauseEvents=function(t){this._eventsPaused=t},gt.prototype.onPlayPause=function(t){t&&"function"==typeof t&&this.cbPlayPause.push(t)},gt.prototype.onTimeChange=function(t){t&&"function"==typeof t&&this.cbTimeChange.push(t)};const dt=Math.PI/180,ft=(Math.PI,-1!=window.navigator.userAgent.indexOf("Windows")),mt=function(t){let e;if(t.wheelDelta)e=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30,e*=-1.5,ft&&(e*=2);else{let i=t.deltaY;t.shiftKey&&(i=t.deltaX);const s=i||t.detail;e=-(s%3?10*s:s/3),e*=-3}return e>20&&(e=20),e<-20&&(e=-20),e},Et=mt,Tt=mt,At={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bt=/[&<>"']/g,yt=RegExp(bt.source);const vt=function(t,e){if(!t)throw new Error("shader constructed without cgl "+e);this._log=new _("cgl_shader"),this._cgl=t,e||this._log.stack("no shader name given"),this._name=e||"unknown",this.glslVersion=0,t.glVersion>1&&(this.glslVersion=300),this.id=v(),this._isValid=!0,this._program=null,this._uniforms=[],this._drawBuffers=[!0],this._defines=[],this._needsRecompile=!0,this._compileReason="initial",this._projMatrixUniform=null,this._mvMatrixUniform=null,this._mMatrixUniform=null,this._vMatrixUniform=null,this._camPosUniform=null,this._normalMatrixUniform=null,this._inverseViewMatrixUniform=null,this._attrVertexPos=-1,this.precision=t.patch.config.glslPrecision||"highp",this._pMatrixState=-1,this._vMatrixState=-1,this._modGroupCount=0,this._feedBackNames=[],this._attributes=[],this.glPrimitive=null,this.offScreenPass=!1,this._extensions=[],this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader(),this.lastCompile=0,this._moduleNames=[],this._modules=[],this._moduleNumId=0,this._libs=[],this._structNames=[],this._structUniformNames=[],this._textureStackUni=[],this._textureStackTex=[],this._textureStackType=[],this._textureStackTexCgl=[],this._tempNormalMatrix=mat4.create(),this._tempCamPosMatrix=mat4.create(),this._tempInverseViewMatrix=mat4.create(),this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"])};vt.prototype.isValid=function(){return this._isValid},vt.prototype.getCgl=function(){return this._cgl},vt.prototype.getName=function(){return this._name},vt.prototype.enableExtension=function(t){this.setWhyCompile("enable extension "+t),this._needsRecompile=!0,this._extensions.push(t)},vt.prototype.getAttrVertexPos=function(){return this._attrVertexPos},vt.prototype.hasTextureUniforms=function(){for(let t=0;t<this._uniforms.length;t++)if("t"==this._uniforms[t].getType())return!0;return!1},vt.prototype.setWhyCompile=function(t){this._compileReason=t},vt.prototype.copyUniformValues=function(t){for(let e=0;e<t._uniforms.length;e++)this._uniforms[e]&&this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue());this.popTextures();for(let e=0;e<t._textureStackUni.length;e++)this._textureStackUni[e]=t._textureStackUni[e],this._textureStackTex[e]=t._textureStackTex[e],this._textureStackType[e]=t._textureStackType[e],this._textureStackTexCgl[e]=t._textureStackTexCgl[e]},vt.prototype.copy=function(){const t=new vt(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag),t._modules=JSON.parse(JSON.stringify(this._modules)),t._defines=JSON.parse(JSON.stringify(this._defines)),t._modGroupCount=this._modGroupCount,t._moduleNames=this._moduleNames,t.glPrimitive=this.glPrimitive,t.offScreenPass=this.offScreenPass,t._extensions=this._extensions;for(let e=0;e<this._uniforms.length;e++){this._uniforms[e].copy(t).resetLoc()}return this.setWhyCompile("copy"),t._needsRecompile=!0,t},vt.prototype.setSource=function(t,e){this.srcVert=t,this.srcFrag=e,this.setWhyCompile("Source changed"),this._needsRecompile=!0},vt.prototype._addLibs=function(t){for(const e in ut)if(t.indexOf(e)>-1){const i=new ut[e];t=t.replace("{{"+e+"}}",i.srcHeadFrag),this._libs.push(i),i.initUniforms&&i.initUniforms(this)}return t},vt.prototype.createStructUniforms=function(){let t="",e="";this._structNames=[],this._injectedStringsFrag={},this._injectedStringsVert={},this._structUniformNamesIndicesFrag=[],this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++)if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(-1===this._structNames.indexOf(this._uniforms[i]._structName)){const r="struct "+this._uniforms[i]._structName+" {".endl()+s+"};".endl().endl();"both"!==this._uniforms[i].getShaderType()&&"frag"!==this._uniforms[i].getShaderType()||(t=t.concat(r)),"both"!==this._uniforms[i].getShaderType()&&"vert"!==this._uniforms[i].getShaderType()||(e=e.concat(r)),this._structNames.push(this._uniforms[i]._structName),this._injectedStringsFrag[this._uniforms[i]._structName]=[],this._injectedStringsVert[this._uniforms[i]._structName]=[]}let r="";this._uniforms[i].comment&&(r=" // "+this._uniforms[i].comment);let n="";if(null==this._uniforms[i].getGlslTypeString()&&(n+="//"),n+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+r,"both"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)&&-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const r=t.lastIndexOf(s),o=e.lastIndexOf(s);t=t.slice(0,r)+n+t.slice(r-1),e=e.slice(0,o)+n+e.slice(o-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i),-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}else if("frag"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)){const e=t.lastIndexOf(s);t=t.slice(0,e)+n+t.slice(e-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i)}else if("vert"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const t=e.lastIndexOf(s);e=e.slice(0,t)+n+e.slice(t-1),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}}this._uniDeclarationsFrag=[],this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const i=this._structUniformNamesIndicesFrag[e],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsFrag.indexOf(s)){const e="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";t=t.replace(e,""),t+=s,this._uniDeclarationsFrag.push(s)}}for(let t=0;t<this._structUniformNamesIndicesVert.length;t+=1){const i=this._structUniformNamesIndicesVert[t],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsVert.indexOf(s)){const t="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";e=e.replace(t,""),e+=s,this._uniDeclarationsVert.push(s)}}return[e,t]},vt.prototype.compile=function(){const t=performance.now();this._cgl.printError("shader.compile"),this._cgl.profileData.profileShaderCompiles++,this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let e="";if(this._extensions)for(let t=0;t<this._extensions.length;t++)e+="#extension "+this._extensions[t]+" : enable".endl();let i="";this._defines.length&&(i="\n// cgl generated".endl());for(let t=0;t<this._defines.length;t++)i+="#define "+this._defines[t][0]+" "+this._defines[t][1]+"".endl();const s=this.createStructUniforms();if(this._cgl.printError("createStructUniforms"),this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]"),this._compileReason="",this._uniforms){const t=this._uniforms.map(t=>t._name),e=[];for(let i=0;i<this._uniforms.length;i++){const s=this._uniforms[i];t.indexOf(s._name,i+1)>-1&&e.push(i)}for(let t=this._uniforms.length-1;t>=0;t-=1)e.indexOf(t)>-1?this._uniforms.splice(t,1):this._uniforms[t].resetLoc()}this._cgl.printError("uniform resets"),this.hasTextureUniforms()&&(i+="#define HAS_TEXTURES".endl());let r="",n="";if(this.srcFrag||(this._log.error("[cgl shader] has no fragment source!"),this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader()),300==this.glslVersion){let t="";if(this.srcFrag.indexOf("outColor0")>-1&&(this._drawBuffers[0]=!0),this.srcFrag.indexOf("outColor1")>-1&&(this._drawBuffers[1]=!0),this.srcFrag.indexOf("outColor2")>-1&&(this._drawBuffers[2]=!0),this.srcFrag.indexOf("outColor3")>-1&&(this._drawBuffers[3]=!0),1==this._drawBuffers.length)t="out vec4 outColor;".endl(),t+="#define gl_FragColor outColor".endl();else{let e=0;t+="#define MULTI_COLORTARGETS".endl(),t+="vec4 outColor;".endl();for(let i=0;i<this._drawBuffers.length;i++)0==e&&(t+="#define gl_FragColor outColor"+i+"".endl()),t+="layout(location = "+i+") out vec4 outColor"+i+";".endl(),e++}r="#version 300 es".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define UNI uniform".endl()+"#define IN in".endl()+"#define OUT out".endl(),n="#version 300 es".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define IN in".endl()+"#define UNI uniform".endl()+t.endl()}else n="".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define outColor gl_FragColor".endl()+"#define IN varying".endl()+"#define UNI uniform".endl(),r="".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define OUT varying".endl()+"#define IN attribute".endl()+"#define UNI uniform".endl();let o="\n// cgl generated".endl(),h="\n// cgl generated".endl();n+="\n// active mods: --------------- ",r+="\n// active mods: --------------- ";let a=!1,l=!1;for(let t=0;t<this._moduleNames.length;t++)for(let e=0;e<this._modules.length;e++)this._modules[e].name==this._moduleNames[t]&&((this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag)&&(a=!0,n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"),(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert)&&(r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")",l=!0));l||(n+="\n// no mods used..."),a||(n+="\n// no mods used..."),n+="\n",r+="\n";for(let t=0;t<this._uniforms.length;t++)if(this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()){let e="";this._uniforms[t].getGlslTypeString()||(e+="// "),e+="UNI "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName();let i="";this._uniforms[t].comment&&(i=" // "+this._uniforms[t].comment),"vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcVert.indexOf(e)&&-1==this.srcVert.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(o+=e+";"+i.endl()),"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcFrag.indexOf(e)&&-1==this.srcFrag.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(h+=e+";"+i.endl())}let c=0,u=0;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()&&("vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||u++,"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||c++);c>=this._cgl.maxUniformsFrag&&this._log.warn("[cgl_shader] num uniforms frag: "+c+" / "+this._cgl.maxUniformsFrag),u>=this._cgl.maxUniformsVert&&this._log.warn("[cgl_shader] num uniforms vert: "+u+" / "+this._cgl.maxUniformsVert),-1==n.indexOf("precision")&&(n="precision "+this.precision+" float;".endl()+n),-1==r.indexOf("precision")&&(r="precision "+this.precision+" float;".endl()+r),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(n+="#define MOBILE".endl(),r+="#define MOBILE".endl()),r=e+r+i+s[0]+o+"\n// -- \n"+this.srcVert,n=e+n+i+s[1]+h+"\n// -- \n"+this.srcFrag;let _="",p="";this._modules.sort((function(t,e){return t.group-e.group})),this._modules.sort((function(t,e){return t.priority||0-e.priority||0}));let g=!1;for(let t=0;t<this._moduleNames.length;t++){let e="",i="";for(let s=0;s<this._modules.length;s++)if(this._modules[s].name==this._moduleNames[t]){if(_+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",p+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",e+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",i+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",!g){g=!0;for(let t=0;t<this._attributes.length;t++)this._attributes[t].name&&this._attributes[t].type&&(_+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].name.endl()+"  #define ATTRIB_"+this._attributes[t].name.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].name+";".endl()+"#endif",this._attributes[t].nameFrag&&(_+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  OUT "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif",e+="".endl()+this._attributes[t].nameFrag+"="+this._attributes[t].name+";"),p+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif")}_+=this._modules[s].srcHeadVert||"",p+=this._modules[s].srcHeadFrag||"",e+=this._modules[s].srcBodyVert||"",i+=this._modules[s].srcBodyFrag||"",_+="\n//---- end mod ------\n",p+="\n//---- end mod ------\n",e+="\n//---- end mod ------\n",i+="\n//---- end mod ------\n",e=e.replace(/{{mod}}/g,this._modules[s].prefix),i=i.replace(/{{mod}}/g,this._modules[s].prefix),_=_.replace(/{{mod}}/g,this._modules[s].prefix),p=p.replace(/{{mod}}/g,this._modules[s].prefix),e=e.replace(/MOD_/g,this._modules[s].prefix),i=i.replace(/MOD_/g,this._modules[s].prefix),_=_.replace(/MOD_/g,this._modules[s].prefix),p=p.replace(/MOD_/g,this._modules[s].prefix)}r=r.replace("{{"+this._moduleNames[t]+"}}",e),n=n.replace("{{"+this._moduleNames[t]+"}}",i)}if(r=r.replace("{{MODULES_HEAD}}",_),n=n.replace("{{MODULES_HEAD}}",p),r=this._addLibs(r),n=this._addLibs(n),this._program){this._program=this._createProgram(r,n),this._projMatrixUniform=null;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].resetLoc()}else this._program=this._createProgram(r,n);this.finalShaderFrag=n,this.finalShaderVert=r,ht.lastMesh=null,ht.lastShader=null,this._needsRecompile=!1,this.lastCompile=pt(),this._cgl.profileData.shaderCompileTime+=performance.now()-t},vt.hasChanged=function(){return this._needsRecompile},vt.prototype.bind=function(){if(this._isValid&&(ht.lastShader=this,this._program&&!this._needsRecompile||this.compile(),this._isValid)){if(!this._projMatrixUniform){this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,ot.SHADER.SHADERVAR_VERTEX_POSITION),this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_PROJMAT),this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix"),this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWMAT),this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_MODELMAT),this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWPOS),this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_NORMALMAT),this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_INVVIEWMAT);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate=!0}this._cgl.currentProgram!=this._program&&(this._cgl.profileData.profileShaderBinds++,this._cgl.gl.useProgram(this._program),this._cgl.currentProgram=this._program);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate&&this._uniforms[t].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()&&(this._pMatrixState=this._cgl.getProjectionMatrixStateCount(),this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,!1,this._cgl.pMatrix),this._cgl.profileData.profileMVPMatrixCount++),this._vMatrixUniform)this._vMatrixState!=this._cgl.getViewMatrixStateCount()&&(this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,!1,this._cgl.vMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._vMatrixState=this._cgl.getViewMatrixStateCount(),this._inverseViewMatrixUniform&&(mat4.invert(this._tempInverseViewMatrix,this._cgl.vMatrix),this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,!1,this._tempInverseViewMatrix),this._cgl.profileData.profileMVPMatrixCount++)),this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,!1,this._cgl.mMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._camPosUniform&&(mat4.invert(this._tempCamPosMatrix,this._cgl.vMatrix),this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]),this._cgl.profileData.profileMVPMatrixCount++);else{const t=mat4.create();mat4.mul(t,this._cgl.vMatrix,this._cgl.mMatrix),this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,!1,t),this._cgl.profileData.profileMVPMatrixCount++}this._normalMatrixUniform&&(mat4.invert(this._tempNormalMatrix,this._cgl.mMatrix),mat4.transpose(this._tempNormalMatrix,this._tempNormalMatrix),this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,!1,this._tempNormalMatrix),this._cgl.profileData.profileMVPMatrixCount++);for(let t=0;t<this._libs.length;t++)this._libs[t].onBind&&this._libs[t].onBind.bind(this._libs[t])(this._cgl,this);this._bindTextures()}},vt.prototype.toggleDefine=function(t,e){e&&"object"==typeof e&&e.addEventListener&&(e.changeListener&&e.removeEventListener(e.changeListener),e.onToggleDefine=e=>{this.toggleDefine(t,e)},e.changeListener=e.on("change",e.onToggleDefine),e=e.get()),e?this.define(t):this.removeDefine(t)},vt.prototype.define=function(t,e){null==e&&(e=""),"object"==typeof e&&(e.removeEventListener("change",e.onDefineChange),e.onDefineChange=e=>{this.define(t,e)},e.on("change",e.onDefineChange),e=e.get());for(let i=0;i<this._defines.length;i++){if(this._defines[i][0]==t&&this._defines[i][1]==e)return;if(this._defines[i][0]==t)return this._defines[i][1]=e,this.setWhyCompile("define "+t+" "+e),void(this._needsRecompile=!0)}this.setWhyCompile("define "+t+" "+e),this._needsRecompile=!0,this._defines.push([t,e])},vt.prototype.getDefines=function(){return this._defines},vt.prototype.getDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null},vt.prototype.hasDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return!0},vt.prototype.removeDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines.splice(e,1),this._needsRecompile=!0,void this.setWhyCompile("define removed:"+t)},vt.prototype.removeModule=function(t){for(let e=0;e<this._modules.length;e++)if(t&&t.id&&(this._modules[e].id==t.id||!this._modules[e])){let i=!0;for(;i;){i=!1;for(let e=0;e<this._uniforms.length;e++)0!=this._uniforms[e].getName().indexOf(t.prefix)||(this._uniforms.splice(e,1),i=!0)}this._needsRecompile=!0,this.setWhyCompile("remove module "+t.title),this._modules.splice(e,1);break}},vt.prototype.getNumModules=function(){return this._modules.length},vt.prototype.getCurrentModules=function(){return this._modules},vt.prototype.addModule=function(t,e){return t.id||(t.id=b()),t.numId||(t.numId=this._moduleNumId),t.num||(t.num=this._modules.length),e&&!e.group&&(e.group=v()),t.group||(t.group=e?e.group:v()),t.prefix="mod"+t.group+"_",this._modules.push(t),this._needsRecompile=!0,this.setWhyCompile("add module "+t.title),this._moduleNumId++,t},vt.prototype.hasModule=function(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return!0;return!1},vt.prototype.setModules=function(t){this._moduleNames=t},vt.prototype.dispose=function(){this._cgl.gl.deleteProgram(this._program)},vt.prototype.needsRecompile=function(){return this._needsRecompile},vt.prototype.setDrawBuffers=function(t){if(this._drawBuffers.length!==t.length)return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers");for(let e=0;e<t;e++)if(t[e]!==this._drawBuffers[e])return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers")},vt.prototype.getUniforms=function(){return this._uniforms},vt.prototype.getUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null},vt.prototype.removeUniform=function(t){for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].getName()==t&&this._uniforms.splice(e,1);this._needsRecompile=!0,this.setWhyCompile("remove uniform "+t)},vt.prototype._addUniform=function(t){this._uniforms.push(t),this.setWhyCompile("add uniform "+name),this._needsRecompile=!0},vt.prototype.addUniformFrag=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="frag",o},vt.prototype.addUniformVert=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="vert",o},vt.prototype.addUniformBoth=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="both",o},vt.prototype.addUniformStructFrag=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="frag",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructVert=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="vert",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructBoth=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if("2i"!==n.type&&"i"!==n.type&&"3i"!==n.type||this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",n.name," of type:",n.type,"."),!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="both",s[e+"."+n.name]=i}}return s},vt.prototype.hasUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return!0;return!1},vt.prototype._createProgram=function(t,e){this._cgl.printError("_createprogram");const i=this._cgl.gl.createProgram();return this._cgl.printError("gl.createprogram"),this.vshader=vt.createShader(this._cgl,t,this._cgl.gl.VERTEX_SHADER,this),this._cgl.printError("createshader"),this.fshader=vt.createShader(this._cgl,e,this._cgl.gl.FRAGMENT_SHADER,this),this._cgl.printError("createshader"),this._cgl.gl.attachShader(i,this.vshader),this._cgl.printError("attachshader "),this._cgl.gl.attachShader(i,this.fshader),this._cgl.printError("attachshader "),this._linkProgram(i,t,e),this._cgl.printError("shader linkprogram err"),i},vt.prototype.hasErrors=function(){return this._hasErrors},vt.prototype._linkProgram=function(t,e,i){this._cgl.printError("_linkprogram"),this._feedBackNames.length>0&&this._cgl.gl.transformFeedbackVaryings(t,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS),this._cgl.gl.linkProgram(t),this._cgl.printError("gl.linkprogram"),this._isValid=!0,this._hasErrors=!1,!1!==this._cgl.patch.config.glValidateShader&&(this._cgl.gl.validateProgram(t),this._cgl.gl.getProgramParameter(t,this._cgl.gl.LINK_STATUS)||(this._hasErrors=!0,this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader)||"empty shader infolog"),this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader)||"empty shader infolog"),this._log.error(this._name+" shader linking fail..."),console.log("srcFrag",i),console.log("srcVert",e),console.log(this._name+" programinfo: ",this._cgl.gl.getProgramInfoLog(t)),console.log("--------------------------------------"),console.log(this),console.log("--------------------------------------"),this._isValid=!1,this._name="errorshader",this.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader()),this._cgl.printError("shader link err")))},vt.prototype.getProgram=function(){return this._program},vt.prototype.setFeedbackNames=function(t){this.setWhyCompile("setFeedbackNames"),this._needsRecompile=!0,this._feedBackNames=t},vt.prototype.getDefaultVertexShader=vt.getDefaultVertexShader=function(){return"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},vt.prototype.getDefaultFragmentShader=vt.getDefaultFragmentShader=function(t,e,i){return null==t&&(t=.5,e=.5,i=.5),"".endl()+"IN vec2 texCoord;".endl()+"{{MODULES_HEAD}}".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4("+t+","+e+","+i+",1.0);".endl()+"    {{MODULE_COLOR}}".endl()+"    outColor = col;".endl()+"}"},vt.prototype.addAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return;this._attributes.push(t),this._needsRecompile=!0,this.setWhyCompile("addAttribute")},vt.prototype.bindTextures=vt.prototype._bindTextures=function(){this._textureStackTex.length>this._cgl.maxTextureUnits&&this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits);for(let t=0;t<this._textureStackTex.length;t++)if(this._textureStackTex[t]||this._textureStackTexCgl[t]){let e=this._textureStackTex[t];this._textureStackTexCgl[t]&&(e=this._textureStackTexCgl[t].tex||CGL.Texture.getEmptyTexture(this._cgl).tex);let i=!0;this._textureStackUni[t]?(this._textureStackUni[t].setValue(t),i=this._cgl.setTexture(t,e,this._textureStackType[t])):(this._log.warn("no uniform for pushtexture",this._name),i=this._cgl.setTexture(t,e,this._textureStackType[t])),i||this._log.warn("tex bind failed",this.getName(),this._textureStackUni[t])}else this._log.warn("no texture for pushtexture",this._name)},vt.prototype.setUniformTexture=function(t,e){for(let i=0;i<this._textureStackTex.length;i++)if(this._textureStackUni[i]==t){const t=this._textureStackTex[i];return this._textureStackTex[i]=e,t}return null},vt.prototype.pushTexture=function(t,e,i){if(!t)throw new Error("no uniform given to texturestack");if(e){if(!(e.hasOwnProperty("tex")||e instanceof WebGLTexture))return this._log.warn(new Error("invalid texture").stack),void this._log.warn("[cgl_shader] invalid texture...",e);this._textureStackUni.push(t),e.hasOwnProperty("tex")?(this._textureStackTexCgl.push(e),this._textureStackTex.push(null)):(this._textureStackTexCgl.push(null),this._textureStackTex.push(e)),this._textureStackType.push(i)}},vt.prototype.popTexture=function(){this._textureStackUni.pop(),this._textureStackTex.pop(),this._textureStackType.pop()},vt.prototype.popTextures=function(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0},vt.getErrorFragmentShader=function(){return"".endl()+"void main()".endl()+"{".endl()+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;".endl()+"   g= step(0.1,g);".endl()+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);".endl()+"}"},vt.createShader=function(t,e,i,s){if(t.aborted)return;const r=t.gl.createShader(i);if(t.gl.shaderSource(r,e),t.gl.compileShader(r),!t.gl.getShaderParameter(r,t.gl.COMPILE_STATUS)){console.log("compile status: "),i==t.gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),i==t.gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER");let o=t.gl.getShaderInfoLog(r)||"empty shader info log";const h=function(t){const e=[],i=t.split("\n");for(const t in i){const s=i[t].split(":");parseInt(s[2],10)&&e.push(parseInt(s[2],10))}return e}(o);let a='<div class="shaderErrorCode">';const l=e.match(/^.*((\r\n|\n|\r)|$)/gm);for(const t in l){const e=parseInt(t,10)+1,i=e+": "+l[t];console.log(i);let s=!1;for(const t in h)h[t]==e&&(s=!0);s&&(a+='<span class="error">'),a+=(n=i)&&yt.test(n)?n.replace(bt,(function(t){return At[t]})):n||"",s&&(a+="</span>")}console.warn(o),o=o.replace(/\n/g,"<br/>"),a=o+"<br/>"+a+"<br/><br/>",t.patch.emitEvent("criticalError","Shader error "+this._name,a),t.patch.isEditorMode()&&console.log("Shader error "+this._name,a),a+="</div>",this._name="errorshader",s.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader())}var n;return r};const xt=function(){this._arr=[mat4.create()],this._index=0,this.stateCounter=0};xt.prototype.push=function(t){if(this._index++,this.stateCounter++,this._index==this._arr.length){const t=mat4.create();this._arr.push(t)}return mat4.copy(this._arr[this._index],t||this._arr[this._index-1]),this._arr[this._index]},xt.prototype.pop=function(){return this.stateCounter++,this._index--,this._index<0&&(this._index=0),this._arr[this._index]},xt.prototype.length=function(){return this._index};class It{constructor(t){this._cgl=t,this._lastTime=0,this.pause=!1,this.profileUniformCount=0,this.profileShaderBinds=0,this.profileUniformCount=0,this.profileShaderCompiles=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileEffectBuffercreate=0,this.profileShaderGetUniform=0,this.profileFrameBuffercreate=0,this.profileMeshSetGeom=0,this.profileTextureNew=0,this.profileGenMipMap=0,this.profileOnAnimFrameOps=0,this.profileMainloopMs=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.shaderCompileTime=0,this.profileMeshNumElements=0,this.profileMeshAttributes=0,this.profileSingleMeshAttribute=[],this.heavyEvents=[],this.doProfileGlQuery=!1,this.glQueryData={}}clear(){this.profileSingleMeshAttribute={},this.profileMeshAttributes=0,this.profileUniformCount=0,this.profileShaderGetUniform=0,this.profileShaderCompiles=0,this.profileShaderBinds=0,this.profileTextureResize=0,this.profileFrameBuffercreate=0,this.profileEffectBuffercreate=0,this.profileTextureDelete=0,this.profileMeshSetGeom=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileNonTypedAttrib=0,this.profileNonTypedAttribNames="",this.profileTextureNew=0,this.profileGenMipMap=0,this.profileFramebuffer=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.profileMeshNumElements=0}clearGlQuery(){for(let t in this.glQueryData)(!this.glQueryData[t].lastClear||performance.now()-this.glQueryData[t].lastClear>1e3)&&(this.glQueryData[t].time=this.glQueryData[t]._times/this.glQueryData[t]._numcount,this.glQueryData[t].num=this.glQueryData[t]._numcount,this.glQueryData[t]._times=0,this.glQueryData[t]._numcount=0,this.glQueryData[t].lastClear=performance.now())}addHeavyEvent(t,e,i){const s={event:t,name:e,info:i,date:performance.now()};this.heavyEvents.push(s),this._cgl.emitEvent("heavyEvent",s)}}const Ot=function(t){p.apply(this),this.profileData=new It(this),this._log=new _("cgl_context");const e=[0,0,0,0];this.glVersion=0,this.glUseHalfFloatTex=!1,this.clearCanvasTransparent=!0,this.clearCanvasDepth=!0,this.patch=t,this.debugOneFrame=!1,this.maxTextureUnits=0,this.maxVaryingVectors=0,this.currentProgram=null,this._hadStackError=!1,this.glSlowRenderer=!1,this.temporaryTexture=null,this.frameStore={},this._onetimeCallbacks=[],this.gl=null,this._cursor="auto",this._currentCursor="",this.pMatrix=mat4.create(),this.mMatrix=mat4.create(),this.vMatrix=mat4.create(),this._textureslots=[],this._pMatrixStack=new xt,this._mMatrixStack=new xt,this._vMatrixStack=new xt,this._glFrameBufferStack=[],this._frameBufferStack=[],this._shaderStack=[],this._stackDepthTest=[],Object.defineProperty(this,"mvMatrix",{get(){return this.mMatrix},set(t){this.mMatrix=t}}),this.canvas=null,this.pixelDensity=1,mat4.identity(this.mMatrix),mat4.identity(this.vMatrix);const i=new vt(this,"simpleshader");i.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]),i.setSource(vt.getDefaultVertexShader(),vt.getDefaultFragmentShader());let s=i;this.aborted=!1;const r=[];this.addEventListener=function(t,e){console.log("cgl state old addEventListener"),this._log.stack("cgl state old addEventListener"),"resize"==t&&r.push(e)},this.removeEventListener=function(t,e){if("resize"==t)for(const t in r)if(r[t]==e)return void r.splice(t,1)},this.exitError=function(t,e){this.patch.exitError(t,e),this.aborted=!0},this.setCanvas=function(t){if(this.canvas="string"==typeof t?document.getElementById(t):t,this.patch.config.canvas||(this.patch.config.canvas={}),this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer")||(this.patch.config.canvas.preserveDrawingBuffer=!1),this.patch.config.canvas.hasOwnProperty("premultipliedAlpha")||(this.patch.config.canvas.premultipliedAlpha=!1),this.patch.config.canvas.hasOwnProperty("alpha")||(this.patch.config.canvas.alpha=!1),this.patch.config.hasOwnProperty("clearCanvasColor")&&(this.clearCanvasTransparent=this.patch.config.clearCanvasColor),this.patch.config.hasOwnProperty("clearCanvasDepth")&&(this.clearCanvasDepth=this.patch.config.clearCanvasDepth),this.patch.config.canvas.forceWebGl1||(this.gl=this.canvas.getContext("webgl2",this.patch.config.canvas)),this.gl&&"WebGL 1.0"!=this.gl.getParameter(this.gl.VERSION)?this.glVersion=2:(this.gl=this.canvas.getContext("webgl",this.patch.config.canvas)||this.canvas.getContext("experimental-webgl",this.patch.config.canvas),this.glVersion=1,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i))&&(this.glUseHalfFloatTex=!0),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(this.patch.config.canvas.hasOwnProperty("powerPreference")||(this.patch.config.canvas.powerPreference="high-performance"))),!this.gl)return void this.exitError("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");const e=this.gl.getExtension("WEBGL_debug_renderer_info");if(e){"Google SwiftShader"===this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)&&(this.glSlowRenderer=!0)}this.gl.getExtension("OES_standard_derivatives");const i=this.gl.getExtension("ANGLE_instanced_arrays")||this.gl;this.canvas.addEventListener("webglcontextlost",t=>{this._log.error("canvas lost...",t),this.aborted=!0}),this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS),this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS),this.maxSamples=0,this.gl.MAX_SAMPLES&&(this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES)),i.vertexAttribDivisorANGLE&&(this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i),this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)),this.updateSize()},this.updateSize=function(){this.canvas.width=this.canvasWidth=this.canvas.clientWidth*this.pixelDensity,this.canvas.height=this.canvasHeight=this.canvas.clientHeight*this.pixelDensity},this.canvasWidth=-1,this.canvasHeight=-1,this.canvasScale=1;let n=-1,o=-1;this.getViewPort=function(){return e},this.resetViewPort=function(){this.gl.viewport(e[0],e[1],e[2],e[3])},this.setViewPort=function(t,i,s,r){e[0]=Math.round(t),e[1]=Math.round(i),e[2]=Math.round(s),e[3]=Math.round(r),this.gl.viewport(e[0],e[1],e[2],e[3])},this.screenShot=function(t,e,i,s){e&&(this.gl.clearColor(1,1,1,1),this.gl.colorMask(!1,!1,!1,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0)),this.canvas&&this.canvas.toBlob&&this.canvas.toBlob(e=>{t?t(e):this._log.log("no screenshot callback...")},i,s)},this.endFrame=function(){if(this.patch.isEditorMode()&&CABLES.GL_MARKER.drawMarkerLayer(this),this.setPreviousShader(),this._vMatrixStack.length()>0&&this.logStackError("view matrix stack length !=0 at end of rendering..."),this._mMatrixStack.length()>0&&this.logStackError("mvmatrix stack length !=0 at end of rendering..."),this._pMatrixStack.length()>0&&this.logStackError("pmatrix stack length !=0 at end of rendering..."),this._glFrameBufferStack.length>0&&this.logStackError("glFrameBuffer stack length !=0 at end of rendering..."),this._stackDepthTest.length>0&&this.logStackError("depthtest stack length !=0 at end of rendering..."),this._stackDepthWrite.length>0&&this.logStackError("depthwrite stack length !=0 at end of rendering..."),this._stackDepthFunc.length>0&&this.logStackError("depthfunc stack length !=0 at end of rendering..."),this._stackBlend.length>0&&this.logStackError("blend stack length !=0 at end of rendering..."),this._stackBlendMode.length>0&&this.logStackError("blendMode stack length !=0 at end of rendering..."),this._shaderStack.length>0&&this.logStackError("this._shaderStack length !=0 at end of rendering..."),this._stackCullFace.length>0&&this.logStackError("this._stackCullFace length !=0 at end of rendering..."),this._stackCullFaceFacing.length>0&&this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering..."),this._frameStarted=!1,n!=this.canvasWidth||o!=this.canvasHeight){n=this.canvasWidth,o=this.canvasHeight,this.setSize(this.canvasWidth/this.pixelDensity,this.canvasHeight/this.pixelDensity),this.updateSize();for(let t=0;t<r.length;t++)r[t]();this.emitEvent("resize")}this._cursor!=this._currentCursor&&(this._currentCursor=this.canvas.style.cursor=this._cursor)},this.logStackError=function(t){this._hadStackError||(this._hadStackError=!0,this._log.warn("["+this.canvas.id+"]: ",t))},this.getShader=function(){if(s&&(!this.frameStore||!0===this.frameStore.renderOffscreen==s.offScreenPass==!0))return s;for(let t=this._shaderStack.length-1;t>=0;t--)if(this._shaderStack[t]&&this.frameStore.renderOffscreen==this._shaderStack[t].offScreenPass)return this._shaderStack[t]},this.getDefaultShader=function(){return i},this.pushShader=this.setShader=function(t){this._shaderStack.push(t),s=t},this.popShader=this.setPreviousShader=function(){if(0===this._shaderStack.length)throw new Error("Invalid shader stack pop!");this._shaderStack.pop(),s=this._shaderStack[this._shaderStack.length-1]},this.pushGlFrameBuffer=function(t){this._glFrameBufferStack.push(t)},this.popGlFrameBuffer=function(){return 0==this._glFrameBufferStack.length?null:(this._glFrameBufferStack.pop(),this._glFrameBufferStack[this._glFrameBufferStack.length-1])},this.getCurrentGlFrameBuffer=function(){return 0===this._glFrameBufferStack.length?null:this._glFrameBufferStack[this._glFrameBufferStack.length-1]},this.pushFrameBuffer=function(t){this._frameBufferStack.push(t)},this.popFrameBuffer=function(){return 0==this._frameBufferStack.length?null:(this._frameBufferStack.pop(),this._frameBufferStack[this._frameBufferStack.length-1])},this.getCurrentFrameBuffer=function(){return 0===this._frameBufferStack.length?null:this._frameBufferStack[this._frameBufferStack.length-1]};const h=vec3.create();vec3.set(h,0,0,2);const a=vec3.create();vec3.set(a,0,0,0),this.renderStart=function(t,e,s){e||(e=a),s||(s=h),this.pushDepthTest(!0),this.pushDepthWrite(!0),this.pushDepthFunc(t.gl.LEQUAL),this.pushCullFaceFacing(t.gl.BACK),this.pushCullFace(!1),this.clearCanvasTransparent&&(t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT)),this.clearCanvasDepth&&t.gl.clear(t.gl.DEPTH_BUFFER_BIT),t.setViewPort(0,0,t.canvasWidth,t.canvasHeight),mat4.perspective(t.pMatrix,45,t.canvasWidth/t.canvasHeight,.1,1e3),mat4.identity(t.mMatrix),mat4.identity(t.vMatrix),mat4.translate(t.mMatrix,t.mMatrix,e),mat4.translate(t.vMatrix,t.vMatrix,s),t.pushPMatrix(),t.pushModelMatrix(),t.pushViewMatrix(),t.pushBlendMode(ot.BLEND_MODES.BLEND_NORMAL,!1);for(let t=0;t<this._textureslots.length;t++)this._textureslots[t]=null;if(this.pushShader(i),this._frameStarted=!0,this._onetimeCallbacks.length>0){for(let t=0;t<this._onetimeCallbacks.length;t++)this._onetimeCallbacks[t]();this._onetimeCallbacks.length=0}this.emitEvent("beginFrame")},this.renderEnd=function(t){t.popViewMatrix(),t.popModelMatrix(),t.popPMatrix(),this.popDepthTest(),this.popDepthWrite(),this.popDepthFunc(),this.popCullFaceFacing(),this.popCullFace(),this.popBlend(),this.popBlendMode(),t.endFrame(),this.emitEvent("endFrame")},this.getTexture=function(t){return this._textureslots[t]},this.checkFrameStarted=function(t){this._frameStarted||(this._log.warn("frame not started "+t),this.patch.printTriggerStack())},this.setTexture=function(t,e,i){return this.checkFrameStarted("cgl setTexture"),null===e&&(e=CGL.Texture.getEmptyTexture(this).tex),this._textureslots[t]!=e&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(i||this.gl.TEXTURE_2D,e),this._textureslots[t]=e),!0},this.fullScreen=function(){this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.mozRequestFullScreen?this.canvas.mozRequestFullScreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen()},this.setSize=function(t,e,i){i||(this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"),this.canvas.width=t*this.pixelDensity,this.canvas.height=e*this.pixelDensity,this.updateSize()},this._resizeToWindowSize=function(){this.setSize(window.innerWidth,window.innerHeight),this.updateSize()},this._resizeToParentSize=function(){const t=this.canvas.parentElement;t?(this.setSize(t.clientWidth,t.clientHeight),this.updateSize()):this._log.error("cables: can not resize to container element")},this.setAutoResize=function(t){window.removeEventListener("resize",this._resizeToWindowSize.bind(this)),window.removeEventListener("resize",this._resizeToParentSize.bind(this)),"window"==t&&(window.addEventListener("resize",this._resizeToWindowSize.bind(this)),window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this)),this._resizeToWindowSize()),"parent"==t&&(window.addEventListener("resize",this._resizeToParentSize.bind(this)),this._resizeToParentSize())},this.printError=function(t){let e=!1,i=this.gl.getError();if(i!=this.gl.NO_ERROR){let s="";i==this.gl.OUT_OF_MEMORY&&(s="OUT_OF_MEMORY"),i==this.gl.INVALID_ENUM&&(s="INVALID_ENUM"),i==this.gl.INVALID_OPERATION&&(s="INVALID_OPERATION"),i==this.gl.INVALID_FRAMEBUFFER_OPERATION&&(s="INVALID_FRAMEBUFFER_OPERATION"),i==this.gl.INVALID_VALUE&&(s="INVALID_VALUE"),i==this.gl.CONTEXT_LOST_WEBGL&&(this.aborted=!0,s="CONTEXT_LOST_WEBGL"),i==this.gl.NO_ERROR&&(s="NO_ERROR"),e=!0,this._log.warn("gl error ["+this.canvas.id+"]: ",t,i,s),this._loggedGlError||(this.patch.printTriggerStack(),this._log.stack("glerror"),this._loggedGlError=!0)}return i=this.gl.getError(),e},this.saveScreenshot=function(t,e,i,s,r){this.patch.renderOneFrame();let n=this.canvas.clientWidth,o=this.canvas.clientHeight;function h(t,e,i){return Array(e-String(t).length+1).join(i||"0")+t}i&&(this.canvas.width=i,n=i),s&&(this.canvas.height=s,o=s);const a=new Date,l="".concat(String(a.getFullYear())+String(a.getMonth()+1)+String(a.getDate()),"_").concat(h(a.getHours(),2)).concat(h(a.getMinutes(),2)).concat(h(a.getSeconds(),2));t?t+=".png":t="cables_"+l+".png",this.patch.cgl.screenShot(function(i){if(this.canvas.width=n,this.canvas.height=o,i){const s=document.createElement("a");s.download=t,s.href=URL.createObjectURL(i),setTimeout((function(){s.click(),e&&e(i)}),100)}else this._log.log("screenshot: no blob")}.bind(this),r)}};Ot.prototype.addNextFrameOnceCallback=function(t){t&&this._onetimeCallbacks.push(t)},Ot.prototype.pushViewMatrix=function(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)},Ot.prototype.popViewMatrix=function(){this.vMatrix=this._vMatrixStack.pop()},Ot.prototype.getViewMatrixStateCount=function(){return this._vMatrixStack.stateCounter},Ot.prototype.pushPMatrix=function(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)},Ot.prototype.popPMatrix=function(){return this.pMatrix=this._pMatrixStack.pop(),this.pMatrix},Ot.prototype.getProjectionMatrixStateCount=function(){return this._pMatrixStack.stateCounter},Ot.prototype.pushMvMatrix=Ot.prototype.pushModelMatrix=function(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)},Ot.prototype.popMvMatrix=Ot.prototype.popmMatrix=Ot.prototype.popModelMatrix=function(){return this.mMatrix=this._mMatrixStack.pop(),this.mMatrix},Ot.prototype.modelMatrix=function(){return this.mMatrix},Ot.prototype._stackDepthTest=[],Ot.prototype.pushDepthTest=function(t){this._stackDepthTest.push(t),t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype.stateDepthTest=function(){return this._stackDepthTest[this._stackDepthTest.length-1]},Ot.prototype.popDepthTest=function(){this._stackDepthTest.pop(),this._stackDepthTest[this._stackDepthTest.length-1]?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype._stackDepthWrite=[],Ot.prototype.pushDepthWrite=function(t){this._stackDepthWrite.push(t),this.gl.depthMask(t)},Ot.prototype.stateDepthWrite=function(){return this._stackDepthWrite[this._stackDepthWrite.length-1]},Ot.prototype.popDepthWrite=function(){this._stackDepthWrite.pop(),this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1])},Ot.prototype._stackCullFace=[],Ot.prototype.pushCullFace=function(t){this._stackCullFace.push(t),t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype.stateCullFace=function(){return this._stackCullFace[this._stackCullFace.length-1]},Ot.prototype.popCullFace=function(){this._stackCullFace.pop(),this._stackCullFace[this._stackCullFace.length-1]?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype._stackCullFaceFacing=[],Ot.prototype.pushCullFaceFacing=function(t){this._stackCullFaceFacing.push(t),this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype.stateCullFaceFacing=function(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]},Ot.prototype.popCullFaceFacing=function(){this._stackCullFaceFacing.pop(),this._stackCullFaceFacing.length>0&&this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype._stackDepthFunc=[],Ot.prototype.pushDepthFunc=function(t){this._stackDepthFunc.push(t),this.gl.depthFunc(t)},Ot.prototype.stateDepthFunc=function(){return this._stackDepthFunc.length>0&&this._stackDepthFunc[this._stackDepthFunc.length-1]},Ot.prototype.popDepthFunc=function(){this._stackDepthFunc.pop(),this._stackDepthFunc.length>0&&this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])},Ot.prototype._stackBlend=[],Ot.prototype.pushBlend=function(t){this._stackBlend.push(t),t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.popBlend=function(){this._stackBlend.pop(),this._stackBlend[this._stackBlend.length-1]?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.stateBlend=function(){return this._stackBlend[this._stackBlend.length-1]};Ot.prototype._stackBlendMode=[],Ot.prototype._stackBlendModePremul=[],Ot.prototype.pushBlendMode=function(t,e){this._stackBlendMode.push(t),this._stackBlendModePremul.push(e);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==ot.BLEND_MODES.BLEND_NONE),this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])},Ot.prototype.popBlendMode=function(){this._stackBlendMode.pop(),this._stackBlendModePremul.pop();const t=this._stackBlendMode.length-1;this.popBlend(this._stackBlendMode[t]!==ot.BLEND_MODES.BLEND_NONE),t>=0&&this._setBlendMode(this._stackBlendMode[t],this._stackBlendModePremul[t])},Ot.prototype.glGetAttribLocation=function(t,e){return this.gl.getAttribLocation(t,e)},Ot.prototype.shouldDrawHelpers=function(t){return!this.frameStore.shadowPass&&(!!t.patch.isEditorMode()&&(CABLES.UI.renderHelper||CABLES.UI.renderHelperCurrent&&t.isCurrentUiOp()))},Ot.prototype._setBlendMode=function(t,e){const i=this.gl;t==ot.BLEND_MODES.BLEND_NONE||(t==ot.BLEND_MODES.BLEND_ADD?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE)):t==ot.BLEND_MODES.BLEND_SUB?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)):t==ot.BLEND_MODES.BLEND_MUL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.SRC_COLOR)):t==ot.BLEND_MODES.BLEND_NORMAL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):this._log.log("setblendmode: unknown blendmode"))},Ot.prototype.setCursor=function(t){this._cursor=t};const Rt=Object.assign({Framebuffer:function(t,e,i,s){const r=t;this._log=new _("Framebuffer");const n=r.gl.getExtension("WEBGL_depth_texture")||r.gl.getExtension("WEBKIT_WEBGL_depth_texture")||r.gl.getExtension("MOZ_WEBGL_depth_texture")||r.gl.DEPTH_TEXTURE;n||r.exitError("NO_DEPTH_TEXTURE","no depth texture support");let o=e||512,h=i||512;(s=s||{isFloatingPointTexture:!1}).hasOwnProperty("clear")||(s.clear=!0),s.hasOwnProperty("filter")||(s.filter=tt.FILTER_LINEAR);const a=new tt(r,{isFloatingPointTexture:s.isFloatingPointTexture,filter:s.filter,wrap:s.wrap||tt.CLAMP_TO_EDGE});let l=null;n&&(l=new tt(r,{isDepthTexture:!0})),this._options=s;const c=r.gl.createFramebuffer(),u=r.gl.createRenderbuffer();this.getWidth=function(){return o},this.getHeight=function(){return h},this.getGlFrameBuffer=function(){return c},this.getDepthRenderBuffer=function(){return u},this.getTextureColor=function(){return a},this.getTextureDepth=function(){return l},this.setFilter=function(t){a.filter=t,a.setSize(o,h)},this.setSize=function(t,e){if(t<2&&(t=2),e<2&&(e=2),o=Math.ceil(t),h=Math.ceil(e),r.profileData.profileFrameBuffercreate++,r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,c),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,u),a.setSize(o,h),l&&l.setSize(o,h),n&&r.gl.renderbufferStorage(r.gl.RENDERBUFFER,r.gl.DEPTH_COMPONENT16,o,h),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.COLOR_ATTACHMENT0,r.gl.TEXTURE_2D,a.tex,0),n&&(r.gl.framebufferRenderbuffer(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.RENDERBUFFER,u),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.TEXTURE_2D,l.tex,0)),!r.gl.isFramebuffer(c))throw new Error("Invalid framebuffer");const i=r.gl.checkFramebufferStatus(r.gl.FRAMEBUFFER);switch(i){case r.gl.FRAMEBUFFER_COMPLETE:break;case r.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",o,h,a.tex,u),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case r.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");case 36059:this._log.warn("Incomplete: FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER from ext. Or Safari/iOS undefined behaviour.");break;default:throw this._log.warn("incomplete framebuffer",i),new Error("Incomplete framebuffer: "+i)}r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,null),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,null)},this.renderStart=function(){r.pushModelMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,c),r.pushGlFrameBuffer(c),r.pushFrameBuffer(this),r.pushPMatrix(),r.gl.viewport(0,0,o,h),this._options.clear&&(r.gl.clearColor(0,0,0,0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT))},this.renderEnd=function(){r.popPMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,r.popGlFrameBuffer()),r.popFrameBuffer(),r.popModelMatrix(),r.resetViewPort()},this.delete=function(){a.delete(),l&&l.delete(),r.gl.deleteRenderbuffer(u),r.gl.deleteFramebuffer(c)},this.setSize(o,h)},Framebuffer2:et,Geometry:st,BoundingBox:it,Marker:function(t){const e=new st("marker");e.setPointVertices([1e-5,0,0,1,0,0,0,1e-5,0,0,1,0,0,0,1e-5,0,0,1]);const i=new at(t,e,t.gl.LINES);i.setGeom(e);const s=new vt(t,"markermaterial"),r="".endl()+"precision highp float;".endl()+"IN vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4(axisColor,1.0);".endl()+"    outColor = col;".endl()+"}",n="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"OUT vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"   vec4 pos=vec4(vPosition, 1.0);".endl()+"   if(pos.x!=0.0)axisColor=vec3(1.0,0.3,0.0);".endl()+"   if(pos.y!=0.0)axisColor=vec3(0.0,1.0,0.2);".endl()+"   if(pos.z!=0.0)axisColor=vec3(0.0,0.5,1.0);".endl()+"   gl_Position = projMatrix * mvMatrix * pos;".endl()+"}";s.setSource(n,r),this._vScale=vec3.create(),this.draw=function(t,e,r){const n=e||2;t.pushModelMatrix(),t.pushShader(s),vec3.set(this._vScale,n,n,n),mat4.scale(t.mvMatrix,t.mvMatrix,this._vScale),t.pushDepthTest(1==r),i.render(t.getShader()),t.popDepthTest(),t.popShader(),t.popModelMatrix()}},WirePoint:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s){t.pushModelMatrix(),vec3.set(i,s,s,s),mat4.scale(t.mvMatrix,t.mvMatrix,i);const r=t.getShader();r&&(r.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(r.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(r.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];let s=0,r=0;for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(0),i.push(.5*Math.sin(r));for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r)),i.push(0);for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(0),i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r));t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},WireCube:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s,r,n){t.pushModelMatrix(),vec3.set(i,s||1,r||1,n||1),mat4.scale(t.mvMatrix,t.mvMatrix,i);const o=t.getShader();o&&(o.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(o.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(o.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];i.push(-1,-1,1),i.push(1,-1,1),i.push(1,1,1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(-1,1,-1),i.push(-1,-1,-1),i.push(-1,-1,-1),i.push(-1,1,-1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(1,1,1),i.push(1,-1,1),i.push(1,-1,-1),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},MatrixStack:xt,Mesh:at,MESH:ht,ShaderLibMods:ut,Shader:vt,Uniform:rt,MESHES:lt,Context:Ot,Texture:tt,TextureEffect:ct,isWindows:ft,getWheelSpeed:Et,getWheelDelta:Tt,onLoadingAssetsFinished:null,profileData:void 0,UniColorShader:class{constructor(t){this.shader=new CGL.Shader(t,"markermaterial");const e="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}",i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,e),this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(t,e,i,s){this.coloruni.set(t,e,i,s)}}},ot.BLEND_MODES,ot.SHADER,ot.MATH,ot.BLEND_MODES);window.CGL=Rt;const Pt=function(t){this._log=new _("LoadingStatus"),this._loadingAssets={},this._cbFinished=[],this._assetTasks=[],this._percent=0,this._count=0,this._countFinished=0,this._order=0,this._startTime=0,this._patch=t,this._wasFinishedPrinted=!1,this._loadingAssetTaskCb=!1};Pt.prototype.setOnFinishedLoading=function(t){this._cbFinished.push(t)},Pt.prototype.getNumAssets=function(){return this._countFinished},Pt.prototype.getProgress=function(){return this._percent},Pt.prototype.checkStatus=function(){this._countFinished=0,this._count=0;for(const t in this._loadingAssets)this._count++,this._loadingAssets[t].finished||this._countFinished++;if(this._percent=(this._count-this._countFinished)/this._count,0===this._countFinished){for(let t=0;t<this._cbFinished.length;t++)if(this._cbFinished[t]){const e=this._cbFinished[t];setTimeout(()=>{e(this._patch)},200)}this._wasFinishedPrinted||(this._wasFinishedPrinted=!0,this.print())}},Pt.prototype.getListJobs=function(){let t=[];for(const e in this._loadingAssets)this._loadingAssets[e].finished||t.push(this._loadingAssets[e].name);return t},Pt.prototype.print=function(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets)t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"]);this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s"),this._log.table(t),this._log.groupEnd()},Pt.prototype.finished=function(t){this._loadingAssets[t]&&(this._loadingAssets[t].finished=!0,this._loadingAssets[t].timeEnd=Date.now()),this.checkStatus()},Pt.prototype._startAssetTasks=function(){for(let t=0;t<this._assetTasks.length;t++)this._assetTasks[t]();this._assetTasks.length=0},Pt.prototype.addAssetLoadingTask=function(t){this._patch.isEditorMode()&&!CABLES.UI.loaded?(this._assetTasks.push(t),this._loadingAssetTaskCb||window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this)),this._loadingAssetTaskCb=!0):t()},Pt.prototype.existByName=function(t){for(let e in this._loadingAssets)if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return!0},Pt.prototype.start=function(t,e){0==this._startTime&&(this._startTime=Date.now());const i=b();return this._loadingAssets[i]={id:i,type:t,name:e,finished:!1,timeStart:Date.now(),order:this._order},this._order++,i};const St=function(){this._loops=[],this._indizes=[],this._index=0};St.prototype.pushLoop=function(t){this._loops.push(Math.abs(Math.floor(t))),this._indizes.push(this._index)},St.prototype.popLoop=function(){this._loops.pop(),this._index=this._indizes.pop(),0===this._loops.length&&(this._index=0)},St.prototype.numLoops=function(){return this._loops.length},St.prototype.numCycles=function(){if(0===this._loops.length)return 0;let t=this._loops[0];for(let e=1;e<this._loops.length;e++)t*=this._loops[e];return t},St.prototype.inLoop=function(){return this._loops.length>0},St.prototype.increment=function(){this._index++},St.prototype.index=function(){return this._index};const Nt=function(t){this.startFrame=t.getFrameNum();let e={},i=null,s=0;this.getItems=function(){return e},this.clear=function(){e={}},this.add=function(r,n){null!==i&&(n&&n.id==i||e[i]&&(e[i].timeUsed+=performance.now()-s,(!e[i].peakTime||pt()-e[i].peakTime>5e3)&&(e[i].peak=0,e[i].peakTime=pt()),e[i].peak=Math.max(e[i].peak,performance.now()-s))),null!==n?(e[n.id]||(e[n.id]={numTriggers:0,timeUsed:0}),e[n.id].lastFrame!=t.getFrameNum()&&(e[n.id].numTriggers=0),e[n.id].lastFrame=t.getFrameNum(),e[n.id].numTriggers++,e[n.id].opid=n.parent.id,e[n.id].title=n.parent.name+"."+n.name,e[n.id].subPatch=n.parent.uiAttribs.subPatch,i=n.id,s=performance.now()):i=null},this.print=function(){console.log("--------");for(const t in e)console.log(e[t].title+": "+e[t].numTriggers+" / "+e[t].timeUsed)}},Ft=function(t){this._patch=t,this.result=[]};Ft.MIDI=0,Ft.POINTERLOCK=1,Ft.WEBAUDIO=2,Ft.WEBGL2=3,(Ft.infos=[])[Ft.POINTERLOCK]={title:"pointerLock",caniuse:"https://caniuse.com/#search=pointerlock"},Ft.infos[Ft.MIDI]={title:"midi API",caniuse:"https://caniuse.com/#search=midi"},Ft.infos[Ft.WEBAUDIO]={title:"web audio",caniuse:"https://caniuse.com/#search=webaudio"},Ft.infos[Ft.WEBGL2]={title:"WebGL 2"},Ft.prototype.checkRequirement=function(t,e){switch(this.result=[],t){case Ft.WEBGL2:return e.patch.cgl.glVersion>=2;case Ft.POINTERLOCK:return"exitPointerLock"in document;case Ft.MIDI:return"MIDIAccess"in window;case Ft.WEBAUDIO:let t=!1;return window.audioContext&&(t=!0),t||!("webkitAudioContext"in window)&&!("AudioContext"in window)||(t=!0),t}},Ft.prototype.checkOp=function(t){if(t&&t.requirements)for(let e=0;e<t.requirements.length;e++){const i=t.requirements[e];if(!this.result[i]){const e=this.checkRequirement(i,t);if(!e){t.patch.cgl&&t.patch.cgl.canvas&&t.patch.cgl.canvas.remove();let e=Ft.infos[i].title;Ft.infos[i].caniuse&&(e='<a href="'+Ft.infos[i].caniuse+'" target="_blank">'+Ft.infos[i].title+" ("+t.objName+")</a>"),console.warn("this browser does not meet requirement: "+Ft.infos[i].title+" ("+t.objName+")")}this.result[i]={success:e,info:Ft.infos[i]}}}};const Ct=function(t){p.apply(this),this._log=new _("core_patch"),this.ops=[],this.settings={},this.config=t||{glCanvasResizeToWindow:!1,prefixAssetPath:"",prefixJsPath:"",silent:!0,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0},this.timer=new gt,this.freeTimer=new gt,this.animFrameOps=[],this.animFrameCallbacks=[],this.gui=!1,CABLES.logSilent=this.silent=!0,this.profiler=null,this.aborted=!1,this._crashedOps=[],this._renderOneFrame=!1,this._animReq=null,this._opIdCache={},this._triggerStack=[],this.loading=new Pt(this),this._perf={fps:0,ms:0,_fpsFrameCount:0,_fpsMsCount:0,_fpsStart:0},this._volumeListeners=[],this._paused=!1,this._frameNum=0,this.instancing=new St,this.onOneFrameRendered=null,this.namedTriggers={},this._origData=null,this._frameNext=0,this._frameInterval=0,this._lastFrameTime=0,this._frameWasdelayed=!0,function(){return!this}()||this._log.warn("not in strict mode: core patch"),this._isLocal=0===document.location.href.indexOf("file:"),this.config.hasOwnProperty("silent")&&(this.silent=CABLES.logSilent=this.config.silent),this.config.hasOwnProperty("doRequestAnimation")||(this.config.doRequestAnimation=!0),this.config.prefixAssetPath||(this.config.prefixAssetPath=""),this.config.prefixJsPath||(this.config.prefixJsPath=""),this.config.masterVolume||(this.config.masterVolume=1),this._variables={},this._variableListeners=[],this.vars={},t&&t.vars&&(this.vars=t.vars),this.cgl=new Ot(this),this.cgl.setCanvas(this.config.glCanvasId||this.config.glCanvas||"glcanvas"),!0===this.config.glCanvasResizeToWindow&&this.cgl.setAutoResize("window"),!0===this.config.glCanvasResizeToParent&&this.cgl.setAutoResize("parent"),this.loading.setOnFinishedLoading(this.config.onFinishedLoading),this.cgl.aborted&&(this.aborted=!0),this.cgl.silent&&(this.silent=!0),this.freeTimer.play(),this.exec(),this.aborted||(this.config.patch?this.deSerialize(this.config.patch):this.config.patchFile&&w(this.config.patchFile,(t,e)=>{const i=JSON.parse(e);if(t){return this._log.error("err",t),this._log.error("data",i),void this._log.error("data",i.msg)}this.deSerialize(i)}),this.timer.play()),console.log("made with https://cables.gl")};Ct.prototype.isPlaying=function(){return!this._paused},Ct.prototype.isRenderingOneFrame=function(){return this._renderOneFrame},Ct.prototype.renderOneFrame=function(){this._paused=!0,this._renderOneFrame=!0,this.exec(),this._renderOneFrame=!1},Ct.prototype.getFPS=function(){return this._perf.fps},Ct.prototype.isEditorMode=function(){return!0===this.config.editorMode},Ct.prototype.pause=function(){cancelAnimationFrame(this._animReq),this.emitEvent("pause"),this._animReq=null,this._paused=!0,this.freeTimer.pause()},Ct.prototype.resume=function(){this._paused&&(cancelAnimationFrame(this._animReq),this._paused=!1,this.freeTimer.play(),this.emitEvent("resume"),this.exec())},Ct.prototype.setVolume=function(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)},Ct.prototype.getAssetPath=function(){if(this.isEditorMode())return"/assets/"+gui.project()._id+"/";if(document.location.href.indexOf("cables.gl")>0){const t=document.location.href.split("/");return"/assets/"+t[t.length-1]+"/"}return"assets/"},Ct.prototype.getFilePath=function(t){return this._isLocal&&!this.config.allowLocalFileAccess&&this.exitError("localAccess","Browser security forbids loading files directly without a webserver. Upload files to a server to work. use allowLocalFileAccess:true to ignore this."),t?0===(t=String(t)).indexOf("https:")||0===t.indexOf("http:")?t:(t=t.replace("//","/"),this.config.prefixAssetPath+t+(this.config.suffixAssetPath||"")):t},Ct.prototype.clear=function(){for(this.cgl.TextureEffectMesh=null,this.animFrameOps.length=0,this.timer=new gt;this.ops.length>0;)this.deleteOp(this.ops[0].id)},Ct.getOpClass=function(t){const e=t.split(".");let i=null;try{return 2==e.length?i=window[e[0]][e[1]]:3==e.length?i=window[e[0]][e[1]][e[2]]:4==e.length?i=window[e[0]][e[1]][e[2]][e[3]]:5==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]]:6==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]]:7==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]]:8==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]]:9==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]]:10==e.length&&(i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]][e[9]]),i}catch(t){return null}},Ct.prototype.createOp=function(t,e){const i=t.split(".");let s=null,r="";try{if(-1==t.indexOf("Ops.")){const i=t;if(!CABLES.OPS[i])throw new Error("could not find op by id: "+i);r=CABLES.OPS[i].objName,s=new CABLES.OPS[i].f(this,r,e,i),s.opId=i}if(!s){r=t;if(!Ct.getOpClass(r))throw this.emitEvent("criticalError","unknown op","unknown op: "+r),this._log.error("unknown op: "+r),new Error("unknown op: "+r);if(2==i.length?s=new window[i[0]][i[1]](this,r,e):3==i.length?s=new window[i[0]][i[1]][i[2]](this,r,e):4==i.length?s=new window[i[0]][i[1]][i[2]][i[3]](this,r,e):5==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]](this,r,e):6==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]](this,r,e):7==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]](this,r,e):8==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]](this,r,e):9==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]](this,r,e):10==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]][i[9]](this,r,e):this._log.warn("parts.length",i.length),s){s.opId=null;for(const t in CABLES.OPS)CABLES.OPS[t].objName==r&&(s.opId=t)}}}catch(t){if(this._crashedOps.push(r),this.emitEvent("exceptionOp",t,r),!this.isEditorMode())throw this._log.error(t),this._log.error("[instancing error] "+r,t),CABLES.api&&CABLES.api.sendErrorReport(t),this.exitError("INSTANCE_ERR","Instancing Error "+r,t),new Error("instancing error "+r)}return s?(s.objName=r,s.patch=this):this._log.log("no op was created!?",t,e),s},Ct.prototype.addOp=function(t,e,i,s){const r=this.createOp(t,i);if(r){if(e&&e.hasOwnProperty("errors")&&delete e.errors,e&&e.hasOwnProperty("error")&&delete e.error,r.uiAttr(e),r.onCreate&&r.onCreate(),r.hasOwnProperty("onAnimFrame")&&this.addOnAnimFrame(r),r.hasOwnProperty("onMasterVolumeChanged")&&this._volumeListeners.push(r),this._opIdCache[r.id])return void this._log.warn("opid with id "+r.id+" already exists in patch!");this.ops.push(r),this._opIdCache[r.id]=r,this.emitEvent("onOpAdd",r,s),r.init&&r.init()}else this._log.error("addop: no op.....");return r},Ct.prototype.addOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return;this.animFrameOps.push(t)},Ct.prototype.removeOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return void this.animFrameOps.splice(e,1)},Ct.prototype.addOnAnimFrameCallback=function(t){this.animFrameCallbacks.push(t)},Ct.prototype.removeOnAnimCallback=function(t){for(let e=0;e<this.animFrameCallbacks.length;e++)if(this.animFrameCallbacks[e]==t)return void this.animFrameCallbacks.splice(e,1)},Ct.prototype.deleteOp=function(t,e,i){let s=!1;for(const r in this.ops)if(this.ops[r].id==t){const n=this.ops[r];let o=null,h=null;if(n){s=!0,e&&n.portsIn.length>0&&n.portsIn[0].isLinked()&&n.portsOut.length>0&&n.portsOut[0].isLinked()&&n.portsIn[0].getType()==n.portsOut[0].getType()&&(o=n.portsIn[0].links[0].getOtherPort(n.portsIn[0]),h=n.portsOut[0].links[0].getOtherPort(n.portsOut[0]));const a=this.ops[r];a.removeLinks(),a.emitEvent("onDelete",this.ops[r]),this.onDelete&&(this._log.warn("deprecated this.onDelete",this.onDelete),this.onDelete(a)),this.ops.splice(r,1),this.emitEvent("onOpDelete",a,i),a.onDelete&&a.onDelete(i),a.cleanUp(),null!==o&&null!==h&&this.link(o.parent,o.getName(),h.parent,h.getName()),delete this._opIdCache[t];break}}s||this._log.warn("core patch deleteop: not found...")},Ct.prototype.getFrameNum=function(){return this._frameNum},Ct.prototype.renderFrame=function(t){this.timer.update(),this.freeTimer.update();const e=this.timer.getTime(),i=performance.now();for(let t=0;t<this.animFrameCallbacks.length;++t)this.animFrameCallbacks[t]&&this.animFrameCallbacks[t](e,this._frameNum);for(let t=0;t<this.animFrameOps.length;++t)this.animFrameOps[t].onAnimFrame&&this.animFrameOps[t].onAnimFrame(e);this.cgl.profileData.profileOnAnimFrameOps=performance.now()-i,this.emitEvent("onRenderFrame",e),this._frameNum++,1==this._frameNum&&this.config.onFirstFrameRendered&&this.config.onFirstFrameRendered()},Ct.prototype.exec=function(t){if(!this._renderOneFrame&&(this._paused||this.aborted))return;this.config.fpsLimit=this.config.fpsLimit||0,this.config.fpsLimit&&(this._frameInterval=1e3/this.config.fpsLimit);const e=CABLES.now(),i=e-this._frameNext;if(this.isEditorMode()&&!this._renderOneFrame&&e-this._lastFrameTime>=500&&0!==this._lastFrameTime&&!this._frameWasdelayed)return this._lastFrameTime=0,setTimeout(this.exec.bind(this),500),this.emitEvent("renderDelayStart"),void(this._frameWasdelayed=!0);if(this._renderOneFrame||0===this.config.fpsLimit||i>this._frameInterval||this._frameWasdelayed){const t=CABLES.now();this.renderFrame(),this._perf._lastFrameTime=CABLES.now(),this._perf._fpsFrameCount++,this._perf._fpsMsCount+=CABLES.now()-t,this._frameInterval&&(this._frameNext=e-i%this._frameInterval)}this._frameWasdelayed&&(this.emitEvent("renderDelayEnd"),this._frameWasdelayed=!1),this._renderOneFrame&&(this.onOneFrameRendered&&this.onOneFrameRendered(),this.emitEvent("renderedOneFrame"),this._renderOneFrame=!1),CABLES.now()-this._perf._fpsStart>=1e3&&this._perf.fps!=this._perf._fpsFrameCount&&(this._perf.fps=this._perf._fpsFrameCount,this._perf.ms=Math.round(this._perf._fpsMsCount/this._perf._fpsFrameCount),this.emitEvent("performance",this._perf),this._perf._fpsFrameCount=0,this._perf._fpsMsCount=0,this._perf._fpsStart=CABLES.now()),this.config.doRequestAnimation&&(this._animReq=requestAnimationFrame(this.exec.bind(this)))},Ct.prototype.link=function(t,e,i,s,r,n){if(!t)return void this._log.warn("link: op1 is null ");if(!i)return void this._log.warn("link: op2 is null");const o=t.getPort(e,r),h=i.getPort(s,r);if(o)if(h){if(!o.shouldLink(o,h)||!h.shouldLink(o,h))return!1;if(Q.canLink(o,h)){const t=new Q(this);return t.link(o,h),this.emitEvent("onLink",o,h,t,n),t}}else this._log.warn("port not found! "+s+" of "+i.name+"("+i.objName+")");else this._log.warn("port not found! "+e+"("+t.objName+")")},Ct.prototype.serialize=function(t){const e={ops:[]};e.settings=this.settings;for(const t in this.ops)e.ops.push(this.ops[t].getSerialized());return t?e:JSON.stringify(e)},Ct.prototype.getOpById=function(t){return this._opIdCache[t]},Ct.prototype.getOpsByName=function(t){const e=[];for(const i in this.ops)this.ops[i].name==t&&e.push(this.ops[i]);return e},Ct.prototype.getOpsByObjName=function(t){const e=[];for(const i in this.ops)this.ops[i].objName==t&&e.push(this.ops[i]);return e},Ct.prototype.loadLib=function(t){M("/ui/libs/"+t+".js",(t,e)=>{const i=document.createElement("script");i.type="text/javascript",i.text=e,document.getElementsByTagName("head")[0].appendChild(i)},"GET")},Ct.prototype.reloadOp=function(t,e){let i=0;const s=[],r=[];for(const e in this.ops)this.ops[e].objName==t&&r.push(this.ops[e]);for(let e=0;e<r.length;e++){i++;const n=r[e];n.deleted=!0;const o=this,h=this.addOp(t,n.uiAttribs);let a,l;for(a in s.push(h),n.portsIn)if(0===n.portsIn[a].links.length){const t=h.getPort(n.portsIn[a].name);t?(t.set(n.portsIn[a].get()),n.portsIn[a].getVariableName()&&t.setVariable(n.portsIn[a].getVariableName())):this._log.error("[reloadOp] could not set port "+n.portsIn[a].name+", propably renamed port ?")}else for(;n.portsIn[a].links.length;){const t=n.portsIn[a].links[0].portIn.name,e=n.portsIn[a].links[0].portOut.name,i=n.portsIn[a].links[0].portOut.parent;n.portsIn[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("[reloadOp] relink after op reload not successfull for port "+e)}for(a in n.portsOut)for(;n.portsOut[a].links.length;){const t=n.portsOut[a].links[0].portOut.name,e=n.portsOut[a].links[0].portIn.name,i=n.portsOut[a].links[0].portIn.parent;n.portsOut[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("relink after op reload not successfull for port "+e)}this.deleteOp(n.id,!1,!0)}e(i,s)},Ct.prototype.getSubPatchOps=function(t){const e=[];for(const i in this.ops)this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&e.push(this.ops[i]);return e},Ct.prototype.getSubPatchOp=function(t,e){for(const i in this.ops)if(this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&this.ops[i].objName==e)return this.ops[i];return!1},Ct.prototype.deSerialize=function(t,e){if(this.aborted)return;const i=this.loading.start("core","deserialize");this.namespace=t.namespace||"",this.name=t.name||"","string"==typeof t&&(t=JSON.parse(t));const s=this;function r(t,e,i,r){s.link(s.getOpById(t),i,s.getOpById(e),r,!1,!0)}this.settings=t.settings;const n=new Ft(this);for(const i in t.ops){const s=CABLES.now(),r=t.ops[i];let o=null;try{o=r.opId?this.addOp(r.opId,r.uiAttribs,r.id,!0):this.addOp(r.objName,r.uiAttribs,r.id,!0)}catch(t){throw this._log.warn("[instancing error] op data:",r,t),new Error("instancing error: "+r.objName)}if(n.checkOp(o),o){e&&(o.id=A()),o.portsInData=r.portsIn,o._origData=r,o.storage=r.storage;for(const t in r.portsIn){const e=r.portsIn[t],i=o.getPort(e.name);!i||"bool"!=i.uiAttribs.display&&"bool"!=i.uiAttribs.type||isNaN(e.value)||(e.value=!0===e.value),i&&void 0!==e.value&&i.type!=B.OP_PORT_TYPE_TEXTURE&&i.set(e.value),i&&i.deSerializeSettings(e)}for(const e in r.portsOut){const s=o.getPort(r.portsOut[e].name);s&&s.type!=B.OP_PORT_TYPE_TEXTURE&&r.portsOut[e].hasOwnProperty("value")&&s.set(t.ops[i].portsOut[e].value)}}const h=Math.round(100*(CABLES.now()-s))/100;!this.silent&&h>200&&this._log.warn("long op init ",t.ops[i].objName,h)}for(const t in this.ops)this.ops[t].onLoadedValueSet&&(this.ops[t].onLoadedValueSet(this.ops[t]._origData),this.ops[t].onLoadedValueSet=null,this.ops[t]._origData=null);if(t.ops)for(let e=0;e<t.ops.length;e++){if(t.ops[e].portsIn)for(let i=0;i<t.ops[e].portsIn.length;i++)if(t.ops[e].portsIn[i].links)for(let s=0;s<t.ops[e].portsIn[i].links.length;s++)t.ops[e].portsIn[i].links[s]&&r(t.ops[e].portsIn[i].links[s].objIn,t.ops[e].portsIn[i].links[s].objOut,t.ops[e].portsIn[i].links[s].portIn,t.ops[e].portsIn[i].links[s].portOut);if(t.ops[e].portsOut)for(let i=0;i<t.ops[e].portsOut.length;i++)if(t.ops[e].portsOut[i].links)for(let s=0;s<t.ops[e].portsOut[i].links.length;s++)t.ops[e].portsOut[i].links[s]&&r(t.ops[e].portsOut[i].links[s].objIn,t.ops[e].portsOut[i].links[s].objOut,t.ops[e].portsOut[i].links[s].portIn,t.ops[e].portsOut[i].links[s].portOut)}for(const t in this.ops)this.ops[t].onLoaded&&(this.ops[t].onLoaded(),this.ops[t].onLoaded=null);for(const t in this.ops)this.ops[t].init&&(this.ops[t].init(),this.ops[t].init=null);if(this.config.variables)for(const t in this.config.variables)this.setVarValue(t,this.config.variables[t]);for(const t in this.ops)this.ops[t].initVarPorts(),delete this.ops[t].uiAttribs.pasted;setTimeout(()=>{this.loading.finished(i)},100),this.config.onPatchLoaded&&this.config.onPatchLoaded(this),this.emitEvent("patchLoadEnd")},Ct.prototype.profile=function(t){this.profiler=new Nt(this);for(const e in this.ops)this.ops[e].profile(t)},(Ct.Variable=function(t,e,i){this._name=t,this._changeListeners=[],this.type=i,this.setValue(e)}).prototype.getValue=function(){return this._v},Ct.Variable.prototype.getName=function(){return this._name},Ct.Variable.prototype.setValue=function(t){this._v=t;for(let e=0;e<this._changeListeners.length;e++)this._changeListeners[e](t,this)},Ct.Variable.prototype.addListener=function(t){-1==this._changeListeners.indexOf(t)&&this._changeListeners.push(t)},Ct.Variable.prototype.removeListener=function(t){const e=this._changeListeners.indexOf(t);this._changeListeners.splice(e,1)},Ct.prototype.setVariable=function(t,e){void 0!==this._variables[t]?this._variables[t].setValue(e):this._log.warn("variable "+t+" not found!")},Ct.prototype._sortVars=function(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((t,e)=>t.localeCompare(e,"en",{sensitivity:"base"})).forEach(e=>{t[e]=this._variables[e]}),this._variables=t},Ct.prototype.hasVar=function(t){return void 0!==this._variables[t]},Ct.prototype.setVarValue=function(t,e,i){return this.hasVar(t)?this._variables[t].setValue(e):(this._variables[t]=new Ct.Variable(t,e,i),this._sortVars(),this.emitEvent("variablesChanged")),this._variables[t]},Ct.prototype.getVarValue=function(t,e){if(this._variables.hasOwnProperty(t))return this._variables[t].getValue()},Ct.prototype.getVar=function(t){if(this._variables.hasOwnProperty(t))return this._variables[t]},Ct.prototype.deleteVar=function(t){for(let e=0;e<this.ops.length;e++)for(let i=0;i<this.ops[e].portsIn.length;i++)this.ops[e].portsIn[i].getVariableName()==t&&this.ops[e].portsIn[i].setVariable(null);delete this._variables[t],this.emitEvent("variableDeleted",t),this.emitEvent("variablesChanged")},Ct.prototype.getVars=function(t){if(void 0===t)return this._variables;const e=[];t==CABLES.OP_PORT_TYPE_STRING&&(t="string"),t==CABLES.OP_PORT_TYPE_VALUE&&(t="number"),t==CABLES.OP_PORT_TYPE_ARRAY&&(t="array"),t==CABLES.OP_PORT_TYPE_OBJECT&&(t="object");for(const i in this._variables)this._variables[i].type&&this._variables[i].type!=t||e.push(this._variables[i]);return e},Ct.prototype.exitError=function(t,e,i){if(this.aborted=!0,this&&this.config&&this.config.onError)this.config.onError(t,e);else if(!this.isEditorMode()){const s=document.createElement("div"),r=this.cgl.canvas.getBoundingClientRect();s.setAttribute("style","position:absolute;border:5px solid red;padding:15px;background-color:black;color:white;font-family:monospace;"),s.style.top=r.top+"px",s.style.left=r.left+"px";let n="cables - An error occured:<br/>";n+="["+t+"] - "+e,i&&(n+="<br/>Exception: "+i.message),s.innerHTML=n;const o=this.cgl.canvas.parentElement;for(;o.hasChildNodes();)o.removeChild(o.lastChild);document.body.appendChild(s)}},Ct.prototype.preRenderOps=function(){this._log.log("prerendering...");for(let t=0;t<this.ops.length;t++)this.ops[t].preRender&&(this.ops[t].preRender(),this._log.log("prerender "+this.ops[t].objName))},Ct.prototype.dispose=function(){this.pause(),this.clear()},Ct.prototype.pushTriggerStack=function(t){this._triggerStack.push(t)},Ct.prototype.popTriggerStack=function(){this._triggerStack.pop()},Ct.prototype.printTriggerStack=function(){if(0==this._triggerStack.length)return void console.log("stack length",this._triggerStack.length);console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].parent.name+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++)t.push(e+". "+this._triggerStack[e].parent.name+" "+this._triggerStack[e].name);console.table(t),console.groupEnd()};var Mt=Ct;const wt={addPatch:function(t,e){let i=t,s=b();if("string"==typeof t&&(s=t,i=document.getElementById(s),!i))return void console.error(s+" Polyshape Container Element not found!");const r=document.createElement("canvas");return r.id="glcanvas_"+s,r.width=i.clientWidth,r.height=i.clientHeight,window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth),this.height=i.clientHeight}.bind(r)),i.appendChild(r),(e=e||{}).glCanvasId=r.id,e.onError||(e.onError=function(t){console.error(t)}),CABLES.patch=new Mt(e),r}},Ut={toneJsInitialized:!1,createAudioContext:function(t){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)return window.audioContext||(window.audioContext=new AudioContext),window.Tone&&!Ut.toneJsInitialized&&(Tone.setContext(window.audioContext),Ut.toneJsInitialized=!0),window.audioContext;t.patch.config.onError("NO_WEBAUDIO","Web Audio is not supported in this browser.")},getAudioContext:function(){return window.audioContext},createAudioInPort:function(t,e,i,s){if(!t||!e||!i){const e="ERROR: createAudioInPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}s||(s=0),t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const r=t.inObject(e);return r.webAudio={},r.webAudio.previousAudioInNode=null,r.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=r,r.onChange=function(){const e=r.get();if(e)try{e.connect?(e.connect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)):t.setUiError("audioCtx","The passed input is not an audio context. Please make sure you connect an audio context to the input.",2)}catch(i){throw t.log("Error: Failed to connect web audio node!",i),t.log("port.webAudio.audioNode",r.webAudio.audioNode),t.log("audioInNode: ",e),t.log("inputChannelIndex:",s),t.log("audioInNode.connect: ",e.connect),i}else if(r.webAudio.previousAudioInNode)try{r.webAudio.previousAudioInNode.disconnect&&r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)}catch(e){try{r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode)}catch(i){throw t.log("Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",e),e.printStackTrace&&e.printStackTrace(),e}}r.webAudio.previousAudioInNode=e},r},replaceNodeInPort:function(t,e,i){const s=t.webAudio.previousAudioInNode;if(s&&s.disconnect){try{s.disconnect(e)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not disconnect old audio node. "+t.name+" "+t.message)}t.webAudio.audioNode=i;try{s.connect(i)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not connect to new node. "+t.name+" "+t.message)}}},createAudioOutPort:function(t,e,i){if(!t||!e||!i){const e="ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}const s=t.outObject(e);return s.set(i),s},createAudioParamInPort:function(t,e,i,s,r){if(!t||!e||!i)return t.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode"),t&&t.name&&t.log("opname: ",t.name),t.log("portName",e),void t.log("audioNode: ",i);t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const n=t.inDynamic(e,[B.OP_PORT_TYPE_VALUE,B.OP_PORT_TYPE_OBJECT],s,r);return n.webAudio={},n.webAudio.previousAudioInNode=null,n.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=n,n.onChange=function(){const e=n.get(),i=n.webAudio.audioNode,s=Ut.getAudioContext();if(null!=e)if("object"==typeof e&&e.connect){try{e.connect(i)}catch(e){throw t.log("Could not connect audio node: ",e),e.printStackTrace&&e.printStackTrace(),e}n.webAudio.previousAudioInNode=e}else{if(i._param&&i._param.minValue&&i._param.maxValue)if(e>=i._param.minValue&&e<=i._param.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem with tone.js op: ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else if(i.minValue&&i.maxValue)if(e>=i.minValue&&e<=i.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem (without minValue / maxValue): ",e),e.printStackTrace&&e.printStackTrace(),e}if(n.webAudio.previousAudioInNode&&n.webAudio.previousAudioInNode.disconnect){try{n.webAudio.previousAudioInNode.disconnect(i)}catch(e){throw t.log("Could not disconnect previous audio node: ",e),e}n.webAudio.previousAudioInNode=void 0}}else n.webAudio.previousAudioInNode},n},loadAudioFile:function(t,e,i,s,r){const n=Ut.createAudioContext();let o=null;(r||void 0===r)&&(o=t.loading.start("audio",e),t.isEditorMode()&&gui.jobs().start({id:"loadaudio"+o,title:" loading audio ("+e+")"}));const h=new XMLHttpRequest;e&&(h.open("GET",e,!0),h.responseType="arraybuffer",h.onload=function(){t.loading.finished(o),t.isEditorMode()&&gui.jobs().finish("loadaudio"+o),n.decodeAudioData(h.response,i,s)},h.send())},isValidToneTime:function(t){try{new Tone.Time(t)}catch(t){return!1}return!0},isValidToneNote:function(t){try{Tone.Frequency(t)}catch(t){return!1}return!0}},Lt=function(t,e,i){this._patch=t,this.connector=i,this._log=new _("PatchConnectionReceiver")};Lt.prototype._receive=function(t){let e={};if(e=t.hasOwnProperty("event")?t:JSON.parse(t.data),e.event==D.PACO_OP_CREATE){if(this._log.log("op create: data.vars.objName"),this._patch.getOpById(e.vars.opId))return;let t=null;window.gui?gui.serverOps.loadOpLibs(e.vars.objName,()=>{t=this._patch.addOp(e.vars.objName,null,e.vars.opId),t.id=e.vars.opId,t.uiAttribs={...t.uiAttribs,...e.vars.uiAttribs}}):(t=this._patch.addOp(e.vars.objName,null,e.vars.opId),t.id=e.vars.opId,t.uiAttribs={...t.uiAttribs,...e.vars.uiAttribs}),t&&e.vars.portsIn&&e.vars.portsIn.forEach(e=>{const i=t.getPortByName(e.name);i&&i.set(e.value)})}else if(e.event==D.PACO_LOAD)this._log.log("PACO load patch....."),this._patch.clear(),window.gui?gui.serverOps.loadProjectLibs(JSON.parse(e.vars.patch),()=>{this._patch.deSerialize(e.vars.patch)}):this._patch.deSerialize(e.vars.patch);else if(e.event==D.PACO_CLEAR)this._patch.clear(),this._log.log("clear");else if(e.event==D.PACO_OP_DELETE)this._log.log("op delete"),this._patch.deleteOp(e.vars.op,!0);else if(e.event==D.PACO_OP_ENABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!0)}else if(e.event==D.PACO_OP_DISABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!1)}else if(e.event==D.PACO_UIATTRIBS){const t=this._patch.getOpById(e.vars.op);t&&t.setUiAttrib(e.vars.uiAttribs)}else if(e.event==D.PACO_UNLINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);if(!t||!i)return void console.log("[paco] unlink op not found ");const s=t.getPort(e.vars.port1),r=i.getPort(e.vars.port2);s&&r?s.removeLinkTo(r):this._log.warn("paco unlink could not find port...")}else if(e.event==D.PACO_LINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);this._patch.link(t,e.vars.port1,i,e.vars.port2)}else if(e.event==D.PACO_VALUECHANGE){if("+ create new one"===e.vars.v)return;this._patch.getOpById(e.vars.op).getPort(e.vars.port).set(e.vars.v)}else e.event==D.PACO_VARIABLES?e.vars.variables&&e.vars.variables.forEach(t=>{this._patch.setVarValue(t.name,t.value,t.type)}):this._log.warn("unknown patchConnectionEvent!",t)};const Bt=function(t){this.connectors=[],t.addEventListener("onOpDelete",t=>{this.send(CABLES.PACO_OP_DELETE,{op:t.id})}),t.addEventListener("onOpAdd",t=>{const e=[];t.portsIn.forEach(t=>{const i={id:t.id,name:t.name,value:t.get()};e.push(i)}),t.uiAttribs.fromNetwork=!0,this.send(CABLES.PACO_OP_CREATE,{opId:t.id,objName:t.objName,uiAttribs:t.uiAttribs,portsIn:e})}),t.addEventListener("onUnLink",(t,e)=>{this.send(CABLES.PACO_UNLINK,{op1:t.parent.id,op2:e.parent.id,port1:t.getName(),port2:e.getName()})}),t.addEventListener("onUiAttribsChange",t=>{this.send(CABLES.PACO_UIATTRIBS,{op:t.id,uiAttribs:t.uiAttribs})}),t.addEventListener("variablesChanged",()=>{const e=[],i=t.getVars();for(const s in t.getVars()){const t=i[s];e.push({name:t.getName(),type:t.type,value:t.getValue()})}this.send(CABLES.PACO_VARIABLES,{variables:e})}),t.addEventListener("onLink",(t,e)=>{this.send(CABLES.PACO_LINK,{op1:t.parent.id,op2:e.parent.id,port1:t.name,port2:e.name})})};Bt.prototype.send=function(t,e){if(t!==CABLES.PACO_VALUECHANGE||"+ create new one"!==e.v)for(let i=0;i<this.connectors.length;i++)this.connectors[i].send(t,e)};const kt=function(){window.BroadcastChannel&&(this.bc=new BroadcastChannel("test_channel"))};kt.prototype.receive=function(t){this.bc&&(this._log.log("init"),this.bc.onmessage=t._receive.bind(t))},kt.prototype.send=function(t,e){if(!this.bc)return;const i={};i.event=t,i.vars=e,this.bc.postMessage(JSON.stringify(i))};const Dt=Object.assign({EventTarget:p,EMBED:wt,Link:Q,Port:q,Op:$,Profiler:Nt,Requirements:Ft,Patch:Mt,Instancing:St,Timer:gt,WEBAUDIO:Ut,Variable:function(){let t=null;const e=[];this.onChanged=function(t){e.push(t)},this.getValue=function(){return t},this.setValue=function(e){t=e,this.emitChanged()},this.emitChanged=function(){for(let t=0;t<e.length;t++)e[t]()}},LoadingStatus:Pt,now:pt,internalNow:_t},s,r,n,L,o,k,D,L,B);e.default=Dt;(function(){return!this})()||console.warn("not in strict mode: index core")}]).default;
//# sourceMappingURL=cables.min.js.mapvar CABLES = CABLES || {}; CABLES.build = {"timestamp":1644501123821,"created":"2022-02-10T13:52:03.821Z","git":{"branch":"master","commit":"71b2fa591eaaac5525a153041f60ab23612cdcc6","date":"2022-02-10T13:51:18.000Z","message":"fix customop port serialize"}};
/*!
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.1.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).glMatrix={})}(this,function(t){"use strict";var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random;var u=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var e=Object.freeze({EPSILON:n,get ARRAY_TYPE(){return a},RANDOM:r,setMatrixArrayType:function(t){a=t},toRadian:function(t){return t*u},equals:function(t,a){return Math.abs(t-a)<=n*Math.max(1,Math.abs(t),Math.abs(a))}});function o(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*i+e*c,t[1]=u*i+o*c,t[2]=r*h+e*s,t[3]=u*h+o*s,t}function i(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}var c=o,h=i,s=Object.freeze({create:function(){var t=new a(4);return a!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e},set:function(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t},transpose:function(t,n){if(t===n){var a=n[1];t[1]=n[2],t[2]=a}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*e-u*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-u*o,t[3]=a*o,t):null},adjoint:function(t,n){var a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:o,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+e*i,t[1]=u*c+o*i,t[2]=r*-i+e*c,t[3]=u*-i+o*c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1];return t[0]=r*i,t[1]=u*i,t[2]=e*c,t[3]=o*c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t},subtract:i,exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))},multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},mul:c,sub:h});function M(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return t[0]=r*h+e*s,t[1]=u*h+o*s,t[2]=r*M+e*f,t[3]=u*M+o*f,t[4]=r*l+e*v+i,t[5]=u*l+o*v+c,t}function f(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}var l=M,v=f,b=Object.freeze({create:function(){var t=new a(6);return a!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,n,r,u,e,o){var i=new a(6);return i[0]=t,i[1]=n,i[2]=r,i[3]=u,i[4]=e,i[5]=o,i},set:function(t,n,a,r,u,e,o){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=a*e-r*u;return c?(c=1/c,t[0]=e*c,t[1]=-r*c,t[2]=-u*c,t[3]=a*c,t[4]=(u*i-e*o)*c,t[5]=(r*o-a*i)*c,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:M,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=Math.sin(a),s=Math.cos(a);return t[0]=r*s+e*h,t[1]=u*s+o*h,t[2]=r*-h+e*s,t[3]=u*-h+o*s,t[4]=i,t[5]=c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r*h,t[1]=u*h,t[2]=e*s,t[3]=o*s,t[4]=i,t[5]=c,t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=r*h+e*s+i,t[5]=u*h+o*s+c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t},subtract:f,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return Math.abs(r-h)<=n*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(u-s)<=n*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(e-M)<=n*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(o-f)<=n*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=n*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(c-v)<=n*Math.max(1,Math.abs(c),Math.abs(v))},mul:l,sub:v});function m(){var t=new a(9);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function d(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return t[0]=f*r+l*o+v*h,t[1]=f*u+l*i+v*s,t[2]=f*e+l*c+v*M,t[3]=b*r+m*o+d*h,t[4]=b*u+m*i+d*s,t[5]=b*e+m*c+d*M,t[6]=x*r+p*o+y*h,t[7]=x*u+p*i+y*s,t[8]=x*e+p*c+y*M,t}function x(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t}var p=d,y=x,q=Object.freeze({create:m,fromMat4:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},clone:function(t){var n=new a(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromValues:function(t,n,r,u,e,o,i,c,h){var s=new a(9);return s[0]=t,s[1]=n,s[2]=r,s[3]=u,s[4]=e,s[5]=o,s[6]=i,s[7]=c,s[8]=h,s},set:function(t,n,a,r,u,e,o,i,c,h){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[5];t[1]=n[3],t[2]=n[6],t[3]=a,t[5]=n[7],t[6]=r,t[7]=u}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=s*o-i*h,f=-s*e+i*c,l=h*e-o*c,v=a*M+r*f+u*l;return v?(v=1/v,t[0]=M*v,t[1]=(-s*r+u*h)*v,t[2]=(i*r-u*o)*v,t[3]=f*v,t[4]=(s*a-u*c)*v,t[5]=(-i*a+u*e)*v,t[6]=l*v,t[7]=(-h*a+r*c)*v,t[8]=(o*a-r*e)*v,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8];return t[0]=o*s-i*h,t[1]=u*h-r*s,t[2]=r*i-u*o,t[3]=i*c-e*s,t[4]=a*s-u*c,t[5]=u*e-a*i,t[6]=e*h-o*c,t[7]=r*c-a*h,t[8]=a*o-r*e,t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8];return n*(h*e-o*c)+a*(-h*u+o*i)+r*(c*u-e*i)},multiply:d,translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=f*r+l*o+h,t[7]=f*u+l*i+s,t[8]=f*e+l*c+M,t},rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=Math.sin(a),l=Math.cos(a);return t[0]=l*r+f*o,t[1]=l*u+f*i,t[2]=l*e+f*c,t[3]=l*o-f*r,t[4]=l*i-f*u,t[5]=l*c-f*e,t[6]=h,t[7]=s,t[8]=M,t},scale:function(t,n,a){var r=a[0],u=a[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=u*n[3],t[4]=u*n[4],t[5]=u*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[3]=s-d,t[6]=f+m,t[1]=s+d,t[4]=1-h-v,t[7]=l-b,t[2]=f-m,t[5]=l+b,t[8]=1-h-M,t},normalFromMat4:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(c*z-o*I-h*R)*S,t[2]=(o*j-i*z+h*w)*S,t[3]=(u*j-r*I-e*P)*S,t[4]=(a*I-u*z+e*R)*S,t[5]=(r*z-a*j-e*w)*S,t[6]=(b*A-m*g+d*q)*S,t[7]=(m*y-v*A-d*p)*S,t[8]=(v*g-b*y+d*x)*S,t):null},projection:function(t,n,a){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t},subtract:x,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return Math.abs(r-f)<=n*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(u-l)<=n*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(e-v)<=n*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(o-b)<=n*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-m)<=n*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-d)<=n*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(s-p)<=n*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(M-y)<=n*Math.max(1,Math.abs(M),Math.abs(y))},mul:p,sub:y});function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],b=n[12],m=n[13],d=n[14],x=n[15],p=a[0],y=a[1],q=a[2],g=a[3];return t[0]=p*r+y*i+q*M+g*b,t[1]=p*u+y*c+q*f+g*m,t[2]=p*e+y*h+q*l+g*d,t[3]=p*o+y*s+q*v+g*x,p=a[4],y=a[5],q=a[6],g=a[7],t[4]=p*r+y*i+q*M+g*b,t[5]=p*u+y*c+q*f+g*m,t[6]=p*e+y*h+q*l+g*d,t[7]=p*o+y*s+q*v+g*x,p=a[8],y=a[9],q=a[10],g=a[11],t[8]=p*r+y*i+q*M+g*b,t[9]=p*u+y*c+q*f+g*m,t[10]=p*e+y*h+q*l+g*d,t[11]=p*o+y*s+q*v+g*x,p=a[12],y=a[13],q=a[14],g=a[15],t[12]=p*r+y*i+q*M+g*b,t[13]=p*u+y*c+q*f+g*m,t[14]=p*e+y*h+q*l+g*d,t[15]=p*o+y*s+q*v+g*x,t}function w(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=r+r,c=u+u,h=e+e,s=r*i,M=r*c,f=r*h,l=u*c,v=u*h,b=e*h,m=o*i,d=o*c,x=o*h;return t[0]=1-(l+b),t[1]=M+x,t[2]=f-d,t[3]=0,t[4]=M-x,t[5]=1-(s+b),t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-(s+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function R(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function z(t,n){var a=n[0],r=n[1],u=n[2],e=n[4],o=n[5],i=n[6],c=n[8],h=n[9],s=n[10];return t[0]=Math.hypot(a,r,u),t[1]=Math.hypot(e,o,i),t[2]=Math.hypot(c,h,s),t}function P(t,n){var r=new a(3);z(r,n);var u=1/r[0],e=1/r[1],o=1/r[2],i=n[0]*u,c=n[1]*e,h=n[2]*o,s=n[4]*u,M=n[5]*e,f=n[6]*o,l=n[8]*u,v=n[9]*e,b=n[10]*o,m=i+M+b,d=0;return m>0?(d=2*Math.sqrt(m+1),t[3]=.25*d,t[0]=(f-v)/d,t[1]=(l-h)/d,t[2]=(c-s)/d):i>M&&i>b?(d=2*Math.sqrt(1+i-M-b),t[3]=(f-v)/d,t[0]=.25*d,t[1]=(c+s)/d,t[2]=(l+h)/d):M>b?(d=2*Math.sqrt(1+M-i-b),t[3]=(l-h)/d,t[0]=(c+s)/d,t[1]=.25*d,t[2]=(f+v)/d):(d=2*Math.sqrt(1+b-i-M),t[3]=(c-s)/d,t[0]=(l+h)/d,t[1]=(f+v)/d,t[2]=.25*d),t}function j(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t[9]=n[9]-a[9],t[10]=n[10]-a[10],t[11]=n[11]-a[11],t[12]=n[12]-a[12],t[13]=n[13]-a[13],t[14]=n[14]-a[14],t[15]=n[15]-a[15],t}var I=A,S=j,E=Object.freeze({create:function(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var n=new a(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},fromValues:function(t,n,r,u,e,o,i,c,h,s,M,f,l,v,b,m){var d=new a(16);return d[0]=t,d[1]=n,d[2]=r,d[3]=u,d[4]=e,d[5]=o,d[6]=i,d[7]=c,d[8]=h,d[9]=s,d[10]=M,d[11]=f,d[12]=l,d[13]=v,d[14]=b,d[15]=m,d},set:function(t,n,a,r,u,e,o,i,c,h,s,M,f,l,v,b,m){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t[9]=s,t[10]=M,t[11]=f,t[12]=l,t[13]=v,t[14]=b,t[15]=m,t},identity:g,transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[3],e=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=a,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=e,t[11]=n[14],t[12]=u,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(u*j-r*I-e*P)*S,t[2]=(b*A-m*g+d*q)*S,t[3]=(f*g-M*A-l*q)*S,t[4]=(c*z-o*I-h*R)*S,t[5]=(a*I-u*z+e*R)*S,t[6]=(m*y-v*A-d*p)*S,t[7]=(s*A-f*y+l*p)*S,t[8]=(o*j-i*z+h*w)*S,t[9]=(r*z-a*j-e*w)*S,t[10]=(v*g-b*y+d*x)*S,t[11]=(M*y-s*g-l*x)*S,t[12]=(i*R-o*P-c*w)*S,t[13]=(a*P-r*R+u*w)*S,t[14]=(b*p-v*q-m*x)*S,t[15]=(s*q-M*p+f*x)*S,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15];return t[0]=i*(f*d-l*m)-M*(c*d-h*m)+b*(c*l-h*f),t[1]=-(r*(f*d-l*m)-M*(u*d-e*m)+b*(u*l-e*f)),t[2]=r*(c*d-h*m)-i*(u*d-e*m)+b*(u*h-e*c),t[3]=-(r*(c*l-h*f)-i*(u*l-e*f)+M*(u*h-e*c)),t[4]=-(o*(f*d-l*m)-s*(c*d-h*m)+v*(c*l-h*f)),t[5]=a*(f*d-l*m)-s*(u*d-e*m)+v*(u*l-e*f),t[6]=-(a*(c*d-h*m)-o*(u*d-e*m)+v*(u*h-e*c)),t[7]=a*(c*l-h*f)-o*(u*l-e*f)+s*(u*h-e*c),t[8]=o*(M*d-l*b)-s*(i*d-h*b)+v*(i*l-h*M),t[9]=-(a*(M*d-l*b)-s*(r*d-e*b)+v*(r*l-e*M)),t[10]=a*(i*d-h*b)-o*(r*d-e*b)+v*(r*h-e*i),t[11]=-(a*(i*l-h*M)-o*(r*l-e*M)+s*(r*h-e*i)),t[12]=-(o*(M*m-f*b)-s*(i*m-c*b)+v*(i*f-c*M)),t[13]=a*(M*m-f*b)-s*(r*m-u*b)+v*(r*f-u*M),t[14]=-(a*(i*m-c*b)-o*(r*m-u*b)+v*(r*c-u*i)),t[15]=a*(i*f-c*M)-o*(r*f-u*M)+s*(r*c-u*i),t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8],s=t[9],M=t[10],f=t[11],l=t[12],v=t[13],b=t[14],m=t[15];return(n*o-a*e)*(M*m-f*b)-(n*i-r*e)*(s*m-f*v)+(n*c-u*e)*(s*b-M*v)+(a*i-r*o)*(h*m-f*l)-(a*c-u*o)*(h*b-M*l)+(r*c-u*i)*(h*v-s*l)},multiply:A,translate:function(t,n,a){var r,u,e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2];return n===t?(t[12]=n[0]*b+n[4]*m+n[8]*d+n[12],t[13]=n[1]*b+n[5]*m+n[9]*d+n[13],t[14]=n[2]*b+n[6]*m+n[10]*d+n[14],t[15]=n[3]*b+n[7]*m+n[11]*d+n[15]):(r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=h,t[7]=s,t[8]=M,t[9]=f,t[10]=l,t[11]=v,t[12]=r*b+i*m+M*d+n[12],t[13]=u*b+c*m+f*d+n[13],t[14]=e*b+h*m+l*d+n[14],t[15]=o*b+s*m+v*d+n[15]),t},scale:function(t,n,a){var r=a[0],u=a[1],e=a[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*u,t[5]=n[5]*u,t[6]=n[6]*u,t[7]=n[7]*u,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},rotate:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b,m,d,x,p,y,q,g,A,w,R,z,P,j,I=u[0],S=u[1],E=u[2],O=Math.hypot(I,S,E);return O<n?null:(I*=O=1/O,S*=O,E*=O,e=Math.sin(r),i=1-(o=Math.cos(r)),c=a[0],h=a[1],s=a[2],M=a[3],f=a[4],l=a[5],v=a[6],b=a[7],m=a[8],d=a[9],x=a[10],p=a[11],y=I*I*i+o,q=S*I*i+E*e,g=E*I*i-S*e,A=I*S*i-E*e,w=S*S*i+o,R=E*S*i+I*e,z=I*E*i+S*e,P=S*E*i-I*e,j=E*E*i+o,t[0]=c*y+f*q+m*g,t[1]=h*y+l*q+d*g,t[2]=s*y+v*q+x*g,t[3]=M*y+b*q+p*g,t[4]=c*A+f*w+m*R,t[5]=h*A+l*w+d*R,t[6]=s*A+v*w+x*R,t[7]=M*A+b*w+p*R,t[8]=c*z+f*P+m*j,t[9]=h*z+l*P+d*j,t[10]=s*z+v*P+x*j,t[11]=M*z+b*P+p*j,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},rotateX:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[4],o=n[5],i=n[6],c=n[7],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=e*u+h*r,t[5]=o*u+s*r,t[6]=i*u+M*r,t[7]=c*u+f*r,t[8]=h*u-e*r,t[9]=s*u-o*r,t[10]=M*u-i*r,t[11]=f*u-c*r,t},rotateY:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u-h*r,t[1]=o*u-s*r,t[2]=i*u-M*r,t[3]=c*u-f*r,t[8]=e*r+h*u,t[9]=o*r+s*u,t[10]=i*r+M*u,t[11]=c*r+f*u,t},rotateZ:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[4],s=n[5],M=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u+h*r,t[1]=o*u+s*r,t[2]=i*u+M*r,t[3]=c*u+f*r,t[4]=h*u-e*r,t[5]=s*u-o*r,t[6]=M*u-i*r,t[7]=f*u-c*r,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,a,r){var u,e,o,i=r[0],c=r[1],h=r[2],s=Math.hypot(i,c,h);return s<n?null:(i*=s=1/s,c*=s,h*=s,u=Math.sin(a),o=1-(e=Math.cos(a)),t[0]=i*i*o+e,t[1]=c*i*o+h*u,t[2]=h*i*o-c*u,t[3]=0,t[4]=i*c*o-h*u,t[5]=c*c*o+e,t[6]=h*c*o+i*u,t[7]=0,t[8]=i*h*o+c*u,t[9]=c*h*o-i*u,t[10]=h*h*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:w,fromQuat2:function(t,n){var r=new a(3),u=-n[0],e=-n[1],o=-n[2],i=n[3],c=n[4],h=n[5],s=n[6],M=n[7],f=u*u+e*e+o*o+i*i;return f>0?(r[0]=2*(c*i+M*u+h*o-s*e)/f,r[1]=2*(h*i+M*e+s*u-c*o)/f,r[2]=2*(s*i+M*o+c*e-h*u)/f):(r[0]=2*(c*i+M*u+h*o-s*e),r[1]=2*(h*i+M*e+s*u-c*o),r[2]=2*(s*i+M*o+c*e-h*u)),w(t,n,r),t},getTranslation:R,getScaling:z,getRotation:P,fromRotationTranslationScale:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3],c=u+u,h=e+e,s=o+o,M=u*c,f=u*h,l=u*s,v=e*h,b=e*s,m=o*s,d=i*c,x=i*h,p=i*s,y=r[0],q=r[1],g=r[2];return t[0]=(1-(v+m))*y,t[1]=(f+p)*y,t[2]=(l-x)*y,t[3]=0,t[4]=(f-p)*q,t[5]=(1-(M+m))*q,t[6]=(b+d)*q,t[7]=0,t[8]=(l+x)*g,t[9]=(b-d)*g,t[10]=(1-(M+v))*g,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,n,a,r,u){var e=n[0],o=n[1],i=n[2],c=n[3],h=e+e,s=o+o,M=i+i,f=e*h,l=e*s,v=e*M,b=o*s,m=o*M,d=i*M,x=c*h,p=c*s,y=c*M,q=r[0],g=r[1],A=r[2],w=u[0],R=u[1],z=u[2],P=(1-(b+d))*q,j=(l+y)*q,I=(v-p)*q,S=(l-y)*g,E=(1-(f+d))*g,O=(m+x)*g,T=(v+p)*A,D=(m-x)*A,F=(1-(f+b))*A;return t[0]=P,t[1]=j,t[2]=I,t[3]=0,t[4]=S,t[5]=E,t[6]=O,t[7]=0,t[8]=T,t[9]=D,t[10]=F,t[11]=0,t[12]=a[0]+w-(P*w+S*R+T*z),t[13]=a[1]+R-(j*w+E*R+D*z),t[14]=a[2]+z-(I*w+O*R+F*z),t[15]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[1]=s+d,t[2]=f-m,t[3]=0,t[4]=s-d,t[5]=1-h-v,t[6]=l+b,t[7]=0,t[8]=f+m,t[9]=l-b,t[10]=1-h-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,n,a,r,u,e,o){var i=1/(a-n),c=1/(u-r),h=1/(e-o);return t[0]=2*e*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*c,t[6]=0,t[7]=0,t[8]=(a+n)*i,t[9]=(u+r)*c,t[10]=(o+e)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*h,t[15]=0,t},perspective:function(t,n,a,r,u){var e,o=1/Math.tan(n/2);return t[0]=o/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(e=1/(r-u),t[10]=(u+r)*e,t[14]=2*u*r*e):(t[10]=-1,t[14]=-2*r),t},perspectiveFromFieldOfView:function(t,n,a,r){var u=Math.tan(n.upDegrees*Math.PI/180),e=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),i=Math.tan(n.rightDegrees*Math.PI/180),c=2/(o+i),h=2/(u+e);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-i)*c*.5,t[9]=(u-e)*h*.5,t[10]=r/(a-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*a/(a-r),t[15]=0,t},ortho:function(t,n,a,r,u,e,o){var i=1/(n-a),c=1/(r-u),h=1/(e-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(n+a)*i,t[13]=(u+r)*c,t[14]=(o+e)*h,t[15]=1,t},lookAt:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2],x=u[0],p=u[1],y=u[2],q=r[0],A=r[1],w=r[2];return Math.abs(b-q)<n&&Math.abs(m-A)<n&&Math.abs(d-w)<n?g(t):(M=b-q,f=m-A,l=d-w,e=p*(l*=v=1/Math.hypot(M,f,l))-y*(f*=v),o=y*(M*=v)-x*l,i=x*f-p*M,(v=Math.hypot(e,o,i))?(e*=v=1/v,o*=v,i*=v):(e=0,o=0,i=0),c=f*i-l*o,h=l*e-M*i,s=M*o-f*e,(v=Math.hypot(c,h,s))?(c*=v=1/v,h*=v,s*=v):(c=0,h=0,s=0),t[0]=e,t[1]=c,t[2]=M,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(e*b+o*m+i*d),t[13]=-(c*b+h*m+s*d),t[14]=-(M*b+f*m+l*d),t[15]=1,t)},targetTo:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=r[0],c=r[1],h=r[2],s=u-a[0],M=e-a[1],f=o-a[2],l=s*s+M*M+f*f;l>0&&(s*=l=1/Math.sqrt(l),M*=l,f*=l);var v=c*f-h*M,b=h*s-i*f,m=i*M-c*s;return(l=v*v+b*b+m*m)>0&&(v*=l=1/Math.sqrt(l),b*=l,m*=l),t[0]=v,t[1]=b,t[2]=m,t[3]=0,t[4]=M*m-f*b,t[5]=f*v-s*m,t[6]=s*b-M*v,t[7]=0,t[8]=s,t[9]=M,t[10]=f,t[11]=0,t[12]=u,t[13]=e,t[14]=o,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t[9]=n[9]+a[9],t[10]=n[10]+a[10],t[11]=n[11]+a[11],t[12]=n[12]+a[12],t[13]=n[13]+a[13],t[14]=n[14]+a[14],t[15]=n[15]+a[15],t},subtract:j,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12]*a,t[13]=n[13]*a,t[14]=n[14]*a,t[15]=n[15]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t[9]=n[9]+a[9]*r,t[10]=n[10]+a[10]*r,t[11]=n[11]+a[11]*r,t[12]=n[12]+a[12]*r,t[13]=n[13]+a[13]*r,t[14]=n[14]+a[14]*r,t[15]=n[15]+a[15]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=t[9],l=t[10],v=t[11],b=t[12],m=t[13],d=t[14],x=t[15],p=a[0],y=a[1],q=a[2],g=a[3],A=a[4],w=a[5],R=a[6],z=a[7],P=a[8],j=a[9],I=a[10],S=a[11],E=a[12],O=a[13],T=a[14],D=a[15];return Math.abs(r-p)<=n*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(u-y)<=n*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(e-q)<=n*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(o-g)<=n*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-A)<=n*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(c-w)<=n*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-R)<=n*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(s-z)<=n*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(M-P)<=n*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(f-j)<=n*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(l-I)<=n*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(v-S)<=n*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(b-E)<=n*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(m-O)<=n*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(d-T)<=n*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(x-D)<=n*Math.max(1,Math.abs(x),Math.abs(D))},mul:I,sub:S});function O(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t){var n=t[0],a=t[1],r=t[2];return Math.hypot(n,a,r)}function D(t,n,r){var u=new a(3);return u[0]=t,u[1]=n,u[2]=r,u}function F(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t}function L(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t}function V(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t}function Q(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return Math.hypot(a,r,u)}function Y(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return a*a+r*r+u*u}function X(t){var n=t[0],a=t[1],r=t[2];return n*n+a*a+r*r}function Z(t,n){var a=n[0],r=n[1],u=n[2],e=a*a+r*r+u*u;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function _(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function B(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2];return t[0]=u*c-e*i,t[1]=e*o-r*c,t[2]=r*i-u*o,t}var N,k=F,U=L,W=V,C=Q,G=Y,H=T,J=X,K=(N=O(),function(t,n,a,r,u,e){var o,i;for(n||(n=3),a||(a=0),i=r?Math.min(r*n+a,t.length):t.length,o=a;o<i;o+=n)N[0]=t[o],N[1]=t[o+1],N[2]=t[o+2],u(N,N,e),t[o]=N[0],t[o+1]=N[1],t[o+2]=N[2];return t}),$=Object.freeze({create:O,clone:function(t){var n=new a(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:T,fromValues:D,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:function(t,n,a,r){return t[0]=n,t[1]=a,t[2]=r,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t},subtract:F,multiply:L,divide:V,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t},distance:Q,squaredDistance:Y,squaredLength:X,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:Z,dot:_,cross:B,lerp:function(t,n,a,r){var u=n[0],e=n[1],o=n[2];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t},hermite:function(t,n,a,r,u,e){var o=e*e,i=o*(2*e-3)+1,c=o*(e-2)+e,h=o*(e-1),s=o*(3-2*e);return t[0]=n[0]*i+a[0]*c+r[0]*h+u[0]*s,t[1]=n[1]*i+a[1]*c+r[1]*h+u[1]*s,t[2]=n[2]*i+a[2]*c+r[2]*h+u[2]*s,t},bezier:function(t,n,a,r,u,e){var o=1-e,i=o*o,c=e*e,h=i*o,s=3*e*i,M=3*c*o,f=c*e;return t[0]=n[0]*h+a[0]*s+r[0]*M+u[0]*f,t[1]=n[1]*h+a[1]*s+r[1]*M+u[1]*f,t[2]=n[2]*h+a[2]*s+r[2]*M+u[2]*f,t},random:function(t,n){n=n||1;var a=2*r()*Math.PI,u=2*r()-1,e=Math.sqrt(1-u*u)*n;return t[0]=Math.cos(a)*e,t[1]=Math.sin(a)*e,t[2]=u*n,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[3]*r+a[7]*u+a[11]*e+a[15];return o=o||1,t[0]=(a[0]*r+a[4]*u+a[8]*e+a[12])/o,t[1]=(a[1]*r+a[5]*u+a[9]*e+a[13])/o,t[2]=(a[2]*r+a[6]*u+a[10]*e+a[14])/o,t},transformMat3:function(t,n,a){var r=n[0],u=n[1],e=n[2];return t[0]=r*a[0]+u*a[3]+e*a[6],t[1]=r*a[1]+u*a[4]+e*a[7],t[2]=r*a[2]+u*a[5]+e*a[8],t},transformQuat:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=u*h-e*c,M=e*i-r*h,f=r*c-u*i,l=u*f-e*M,v=e*s-r*f,b=r*M-u*s,m=2*o;return s*=m,M*=m,f*=m,l*=2,v*=2,b*=2,t[0]=i+s+l,t[1]=c+M+v,t[2]=h+f+b,t},rotateX:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0],e[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),e[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateY:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),e[1]=u[1],e[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateZ:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),e[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),e[2]=u[2],t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},angle:function(t,n){var a=D(t[0],t[1],t[2]),r=D(n[0],n[1],n[2]);Z(a,a),Z(r,r);var u=_(a,r);return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=a[0],i=a[1],c=a[2];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(u-i)<=n*Math.max(1,Math.abs(u),Math.abs(i))&&Math.abs(e-c)<=n*Math.max(1,Math.abs(e),Math.abs(c))},sub:k,mul:U,div:W,dist:C,sqrDist:G,len:H,sqrLen:J,forEach:K});function tt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function nt(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function at(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e}function rt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ut(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function et(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function ot(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function it(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t[3]=n[3]*a[3],t}function ct(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t[3]=n[3]/a[3],t}function ht(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function st(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return Math.hypot(a,r,u,e)}function Mt(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return a*a+r*r+u*u+e*e}function ft(t){var n=t[0],a=t[1],r=t[2],u=t[3];return Math.hypot(n,a,r,u)}function lt(t){var n=t[0],a=t[1],r=t[2],u=t[3];return n*n+a*a+r*r+u*u}function vt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=a*o,t[1]=r*o,t[2]=u*o,t[3]=e*o,t}function bt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function mt(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t[3]=i+r*(a[3]-i),t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function xt(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))}var pt=ot,yt=it,qt=ct,gt=st,At=Mt,wt=ft,Rt=lt,zt=function(){var t=tt();return function(n,a,r,u,e,o){var i,c;for(a||(a=4),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],e(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),Pt=Object.freeze({create:tt,clone:nt,fromValues:at,copy:rt,set:ut,add:et,subtract:ot,multiply:it,divide:ct,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t[3]=Math.min(n[3],a[3]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t[3]=Math.max(n[3],a[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:ht,scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},distance:st,squaredDistance:Mt,length:ft,squaredLength:lt,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:vt,dot:bt,cross:function(t,n,a,r){var u=a[0]*r[1]-a[1]*r[0],e=a[0]*r[2]-a[2]*r[0],o=a[0]*r[3]-a[3]*r[0],i=a[1]*r[2]-a[2]*r[1],c=a[1]*r[3]-a[3]*r[1],h=a[2]*r[3]-a[3]*r[2],s=n[0],M=n[1],f=n[2],l=n[3];return t[0]=M*h-f*c+l*i,t[1]=-s*h+f*o-l*e,t[2]=s*c-M*o+l*u,t[3]=-s*i+M*e-f*u,t},lerp:mt,random:function(t,n){var a,u,e,o,i,c;n=n||1;do{i=(a=2*r()-1)*a+(u=2*r()-1)*u}while(i>=1);do{c=(e=2*r()-1)*e+(o=2*r()-1)*o}while(c>=1);var h=Math.sqrt((1-i)/c);return t[0]=n*a,t[1]=n*u,t[2]=n*e*h,t[3]=n*o*h,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3];return t[0]=a[0]*r+a[4]*u+a[8]*e+a[12]*o,t[1]=a[1]*r+a[5]*u+a[9]*e+a[13]*o,t[2]=a[2]*r+a[6]*u+a[10]*e+a[14]*o,t[3]=a[3]*r+a[7]*u+a[11]*e+a[15]*o,t},transformQuat:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2],h=a[3],s=h*r+i*e-c*u,M=h*u+c*r-o*e,f=h*e+o*u-i*r,l=-o*r-i*u-c*e;return t[0]=s*h+l*-o+M*-c-f*-i,t[1]=M*h+l*-i+f*-o-s*-c,t[2]=f*h+l*-c+s*-i-M*-o,t[3]=n[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:dt,equals:xt,sub:pt,mul:yt,div:qt,dist:gt,sqrDist:At,len:wt,sqrLen:Rt,forEach:zt});function jt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function It(t,n,a){a*=.5;var r=Math.sin(a);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(a),t}function St(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,t}function Et(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+o*i,t[1]=u*c+e*i,t[2]=e*c-u*i,t[3]=o*c-r*i,t}function Ot(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c-e*i,t[1]=u*c+o*i,t[2]=e*c+r*i,t[3]=o*c-u*i,t}function Tt(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+u*i,t[1]=u*c-r*i,t[2]=e*c+o*i,t[3]=o*c-e*i,t}function Dt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=Math.exp(e),c=o>0?i*Math.sin(o)/o:0;return t[0]=a*c,t[1]=r*c,t[2]=u*c,t[3]=i*Math.cos(o),t}function Ft(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=o>0?Math.atan2(o,e)/o:0;return t[0]=a*i,t[1]=r*i,t[2]=u*i,t[3]=.5*Math.log(a*a+r*r+u*u+e*e),t}function Lt(t,a,r,u){var e,o,i,c,h,s=a[0],M=a[1],f=a[2],l=a[3],v=r[0],b=r[1],m=r[2],d=r[3];return(o=s*v+M*b+f*m+l*d)<0&&(o=-o,v=-v,b=-b,m=-m,d=-d),1-o>n?(e=Math.acos(o),i=Math.sin(e),c=Math.sin((1-u)*e)/i,h=Math.sin(u*e)/i):(c=1-u,h=u),t[0]=c*s+h*v,t[1]=c*M+h*b,t[2]=c*f+h*m,t[3]=c*l+h*d,t}function Vt(t,n){var a,r=n[0]+n[4]+n[8];if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(n[5]-n[7])*a,t[1]=(n[6]-n[2])*a,t[2]=(n[1]-n[3])*a;else{var u=0;n[4]>n[0]&&(u=1),n[8]>n[3*u+u]&&(u=2);var e=(u+1)%3,o=(u+2)%3;a=Math.sqrt(n[3*u+u]-n[3*e+e]-n[3*o+o]+1),t[u]=.5*a,a=.5/a,t[3]=(n[3*e+o]-n[3*o+e])*a,t[e]=(n[3*e+u]+n[3*u+e])*a,t[o]=(n[3*o+u]+n[3*u+o])*a}return t}var Qt,Yt,Xt,Zt,_t,Bt,Nt=nt,kt=at,Ut=rt,Wt=ut,Ct=et,Gt=St,Ht=ht,Jt=bt,Kt=mt,$t=ft,tn=$t,nn=lt,an=nn,rn=vt,un=dt,en=xt,on=(Qt=O(),Yt=D(1,0,0),Xt=D(0,1,0),function(t,n,a){var r=_(n,a);return r<-.999999?(B(Qt,Yt,n),H(Qt)<1e-6&&B(Qt,Xt,n),Z(Qt,Qt),It(t,Qt,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(B(Qt,n,a),t[0]=Qt[0],t[1]=Qt[1],t[2]=Qt[2],t[3]=1+r,rn(t,t))}),cn=(Zt=jt(),_t=jt(),function(t,n,a,r,u,e){return Lt(Zt,n,u,e),Lt(_t,a,r,e),Lt(t,Zt,_t,2*e*(1-e)),t}),hn=(Bt=m(),function(t,n,a,r){return Bt[0]=a[0],Bt[3]=a[1],Bt[6]=a[2],Bt[1]=r[0],Bt[4]=r[1],Bt[7]=r[2],Bt[2]=-n[0],Bt[5]=-n[1],Bt[8]=-n[2],rn(t,Vt(t,Bt))}),sn=Object.freeze({create:jt,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:It,getAxisAngle:function(t,a){var r=2*Math.acos(a[3]),u=Math.sin(r/2);return u>n?(t[0]=a[0]/u,t[1]=a[1]/u,t[2]=a[2]/u):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,n){var a=Jt(t,n);return Math.acos(2*a*a-1)},multiply:St,rotateX:Et,rotateY:Ot,rotateZ:Tt,calculateW:function(t,n){var a=n[0],r=n[1],u=n[2];return t[0]=a,t[1]=r,t[2]=u,t[3]=Math.sqrt(Math.abs(1-a*a-r*r-u*u)),t},exp:Dt,ln:Ft,pow:function(t,n,a){return Ft(t,n),Ht(t,t,a),Dt(t,t),t},slerp:Lt,random:function(t){var n=r(),a=r(),u=r(),e=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=e*Math.sin(2*Math.PI*a),t[1]=e*Math.cos(2*Math.PI*a),t[2]=o*Math.sin(2*Math.PI*u),t[3]=o*Math.cos(2*Math.PI*u),t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e,i=o?1/o:0;return t[0]=-a*i,t[1]=-r*i,t[2]=-u*i,t[3]=e*i,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},fromMat3:Vt,fromEuler:function(t,n,a,r){var u=.5*Math.PI/180;n*=u,a*=u,r*=u;var e=Math.sin(n),o=Math.cos(n),i=Math.sin(a),c=Math.cos(a),h=Math.sin(r),s=Math.cos(r);return t[0]=e*c*s-o*i*h,t[1]=o*i*s+e*c*h,t[2]=o*c*h-e*i*s,t[3]=o*c*s+e*i*h,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:Nt,fromValues:kt,copy:Ut,set:Wt,add:Ct,mul:Gt,scale:Ht,dot:Jt,lerp:Kt,length:$t,len:tn,squaredLength:nn,sqrLen:an,normalize:rn,exactEquals:un,equals:en,rotationTo:on,sqlerp:cn,setAxes:hn});function Mn(t,n,a){var r=.5*a[0],u=.5*a[1],e=.5*a[2],o=n[0],i=n[1],c=n[2],h=n[3];return t[0]=o,t[1]=i,t[2]=c,t[3]=h,t[4]=r*h+u*c-e*i,t[5]=u*h+e*o-r*c,t[6]=e*h+r*i-u*o,t[7]=-r*o-u*i-e*c,t}function fn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}var ln=Ut;var vn=Ut;function bn(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[4],c=a[5],h=a[6],s=a[7],M=n[4],f=n[5],l=n[6],v=n[7],b=a[0],m=a[1],d=a[2],x=a[3];return t[0]=r*x+o*b+u*d-e*m,t[1]=u*x+o*m+e*b-r*d,t[2]=e*x+o*d+r*m-u*b,t[3]=o*x-r*b-u*m-e*d,t[4]=r*s+o*i+u*h-e*c+M*x+v*b+f*d-l*m,t[5]=u*s+o*c+e*i-r*h+f*x+v*m+l*b-M*d,t[6]=e*s+o*h+r*c-u*i+l*x+v*d+M*m-f*b,t[7]=o*s-r*i-u*c-e*h+v*x-M*b-f*m-l*d,t}var mn=bn;var dn=Jt;var xn=$t,pn=xn,yn=nn,qn=yn;var gn=Object.freeze({create:function(){var t=new a(8);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var n=new a(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n},fromValues:function(t,n,r,u,e,o,i,c){var h=new a(8);return h[0]=t,h[1]=n,h[2]=r,h[3]=u,h[4]=e,h[5]=o,h[6]=i,h[7]=c,h},fromRotationTranslationValues:function(t,n,r,u,e,o,i){var c=new a(8);c[0]=t,c[1]=n,c[2]=r,c[3]=u;var h=.5*e,s=.5*o,M=.5*i;return c[4]=h*u+s*r-M*n,c[5]=s*u+M*t-h*r,c[6]=M*u+h*n-s*t,c[7]=-h*t-s*n-M*r,c},fromRotationTranslation:Mn,fromTranslation:function(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t},fromRotation:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,n){var r=jt();P(r,n);var u=new a(3);return R(u,n),Mn(t,r,u),t},copy:fn,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,n,a,r,u,e,o,i,c){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t},getReal:ln,getDual:function(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t},setReal:vn,setDual:function(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t},getTranslation:function(t,n){var a=n[4],r=n[5],u=n[6],e=n[7],o=-n[0],i=-n[1],c=-n[2],h=n[3];return t[0]=2*(a*h+e*o+r*c-u*i),t[1]=2*(r*h+e*i+u*o-a*c),t[2]=2*(u*h+e*c+a*i-r*o),t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=.5*a[0],c=.5*a[1],h=.5*a[2],s=n[4],M=n[5],f=n[6],l=n[7];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=o*i+u*h-e*c+s,t[5]=o*c+e*i-r*h+M,t[6]=o*h+r*c-u*i+f,t[7]=-r*i-u*c-e*h+l,t},rotateX:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Et(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateY:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Ot(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateZ:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Tt(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateByQuatAppend:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=n[3];return t[0]=i*o+s*r+c*e-h*u,t[1]=c*o+s*u+h*r-i*e,t[2]=h*o+s*e+i*u-c*r,t[3]=s*o-i*r-c*u-h*e,i=n[4],c=n[5],h=n[6],s=n[7],t[4]=i*o+s*r+c*e-h*u,t[5]=c*o+s*u+h*r-i*e,t[6]=h*o+s*e+i*u-c*r,t[7]=s*o-i*r-c*u-h*e,t},rotateByQuatPrepend:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,i=a[4],c=a[5],h=a[6],s=a[7],t[4]=r*s+o*i+u*h-e*c,t[5]=u*s+o*c+e*i-r*h,t[6]=e*s+o*h+r*c-u*i,t[7]=o*s-r*i-u*c-e*h,t},rotateAroundAxis:function(t,a,r,u){if(Math.abs(u)<n)return fn(t,a);var e=Math.hypot(r[0],r[1],r[2]);u*=.5;var o=Math.sin(u),i=o*r[0]/e,c=o*r[1]/e,h=o*r[2]/e,s=Math.cos(u),M=a[0],f=a[1],l=a[2],v=a[3];t[0]=M*s+v*i+f*h-l*c,t[1]=f*s+v*c+l*i-M*h,t[2]=l*s+v*h+M*c-f*i,t[3]=v*s-M*i-f*c-l*h;var b=a[4],m=a[5],d=a[6],x=a[7];return t[4]=b*s+x*i+m*h-d*c,t[5]=m*s+x*c+d*i-b*h,t[6]=d*s+x*h+b*c-m*i,t[7]=x*s-b*i-m*c-d*h,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t},multiply:bn,mul:mn,scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t},dot:dn,lerp:function(t,n,a,r){var u=1-r;return dn(n,a)<0&&(r=-r),t[0]=n[0]*u+a[0]*r,t[1]=n[1]*u+a[1]*r,t[2]=n[2]*u+a[2]*r,t[3]=n[3]*u+a[3]*r,t[4]=n[4]*u+a[4]*r,t[5]=n[5]*u+a[5]*r,t[6]=n[6]*u+a[6]*r,t[7]=n[7]*u+a[7]*r,t},invert:function(t,n){var a=yn(n);return t[0]=-n[0]/a,t[1]=-n[1]/a,t[2]=-n[2]/a,t[3]=n[3]/a,t[4]=-n[4]/a,t[5]=-n[5]/a,t[6]=-n[6]/a,t[7]=n[7]/a,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t},length:xn,len:pn,squaredLength:yn,sqrLen:qn,normalize:function(t,n){var a=yn(n);if(a>0){a=Math.sqrt(a);var r=n[0]/a,u=n[1]/a,e=n[2]/a,o=n[3]/a,i=n[4],c=n[5],h=n[6],s=n[7],M=r*i+u*c+e*h+o*s;t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=(i-r*M)/a,t[5]=(c-u*M)/a,t[6]=(h-e*M)/a,t[7]=(s-o*M)/a}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=a[0],f=a[1],l=a[2],v=a[3],b=a[4],m=a[5],d=a[6],x=a[7];return Math.abs(r-M)<=n*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(u-f)<=n*Math.max(1,Math.abs(u),Math.abs(f))&&Math.abs(e-l)<=n*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(o-v)<=n*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-b)<=n*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(c-m)<=n*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-d)<=n*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(s-x)<=n*Math.max(1,Math.abs(s),Math.abs(x))}});function An(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}function wn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t}function Rn(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t}function zn(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t}function Pn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return Math.hypot(a,r)}function jn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return a*a+r*r}function In(t){var n=t[0],a=t[1];return Math.hypot(n,a)}function Sn(t){var n=t[0],a=t[1];return n*n+a*a}var En=In,On=wn,Tn=Rn,Dn=zn,Fn=Pn,Ln=jn,Vn=Sn,Qn=function(){var t=An();return function(n,a,r,u,e,o){var i,c;for(a||(a=2),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],e(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),Yn=Object.freeze({create:An,clone:function(t){var n=new a(2);return n[0]=t[0],n[1]=t[1],n},fromValues:function(t,n){var r=new a(2);return r[0]=t,r[1]=n,r},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t},set:function(t,n,a){return t[0]=n,t[1]=a,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t},subtract:wn,multiply:Rn,divide:zn,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t},distance:Pn,squaredDistance:jn,length:In,squaredLength:Sn,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},normalize:function(t,n){var a=n[0],r=n[1],u=a*a+r*r;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},cross:function(t,n,a){var r=n[0]*a[1]-n[1]*a[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,n,a,r){var u=n[0],e=n[1];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t},random:function(t,n){n=n||1;var a=2*r()*Math.PI;return t[0]=Math.cos(a)*n,t[1]=Math.sin(a)*n,t},transformMat2:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u,t[1]=a[1]*r+a[3]*u,t},transformMat2d:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u+a[4],t[1]=a[1]*r+a[3]*u+a[5],t},transformMat3:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[3]*u+a[6],t[1]=a[1]*r+a[4]*u+a[7],t},transformMat4:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[4]*u+a[12],t[1]=a[1]*r+a[5]*u+a[13],t},rotate:function(t,n,a,r){var u=n[0]-a[0],e=n[1]-a[1],o=Math.sin(r),i=Math.cos(r);return t[0]=u*i-e*o+a[0],t[1]=u*o+e*i+a[1],t},angle:function(t,n){var a=t[0],r=t[1],u=n[0],e=n[1],o=a*a+r*r;o>0&&(o=1/Math.sqrt(o));var i=u*u+e*e;i>0&&(i=1/Math.sqrt(i));var c=(a*u+r*e)*o*i;return c>1?0:c<-1?Math.PI:Math.acos(c)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},equals:function(t,a){var r=t[0],u=t[1],e=a[0],o=a[1];return Math.abs(r-e)<=n*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(u-o)<=n*Math.max(1,Math.abs(u),Math.abs(o))},len:En,sub:On,mul:Tn,div:Dn,dist:Fn,sqrDist:Ln,sqrLen:Vn,forEach:Qn});t.glMatrix=e,t.mat2=s,t.mat2d=b,t.mat3=q,t.mat4=E,t.quat=sn,t.quat2=gn,t.vec2=Yn,t.vec3=$,t.vec4=Pt,Object.defineProperty(t,"__esModule",{value:!0})});

// ["glMatrix", "mat2", "mat2d", "mat3", "mat4", "quat", "quat2", "vec2", "vec3", "vec4"]
window.glMatrix = glMatrix;
window.mat2 = glMatrix.mat2;
window.mat2d = glMatrix.mat2d;
window.mat3 = glMatrix.mat3;
window.mat4 = glMatrix.mat4;
window.quat = glMatrix.quat;
window.quat2 = glMatrix.quat2;
window.vec2 = glMatrix.vec2;
window.vec3 = glMatrix.vec3;
window.vec4 = glMatrix.vec4;

var CABLES = CABLES || {}; CABLES.build = {"timestamp":1644501123821,"created":"2022-02-10T13:52:03.821Z","git":{"branch":"master","commit":"71b2fa591eaaac5525a153041f60ab23612cdcc6","date":"2022-02-10T13:51:18.000Z","message":"fix customop port serialize"}};
if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["sLw7HZ"]={settings:{opExample:[],licence:"none",isPublic:false},ops:[{objName:"Ops.Gl.Shader.CustomShader_v2",id:"0",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nfloat beehive_dist(vec2 p){\n\tvec2 s = vec2(1.0, 1.73205080757);\n    p = abs(p);\n    return max(dot(p, s*.5), p.x);\n}\n\nvec4 beehive_center(vec2 p) {\n\tvec2 s = vec2(1.0, 1.73205080757);\n    vec4 hC = floor(vec4(p, p - vec2(.5, 1))/vec4(s,s)) + .5;\n    vec4 h = vec4(p - hC.xy*s, p - (hC.zw + .5)*s);\n    return dot(h.xy, h.xy)<dot(h.zw, h.zw) ? vec4(h.xy, hC.xy) : vec4(h.zw, hC.zw + 9.73);\n}\nvec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o490056_gradient_0_pos = 0.000000000;\nconst float p_o490056_gradient_0_r = 1.000000000;\nconst float p_o490056_gradient_0_g = 0.000000000;\nconst float p_o490056_gradient_0_b = 0.000000000;\nconst float p_o490056_gradient_0_a = 1.000000000;\nconst float p_o490056_gradient_1_pos = 0.254545000;\nconst float p_o490056_gradient_1_r = 1.000000000;\nconst float p_o490056_gradient_1_g = 0.968750000;\nconst float p_o490056_gradient_1_b = 0.000000000;\nconst float p_o490056_gradient_1_a = 1.000000000;\nconst float p_o490056_gradient_2_pos = 0.527273000;\nconst float p_o490056_gradient_2_r = 0.000000000;\nconst float p_o490056_gradient_2_g = 1.000000000;\nconst float p_o490056_gradient_2_b = 0.125000000;\nconst float p_o490056_gradient_2_a = 1.000000000;\nconst float p_o490056_gradient_3_pos = 0.772727000;\nconst float p_o490056_gradient_3_r = 0.000000000;\nconst float p_o490056_gradient_3_g = 0.062500000;\nconst float p_o490056_gradient_3_b = 1.000000000;\nconst float p_o490056_gradient_3_a = 1.000000000;\nconst float p_o490056_gradient_4_pos = 1.000000000;\nconst float p_o490056_gradient_4_r = 0.843750000;\nconst float p_o490056_gradient_4_g = 0.000000000;\nconst float p_o490056_gradient_4_b = 1.000000000;\nconst float p_o490056_gradient_4_a = 1.000000000;\nvec4 o490056_gradient_gradient_fct(float x) {\n  if (x < p_o490056_gradient_0_pos) {\n    return vec4(p_o490056_gradient_0_r,p_o490056_gradient_0_g,p_o490056_gradient_0_b,p_o490056_gradient_0_a);\n  } else if (x < p_o490056_gradient_1_pos) {\n    return mix(vec4(p_o490056_gradient_0_r,p_o490056_gradient_0_g,p_o490056_gradient_0_b,p_o490056_gradient_0_a), vec4(p_o490056_gradient_1_r,p_o490056_gradient_1_g,p_o490056_gradient_1_b,p_o490056_gradient_1_a), ((x-p_o490056_gradient_0_pos)/(p_o490056_gradient_1_pos-p_o490056_gradient_0_pos)));\n  } else if (x < p_o490056_gradient_2_pos) {\n    return mix(vec4(p_o490056_gradient_1_r,p_o490056_gradient_1_g,p_o490056_gradient_1_b,p_o490056_gradient_1_a), vec4(p_o490056_gradient_2_r,p_o490056_gradient_2_g,p_o490056_gradient_2_b,p_o490056_gradient_2_a), ((x-p_o490056_gradient_1_pos)/(p_o490056_gradient_2_pos-p_o490056_gradient_1_pos)));\n  } else if (x < p_o490056_gradient_3_pos) {\n    return mix(vec4(p_o490056_gradient_2_r,p_o490056_gradient_2_g,p_o490056_gradient_2_b,p_o490056_gradient_2_a), vec4(p_o490056_gradient_3_r,p_o490056_gradient_3_g,p_o490056_gradient_3_b,p_o490056_gradient_3_a), ((x-p_o490056_gradient_2_pos)/(p_o490056_gradient_3_pos-p_o490056_gradient_2_pos)));\n  } else if (x < p_o490056_gradient_4_pos) {\n    return mix(vec4(p_o490056_gradient_3_r,p_o490056_gradient_3_g,p_o490056_gradient_3_b,p_o490056_gradient_3_a), vec4(p_o490056_gradient_4_r,p_o490056_gradient_4_g,p_o490056_gradient_4_b,p_o490056_gradient_4_a), ((x-p_o490056_gradient_3_pos)/(p_o490056_gradient_4_pos-p_o490056_gradient_3_pos)));\n  }\n  return vec4(p_o490056_gradient_4_r,p_o490056_gradient_4_g,p_o490056_gradient_4_b,p_o490056_gradient_4_a);\n}\nconst float p_o370343_cx = 0.500000000;\nconst float p_o370343_cy = 0.500000000;\nconst float p_o370343_r = 0.030000000;\nconst float p_o15985_cx = 0.500000000;\nconst float p_o15985_cy = 0.500000000;\nconst float p_o15985_r = 0.520000000;\nconst float seed_o20146 = 0.000000000;\nconst float p_o20146_sx = 4.000000000;\nconst float p_o20146_sy = 4.000000000;\nvec3 o448778_input_in(vec2 uv, float _seed_variation_) {\nfloat o370343_0_1_f = sphere((uv), vec2(p_o370343_cx, p_o370343_cy), p_o370343_r);\nfloat o15985_0_1_f = sphere((uv), vec2(p_o15985_cx, p_o15985_cy), p_o15985_r);\nvec2 o20146_0_uv = (uv)*vec2(p_o20146_sx, p_o20146_sy*1.73205080757);\nvec4 o20146_0_center = beehive_center(o20146_0_uv);float o20146_0_1_f = 1.0-2.0*beehive_dist(o20146_0_center.xy);\nvec4 o26946_0_s1 = vec4(((uv)).x, 1.0, 1.0, 1.0);\nvec4 o26946_0_s2 = vec4(vec3(o15985_0_1_f), 1.0);\nfloat o26946_0_a = (abs(iTime*0.4)*sin(iTime))*o20146_0_1_f;\nvec4 o26946_0_2_rgba = vec4(blend_screen((uv), o26946_0_s1.rgb, o26946_0_s2.rgb, o26946_0_a*o26946_0_s1.a), min(1.0, o26946_0_s2.a+o26946_0_a*o26946_0_s1.a));\nvec4 o369032_0_s1 = vec4(vec3(o370343_0_1_f), 1.0);\nvec4 o369032_0_s2 = o26946_0_2_rgba;\nfloat o369032_0_a = (abs(iTime*0.4)*sin(iTime))*1.0;\nvec4 o369032_0_2_rgba = vec4(blend_screen((uv), o369032_0_s1.rgb, o369032_0_s2.rgb, o369032_0_a*o369032_0_s1.a), min(1.0, o369032_0_s2.a+o369032_0_a*o369032_0_s1.a));\n\nreturn ((o369032_0_2_rgba).rgb);\n}\nfloat o448778_fct(vec2 uv, float _seed_variation_) {\n\tvec2 e = vec2(1.0/64.000000000, 0.0);\n\tvec3 rv = 4.0*o448778_input_in(uv, _seed_variation_);\n\trv -= o448778_input_in(uv+e.xy, _seed_variation_);\n\trv -= o448778_input_in(uv-e.xy, _seed_variation_);\n\trv -= o448778_input_in(uv+e.yx, _seed_variation_);\n\trv -= o448778_input_in(uv-e.yx, _seed_variation_);\n\trv = abs(rv);\n\treturn max(rv.x, max(rv.y ,rv.z))*64.000000000;\n}\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nfloat o448778_0_1_f = clamp(o448778_fct((UV), _seed_variation_), 0.0, 1.0);\nfloat o370343_0_1_f = sphere((UV), vec2(p_o370343_cx, p_o370343_cy), p_o370343_r);\nfloat o15985_0_1_f = sphere((UV), vec2(p_o15985_cx, p_o15985_cy), p_o15985_r);\nvec2 o20146_0_uv = (UV)*vec2(p_o20146_sx, p_o20146_sy*1.73205080757);\nvec4 o20146_0_center = beehive_center(o20146_0_uv);float o20146_0_1_f = 1.0-2.0*beehive_dist(o20146_0_center.xy);\nvec4 o26946_0_s1 = vec4(((UV)).x, 1.0, 1.0, 1.0);\nvec4 o26946_0_s2 = vec4(vec3(o15985_0_1_f), 1.0);\nfloat o26946_0_a = (abs(iTime*0.4)*sin(iTime))*o20146_0_1_f;\nvec4 o26946_0_2_rgba = vec4(blend_screen((UV), o26946_0_s1.rgb, o26946_0_s2.rgb, o26946_0_a*o26946_0_s1.a), min(1.0, o26946_0_s2.a+o26946_0_a*o26946_0_s1.a));\nvec4 o369032_0_s1 = vec4(vec3(o370343_0_1_f), 1.0);\nvec4 o369032_0_s2 = o26946_0_2_rgba;\nfloat o369032_0_a = (abs(iTime*0.4)*sin(iTime))*1.0;\nvec4 o369032_0_2_rgba = vec4(blend_screen((UV), o369032_0_s1.rgb, o369032_0_s2.rgb, o369032_0_a*o369032_0_s1.a), min(1.0, o369032_0_s2.a+o369032_0_a*o369032_0_s1.a));\nvec4 o452611_0_s1 = vec4(vec3(o448778_0_1_f), 1.0);\nvec4 o452611_0_s2 = o369032_0_2_rgba;\nfloat o452611_0_a = (round(iTime*0.9)*sin(iTime*0.2))*1.0;\nvec4 o452611_0_2_rgba = vec4(blend_multiply((UV), o452611_0_s1.rgb, o452611_0_s2.rgb, o452611_0_a*o452611_0_s1.a), min(1.0, o452611_0_s2.a+o452611_0_a*o452611_0_s1.a));\nvec4 o490056_0_1_rgba = o490056_gradient_gradient_fct((dot((o452611_0_2_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o490056_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"1",objOut:"0"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"1",objOut:"0"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"1",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"10",objOut:"1"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"5",objOut:"1"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"2",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:2.19},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"0",objOut:"2"},{portIn:"time",portOut:"Time",objIn:"11",objOut:"2"}]}]},{objName:"Ops.Sequence",id:"3",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"0",objOut:"3"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Gl.MainLoop",id:"4",uiAttribs:{subPatch:0},portsIn:[{name:"FPS Limit",value:0},{name:"Reduce FPS not focussed",value:true},{name:"Reduce FPS loading",value:false},{name:"Clear",value:true},{name:"ClearAlpha",value:true},{name:"Fullscreen Button",value:false},{name:"Active",value:true},{name:"Hires Displays",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"37",objOut:"4"},{portIn:"render",portOut:"trigger",objIn:"119",objOut:"4"},{portIn:"Render",portOut:"trigger",objIn:"118",objOut:"4"},{portIn:"render",portOut:"trigger",objIn:"124",objOut:"4"}]},{name:"width",value:640},{name:"height",value:320}]},{objName:"Ops.Ui.VizTexture",id:"5",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"7",objOut:"5"}]}]},{objName:"Ops.Gl.Render2Texture",id:"6",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"7",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"39",objOut:"7"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"8",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:true},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"exe",portOut:"Next",objIn:"3",objOut:"8"},{portIn:"render",portOut:"Next",objIn:"7",objOut:"8"},{portIn:"Render",portOut:"Next",objIn:"41",objOut:"8"},{portIn:"exe",portOut:"Next",objIn:"115",objOut:"8"}]},{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"40",objOut:"8"}]},{name:"Aspect Ratio",value:2}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"9",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"10",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"11",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",value:0}]},{objName:"Ops.Trigger.TimedSequence",id:"12",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"current"},{name:"overwriteTime",value:false},{name:"ignoreInSubPatch",value:false}],portsOut:[{name:"triggerAlways",links:[{portIn:"Render",portOut:"triggerAlways",objIn:"8",objOut:"12"},{portIn:"Render",portOut:"triggerAlways",objIn:"20",objOut:"12"},{portIn:"Render",portOut:"triggerAlways",objIn:"31",objOut:"12"},{portIn:"Render",portOut:"triggerAlways",objIn:"60",objOut:"12"},{portIn:"Render",portOut:"triggerAlways",objIn:"87",objOut:"12"}]},{name:"Names"},{name:"currentKeyTime",value:0},{name:"Current",value:0},{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"9",objOut:"12"}]},{name:"trigger 1",links:[{portIn:"render",portOut:"trigger 1",objIn:"23",objOut:"12"}]},{name:"trigger 2",links:[{portIn:"render",portOut:"trigger 2",objIn:"34",objOut:"12"}]},{name:"trigger 3",value:0},{name:"trigger 4",links:[{portIn:"render",portOut:"trigger 4",objIn:"63",objOut:"12"}]},{name:"trigger 5",links:[{portIn:"render",portOut:"trigger 5",objIn:"66",objOut:"12"}]},{name:"trigger 6",links:[{portIn:"render",portOut:"trigger 6",objIn:"64",objOut:"12"}]},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0},{name:"trigger 16",value:0},{name:"trigger 17",value:0},{name:"trigger 18",value:0},{name:"trigger 19",value:0},{name:"trigger 20",value:0},{name:"trigger 21",value:0},{name:"trigger 22",value:0},{name:"trigger 23",value:0},{name:"trigger 24",value:0},{name:"trigger 25",value:0},{name:"trigger 26",value:0},{name:"trigger 27",value:0},{name:"trigger 28",value:0},{name:"trigger 29",value:0},{name:"trigger 30",value:0},{name:"trigger 31",value:0}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"13",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nfloat beehive_dist(vec2 p){\n\tvec2 s = vec2(1.0, 1.73205080757);\n    p = abs(p);\n    return max(dot(p, s*.5), p.x);\n}\n\nvec4 beehive_center(vec2 p) {\n\tvec2 s = vec2(1.0, 1.73205080757);\n    vec4 hC = floor(vec4(p, p - vec2(.5, 1))/vec4(s,s)) + .5;\n    vec4 h = vec4(p - hC.xy*s, p - (hC.zw + .5)*s);\n    return dot(h.xy, h.xy)<dot(h.zw, h.zw) ? vec4(h.xy, hC.xy) : vec4(h.zw, hC.zw + 9.73);\n}\nvec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o490056_gradient_0_pos = 0.000000000;\nconst float p_o490056_gradient_0_r = 1.000000000;\nconst float p_o490056_gradient_0_g = 0.000000000;\nconst float p_o490056_gradient_0_b = 0.000000000;\nconst float p_o490056_gradient_0_a = 1.000000000;\nconst float p_o490056_gradient_1_pos = 0.119755415;\nconst float p_o490056_gradient_1_r = 0.843750000;\nconst float p_o490056_gradient_1_g = 0.000000000;\nconst float p_o490056_gradient_1_b = 1.000000000;\nconst float p_o490056_gradient_1_a = 1.000000000;\nconst float p_o490056_gradient_2_pos = 0.488830844;\nconst float p_o490056_gradient_2_r = 0.000000000;\nconst float p_o490056_gradient_2_g = 0.000000000;\nconst float p_o490056_gradient_2_b = 0.000000000;\nconst float p_o490056_gradient_2_a = 1.000000000;\nconst float p_o490056_gradient_3_pos = 0.827149131;\nconst float p_o490056_gradient_3_r = 1.000000000;\nconst float p_o490056_gradient_3_g = 0.968750000;\nconst float p_o490056_gradient_3_b = 0.000000000;\nconst float p_o490056_gradient_3_a = 1.000000000;\nconst float p_o490056_gradient_4_pos = 0.980930120;\nconst float p_o490056_gradient_4_r = 0.000000000;\nconst float p_o490056_gradient_4_g = 0.062500000;\nconst float p_o490056_gradient_4_b = 1.000000000;\nconst float p_o490056_gradient_4_a = 1.000000000;\nvec4 o490056_gradient_gradient_fct(float x) {\n  if (x < p_o490056_gradient_0_pos) {\n    return vec4(p_o490056_gradient_0_r,p_o490056_gradient_0_g,p_o490056_gradient_0_b,p_o490056_gradient_0_a);\n  } else if (x < p_o490056_gradient_1_pos) {\n    return mix(vec4(p_o490056_gradient_0_r,p_o490056_gradient_0_g,p_o490056_gradient_0_b,p_o490056_gradient_0_a), vec4(p_o490056_gradient_1_r,p_o490056_gradient_1_g,p_o490056_gradient_1_b,p_o490056_gradient_1_a), ((x-p_o490056_gradient_0_pos)/(p_o490056_gradient_1_pos-p_o490056_gradient_0_pos)));\n  } else if (x < p_o490056_gradient_2_pos) {\n    return mix(vec4(p_o490056_gradient_1_r,p_o490056_gradient_1_g,p_o490056_gradient_1_b,p_o490056_gradient_1_a), vec4(p_o490056_gradient_2_r,p_o490056_gradient_2_g,p_o490056_gradient_2_b,p_o490056_gradient_2_a), ((x-p_o490056_gradient_1_pos)/(p_o490056_gradient_2_pos-p_o490056_gradient_1_pos)));\n  } else if (x < p_o490056_gradient_3_pos) {\n    return mix(vec4(p_o490056_gradient_2_r,p_o490056_gradient_2_g,p_o490056_gradient_2_b,p_o490056_gradient_2_a), vec4(p_o490056_gradient_3_r,p_o490056_gradient_3_g,p_o490056_gradient_3_b,p_o490056_gradient_3_a), ((x-p_o490056_gradient_2_pos)/(p_o490056_gradient_3_pos-p_o490056_gradient_2_pos)));\n  } else if (x < p_o490056_gradient_4_pos) {\n    return mix(vec4(p_o490056_gradient_3_r,p_o490056_gradient_3_g,p_o490056_gradient_3_b,p_o490056_gradient_3_a), vec4(p_o490056_gradient_4_r,p_o490056_gradient_4_g,p_o490056_gradient_4_b,p_o490056_gradient_4_a), ((x-p_o490056_gradient_3_pos)/(p_o490056_gradient_4_pos-p_o490056_gradient_3_pos)));\n  }\n  return vec4(p_o490056_gradient_4_r,p_o490056_gradient_4_g,p_o490056_gradient_4_b,p_o490056_gradient_4_a);\n}\nconst float p_o370343_cx = 0.500000000;\nconst float p_o370343_cy = 0.500000000;\nconst float p_o370343_r = 0.030000000;\nconst float p_o15985_cx = 0.500000000;\nconst float p_o15985_cy = 0.500000000;\nconst float p_o15985_r = 0.520000000;\nconst float seed_o20146 = 0.000000000;\nvec3 o448778_input_in(vec2 uv, float _seed_variation_) {\nfloat o370343_0_1_f = sphere((uv), vec2(p_o370343_cx, p_o370343_cy), p_o370343_r);\nfloat o15985_0_1_f = sphere((uv), vec2(p_o15985_cx, p_o15985_cy), p_o15985_r);\nvec2 o20146_0_uv = (uv)*vec2((sin(iTime*0.7)), (sin(iTime*0.7))*1.73205080757);\nvec4 o20146_0_center = beehive_center(o20146_0_uv);float o20146_0_1_f = 1.0-2.0*beehive_dist(o20146_0_center.xy);\nvec4 o26946_0_s1 = vec4(((uv)).x, 1.0, 1.0, 1.0);\nvec4 o26946_0_s2 = vec4(vec3(o15985_0_1_f), 1.0);\nfloat o26946_0_a = (abs(iTime*0.4)*sin(iTime))*o20146_0_1_f;\nvec4 o26946_0_2_rgba = vec4(blend_overlay((uv), o26946_0_s1.rgb, o26946_0_s2.rgb, o26946_0_a*o26946_0_s1.a), min(1.0, o26946_0_s2.a+o26946_0_a*o26946_0_s1.a));\nvec4 o369032_0_s1 = vec4(vec3(o370343_0_1_f), 1.0);\nvec4 o369032_0_s2 = o26946_0_2_rgba;\nfloat o369032_0_a = (abs(iTime*0.4)*sin(iTime))*1.0;\nvec4 o369032_0_2_rgba = vec4(blend_burn((uv), o369032_0_s1.rgb, o369032_0_s2.rgb, o369032_0_a*o369032_0_s1.a), min(1.0, o369032_0_s2.a+o369032_0_a*o369032_0_s1.a));\n\nreturn ((o369032_0_2_rgba).rgb);\n}\nfloat o448778_fct(vec2 uv, float _seed_variation_) {\n\tvec2 e = vec2(1.0/64.000000000, 0.0);\n\tvec3 rv = 4.0*o448778_input_in(uv, _seed_variation_);\n\trv -= o448778_input_in(uv+e.xy, _seed_variation_);\n\trv -= o448778_input_in(uv-e.xy, _seed_variation_);\n\trv -= o448778_input_in(uv+e.yx, _seed_variation_);\n\trv -= o448778_input_in(uv-e.yx, _seed_variation_);\n\trv = abs(rv);\n\treturn max(rv.x, max(rv.y ,rv.z))*64.000000000;\n}\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nfloat o448778_0_1_f = clamp(o448778_fct((UV), _seed_variation_), 0.0, 1.0);\nfloat o370343_0_1_f = sphere((UV), vec2(p_o370343_cx, p_o370343_cy), p_o370343_r);\nfloat o15985_0_1_f = sphere((UV), vec2(p_o15985_cx, p_o15985_cy), p_o15985_r);\nvec2 o20146_0_uv = (UV)*vec2((sin(iTime*0.7)), (sin(iTime*0.7))*1.73205080757);\nvec4 o20146_0_center = beehive_center(o20146_0_uv);float o20146_0_1_f = 1.0-2.0*beehive_dist(o20146_0_center.xy);\nvec4 o26946_0_s1 = vec4(((UV)).x, 1.0, 1.0, 1.0);\nvec4 o26946_0_s2 = vec4(vec3(o15985_0_1_f), 1.0);\nfloat o26946_0_a = (abs(iTime*0.4)*sin(iTime))*o20146_0_1_f;\nvec4 o26946_0_2_rgba = vec4(blend_overlay((UV), o26946_0_s1.rgb, o26946_0_s2.rgb, o26946_0_a*o26946_0_s1.a), min(1.0, o26946_0_s2.a+o26946_0_a*o26946_0_s1.a));\nvec4 o369032_0_s1 = vec4(vec3(o370343_0_1_f), 1.0);\nvec4 o369032_0_s2 = o26946_0_2_rgba;\nfloat o369032_0_a = (abs(iTime*0.4)*sin(iTime))*1.0;\nvec4 o369032_0_2_rgba = vec4(blend_burn((UV), o369032_0_s1.rgb, o369032_0_s2.rgb, o369032_0_a*o369032_0_s1.a), min(1.0, o369032_0_s2.a+o369032_0_a*o369032_0_s1.a));\nvec4 o452611_0_s1 = vec4(vec3(o448778_0_1_f), 1.0);\nvec4 o452611_0_s2 = o369032_0_2_rgba;\nfloat o452611_0_a = (round(iTime*0.9)*sin(iTime*0.2))*1.0;\nvec4 o452611_0_2_rgba = vec4(blend_hard_light((UV), o452611_0_s1.rgb, o452611_0_s2.rgb, o452611_0_a*o452611_0_s1.a), min(1.0, o452611_0_s2.a+o452611_0_a*o452611_0_s1.a));\nvec4 o490056_0_1_rgba = o490056_gradient_gradient_fct((dot((o452611_0_2_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o490056_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"14",objOut:"13"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"14",objOut:"13"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"14",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"21",objOut:"14"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"17",objOut:"14"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"15",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.69},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"13",objOut:"15"},{portIn:"time",portOut:"Time",objIn:"22",objOut:"15"}]}]},{objName:"Ops.Sequence",id:"16",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"13",objOut:"16"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Ui.VizTexture",id:"17",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"19",objOut:"17"}]}]},{objName:"Ops.Gl.Render2Texture",id:"18",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"19",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"22",objOut:"19"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"20",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:false},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"19",objOut:"20"},{portIn:"exe",portOut:"Next",objIn:"16",objOut:"20"},{portIn:"exe",portOut:"Next",objIn:"112",objOut:"20"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"23",objOut:"20"}]},{name:"Aspect Ratio",value:1.3333333333333333}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"21",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"22",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"110",objOut:"22"}]}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"23",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"24",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat perlin(vec2 uv, vec2 size, int iterations, float persistence, float seed) {\n\tvec2 seed2 = rand2(vec2(seed, 1.0-seed));\n    float rv = 0.0;\n    float coef = 1.0;\n    float acc = 0.0;\n    for (int i = 0; i < iterations; ++i) {\n    \tvec2 step = vec2(1.0)/size;\n\t\tvec2 xy = floor(uv*size);\n        float f0 = rand(seed2+mod(xy, size));\n        float f1 = rand(seed2+mod(xy+vec2(1.0, 0.0), size));\n        float f2 = rand(seed2+mod(xy+vec2(0.0, 1.0), size));\n        float f3 = rand(seed2+mod(xy+vec2(1.0, 1.0), size));\n        vec2 mixval = smoothstep(0.0, 1.0, fract(uv*size));\n        rv += coef * mix(mix(f0, f1, mixval.x), mix(f2, f3, mixval.x), mixval.y);\n        acc += coef;\n        size *= 2.0;\n        coef *= persistence;\n    }\n    \n    return rv / acc;\n}\nvec2 transform(vec2 uv, vec2 translate, float rotate, vec2 scale, bool repeat) {\n \tvec2 rv;\n\tuv -= translate;\n\tuv -= vec2(0.5);\n\trv.x = cos(rotate)*uv.x + sin(rotate)*uv.y;\n\trv.y = -sin(rotate)*uv.x + cos(rotate)*uv.y;\n\trv /= scale;\n\trv += vec2(0.5);\n    if (repeat) {\n\t\treturn fract(rv);\n\t} else {\n\t\treturn clamp(rv, vec2(0.0), vec2(1.0));\n\t}\t\n}vec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o710689_gradient_0_pos = 0.000000000;\nconst float p_o710689_gradient_0_r = 1.000000000;\nconst float p_o710689_gradient_0_g = 0.000000000;\nconst float p_o710689_gradient_0_b = 0.000000000;\nconst float p_o710689_gradient_0_a = 1.000000000;\nconst float p_o710689_gradient_1_pos = 0.105021078;\nconst float p_o710689_gradient_1_r = 0.785156250;\nconst float p_o710689_gradient_1_g = 0.000000000;\nconst float p_o710689_gradient_1_b = 0.000000000;\nconst float p_o710689_gradient_1_a = 1.000000000;\nconst float p_o710689_gradient_2_pos = 0.494770119;\nconst float p_o710689_gradient_2_r = 0.000000000;\nconst float p_o710689_gradient_2_g = 1.000000000;\nconst float p_o710689_gradient_2_b = 0.125000000;\nconst float p_o710689_gradient_2_a = 1.000000000;\nconst float p_o710689_gradient_3_pos = 0.895845170;\nconst float p_o710689_gradient_3_r = 0.031250000;\nconst float p_o710689_gradient_3_g = 0.000000000;\nconst float p_o710689_gradient_3_b = 1.000000000;\nconst float p_o710689_gradient_3_a = 1.000000000;\nconst float p_o710689_gradient_4_pos = 1.000000000;\nconst float p_o710689_gradient_4_r = 0.000000000;\nconst float p_o710689_gradient_4_g = 0.062500000;\nconst float p_o710689_gradient_4_b = 1.000000000;\nconst float p_o710689_gradient_4_a = 1.000000000;\nvec4 o710689_gradient_gradient_fct(float x) {\n  if (x < p_o710689_gradient_0_pos) {\n    return vec4(p_o710689_gradient_0_r,p_o710689_gradient_0_g,p_o710689_gradient_0_b,p_o710689_gradient_0_a);\n  } else if (x < p_o710689_gradient_1_pos) {\n    return mix(vec4(p_o710689_gradient_0_r,p_o710689_gradient_0_g,p_o710689_gradient_0_b,p_o710689_gradient_0_a), vec4(p_o710689_gradient_1_r,p_o710689_gradient_1_g,p_o710689_gradient_1_b,p_o710689_gradient_1_a), 0.5-0.5*cos(3.14159265359*(x-p_o710689_gradient_0_pos)/(p_o710689_gradient_1_pos-p_o710689_gradient_0_pos)));\n  } else if (x < p_o710689_gradient_2_pos) {\n    return mix(vec4(p_o710689_gradient_1_r,p_o710689_gradient_1_g,p_o710689_gradient_1_b,p_o710689_gradient_1_a), vec4(p_o710689_gradient_2_r,p_o710689_gradient_2_g,p_o710689_gradient_2_b,p_o710689_gradient_2_a), 0.5-0.5*cos(3.14159265359*(x-p_o710689_gradient_1_pos)/(p_o710689_gradient_2_pos-p_o710689_gradient_1_pos)));\n  } else if (x < p_o710689_gradient_3_pos) {\n    return mix(vec4(p_o710689_gradient_2_r,p_o710689_gradient_2_g,p_o710689_gradient_2_b,p_o710689_gradient_2_a), vec4(p_o710689_gradient_3_r,p_o710689_gradient_3_g,p_o710689_gradient_3_b,p_o710689_gradient_3_a), 0.5-0.5*cos(3.14159265359*(x-p_o710689_gradient_2_pos)/(p_o710689_gradient_3_pos-p_o710689_gradient_2_pos)));\n  } else if (x < p_o710689_gradient_4_pos) {\n    return mix(vec4(p_o710689_gradient_3_r,p_o710689_gradient_3_g,p_o710689_gradient_3_b,p_o710689_gradient_3_a), vec4(p_o710689_gradient_4_r,p_o710689_gradient_4_g,p_o710689_gradient_4_b,p_o710689_gradient_4_a), 0.5-0.5*cos(3.14159265359*(x-p_o710689_gradient_3_pos)/(p_o710689_gradient_4_pos-p_o710689_gradient_3_pos)));\n  }\n  return vec4(p_o710689_gradient_4_r,p_o710689_gradient_4_g,p_o710689_gradient_4_b,p_o710689_gradient_4_a);\n}\nconst float p_o755667_translate_y = 1.000000000;\nconst float p_o800540_translate_x = 1.000000000;\nconst float p_o800540_translate_y = 0.370000000;\nconst float p_o800540_rotate = 0.000000000;\nconst float p_o800540_scale_x = 1.000000000;\nconst float p_o800540_scale_y = 1.000000000;\nconst float seed_o800541 = 1093.000000000;\nconst float p_o800541_scale_x = 4.000000000;\nconst float p_o800541_scale_y = 4.000000000;\nconst float p_o800541_iterations = 2.000000000;\nconst float p_o800541_persistence = 0.100000000;\nconst float p_o695213_curve_0_x = 0.000000000;\nconst float p_o695213_curve_0_y = 1.000000000;\nconst float p_o695213_curve_0_ls = 0.000000000;\nconst float p_o695213_curve_0_rs = -1.000000000;\nconst float p_o695213_curve_1_x = 1.000000000;\nconst float p_o695213_curve_1_y = 0.000000000;\nconst float p_o695213_curve_1_ls = -1.000000000;\nconst float p_o695213_curve_1_rs = 0.000000000;\nfloat o695213_curve_curve_fct(float x) {\n{\nfloat dx = x - p_o695213_curve_0_x;\nfloat d = p_o695213_curve_1_x - p_o695213_curve_0_x;\nfloat t = dx/d;\nfloat omt = (1.0 - t);\nfloat omt2 = omt * omt;\nfloat omt3 = omt2 * omt;\nfloat t2 = t * t;\nfloat t3 = t2 * t;\nd /= 3.0;\nfloat y1 = p_o695213_curve_0_y;\nfloat yac = p_o695213_curve_0_y + d*p_o695213_curve_0_rs;\nfloat ybc = p_o695213_curve_1_y - d*p_o695213_curve_1_ls;\nfloat y2 = p_o695213_curve_1_y;\nreturn y1*omt3 + yac*omt2*t*3.0 + ybc*omt*t2*3.0 + y2*t3;\n}\n}\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nfloat o800541_0_1_f = perlin(((UV)-vec2((round(iTime*0.2*0.8)*sin(iTime*0.1*0.8)), p_o755667_translate_y)), vec2(p_o800541_scale_x, p_o800541_scale_y), int(p_o800541_iterations), p_o800541_persistence, (seed_o800541+_seed_variation_));\nfloat o800541_0_3_f = perlin((transform(((UV)-vec2((round(iTime*0.2*0.8)*sin(iTime*0.1*0.8)), p_o755667_translate_y)), vec2(p_o800540_translate_x*(2.0*o800541_0_1_f-1.0), p_o800540_translate_y*(2.0*o800541_0_1_f-1.0)), p_o800540_rotate*0.01745329251*(2.0*1.0-1.0), vec2(p_o800540_scale_x*(2.0*1.0-1.0), p_o800540_scale_y*(2.0*1.0-1.0)), true)), vec2(p_o800541_scale_x, p_o800541_scale_y), int(p_o800541_iterations), p_o800541_persistence, (seed_o800541+_seed_variation_));\nvec4 o800540_0_1_rgba = vec4(vec3(o800541_0_3_f), 1.0);\nvec4 o755667_0_1_rgba = o800540_0_1_rgba;\nfloat o695213_0_1_f = o695213_curve_curve_fct((dot((o755667_0_1_rgba).rgb, vec3(1.0))/3.0));\nvec4 o690393_0_s1 = o755667_0_1_rgba;\nvec4 o690393_0_s2 = vec4(1.0, ((UV)).y, 1.0, 1.0);\nfloat o690393_0_a = (abs(iTime*0.2)*sin(iTime*0.2))*o695213_0_1_f;\nvec4 o690393_0_2_rgba = vec4(blend_lighten((UV), o690393_0_s1.rgb, o690393_0_s2.rgb, o690393_0_a*o690393_0_s1.a), min(1.0, o690393_0_s2.a+o690393_0_a*o690393_0_s1.a));\nvec4 o710689_0_1_rgba = o710689_gradient_gradient_fct((dot((o690393_0_2_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o710689_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"25",objOut:"24"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"25",objOut:"24"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"25",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"32",objOut:"25"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"28",objOut:"25"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"26",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:3.39},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"24",objOut:"26"},{portIn:"time",portOut:"Time",objIn:"33",objOut:"26"}]}]},{objName:"Ops.Sequence",id:"27",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"24",objOut:"27"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Ui.VizTexture",id:"28",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"30",objOut:"28"}]}]},{objName:"Ops.Gl.Render2Texture",id:"29",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"30",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"33",objOut:"30"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"31",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:false},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"30",objOut:"31"},{portIn:"exe",portOut:"Next",objIn:"27",objOut:"31"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"34",objOut:"31"}]},{name:"Aspect Ratio",value:1.3333333333333333}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"32",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"33",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"109",objOut:"33"}]}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"34",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Sidebar.Slider_v3",id:"35",uiAttribs:{subPatch:0},portsIn:[{name:"link",value:0},{name:"Text",value:"Slider"},{name:"Min",value:0},{name:"Max",value:4.04},{name:"Step",value:.1},{name:"Suffix",value:""},{name:"Grey Out",value:false},{name:"Visible",value:true},{name:"Input",value:.5},{name:"Set Default",value:0},{name:"Reset",value:0},{name:"Default",value:.5}],portsOut:[{name:"childs"},{name:"Result",value:.5}]},{objName:"Ops.Sidebar.Button_v2",id:"36",uiAttribs:{subPatch:0},portsIn:[{name:"link",value:0},{name:"Text",value:"Button"},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs"},{name:"Pressed Trigger",value:0}]},{objName:"Ops.Trigger.GateTrigger",id:"37",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Pass Through"}],portsOut:[{name:"Trigger out",links:[{portIn:"exe",portOut:"Trigger out",objIn:"12",objOut:"37"}]}]},{objName:"Ops.Boolean.ToggleBool",id:"38",uiAttribs:{subPatch:0},portsIn:[{name:"trigger"},{name:"reset",value:0},{name:"Default",value:false}],portsOut:[{name:"result",links:[{portIn:"Pass Through",portOut:"result",objIn:"37",objOut:"38"}]}]},{objName:"Ops.Gl.TextureEffects.Gradient",id:"39",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"difference"},{name:"Amount",value:1},{name:"Width",value:1},{name:"Type index",value:0},{name:"Type",value:"X"},{name:"Pos"},{name:"Smoothstep",value:true},{name:"r",value:1},{name:"g",value:0},{name:"b",value:0},{name:"r2",value:0},{name:"g2",value:0},{name:"b2",value:0},{name:"r3",value:0},{name:"g3",value:.20000000000000018},{name:"b3",value:1},{name:"Randomize",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"11",objOut:"39"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"40",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"43",objOut:"40"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"41",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:false},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"40",objOut:"41"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"9",objOut:"41"}]},{name:"Aspect Ratio",value:1.3333333333333333}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"42",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time",value:0},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.Gradient",id:"43",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"hardlight"},{name:"Amount",value:1},{name:"Width",value:1},{name:"Type index",value:0},{name:"Type",value:"Radial"},{name:"Pos",value:.293},{name:"Smoothstep",value:true},{name:"r",value:1},{name:"g",value:0},{name:"b",value:0},{name:"r2",value:0},{name:"g2",value:0},{name:"b2",value:0},{name:"r3",value:0},{name:"g3",value:0},{name:"b3",value:1},{name:"Randomize",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"42",objOut:"43"}]}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"44",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:51},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"48",objOut:"44"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"45",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:52},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"49",objOut:"45"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"46",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:53},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"50",objOut:"46"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Value.Number",id:"47",uiAttribs:{subPatch:0},portsIn:[{name:"value"}],portsOut:[{name:"result",links:[{portIn:"current",portOut:"result",objIn:"12",objOut:"47"}]}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"48",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:0}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"48"}]}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"49",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:1}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"49"}]}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"50",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:2}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"50"}]}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"51",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:17},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"52",objOut:"51"},{portIn:"trigger",portOut:"on press",objIn:"38",objOut:"51"}]},{name:"on release",links:[{portIn:"Trigger",portOut:"on release",objIn:"78",objOut:"51"}]},{name:"Pressed",value:false}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"52",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:0}],portsOut:[{name:"Next",value:0},{name:"Out Value",value:0}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"53",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nconst float p_o254341_R = 0.210000000;\nconst float p_o254341_r = 0.270000000;\nvec2 o256395_input_sdf(vec3 p, float _seed_variation_) {\nvec2 o254341_0_q = vec2(length((p).zx)-p_o254341_R,(p).y);\nfloat o254341_0_1_sdf3d = length(o254341_0_q)-p_o254341_r;\n\nreturn vec2(o254341_0_1_sdf3d, 0.0);\n}\nvec2 raymarch_o256395(vec2 uv, float _seed_variation_) {\n\tvec3 ro = vec3(uv-vec2(0.5), 1.0);\n\tvec3 rd = vec3(0.0, 0.0, -1.0);\n\tfloat dO = 0.0;\n\tfloat c = 0.0;\n    for (int i=0; i < 100; i++) {\n    \tvec3 p = ro + rd*dO;\n        vec2 dS = o256395_input_sdf(p, _seed_variation_);\n        dO += dS.x;\n\n        if (dO >= 1.0) {\n\t\t\tbreak;\n\t\t} else if (dS.x < 0.0001) {\n\t\t\tc = dS.y;\n\t\t\tbreak;\n\t\t}\n    }\n    \n    return vec2(dO, c);\n}\n\nvec3 normal_o256395(vec3 p, float _seed_variation_) {\n\tif (p.z <= 0.0) {\n\t\treturn vec3(0.0, 0.0, 1.0);\n\t}\n\n\tfloat d = o256395_input_sdf(p, _seed_variation_).x;\n    float e = .001;\n    \n    vec3 n = d - vec3(\n        o256395_input_sdf(p-vec3(e, 0.0, 0.0), _seed_variation_).x,\n        o256395_input_sdf(p-vec3(0.0, e, 0.0), _seed_variation_).x,\n        o256395_input_sdf(p-vec3(0.0, 0.0, e), _seed_variation_).x);\n    \n    return vec3(-1.0, -1.0, -1.0)*normalize(n);\n}\n\nconst float p_o207924_d = 0.810000000;\nconst float p_o57201_cx = 0.500000000;\nconst float p_o57201_cy = 0.500000000;\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nvec2 o256395_0_d = raymarch_o256395((UV), _seed_variation_);\nvec3 o256395_1_1_rgb = vec3(0.5)+0.5*normal_o256395(vec3((UV)-vec2(0.5), 1.0-o256395_0_d.x), _seed_variation_);\nfloat o57201_0_1_f = sphere(((vec4(o256395_1_1_rgb, 0.0)).xy+vec2(0.5)), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.9)*sin(iTime*0.5)));\nvec3 o241986_0_1_tex3d = vec3(o57201_0_1_f);\nvec3 o207924_0_1_tex3d = mix(o241986_0_1_tex3d, vec3(0.5), clamp(0.0/max(p_o207924_d, 0.0001), 0.0, 1.0));\nvec3 o245261_0_1_rgb = o207924_0_1_tex3d;\ngl_FragColor = vec4(o245261_0_1_rgb, 1.0);\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"54",objOut:"53"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"54",objOut:"53"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"54",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"69",objOut:"54"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"57",objOut:"54"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"55",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:1},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"53",objOut:"55"},{portIn:"time",portOut:"Time",objIn:"62",objOut:"55"},{portIn:"time",portOut:"Time",objIn:"72",objOut:"55"},{portIn:"Rotate",portOut:"Time",objIn:"73",objOut:"55"}]}]},{objName:"Ops.Sequence",id:"56",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"53",objOut:"56"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Ui.VizTexture",id:"57",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"59",objOut:"57"}]}]},{objName:"Ops.Gl.Render2Texture",id:"58",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"59",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"74",objOut:"59"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"60",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:true},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"59",objOut:"60"},{portIn:"exe",portOut:"Next",objIn:"56",objOut:"60"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"63",objOut:"60"}]},{name:"Aspect Ratio",value:2}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"61",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"62",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"Render",portOut:"Trigger",objIn:"72",objOut:"62"}]}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"63",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"64",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"65",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:0},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"66",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"67",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:54},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"68",objOut:"67"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"68",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:4}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"68"}]}]},{objName:"Ops.Gl.TextureEffects.ColorMap",id:"69",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Gradient"},{name:"Method index",value:0},{name:"Method",value:"Luminance"},{name:"Min",value:.258},{name:"Max",value:1},{name:"Position",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"61",objOut:"69"}]}]},{objName:"Ops.Gl.GradientTexture",id:"70",uiAttribs:{subPatch:0},portsIn:[{name:"Gradient",value:'{"keys":[{"pos":0,"r":1,"g":0,"b":0},{"pos":0.25,"r":1,"g":0,"b":0},{"pos":0.386,"r":0.7604346180181212,"g":0.5489903204869321,"b":0.8147596590458878},{"pos":0.432,"r":0,"g":0.11999999999999966,"b":1},{"pos":1,"r":0,"g":0.11999999999999966,"b":1}]}'},{name:"Direction index",value:0},{name:"Direction",value:"X"},{name:"Smoothstep",value:false},{name:"Step",value:true},{name:"Flip",value:false},{name:"Size",value:256},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Gradient Array",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Gradient",portOut:"Texture",objIn:"69",objOut:"70"}]}]},{objName:"Ops.Gl.TextureEffects.Mirror",id:"71",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"axis index",value:0},{name:"axis",value:"X"},{name:"width",value:5.32},{name:"offset",value:0},{name:"flip",value:true}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"76",objOut:"71"}]}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"72",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:.06},{name:"RepeatY",value:.11},{name:"Multiply",value:6.71},{name:"Mask",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"71",objOut:"72"}]}]},{objName:"Ops.Gl.TextureEffects.Waveform_v2",id:"73",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:.555},{name:"Waveform index",value:0},{name:"Waveform",value:"Square"},{name:"Amplitude",value:.5},{name:"Frequency",value:2.05},{name:"Line Width",value:0},{name:"Line Glow",value:.089},{name:"invert color",value:false},{name:"Solid fill",value:false},{name:"Offset X",value:0},{name:"Offset Y",value:.478},{name:"Rotate"},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"69",objOut:"73"}]}]},{objName:"Ops.Gl.TextureEffects.ColorMap",id:"74",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"multiply invert"},{name:"Amount",value:1},{name:"Gradient"},{name:"Method index",value:0},{name:"Method",value:"Luminance"},{name:"Min",value:.478},{name:"Max",value:1},{name:"Position",value:.383}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"62",objOut:"74"}]}]},{objName:"Ops.Gl.GradientTexture",id:"75",uiAttribs:{subPatch:0},portsIn:[{name:"Gradient",value:'{"keys":[{"pos":0,"r":1,"g":0,"b":0},{"pos":0.392,"r":1,"g":0,"b":0},{"pos":0.588,"r":0.08000000000000008,"g":0,"b":1},{"pos":1,"r":0.08000000000000008,"g":0,"b":1}]}'},{name:"Direction index",value:0},{name:"Direction",value:"X"},{name:"Smoothstep",value:true},{name:"Step",value:true},{name:"Flip",value:true},{name:"Size",value:256},{name:"filter index",value:1},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Gradient Array",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Gradient",portOut:"Texture",objIn:"74",objOut:"75"}]}]},{objName:"Ops.Gl.TextureEffects.Twirl_v3",id:"76",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"exclusion"},{name:"Amount"},{name:"Twist amount",value:200},{name:"Radius",value:.5},{name:"Center X",value:.5},{name:"Center Y",value:.5}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"73",objOut:"76"}]}]},{objName:"Ops.Anim.Timer_v2",id:"77",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:2.92},{name:"Play",value:true},{name:"Reset"},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"Amount",portOut:"Time",objIn:"76",objOut:"77"}]}]},{objName:"Ops.Trigger.TriggerSend",id:"78",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"TimerStart"}],portsOut:[]},{objName:"Ops.Trigger.TriggerReceive",id:"79",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"TimerStart"}],portsOut:[{name:"Triggered",links:[{portIn:"Reset",portOut:"Triggered",objIn:"77",objOut:"79"}]}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"80",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nfloat box(vec2 uv, vec3 center, vec3 rad, vec3 rot) {\n\tvec3 ro = vec3(uv, 1.0)-center;\n\tvec3 rd = vec3(0.0000001, 0.0000001, -1.0);\n\tmat3 r = mat3(vec3(1, 0, 0), vec3(0, cos(rot.x), -sin(rot.x)), vec3(0, sin(rot.x), cos(rot.x)));\n\tr *= mat3(vec3(cos(rot.y), 0, -sin(rot.y)), vec3(0, 1, 0), vec3(sin(rot.y), 0, cos(rot.y)));\n\tr *= mat3(vec3(cos(rot.z), -sin(rot.z), 0), vec3(sin(rot.z), cos(rot.z), 0), vec3(0, 0, 1));\n\tro = r * ro;\n\trd = r * rd;\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*rad;\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\n    float tN = max(max(t1.x, t1.y), t1.z);\n    float tF = min(min(t2.x, t2.y), t2.z);\n    if(tN>tF || tF<0.0) return 1.0;\n    return tN;\n}vec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o419741_gradient_0_pos = 0.000000000;\nconst float p_o419741_gradient_0_r = 1.000000000;\nconst float p_o419741_gradient_0_g = 0.000000000;\nconst float p_o419741_gradient_0_b = 0.000000000;\nconst float p_o419741_gradient_0_a = 1.000000000;\nconst float p_o419741_gradient_1_pos = 0.436363186;\nconst float p_o419741_gradient_1_r = 1.000000000;\nconst float p_o419741_gradient_1_g = 0.968750000;\nconst float p_o419741_gradient_1_b = 0.000000000;\nconst float p_o419741_gradient_1_a = 1.000000000;\nconst float p_o419741_gradient_2_pos = 0.527273005;\nconst float p_o419741_gradient_2_r = 0.000000000;\nconst float p_o419741_gradient_2_g = 1.000000000;\nconst float p_o419741_gradient_2_b = 0.125000000;\nconst float p_o419741_gradient_2_a = 1.000000000;\nconst float p_o419741_gradient_3_pos = 0.627272727;\nconst float p_o419741_gradient_3_r = 0.843750000;\nconst float p_o419741_gradient_3_g = 0.000000000;\nconst float p_o419741_gradient_3_b = 1.000000000;\nconst float p_o419741_gradient_3_a = 1.000000000;\nconst float p_o419741_gradient_4_pos = 1.000000000;\nconst float p_o419741_gradient_4_r = 0.000000000;\nconst float p_o419741_gradient_4_g = 0.062500000;\nconst float p_o419741_gradient_4_b = 1.000000000;\nconst float p_o419741_gradient_4_a = 1.000000000;\nvec4 o419741_gradient_gradient_fct(float x) {\n  if (x < p_o419741_gradient_0_pos) {\n    return vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a);\n  } else if (x < p_o419741_gradient_1_pos) {\n    return mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), 1.0-0.5*(x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos));\n  } else if (x < p_o419741_gradient_2_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)) + mix(mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos))));\n  } else if (x < p_o419741_gradient_3_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)) + mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos))));\n  } else if (x < p_o419741_gradient_4_pos) {\n    return mix(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5+0.5*(x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos));\n  }\n  return vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a);\n}\nconst float p_o398645_amount = 11.490000000;\nconst float p_o254341_r = 0.500000000;\nvec2 o256395_input_sdf(vec3 p, float _seed_variation_) {\nvec2 o254341_0_q = vec2(length((p).xy)-(sin(iTime*0.2)),(p).z);\nfloat o254341_0_1_sdf3d = length(o254341_0_q)-p_o254341_r;\n\nreturn vec2(o254341_0_1_sdf3d, 0.0);\n}\nvec2 raymarch_o256395(vec2 uv, float _seed_variation_) {\n\tvec3 ro = vec3(uv-vec2(0.5), 1.0);\n\tvec3 rd = vec3(0.0, 0.0, -1.0);\n\tfloat dO = 0.0;\n\tfloat c = 0.0;\n    for (int i=0; i < 100; i++) {\n    \tvec3 p = ro + rd*dO;\n        vec2 dS = o256395_input_sdf(p, _seed_variation_);\n        dO += dS.x;\n\n        if (dO >= 1.0) {\n\t\t\tbreak;\n\t\t} else if (dS.x < 0.0001) {\n\t\t\tc = dS.y;\n\t\t\tbreak;\n\t\t}\n    }\n    \n    return vec2(dO, c);\n}\n\nvec3 normal_o256395(vec3 p, float _seed_variation_) {\n\tif (p.z <= 0.0) {\n\t\treturn vec3(0.0, 0.0, 1.0);\n\t}\n\n\tfloat d = o256395_input_sdf(p, _seed_variation_).x;\n    float e = .001;\n    \n    vec3 n = d - vec3(\n        o256395_input_sdf(p-vec3(e, 0.0, 0.0), _seed_variation_).x,\n        o256395_input_sdf(p-vec3(0.0, e, 0.0), _seed_variation_).x,\n        o256395_input_sdf(p-vec3(0.0, 0.0, e), _seed_variation_).x);\n    \n    return vec3(-1.0, -1.0, -1.0)*normalize(n);\n}\n\nconst float p_o207924_d = 0.270000000;\nconst float p_o57201_cx = 0.500000000;\nconst float p_o57201_cy = 0.500000000;\nconst float p_o479214_gradient_0_pos = 0.236363636;\nconst float p_o479214_gradient_0_r = 0.000000000;\nconst float p_o479214_gradient_0_g = 0.062500000;\nconst float p_o479214_gradient_0_b = 1.000000000;\nconst float p_o479214_gradient_0_a = 1.000000000;\nconst float p_o479214_gradient_1_pos = 0.590909368;\nconst float p_o479214_gradient_1_r = 0.000000000;\nconst float p_o479214_gradient_1_g = 1.000000000;\nconst float p_o479214_gradient_1_b = 0.125000000;\nconst float p_o479214_gradient_1_a = 1.000000000;\nconst float p_o479214_gradient_2_pos = 0.800000000;\nconst float p_o479214_gradient_2_r = 1.000000000;\nconst float p_o479214_gradient_2_g = 0.000000000;\nconst float p_o479214_gradient_2_b = 0.000000000;\nconst float p_o479214_gradient_2_a = 1.000000000;\nconst float p_o479214_gradient_3_pos = 0.836363636;\nconst float p_o479214_gradient_3_r = 0.843750000;\nconst float p_o479214_gradient_3_g = 0.000000000;\nconst float p_o479214_gradient_3_b = 1.000000000;\nconst float p_o479214_gradient_3_a = 1.000000000;\nconst float p_o479214_gradient_4_pos = 1.000000000;\nconst float p_o479214_gradient_4_r = 1.000000000;\nconst float p_o479214_gradient_4_g = 0.968750000;\nconst float p_o479214_gradient_4_b = 0.000000000;\nconst float p_o479214_gradient_4_a = 1.000000000;\nvec4 o479214_gradient_gradient_fct(float x) {\n  if (x < p_o479214_gradient_0_pos) {\n    return vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a);\n  } else if (x < p_o479214_gradient_1_pos) {\n    return mix(vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a), vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_0_pos)/(p_o479214_gradient_1_pos-p_o479214_gradient_0_pos)));\n  } else if (x < p_o479214_gradient_2_pos) {\n    return mix(vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_1_pos)/(p_o479214_gradient_2_pos-p_o479214_gradient_1_pos)));\n  } else if (x < p_o479214_gradient_3_pos) {\n    return mix(vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_2_pos)/(p_o479214_gradient_3_pos-p_o479214_gradient_2_pos)));\n  } else if (x < p_o479214_gradient_4_pos) {\n    return mix(vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a), vec4(p_o479214_gradient_4_r,p_o479214_gradient_4_g,p_o479214_gradient_4_b,p_o479214_gradient_4_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_3_pos)/(p_o479214_gradient_4_pos-p_o479214_gradient_3_pos)));\n  }\n  return vec4(p_o479214_gradient_4_r,p_o479214_gradient_4_g,p_o479214_gradient_4_b,p_o479214_gradient_4_a);\n}\nconst float p_o520101_radius = 0.480000000;\nconst float p_o520101_repeat = 6.000000000;\nconst float p_o270325_cx = 0.500000000;\nconst float p_o270325_cy = 0.500000000;\nconst float p_o270325_cz = 0.500000000;\nconst float p_o270325_sx = 0.250000000;\nconst float p_o270325_sy = 0.250000000;\nconst float p_o270325_sz = 0.250000000;\nconst float p_o270325_rx = 0.000000000;\nconst float p_o270325_ry = 0.000000000;\nconst float p_o270325_rz = 0.000000000;\nconst float p_o457554_repeat = 1.000000000;\nconst float p_o457554_gradient_0_pos = 0.000000000;\nconst float p_o457554_gradient_0_r = 0.000000000;\nconst float p_o457554_gradient_0_g = 0.000000000;\nconst float p_o457554_gradient_0_b = 0.000000000;\nconst float p_o457554_gradient_0_a = 1.000000000;\nconst float p_o457554_gradient_1_pos = 0.178294574;\nconst float p_o457554_gradient_1_r = 1.000000000;\nconst float p_o457554_gradient_1_g = 1.000000000;\nconst float p_o457554_gradient_1_b = 1.000000000;\nconst float p_o457554_gradient_1_a = 1.000000000;\nvec4 o457554_gradient_gradient_fct(float x) {\n  if (x < p_o457554_gradient_0_pos) {\n    return vec4(p_o457554_gradient_0_r,p_o457554_gradient_0_g,p_o457554_gradient_0_b,p_o457554_gradient_0_a);\n  } else if (x < p_o457554_gradient_1_pos) {\n    return mix(vec4(p_o457554_gradient_0_r,p_o457554_gradient_0_g,p_o457554_gradient_0_b,p_o457554_gradient_0_a), vec4(p_o457554_gradient_1_r,p_o457554_gradient_1_g,p_o457554_gradient_1_b,p_o457554_gradient_1_a), ((x-p_o457554_gradient_0_pos)/(p_o457554_gradient_1_pos-p_o457554_gradient_0_pos)));\n  }\n  return vec4(p_o457554_gradient_1_r,p_o457554_gradient_1_g,p_o457554_gradient_1_b,p_o457554_gradient_1_a);\n}\n\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nvec2 o256395_0_d = raymarch_o256395((UV), _seed_variation_);\nvec3 o256395_1_1_rgb = vec3(0.5)+0.5*normal_o256395(vec3((UV)-vec2(0.5), 1.0-o256395_0_d.x), _seed_variation_);\nfloat o57201_0_1_f = sphere(((vec4(o256395_1_1_rgb, 0.0)).xy+vec2(0.5)), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.9)*sin(iTime*0.9)));\nvec3 o241986_0_1_tex3d = vec3(o57201_0_1_f);\nvec2 o254341_0_q = vec2(length(((vec4(o256395_1_1_rgb, 0.0)).xyz).xy)-(sin(iTime*0.2)),((vec4(o256395_1_1_rgb, 0.0)).xyz).z);\nfloat o254341_0_1_sdf3d = length(o254341_0_q)-p_o254341_r;\nvec3 o207924_0_1_tex3d = mix(o241986_0_1_tex3d, vec3(0.5), clamp(o254341_0_1_sdf3d/max(p_o207924_d, 0.0001), 0.0, 1.0));\nvec3 o245261_0_1_rgb = o207924_0_1_tex3d;\nfloat o270325_0_1_f = 1.0-box((vec2(fract(p_o520101_repeat*atan((UV).y-0.5, (UV).x-0.5)*0.15915494309), min(0.99999, 2.0/p_o520101_radius*length((UV)-vec2(0.5))))), vec3(p_o270325_cx, p_o270325_cy, p_o270325_cz), vec3(p_o270325_sx, p_o270325_sy, p_o270325_sz), 0.01745329251*vec3(p_o270325_rx, p_o270325_ry, p_o270325_rz));\nvec4 o520101_0_1_rgba = vec4(vec3(o270325_0_1_f), 1.0);\nvec4 o479214_0_1_rgba = o479214_gradient_gradient_fct((dot((o520101_0_1_rgba).rgb, vec3(1.0))/3.0));\nvec4 o457554_0_1_rgba = o457554_gradient_gradient_fct(fract(p_o457554_repeat*1.41421356237*length(fract((UV))-vec2(0.5, 0.5))));\nvec4 o398645_0_s1 = vec4(o245261_0_1_rgb, 1.0);\nvec4 o398645_0_s2 = o479214_0_1_rgba;\nfloat o398645_0_a = p_o398645_amount*(dot((o457554_0_1_rgba).rgb, vec3(1.0))/3.0);\nvec4 o398645_0_1_rgba = vec4(blend_soft_light((UV), o398645_0_s1.rgb, o398645_0_s2.rgb, o398645_0_a*o398645_0_s1.a), min(1.0, o398645_0_s2.a+o398645_0_a*o398645_0_s1.a));\nvec4 o419741_0_1_rgba = o419741_gradient_gradient_fct((dot((o398645_0_1_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o419741_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"81",objOut:"80"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"81",objOut:"80"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"81",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"88",objOut:"81"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"84",objOut:"81"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"82",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:2.14},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"80",objOut:"82"},{portIn:"time",portOut:"Time",objIn:"89",objOut:"82"}]}]},{objName:"Ops.Sequence",id:"83",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"80",objOut:"83"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",links:[{portIn:"Render",portOut:"trigger 15",objIn:"97",objOut:"83"}]}]},{objName:"Ops.Ui.VizTexture",id:"84",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"86",objOut:"84"}]}]},{objName:"Ops.Gl.Render2Texture",id:"85",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"86",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"89",objOut:"86"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"87",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:true},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"clamp to edge"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"86",objOut:"87"},{portIn:"exe",portOut:"Next",objIn:"83",objOut:"87"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"66",objOut:"87"}]},{name:"Aspect Ratio",value:2}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"88",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"89",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:57.62},{name:"RepeatY",value:11},{name:"Multiply",value:.01},{name:"Mask",value:0}],portsOut:[{name:"Trigger",value:0}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"90",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat box(vec2 uv, vec3 center, vec3 rad, vec3 rot) {\n\tvec3 ro = vec3(uv, 1.0)-center;\n\tvec3 rd = vec3(0.0000001, 0.0000001, -1.0);\n\tmat3 r = mat3(vec3(1, 0, 0), vec3(0, cos(rot.x), -sin(rot.x)), vec3(0, sin(rot.x), cos(rot.x)));\n\tr *= mat3(vec3(cos(rot.y), 0, -sin(rot.y)), vec3(0, 1, 0), vec3(sin(rot.y), 0, cos(rot.y)));\n\tr *= mat3(vec3(cos(rot.z), -sin(rot.z), 0), vec3(sin(rot.z), cos(rot.z), 0), vec3(0, 0, 1));\n\tro = r * ro;\n\trd = r * rd;\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*rad;\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\n    float tN = max(max(t1.x, t1.y), t1.z);\n    float tF = min(min(t2.x, t2.y), t2.z);\n    if(tN>tF || tF<0.0) return 1.0;\n    return tN;\n}float sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nvec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o419741_gradient_0_pos = 0.000000000;\nconst float p_o419741_gradient_0_r = 1.000000000;\nconst float p_o419741_gradient_0_g = 0.000000000;\nconst float p_o419741_gradient_0_b = 0.000000000;\nconst float p_o419741_gradient_0_a = 1.000000000;\nconst float p_o419741_gradient_1_pos = 0.144273793;\nconst float p_o419741_gradient_1_r = 1.000000000;\nconst float p_o419741_gradient_1_g = 0.968750000;\nconst float p_o419741_gradient_1_b = 0.000000000;\nconst float p_o419741_gradient_1_a = 1.000000000;\nconst float p_o419741_gradient_2_pos = 0.274273404;\nconst float p_o419741_gradient_2_r = 1.000000000;\nconst float p_o419741_gradient_2_g = 0.000000000;\nconst float p_o419741_gradient_2_b = 0.000000000;\nconst float p_o419741_gradient_2_a = 1.000000000;\nconst float p_o419741_gradient_3_pos = 0.414273349;\nconst float p_o419741_gradient_3_r = 0.843750000;\nconst float p_o419741_gradient_3_g = 0.000000000;\nconst float p_o419741_gradient_3_b = 1.000000000;\nconst float p_o419741_gradient_3_a = 1.000000000;\nconst float p_o419741_gradient_4_pos = 0.854273571;\nconst float p_o419741_gradient_4_r = 0.000000000;\nconst float p_o419741_gradient_4_g = 0.062500000;\nconst float p_o419741_gradient_4_b = 1.000000000;\nconst float p_o419741_gradient_4_a = 1.000000000;\nvec4 o419741_gradient_gradient_fct(float x) {\n  if (x < p_o419741_gradient_0_pos) {\n    return vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a);\n  } else if (x < p_o419741_gradient_1_pos) {\n    return mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), 1.0-0.5*(x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos));\n  } else if (x < p_o419741_gradient_2_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)) + mix(mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos))));\n  } else if (x < p_o419741_gradient_3_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)) + mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos))));\n  } else if (x < p_o419741_gradient_4_pos) {\n    return mix(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5+0.5*(x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos));\n  }\n  return vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a);\n}\nconst float p_o398645_amount = 2.200000000;\nconst float p_o479214_gradient_0_pos = 0.025183105;\nconst float p_o479214_gradient_0_r = 1.000000000;\nconst float p_o479214_gradient_0_g = 0.000000000;\nconst float p_o479214_gradient_0_b = 0.000000000;\nconst float p_o479214_gradient_0_a = 1.000000000;\nconst float p_o479214_gradient_1_pos = 0.435182884;\nconst float p_o479214_gradient_1_r = 1.000000000;\nconst float p_o479214_gradient_1_g = 0.968750000;\nconst float p_o479214_gradient_1_b = 0.000000000;\nconst float p_o479214_gradient_1_a = 1.000000000;\nconst float p_o479214_gradient_2_pos = 0.590909368;\nconst float p_o479214_gradient_2_r = 0.000000000;\nconst float p_o479214_gradient_2_g = 1.000000000;\nconst float p_o479214_gradient_2_b = 0.125000000;\nconst float p_o479214_gradient_2_a = 1.000000000;\nconst float p_o479214_gradient_3_pos = 0.915182218;\nconst float p_o479214_gradient_3_r = 0.000000000;\nconst float p_o479214_gradient_3_g = 0.062500000;\nconst float p_o479214_gradient_3_b = 1.000000000;\nconst float p_o479214_gradient_3_a = 1.000000000;\nvec4 o479214_gradient_gradient_fct(float x) {\n  if (x < p_o479214_gradient_0_pos) {\n    return vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a);\n  } else if (x < p_o479214_gradient_1_pos) {\n    return mix(vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a), vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_0_pos)/(p_o479214_gradient_1_pos-p_o479214_gradient_0_pos)));\n  } else if (x < p_o479214_gradient_2_pos) {\n    return mix(vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_1_pos)/(p_o479214_gradient_2_pos-p_o479214_gradient_1_pos)));\n  } else if (x < p_o479214_gradient_3_pos) {\n    return mix(vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_2_pos)/(p_o479214_gradient_3_pos-p_o479214_gradient_2_pos)));\n  }\n  return vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a);\n}\nconst float p_o520101_repeat = 6.000000000;\nconst float p_o270325_cx = 0.500000000;\nconst float p_o270325_cy = 0.500000000;\nconst float p_o270325_cz = 0.500000000;\nconst float p_o270325_sx = 0.250000000;\nconst float p_o270325_sy = 0.250000000;\nconst float p_o270325_sz = 0.250000000;\nconst float p_o270325_ry = 2.000000000;\nconst float p_o207924_d = 0.710000000;\nconst float p_o553530_radius = 0.320000000;\nconst float p_o553530_repeat = 5.000000000;\nconst float p_o57201_cx = 0.500000000;\nconst float p_o57201_cy = 0.710000000;\nconst float p_o254341_r = 0.500000000;\n\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nfloat o270325_0_1_f = 1.0-box((vec2(fract(p_o520101_repeat*atan((UV).y-0.5, (UV).x-0.5)*0.15915494309), min(0.99999, 2.0/(cos(iTime*0.001))*length((UV)-vec2(0.5))))), vec3(p_o270325_cx, p_o270325_cy, p_o270325_cz), vec3(p_o270325_sx, p_o270325_sy, p_o270325_sz), 0.01745329251*vec3((sin(iTime*0.9)*sin(iTime*0.9)), p_o270325_ry, (sin(iTime*0.9)*sin(iTime*0.9)*abs(iTime))));\nvec4 o520101_0_1_rgba = vec4(vec3(o270325_0_1_f), 1.0);\nvec4 o479214_0_1_rgba = o479214_gradient_gradient_fct((dot((o520101_0_1_rgba).rgb, vec3(1.0))/3.0));\nfloat o57201_0_1_f = sphere((vec2(fract(p_o553530_repeat*atan(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5)).y-0.5, ((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5)).x-0.5)*0.15915494309), min(0.99999, 2.0/p_o553530_radius*length(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5))-vec2(0.5))))), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.2)*sin(iTime*0.9)));\nvec4 o553530_0_1_rgba = vec4(vec3(o57201_0_1_f), 1.0);\nvec3 o241986_0_1_tex3d = ((o553530_0_1_rgba).rgb);\nvec2 o254341_0_q = vec2(length(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xyz).xy)-(sin(iTime*0.2)),((vec4(((o479214_0_1_rgba).rgb), 0.0)).xyz).z);\nfloat o254341_0_1_sdf3d = length(o254341_0_q)-p_o254341_r;\nvec3 o207924_0_1_tex3d = mix(o241986_0_1_tex3d, vec3(0.5), clamp(o254341_0_1_sdf3d/max(p_o207924_d, 0.0001), 0.0, 1.0));\nvec3 o245261_0_1_rgb = o207924_0_1_tex3d;\nvec3 o241986_0_3_tex3d = ((o553530_0_1_rgba).rgb);\nvec3 o818931_0_1_rgb = o241986_0_3_tex3d;\nfloat o57201_0_3_f = sphere((vec2(fract(p_o553530_repeat*atan((UV).y-0.5, (UV).x-0.5)*0.15915494309), min(0.99999, 2.0/p_o553530_radius*length((UV)-vec2(0.5))))), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.2)*sin(iTime*0.9)));\nvec4 o553530_0_3_rgba = vec4(vec3(o57201_0_3_f), 1.0);\nvec4 o398645_0_s1 = vec4(o245261_0_1_rgb, 1.0);\nvec4 o398645_0_s2 = vec4(o818931_0_1_rgb, 1.0);\nfloat o398645_0_a = p_o398645_amount*(dot((o553530_0_3_rgba).rgb, vec3(1.0))/3.0);\nvec4 o398645_0_1_rgba = vec4(blend_hard_light((UV), o398645_0_s1.rgb, o398645_0_s2.rgb, o398645_0_a*o398645_0_s1.a), min(1.0, o398645_0_s2.a+o398645_0_a*o398645_0_s1.a));\nvec4 o419741_0_1_rgba = o419741_gradient_gradient_fct((dot((o398645_0_1_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o419741_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"91",objOut:"90"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"91",objOut:"90"}]},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.Shader.Shader2Texture",id:"91",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Shader"},{name:"Use Viewport Size",value:true},{name:"Width",value:640},{name:"Height",value:320},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"wrap index",value:0},{name:"wrap",value:"mirrored repeat"},{name:"Floating Point",value:true},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"98",objOut:"91"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"94",objOut:"91"}]},{name:"Texture 2"},{name:"Texture 3"},{name:"Texture 4"}]},{objName:"Ops.Anim.Timer_v2",id:"92",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.91},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"iTime",portOut:"Time",objIn:"90",objOut:"92"},{portIn:"time",portOut:"Time",objIn:"99",objOut:"92"}]}]},{objName:"Ops.Sequence",id:"93",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"90",objOut:"93"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Ui.VizTexture",id:"94",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Image",portOut:"Texture Out",objIn:"96",objOut:"94"}]}]},{objName:"Ops.Gl.Render2Texture",id:"95",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",value:0},{name:"texture"},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"96",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"105",objOut:"96"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"97",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:true},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"clamp to edge"},{name:"HDR",value:false},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"96",objOut:"97"},{portIn:"exe",portOut:"Next",objIn:"93",objOut:"97"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"64",objOut:"97"}]},{name:"Aspect Ratio",value:2}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"98",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry"}]},{objName:"Ops.Gl.TextureEffects.Wobble",id:"99",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"time"},{name:"SpeedX",value:4},{name:"SpeedY",value:8},{name:"RepeatX",value:10.94},{name:"RepeatY",value:7.17},{name:"Multiply",value:.08},{name:"Mask",value:0}],portsOut:[{name:"Trigger",value:0}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"100",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:55},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"101",objOut:"100"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"101",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:5}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"101"}]}]},{objName:"Ops.Devices.Keyboard.KeyPressLearn",id:"102",uiAttribs:{subPatch:0},portsIn:[{name:"key code",value:56},{name:"canvas only",value:true},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:true},{name:"Prevent Default",value:false},{name:"learn",value:0}],portsOut:[{name:"on press",links:[{portIn:"Set",portOut:"on press",objIn:"103",objOut:"102"}]},{name:"on release",value:0},{name:"Pressed",value:false}]},{objName:"Ops.Trigger.SetNumberOnTrigger",id:"103",uiAttribs:{subPatch:0},portsIn:[{name:"Set"},{name:"Number",value:6}],portsOut:[{name:"Next",value:0},{name:"Out Value",links:[{portIn:"value",portOut:"Out Value",objIn:"47",objOut:"103"}]}]},{objName:"Ops.Gl.GradientTexture",id:"104",uiAttribs:{subPatch:0},portsIn:[{name:"Gradient",value:'{"keys":[{"pos":0,"r":8.881784197001252e-16,"g":0,"b":1},{"pos":0.25,"r":8.881784197001252e-16,"g":0,"b":1},{"pos":0.75,"r":1,"g":0,"b":0},{"pos":1,"r":1,"g":0,"b":0}]}'},{name:"Direction index",value:0},{name:"Direction",value:"X"},{name:"Smoothstep",value:false},{name:"Step",value:false},{name:"Flip",value:false},{name:"Size",value:256},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Gradient Array",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Gradient",portOut:"Texture",objIn:"105",objOut:"104"}]}]},{objName:"Ops.Gl.TextureEffects.ColorMap",id:"105",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Gradient"},{name:"Method index",value:0},{name:"Method",value:"Luminance"},{name:"Min",value:0},{name:"Max",value:1},{name:"Position",value:.5}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"99",objOut:"105"}]}]},{objName:"Ops.Gl.Shader.CustomShader_v2",id:"106",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:0},{name:"Fragment Code",value:"UNI sampler2D iChannel0;\nUNI vec3 iResolution;\nUNI float iTime;\n\n/* Generated by Material Maker */\n\n#define SEED_VARIATION 0.0\n\n//---\n\nfloat rand(vec2 x) {\n    return fract(cos(mod(dot(x, vec2(13.9898, 8.141)), 3.14)) * 43758.5453);\n}\n\nvec2 rand2(vec2 x) {\n    return fract(cos(mod(vec2(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t      dot(x, vec2(3.4562, 17.398))), vec2(3.14))) * 43758.5453);\n}\n\nvec3 rand3(vec2 x) {\n    return fract(cos(mod(vec3(dot(x, vec2(13.9898, 8.141)),\n\t\t\t\t\t\t\t  dot(x, vec2(3.4562, 17.398)),\n                              dot(x, vec2(13.254, 5.867))), vec3(3.14))) * 43758.5453);\n}\n\nvec3 rgb2hsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat param_rnd(float minimum, float maximum, float seed) {\n\treturn minimum+(maximum-minimum)*rand(vec2(seed));\n}\nfloat box(vec2 uv, vec3 center, vec3 rad, vec3 rot) {\n\tvec3 ro = vec3(uv, 1.0)-center;\n\tvec3 rd = vec3(0.0000001, 0.0000001, -1.0);\n\tmat3 r = mat3(vec3(1, 0, 0), vec3(0, cos(rot.x), -sin(rot.x)), vec3(0, sin(rot.x), cos(rot.x)));\n\tr *= mat3(vec3(cos(rot.y), 0, -sin(rot.y)), vec3(0, 1, 0), vec3(sin(rot.y), 0, cos(rot.y)));\n\tr *= mat3(vec3(cos(rot.z), -sin(rot.z), 0), vec3(sin(rot.z), cos(rot.z), 0), vec3(0, 0, 1));\n\tro = r * ro;\n\trd = r * rd;\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*rad;\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\n    float tN = max(max(t1.x, t1.y), t1.z);\n    float tF = min(min(t2.x, t2.y), t2.z);\n    if(tN>tF || tF<0.0) return 1.0;\n    return tN;\n}float sphere(vec2 uv, vec2 c, float r) {\n\tuv -= c;\n\tuv /= r;\n\treturn 2.0*r*sqrt(max(0.0, 1.0-dot(uv, uv)));\n}\nvec3 blend_normal(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1 + (1.0-opacity)*c2;\n}\n\nvec3 blend_dissolve(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\tif (rand(uv) < opacity) {\n\t\treturn c1;\n\t} else {\n\t\treturn c2;\n\t}\n}\n\nvec3 blend_multiply(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*c1*c2 + (1.0-opacity)*c2;\n}\n\nvec3 blend_screen(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*(1.0-(1.0-c1)*(1.0-c2)) + (1.0-opacity)*c2;\n}\n\nfloat blend_overlay_f(float c1, float c2) {\n\treturn (c1 < 0.5) ? (2.0*c1*c2) : (1.0-2.0*(1.0-c1)*(1.0-c2));\n}\n\nvec3 blend_overlay(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_overlay_f(c1.x, c2.x), blend_overlay_f(c1.y, c2.y), blend_overlay_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_hard_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*0.5*(c1*c2+blend_overlay(uv, c1, c2, 1.0)) + (1.0-opacity)*c2;\n}\n\nfloat blend_soft_light_f(float c1, float c2) {\n\treturn (c2 < 0.5) ? (2.0*c1*c2+c1*c1*(1.0-2.0*c2)) : 2.0*c1*(1.0-c2)+sqrt(c1)*(2.0*c2-1.0);\n}\n\nvec3 blend_soft_light(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_soft_light_f(c1.x, c2.x), blend_soft_light_f(c1.y, c2.y), blend_soft_light_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_burn_f(float c1, float c2) {\n\treturn (c1==0.0)?c1:max((1.0-((1.0-c2)/c1)),0.0);\n}\n\nvec3 blend_burn(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_burn_f(c1.x, c2.x), blend_burn_f(c1.y, c2.y), blend_burn_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nfloat blend_dodge_f(float c1, float c2) {\n\treturn (c1==1.0)?c1:min(c2/(1.0-c1),1.0);\n}\n\nvec3 blend_dodge(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*vec3(blend_dodge_f(c1.x, c2.x), blend_dodge_f(c1.y, c2.y), blend_dodge_f(c1.z, c2.z)) + (1.0-opacity)*c2;\n}\n\nvec3 blend_lighten(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*max(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_darken(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*min(c1, c2) + (1.0-opacity)*c2;\n}\n\nvec3 blend_difference(vec2 uv, vec3 c1, vec3 c2, float opacity) {\n\treturn opacity*clamp(c2-c1, vec3(0.0), vec3(1.0)) + (1.0-opacity)*c2;\n}\nconst float p_o419741_gradient_0_pos = 0.000000000;\nconst float p_o419741_gradient_0_r = 1.000000000;\nconst float p_o419741_gradient_0_g = 0.000000000;\nconst float p_o419741_gradient_0_b = 0.000000000;\nconst float p_o419741_gradient_0_a = 1.000000000;\nconst float p_o419741_gradient_1_pos = 0.144273793;\nconst float p_o419741_gradient_1_r = 1.000000000;\nconst float p_o419741_gradient_1_g = 0.968750000;\nconst float p_o419741_gradient_1_b = 0.000000000;\nconst float p_o419741_gradient_1_a = 1.000000000;\nconst float p_o419741_gradient_2_pos = 0.274273404;\nconst float p_o419741_gradient_2_r = 1.000000000;\nconst float p_o419741_gradient_2_g = 0.000000000;\nconst float p_o419741_gradient_2_b = 0.000000000;\nconst float p_o419741_gradient_2_a = 1.000000000;\nconst float p_o419741_gradient_3_pos = 0.414273349;\nconst float p_o419741_gradient_3_r = 0.843750000;\nconst float p_o419741_gradient_3_g = 0.000000000;\nconst float p_o419741_gradient_3_b = 1.000000000;\nconst float p_o419741_gradient_3_a = 1.000000000;\nconst float p_o419741_gradient_4_pos = 0.854273571;\nconst float p_o419741_gradient_4_r = 0.000000000;\nconst float p_o419741_gradient_4_g = 0.062500000;\nconst float p_o419741_gradient_4_b = 1.000000000;\nconst float p_o419741_gradient_4_a = 1.000000000;\nvec4 o419741_gradient_gradient_fct(float x) {\n  if (x < p_o419741_gradient_0_pos) {\n    return vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a);\n  } else if (x < p_o419741_gradient_1_pos) {\n    return mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), 1.0-0.5*(x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos));\n  } else if (x < p_o419741_gradient_2_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)) + mix(mix(vec4(p_o419741_gradient_0_r,p_o419741_gradient_0_g,p_o419741_gradient_0_b,p_o419741_gradient_0_a), vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), (x-p_o419741_gradient_0_pos)/(p_o419741_gradient_1_pos-p_o419741_gradient_0_pos)), mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos))));\n  } else if (x < p_o419741_gradient_3_pos) {\n    return 0.5*(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)) + mix(mix(vec4(p_o419741_gradient_1_r,p_o419741_gradient_1_g,p_o419741_gradient_1_b,p_o419741_gradient_1_a), vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), (x-p_o419741_gradient_1_pos)/(p_o419741_gradient_2_pos-p_o419741_gradient_1_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5-0.5*cos(3.14159265359*(x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos))));\n  } else if (x < p_o419741_gradient_4_pos) {\n    return mix(mix(vec4(p_o419741_gradient_2_r,p_o419741_gradient_2_g,p_o419741_gradient_2_b,p_o419741_gradient_2_a), vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), (x-p_o419741_gradient_2_pos)/(p_o419741_gradient_3_pos-p_o419741_gradient_2_pos)), mix(vec4(p_o419741_gradient_3_r,p_o419741_gradient_3_g,p_o419741_gradient_3_b,p_o419741_gradient_3_a), vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a), (x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos)), 0.5+0.5*(x-p_o419741_gradient_3_pos)/(p_o419741_gradient_4_pos-p_o419741_gradient_3_pos));\n  }\n  return vec4(p_o419741_gradient_4_r,p_o419741_gradient_4_g,p_o419741_gradient_4_b,p_o419741_gradient_4_a);\n}\nconst float p_o398645_amount = 11.760000000;\nconst float p_o479214_gradient_0_pos = 0.025183105;\nconst float p_o479214_gradient_0_r = 1.000000000;\nconst float p_o479214_gradient_0_g = 0.000000000;\nconst float p_o479214_gradient_0_b = 0.000000000;\nconst float p_o479214_gradient_0_a = 1.000000000;\nconst float p_o479214_gradient_1_pos = 0.435182884;\nconst float p_o479214_gradient_1_r = 1.000000000;\nconst float p_o479214_gradient_1_g = 0.968750000;\nconst float p_o479214_gradient_1_b = 0.000000000;\nconst float p_o479214_gradient_1_a = 1.000000000;\nconst float p_o479214_gradient_2_pos = 0.590909368;\nconst float p_o479214_gradient_2_r = 0.000000000;\nconst float p_o479214_gradient_2_g = 1.000000000;\nconst float p_o479214_gradient_2_b = 0.125000000;\nconst float p_o479214_gradient_2_a = 1.000000000;\nconst float p_o479214_gradient_3_pos = 0.915182218;\nconst float p_o479214_gradient_3_r = 0.000000000;\nconst float p_o479214_gradient_3_g = 0.062500000;\nconst float p_o479214_gradient_3_b = 1.000000000;\nconst float p_o479214_gradient_3_a = 1.000000000;\nvec4 o479214_gradient_gradient_fct(float x) {\n  if (x < p_o479214_gradient_0_pos) {\n    return vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a);\n  } else if (x < p_o479214_gradient_1_pos) {\n    return mix(vec4(p_o479214_gradient_0_r,p_o479214_gradient_0_g,p_o479214_gradient_0_b,p_o479214_gradient_0_a), vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_0_pos)/(p_o479214_gradient_1_pos-p_o479214_gradient_0_pos)));\n  } else if (x < p_o479214_gradient_2_pos) {\n    return mix(vec4(p_o479214_gradient_1_r,p_o479214_gradient_1_g,p_o479214_gradient_1_b,p_o479214_gradient_1_a), vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_1_pos)/(p_o479214_gradient_2_pos-p_o479214_gradient_1_pos)));\n  } else if (x < p_o479214_gradient_3_pos) {\n    return mix(vec4(p_o479214_gradient_2_r,p_o479214_gradient_2_g,p_o479214_gradient_2_b,p_o479214_gradient_2_a), vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a), 0.5-0.5*cos(3.14159265359*(x-p_o479214_gradient_2_pos)/(p_o479214_gradient_3_pos-p_o479214_gradient_2_pos)));\n  }\n  return vec4(p_o479214_gradient_3_r,p_o479214_gradient_3_g,p_o479214_gradient_3_b,p_o479214_gradient_3_a);\n}\nconst float p_o520101_repeat = 6.000000000;\nconst float p_o270325_cx = 0.500000000;\nconst float p_o270325_cy = 0.500000000;\nconst float p_o270325_cz = 0.500000000;\nconst float p_o270325_sx = 0.250000000;\nconst float p_o270325_sy = 0.250000000;\nconst float p_o270325_sz = 0.250000000;\nconst float p_o270325_ry = 2.000000000;\nconst float p_o207924_d = 0.710000000;\nconst float p_o553530_radius = 0.320000000;\nconst float p_o553530_repeat = 5.000000000;\nconst float p_o57201_cx = 0.500000000;\nconst float p_o57201_cy = 0.710000000;\nconst float p_o254341_r = 0.500000000;\n\n\n\n\nIN vec2 texCoord;\n{{MODULES_HEAD}}\nvoid main()\n{\nfloat minSize = min(iResolution.x, iResolution.y);\nfloat _seed_variation_ = SEED_VARIATION;\nvec2 UV = vec2(0.0, 1.0) + vec2(1.0, -1.0) * (texCoord-0.5*(iResolution.xy-vec2(minSize)))/minSize;\nfloat o270325_0_1_f = 1.0-box((vec2(fract(p_o520101_repeat*atan((UV).y-0.5, (UV).x-0.5)*0.15915494309), min(0.99999, 2.0/(cos(iTime*0.001))*length((UV)-vec2(0.5))))), vec3(p_o270325_cx, p_o270325_cy, p_o270325_cz), vec3(p_o270325_sx, p_o270325_sy, p_o270325_sz), 0.01745329251*vec3((sin(iTime*0.9)*sin(iTime*0.9)), p_o270325_ry, (sin(iTime*0.9)*sin(iTime*0.9)*abs(iTime))));\nvec4 o520101_0_1_rgba = vec4(vec3(o270325_0_1_f), 1.0);\nvec4 o479214_0_1_rgba = o479214_gradient_gradient_fct((dot((o520101_0_1_rgba).rgb, vec3(1.0))/3.0));\nfloat o57201_0_1_f = sphere((vec2(fract(p_o553530_repeat*atan(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5)).y-0.5, ((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5)).x-0.5)*0.15915494309), min(0.99999, 2.0/p_o553530_radius*length(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xy+vec2(0.5))-vec2(0.5))))), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.2)*sin(iTime*0.9)));\nvec4 o553530_0_1_rgba = vec4(vec3(o57201_0_1_f), 1.0);\nvec3 o241986_0_1_tex3d = ((o553530_0_1_rgba).rgb);\nvec2 o254341_0_q = vec2(length(((vec4(((o479214_0_1_rgba).rgb), 0.0)).xyz).xy)-(sin(iTime*0.2)),((vec4(((o479214_0_1_rgba).rgb), 0.0)).xyz).z);\nfloat o254341_0_1_sdf3d = length(o254341_0_q)-p_o254341_r;\nvec3 o207924_0_1_tex3d = mix(o241986_0_1_tex3d, vec3(0.5), clamp(o254341_0_1_sdf3d/max(p_o207924_d, 0.0001), 0.0, 1.0));\nvec3 o245261_0_1_rgb = o207924_0_1_tex3d;\nvec3 o241986_0_3_tex3d = ((o553530_0_1_rgba).rgb);\nvec3 o818931_0_1_rgb = o241986_0_3_tex3d;\nfloat o57201_0_3_f = sphere((vec2(fract(p_o553530_repeat*atan((UV).y-0.5, (UV).x-0.5)*0.15915494309), min(0.99999, 2.0/p_o553530_radius*length((UV)-vec2(0.5))))), vec2(p_o57201_cx, p_o57201_cy), (sin(iTime*0.2)*sin(iTime*0.9)));\nvec4 o553530_0_3_rgba = vec4(vec3(o57201_0_3_f), 1.0);\nvec4 o398645_0_s1 = vec4(o245261_0_1_rgb, 1.0);\nvec4 o398645_0_s2 = vec4(o818931_0_1_rgb, 1.0);\nfloat o398645_0_a = p_o398645_amount*(dot((o553530_0_3_rgba).rgb, vec3(1.0))/3.0);\nvec4 o398645_0_1_rgba = vec4(blend_soft_light((UV), o398645_0_s1.rgb, o398645_0_s2.rgb, o398645_0_a*o398645_0_s1.a), min(1.0, o398645_0_s2.a+o398645_0_a*o398645_0_s1.a));\nvec4 o419741_0_1_rgba = o419741_gradient_gradient_fct((dot((o398645_0_1_rgba).rgb, vec3(1.0))/3.0));\ngl_FragColor = o419741_0_1_rgba;\n}\n\n"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:true},{name:"iChannel0"},{name:"iResolution X",value:1},{name:"iResolution Y",value:1},{name:"iResolution Z",value:1.29},{name:"iTime",value:0}],portsOut:[{name:"trigger",value:0},{name:"Shader"},{name:"Has Errors",value:false}]},{objName:"Ops.Gl.TextureEffects.RepeatTexture",id:"107",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"lighten"},{name:"Amount",value:1},{name:"x",value:6.42},{name:"y",value:7.26},{name:"Multiply",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.Shapes2d",id:"108",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Shape index",value:0},{name:"Shape",value:"rhombus"},{name:"Mirror X",value:false},{name:"Mirror Y",value:false},{name:"Offset X",value:0},{name:"Offset Y",value:0},{name:"fillShape",value:true},{name:"Line thickness",value:1},{name:"Invert color",value:false},{name:"width",value:.5},{name:"height",value:.5},{name:"Rotate",value:0},{name:"r",value:.279294982910802},{name:"g",value:.6630621886260724},{name:"b",value:.36875346969439804},{name:"a",value:1}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.PolarCoords",id:"109",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Radius Inner",value:.343},{name:"Radius Outer",value:.582},{name:"Crop",value:true}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"107",objOut:"109"}]}]},{objName:"Ops.Gl.TextureEffects.Mirror",id:"110",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"axis index",value:0},{name:"axis",value:"X"},{name:"width",value:.42},{name:"offset"},{name:"flip",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"111",objOut:"110"}]}]},{objName:"Ops.Gl.TextureEffects.Mirror",id:"111",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"axis index",value:0},{name:"axis",value:"Y"},{name:"width",value:-.87},{name:"offset",value:-.54},{name:"flip",value:false}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Anim.SineAnim",id:"112",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Mode index",value:0},{name:"Mode",value:"Sine"},{name:"phase",value:1.33},{name:"frequency",value:.36},{name:"amplitude",value:1.45}],portsOut:[{name:"Trigger out",value:0},{name:"result",links:[{portIn:"number",portOut:"result",objIn:"113",objOut:"112"}]}]},{objName:"Ops.Math.Abs",id:"113",uiAttribs:{subPatch:0},portsIn:[{name:"number"}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"114",objOut:"113"}]}]},{objName:"Ops.Math.Sine",id:"114",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"phase",value:.48},{name:"frequency",value:1},{name:"amplitude",value:-.85},{name:"asine",value:false}],portsOut:[{name:"result",links:[{portIn:"offset",portOut:"result",objIn:"110",objOut:"114"}]}]},{objName:"Ops.Anim.SineAnim",id:"115",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Mode index",value:0},{name:"Mode",value:"Sine"},{name:"phase",value:0},{name:"frequency",value:1},{name:"amplitude",value:1}],portsOut:[{name:"Trigger out",value:0},{name:"result",links:[{portIn:"Pos",portOut:"result",objIn:"39",objOut:"115"}]}]},{objName:"Ops.Gl.TextureEffects.Noise.FBMNoise",id:"116",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"scale",value:2},{name:"anim"},{name:"scrollX",value:9},{name:"scrollY",value:0},{name:"repeat",value:1},{name:"aspect",value:1},{name:"Layer 1",value:true},{name:"Layer 2",value:true},{name:"Layer 3",value:true},{name:"Layer 4",value:true},{name:"Tileable",value:true}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"117",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger In"},{name:"R",value:.6749438949170184},{name:"G",value:.7866171871183457},{name:"B",value:.962383017559739},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.8585982419554451},{name:"Emissive G",value:.8872829861539678},{name:"Emissive B",value:.10087431949523129},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:null},{name:"AO Texture",value:null},{name:"Emissive Texture",value:null},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:false},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:0}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"122",objOut:"117"}]},{name:"Shader"}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v2",id:"118",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Use viewport size",value:false},{name:"Width",value:10},{name:"Height",value:10},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"HDR",value:0},{name:"Transparent",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"120",objOut:"118"},{portIn:"exe",portOut:"Next",objIn:"127",objOut:"118"},{portIn:"update",portOut:"Next",objIn:"130",objOut:"118"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"126",objOut:"118"},{portIn:"Texture Colorize",portOut:"texture_out",objIn:"124",objOut:"118"}]},{name:"Aspect Ratio",value:1}]},{objName:"Ops.Gl.Render2Texture",id:"119",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"use viewport size",value:true},{name:"texture width",value:640},{name:"texture height",value:320},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:0},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",links:[{portIn:"Trigger In",portOut:"trigger",objIn:"117",objOut:"119"}]},{name:"texture",links:[{portIn:"Image",portOut:"texture",objIn:"120",objOut:"119"}]},{name:"textureDepth"}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"120",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"116",objOut:"120"}]}]},{objName:"Ops.Geometry.GeometryToWireframeArray3",id:"121",uiAttribs:{subPatch:0},portsIn:[{name:"Geometry"}],portsOut:[{name:"Array",links:[{portIn:"Array",portOut:"Array",objIn:"123",objOut:"121"}]}]},{objName:"Ops.Gl.Meshes.Torus",id:"122",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"sides",value:32},{name:"rings",value:32},{name:"innerRadius"},{name:"outerRadius",value:1},{name:"Draw",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry",links:[{portIn:"Geometry",portOut:"geometry",objIn:"121",objOut:"122"}]}]},{objName:"Ops.Gl.Meshes.PointCloudFromArray",id:"123",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Array"},{name:"Num Points",value:569},{name:"Scramble Texcoords",value:true},{name:"Seed",value:0},{name:"Coordinates"},{name:"Vertex Colors",value:null}],portsOut:[{name:"Trigger out",value:0},{name:"Geometry"}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"124",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"PointSize",value:9.85},{name:"Size in Pixels",value:false},{name:"Random Size",value:.77},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:true},{name:"r",value:.2423241285453822},{name:"g",value:.93067326237001},{name:"b",value:.7715621228998878},{name:"a",value:1},{name:"Vertex Colors",value:false},{name:"texture",value:null},{name:"Colorize Texture",value:0},{name:"Texture Mask",value:null},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize"},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"123",objOut:"124"}]},{name:"shader"}]},{objName:"Ops.Anim.Timer_v2",id:"125",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:35.12},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"anim",portOut:"Time",objIn:"116",objOut:"125"}]}]},{objName:"Ops.Ui.VizTexture",id:"126",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"RGBE Texture",portOut:"Texture Out",objIn:"131",objOut:"126"}]}]},{objName:"Ops.Anim.SineAnim",id:"127",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Mode index",value:0},{name:"Mode",value:"Sine"},{name:"phase",value:0},{name:"frequency",value:1},{name:"amplitude",value:1}],portsOut:[{name:"Trigger out",value:0},{name:"result",links:[{portIn:"innerRadius",portOut:"result",objIn:"122",objOut:"127"}]}]},{objName:"Ops.Gl.TextureEffects.Waveform_v2",id:"128",uiAttribs:{subPatch:0},portsIn:[{name:"render",value:null},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"screen"},{name:"Amount",value:1},{name:"Waveform index",value:0},{name:"Waveform",value:"Sine"},{name:"Amplitude",value:.5},{name:"Frequency",value:210},{name:"Line Width",value:.1},{name:"Line Glow",value:.1},{name:"invert color",value:false},{name:"Solid fill",value:false},{name:"Offset X",value:0},{name:"Offset Y",value:.5},{name:"Rotate",value:.208},{name:"r",value:.8933333333333333},{name:"g",value:.20239583333333333},{name:"b",value:.20239583333333333}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureToPointArray3",id:"129",uiAttribs:{subPatch:0},portsIn:[{name:"update",value:null},{name:"Center",value:true},{name:"Threshold Remove",value:0},{name:"Z Multiply",value:.55},{name:"texture",value:null},{name:"Width",value:2},{name:"Height",value:2}],portsOut:[{name:"trigger",value:0},{name:"Points"},{name:"Total Points",value:204800},{name:"Min Z",value:0},{name:"Max Z",value:.33730468750000003}]},{objName:"Ops.Gl.TextureToPointArray3",id:"130",uiAttribs:{subPatch:0},portsIn:[{name:"update"},{name:"Center",value:true},{name:"Threshold Remove",value:0},{name:"Z Multiply",value:2.44},{name:"texture"},{name:"Width",value:2},{name:"Height",value:2}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"131",objOut:"130"}]},{name:"Points",links:[{portIn:"Coordinates",portOut:"Points",objIn:"123",objOut:"130"}]},{name:"Total Points",value:0},{name:"Min Z",value:.02734375},{name:"Max Z",value:0}]},{objName:"Ops.Gl.Textures.TextureToCoordinateGrid",id:"131",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"RGBE Texture"},{name:"Aspect",value:1},{name:"Threshold",value:.2}],portsOut:[{name:"Next",value:0},{name:"HDR Texture",links:[{portIn:"texture",portOut:"HDR Texture",objIn:"130",objOut:"131"}]}]}],users:[],userOps:[],tags:[],_id:"6227b5c55e1e5eb534c37194",name:"copy of cuts_inter",userId:"5ef4b35539e82f6dc9d86144",created:"2022-03-08T20:00:05.805Z",cloneOf:"622752451d37e1b50229eb35",updated:"2022-03-12T14:58:23.398Z",log:[{_id:"6227b5c55e1e5eb534c37196",key:"collabsatcreate",text:"initial list of collaborators:"}],__v:25,shortId:"sLw7HZ",buildInfo:{host:"cables.gl"},opsHash:"3426ca83b09b40ca1a29787722f603075ea0060a",ui:{timeLineLength:20,bookmarks:[],viewBoxesGl:{0:{x:402.4141258242524,y:-270.4841959787359,z:1257.5640037541639},"5fd2d066-66b7-4180-9b9b-ad73ec1170f1":{x:298.8647298438121,y:558.6594230399988,z:1534.9802914325571},"1501bc92-36a1-4682-a50c-acdf31333594":{x:22.727868121013877,y:-71.37969652753532,z:984.9312022579263}},renderer:{w:640,h:320,s:1}},updatedByUser:"Olixaf",cachedUsername:"Olixaf",views:0,statsAdmin:{filenameScreenshots:["_screenshots/screenshot.png","_screenshots/screenshot_1646770589684.png","_screenshots/screenshot_1646919160080.png","_screenshots/screenshot_1646919280397.png","_screenshots/screenshot_1646919409233.png","_screenshots/screenshot_converted.jpg","_screenshots/screenshot_converted.webp"],filenameExports:[],filenameAssets:[],hasOldScreenshots:false,hasOldExports:false,sizeScreenshots:173.5576171875,sizeExports:0,sizeAssets:0},exports:1};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["sLw7HZ"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Math=Ops.Math||{};Ops.Value=Ops.Value||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Geometry=Ops.Geometry||{};Ops.Gl.Phong=Ops.Gl.Phong||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Devices.Keyboard=Ops.Devices.Keyboard||{};Ops.Gl.TextureEffects=Ops.Gl.TextureEffects||{};Ops.Gl.TextureEffects.Noise=Ops.Gl.TextureEffects.Noise||{};Ops.Gl.Shader.CustomShader_v2=function(){CABLES.Op.apply(this,arguments);const m=this;const e={};const t=m.inTrigger("render"),n=m.inStringEditor("Fragment Code"),a=m.inStringEditor("Vertex Code"),i=m.inValueBool("Use As Material",true),r=m.outTrigger("trigger"),o=m.outObject("Shader",null,"shader"),s=m.outBool("Has Errors");const v=m.patch.cgl;const h=[];const x=[];const b=[];m.toWorkPortsNeedToBeLinked(t);n.setUiAttribs({editorSyntax:"glsl"});a.setUiAttribs({editorSyntax:"glsl"});const T=new CGL.Shader(v,m.name);T.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setPortGroup("Source Code",[n,a]);m.setPortGroup("Options",[i]);n.set(CGL.Shader.getDefaultFragmentShader());a.set(CGL.Shader.getDefaultVertexShader());n.onChange=a.onChange=function(){l=true};t.onTriggered=c;var l=true;m.onLoadedValueSet=_;function _(n){d();for(let t=0;t<h.length;t++)for(let e=0;e<n.portsIn.length;e++)if(h[t]&&h[t].name==n.portsIn[e].name){h[t].set(n.portsIn[e].value);h[t].deSerializeSettings(n.portsIn[e])}}m.init=function(){d()};function c(){f();if(l)d();if(i.get())v.pushShader(T);r.trigger();if(i.get())v.popShader()}function u(){for(let e=0;e<x.length;e++)if(x[e]&&x[e].get()&&x[e].get().tex)v.setTexture(0+e+3,x[e].get().tex)}function I(t){for(let e=0;e<h.length;e++)if(h[e]&&h[e].name==t)return true;for(let e=0;e<x.length;e++)if(x[e]&&x[e].name==t)return true;return false}const p=mat4.create();const A=["modelMatrix","viewMatrix","normalMatrix","mvMatrix","projMatrix","inverseViewMatrix","camPos"];let E=0;const y=[];function g(e){const t=e.split("\n");const a=[];for(let e=0;e<t.length;e++){const r=t[e].split(";");for(let e=0;e<r.length;e++){let n=r[e].split(" ");for(var i=0;i<n.length;i++)n[i]=(n[i]+"").trim();if(n[0]==="UNI"||n[0]==="uniform"){let e=n[2];if(n.length>4)for(var i=3;i<n.length;i++)e+=n[i];n=n.filter(function(e){return e!==""});const o=n[1];let t=[e];if(e.indexOf(",")>-1)t=e.split(",");for(let e=0;e<t.length;e++){if(A.indexOf(t[e])>-1)continue;const s=t[e].trim();if(o==="float"){y.push(s);if(!I(s)){const l=m.inFloat(s,0);l.uniform=new CGL.Uniform(T,"f",s,l);h.push(l);a.push(l)}}else if(o==="int"){y.push(s);if(!I(s)){const l=m.inInt(s,0);l.uniform=new CGL.Uniform(T,"i",s,l);h.push(l);a.push(l)}}else if(o==="bool"){y.push(s);if(!I(s)){const l=m.inBool(s,false);l.uniform=new CGL.Uniform(T,"b",s,l);h.push(l);a.push(l)}}else if(o==="mat4"){y.push(s);if(!I(s)){const l=m.inArray(s,0);l.uniform=new CGL.Uniform(T,"m4",s,l);h.push(l);a.push(l);const _={name:s,num:16,port:l,uni:l.uniform,changed:false};l.onChange=function(){this.changed=true}.bind(_);b.push(_)}}else if(o==="sampler2D"||o==="samplerCube"){y.push(s);if(!I(s)){const c=m.inObject(s);let e="t";if(o==="samplerCube")e="tc";c.uniform=new CGL.Uniform(T,e,s,3+x.length);x.push(c);a.push(c);c.set(CGL.Texture.getTempTexture(v));c.on("change",(e,t)=>{if(!e)t.set(CGL.Texture.getTempTexture(v))});E++}}else if(o==="vec3"||o==="vec2"||o==="vec4"){let e=2;if(o==="vec4")e=4;if(o==="vec3")e=3;y.push(s+" X");y.push(s+" Y");if(e>2)y.push(s+" Z");if(e>3)y.push(s+" W");if(!I(s+" X")){const u=[];const _={name:s,num:e,changed:false};b.push(_);S(_);const p=m.inFloat(s+" X",0);p.onChange=function(){this.changed=true}.bind(_);h.push(p);u.push(p);_.x=p;const g=m.inFloat(s+" Y",0);g.onChange=function(){this.changed=true}.bind(_);h.push(g);u.push(g);_.y=g;if(e>2){const d=m.inFloat(s+" Z",0);d.onChange=function(){this.changed=true}.bind(_);h.push(d);u.push(d);_.z=d}if(e>3){const f=m.inFloat(s+" W",0);f.onChange=function(){this.changed=true}.bind(_);h.push(f);u.push(f);_.w=f}m.setPortGroup(s,u)}}}}}}m.setPortGroup("uniforms",a)}function d(){if(!T)return;T.bindTextures=u.bind(this);T.setSource(a.get(),n.get());if(v.glVersion==1){v.gl.getExtension("OES_standard_derivatives");T.enableExtension("GL_OES_standard_derivatives")}E=0;y.length=0;g(a.get());g(n.get());for(var e=0;e<x.length;e++)for(var t=0;t<y.length;t++)if(x[e]&&y.indexOf(x[e].name)==-1){x[e].remove();x[e]=null}for(var e=0;e<h.length;e++)for(var t=0;t<y.length;t++)if(h[e]&&y.indexOf(h[e].name)==-1){h[e].remove();h[e]=null}for(var e=0;e<b.length;e++){S(b[e]);b[e].changed=true}for(t=0;t<h.length;t++)if(h[t]&&h[t].uniform)h[t].uniform.needsUpdate=true;T.compile();if(CABLES.UI)gui.opParams.show(m);o.set(null);o.set(T);l=false;if(T.hasErrors())m.setUiError("compile","Shader has errors");else m.setUiError("compile",null);s.set(T.hasErrors())}function S(e){if(e.num==2)e.uni=new CGL.Uniform(T,"2f",e.name,[0,0]);else if(e.num==3)e.uni=new CGL.Uniform(T,"3f",e.name,[0,0,0]);else if(e.num==4)e.uni=new CGL.Uniform(T,"4f",e.name,[0,0,0,0])}function f(){for(let e=0;e<b.length;e++){const t=b[e];if(t.changed){if(t.num===2)t.uni.setValue([t.x.get(),t.y.get()]);else if(t.num===3)t.uni.setValue([t.x.get(),t.y.get(),t.z.get()]);else if(t.num===4)t.uni.setValue([t.x.get(),t.y.get(),t.z.get(),t.w.get()]);else if(t.num>4){t.uni.setValue(t.port.get())}t.changed=false}}}};Ops.Gl.Shader.CustomShader_v2.prototype=new CABLES.Op;CABLES.OPS["a165fc89-a35b-4d39-8930-7345b098bd9d"]={f:Ops.Gl.Shader.CustomShader_v2,objName:"Ops.Gl.Shader.CustomShader_v2"};Ops.Gl.Shader.Shader2Texture=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Render"),a=e.inObject("Shader",null,"shader"),r=e.inValueBool("Use Viewport Size",true),o=e.inValueInt("Width",512),s=e.inValueInt("Height",512),l=e.inValueSelect("filter",["nearest","linear","mipmap"]),_=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),c=e.inValueBool("Floating Point",false),u=e.inSwitch("Num Textures",["1","4"],"1"),i=e.outTrigger("Next"),p=e.outTexture("Texture"),g=e.outTexture("Texture 2"),d=e.outTexture("Texture 3"),f=e.outTexture("Texture 4");e.setPortGroup("Texture Size",[r,o,s]);e.setPortGroup("Texture settings",[l,_,c]);let m=1;const v=e.patch.cgl;const h=[0,0,0,0];const x=null;let b=null;let T=null;o.onChange=s.onChange=c.onChange=l.onChange=u.onChange=_.onChange=N;r.onChange=O;const I=false;let A=null;const E=null;let y=true;const S=CGL.MESHES.getSimpleRect(v,"shader2texture rect");e.toWorkPortsNeedToBeLinked(a);l.set("nearest");O();function C(){if(l.get()=="mipmap"&&c.get()){e.setUiError("warning","HDR and mipmap filtering at the same time is not possible")}else{e.setUiError("warning",null)}}function O(){o.setUiAttribs({greyout:r.get()});s.setUiAttribs({greyout:r.get()});o.set(v.getViewPort()[2]);s.set(v.getViewPort()[3])}function N(){y=true;C()}const L=[];function U(){if(T)T.dispose();b=null;T=null}function P(){y=false;if(A)A.delete();const e=L.length;m=parseInt(u.get());L.length=0;for(let e=0;e<m;e++)L[e]=true;if(e!=L.length){U()}A=null;let t=o.get();let n=s.get();if(r.get()){t=v.getViewPort()[2];n=v.getViewPort()[3]}let a=CGL.Texture.FILTER_NEAREST;if(l.get()=="linear")a=CGL.Texture.FILTER_LINEAR;else if(l.get()=="mipmap")a=CGL.Texture.FILTER_MIPMAP;let i=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(_.get()=="repeat")i=CGL.Texture.WRAP_REPEAT;if(_.get()=="mirrored repeat")i=CGL.Texture.WRAP_MIRRORED_REPEAT;if(v.glVersion>=2){A=new CGL.Framebuffer2(v,t,n,{isFloatingPointTexture:c.get(),multisampling:false,numRenderBuffers:m,wrap:i,filter:a,depth:true,multisamplingSamples:0,clear:true})}else{A=new CGL.Framebuffer(v,o.get(),s.get(),{isFloatingPointTexture:c.get(),filter:a,wrap:i})}}n.onTriggered=function(){const e=v.getViewPort();if(!A||y)P();if(r.get()&&A&&(e[2]!=A.getTextureColor().width||e[3]!=A.getTextureColor().height))P();if(!a.get()||!a.get().setDrawBuffers)return;if(a.get()!=b){b=a.get();T=a.get().copy();T.setDrawBuffers(L)}if(!T){p.set(null);return}h[0]=e[0];h[1]=e[1];h[2]=e[2];h[3]=e[3];A.renderStart(v);v.pushPMatrix();mat4.identity(v.pMatrix);v.pushViewMatrix();mat4.identity(v.vMatrix);v.pushModelMatrix();mat4.identity(v.mMatrix);v.pushShader(a.get());if(T.bindTextures)T.bindTextures();v.pushBlend(false);S.render(a.get());v.popBlend();v.popPMatrix();v.popModelMatrix();v.popViewMatrix();A.renderEnd(v);if(m>=2){p.set(A.getTextureColorNum(0));g.set(A.getTextureColorNum(1));d.set(A.getTextureColorNum(2));f.set(A.getTextureColorNum(3))}else p.set(A.getTextureColor());v.popShader();v.gl.viewport(h[0],h[1],h[2],h[3]);i.trigger()}};Ops.Gl.Shader.Shader2Texture.prototype=new CABLES.Op;CABLES.OPS["a3debb76-7d84-4548-9e7b-24891423dcce"]={f:Ops.Gl.Shader.Shader2Texture,objName:"Ops.Gl.Shader.Shader2Texture"};Ops.Anim.Timer_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const a=e.inValue("Speed",1),n=e.inValueBool("Play",true),i=e.inTriggerButton("Reset"),r=e.inValueBool("Sync to timeline",false),o=e.outValue("Time");e.setPortGroup("Controls",[n,i,a]);const s=new CABLES.Timer;let l=null;let _=0;let c=false;n.onChange=u;u();function u(){if(n.get()){s.play();e.patch.addOnAnimFrame(e)}else{s.pause();e.patch.removeOnAnimFrame(e)}}i.onTriggered=p;function p(){_=0;l=null;s.setTime(0);o.set(0)}r.onChange=function(){c=r.get();n.setUiAttribs({greyout:c});i.setUiAttribs({greyout:c})};e.onAnimFrame=function(e){if(s.isPlaying()){if(CABLES.overwriteTime!==undefined){o.set(CABLES.overwriteTime*a.get())}else if(c){o.set(e*a.get())}else{s.update();const t=s.get();if(l===null){l=t;return}const n=Math.abs(t-l);l=t;_+=n*a.get();if(_!=_)_=0;o.set(_)}}}};Ops.Anim.Timer_v2.prototype=new CABLES.Op;CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Sequence=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const t=r.inTrigger("exe"),n=r.inTriggerButton("Clean up connections");const a=[],o=[],i=16;let s=null;t.onTriggered=_;n.onTriggered=c;n.setUiAttribs({hidePort:true});n.setUiAttribs({hideParam:true});for(let t=0;t<i;t++){const u=r.outTrigger("trigger "+t);o.push(u);u.onLinkChanged=l;if(t<i-1){let e=r.inTrigger("exe "+t);e.onTriggered=_;a.push(e)}}function l(){clearTimeout(s);s=setTimeout(()=>{let t=false;for(let e=0;e<o.length;e++)if(o[e].links.length>1)t=true;n.setUiAttribs({hideParam:!t});if(r.isCurrentUiOp())r.refreshParams()},60)}function _(){for(let e=0;e<o.length;e++)o[e].trigger()}function c(){let a=0;for(let n=0;n<o.length;n++){let t=[];if(o[n].links.length>1)for(let e=1;e<o[n].links.length;e++){while(o[a].links.length>0)a++;t.push(o[n].links[e]);const i=o[n].links[e].getOtherPort(o[n]);r.patch.link(r,"trigger "+a,i.parent,i.name);a++}for(let e=0;e<t.length;e++)t[e].remove()}l()}};Ops.Sequence.prototype=new CABLES.Op;CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Sequence,objName:"Ops.Sequence"};Ops.Gl.MainLoop=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.inValue("FPS Limit",0);const n=a.outTrigger("trigger");const i=a.outValue("width");const r=a.outValue("height");const o=a.inValueBool("Reduce FPS not focussed",true);const s=a.inValueBool("Reduce FPS loading");const l=a.inValueBool("Clear",true);const _=a.inValueBool("ClearAlpha",true);const c=a.inValueBool("Fullscreen Button",false);const u=a.inValueBool("Active",true);const p=a.inValueBool("Hires Displays",false);a.onAnimFrame=A;p.onChange=function(){if(p.get())a.patch.cgl.pixelDensity=window.devicePixelRatio;else a.patch.cgl.pixelDensity=1;a.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()};u.onChange=function(){a.patch.removeOnAnimFrame(a);if(u.get()){a.setUiAttrib({extendTitle:""});a.onAnimFrame=A;a.patch.addOnAnimFrame(a);a.log("adding again!")}else{a.setUiAttrib({extendTitle:"Inactive"})}};const g=a.patch.cgl;let d=0;let f=0;if(!a.patch.cgl)a.uiAttr({error:"No webgl cgl context"});const m=vec3.create();vec3.set(m,0,0,0);const v=vec3.create();vec3.set(v,0,0,-2);c.onChange=I;setTimeout(I,100);let h=null;let x=true;let b=true;window.addEventListener("blur",()=>{x=false});window.addEventListener("focus",()=>{x=true});document.addEventListener("visibilitychange",()=>{b=!document.hidden});function T(){if(s.get()&&a.patch.loading.getProgress()<1)return 5;if(o.get()){if(!b)return 10;if(!x)return 30}return t.get()}function I(){function e(){if(h)h.style.display="block"}function t(){if(h)h.style.display="none"}a.patch.cgl.canvas.addEventListener("mouseleave",t);a.patch.cgl.canvas.addEventListener("mouseenter",e);if(c.get()){if(!h){h=document.createElement("div");const n=a.patch.cgl.canvas.parentElement;if(n)n.appendChild(h);h.addEventListener("mouseenter",e);h.addEventListener("click",function(e){if(CABLES.UI&&!e.shiftKey)gui.cycleFullscreen();else g.fullScreen()})}h.style.padding="10px";h.style.position="absolute";h.style.right="5px";h.style.top="5px";h.style.width="20px";h.style.height="20px";h.style.cursor="pointer";h.style["border-radius"]="40px";h.style.background="#444";h.style["z-index"]="9999";h.style.display="none";h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 490 490" style="width:20px;height:20px;" xml:space="preserve" width="512px" height="512px"><g><path d="M173.792,301.792L21.333,454.251v-80.917c0-5.891-4.776-10.667-10.667-10.667C4.776,362.667,0,367.442,0,373.333V480     c0,5.891,4.776,10.667,10.667,10.667h106.667c5.891,0,10.667-4.776,10.667-10.667s-4.776-10.667-10.667-10.667H36.416     l152.459-152.459c4.093-4.237,3.975-10.99-0.262-15.083C184.479,297.799,177.926,297.799,173.792,301.792z" fill="#FFFFFF"/><path d="M480,0H373.333c-5.891,0-10.667,4.776-10.667,10.667c0,5.891,4.776,10.667,10.667,10.667h80.917L301.792,173.792     c-4.237,4.093-4.354,10.845-0.262,15.083c4.093,4.237,10.845,4.354,15.083,0.262c0.089-0.086,0.176-0.173,0.262-0.262     L469.333,36.416v80.917c0,5.891,4.776,10.667,10.667,10.667s10.667-4.776,10.667-10.667V10.667C490.667,4.776,485.891,0,480,0z" fill="#FFFFFF"/><path d="M36.416,21.333h80.917c5.891,0,10.667-4.776,10.667-10.667C128,4.776,123.224,0,117.333,0H10.667     C4.776,0,0,4.776,0,10.667v106.667C0,123.224,4.776,128,10.667,128c5.891,0,10.667-4.776,10.667-10.667V36.416l152.459,152.459     c4.237,4.093,10.99,3.975,15.083-0.262c3.992-4.134,3.992-10.687,0-14.82L36.416,21.333z" fill="#FFFFFF"/><path d="M480,362.667c-5.891,0-10.667,4.776-10.667,10.667v80.917L316.875,301.792c-4.237-4.093-10.99-3.976-15.083,0.261     c-3.993,4.134-3.993,10.688,0,14.821l152.459,152.459h-80.917c-5.891,0-10.667,4.776-10.667,10.667s4.776,10.667,10.667,10.667     H480c5.891,0,10.667-4.776,10.667-10.667V373.333C490.667,367.442,485.891,362.667,480,362.667z" fill="#FFFFFF"/></g></svg>'}else{if(h){h.style.display="none";h.remove();h=null}}}a.onDelete=function(){g.gl.clearColor(0,0,0,0);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)};function A(e){if(!u.get())return;if(g.aborted||g.canvas.clientWidth===0||g.canvas.clientHeight===0)return;const t=performance.now();a.patch.config.fpsLimit=T();if(g.canvasWidth==-1){g.setCanvas(a.patch.config.glCanvasId);return}if(g.canvasWidth!=i.get()||g.canvasHeight!=r.get()){i.set(g.canvasWidth);r.set(g.canvasHeight)}if(CABLES.now()-f>1e3){CGL.fpsReport=CGL.fpsReport||[];if(a.patch.loading.getProgress()>=1&&f!==0)CGL.fpsReport.push(d);d=0;f=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;g.renderStart(g,m,v);if(l.get()){g.gl.clearColor(0,0,0,1);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)}n.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(g);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}g.renderEnd(g);if(_.get()){g.gl.clearColor(1,1,1,1);g.gl.colorMask(false,false,false,true);g.gl.clear(g.gl.COLOR_BUFFER_BIT);g.gl.colorMask(true,true,true,true)}if(!g.frameStore.phong)g.frameStore.phong={};d++;a.patch.cgl.profileData.profileMainloopMs=performance.now()-t}};Ops.Gl.MainLoop.prototype=new CABLES.Op;CABLES.OPS["b0472a1d-db16-4ba6-8787-f300fbdc77bb"]={f:Ops.Gl.MainLoop,objName:"Ops.Gl.MainLoop"};Ops.Ui.VizTexture=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTexture("Texture In"),a=e.outTexture("Texture Out");e.setUiAttrib({height:150,resizable:true});n.onChange=()=>{a.set(n.get())}};Ops.Ui.VizTexture.prototype=new CABLES.Op;CABLES.OPS["4ea2d7b0-ca74-45db-962b-4d1965ac20c0"]={f:Ops.Ui.VizTexture,objName:"Ops.Ui.VizTexture"};Ops.Gl.Render2Texture=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const i=a.patch.cgl;const t=a.inTrigger("render"),n=a.inValueBool("use viewport size",true),r=a.inValueInt("texture width",512),o=a.inValueInt("texture height",512),s=a.inBool("Auto Aspect",false),l=a.inSwitch("filter",["nearest","linear","mipmap"],"linear"),_=a.inSwitch("Wrap",["Clamp","Repeat","Mirror"],"Repeat"),c=a.inSwitch("MSAA",["none","2x","4x","8x"],"none"),u=a.outTrigger("trigger"),p=a.outTexture("texture"),g=a.outTexture("textureDepth"),d=a.inValueBool("HDR"),f=a.inValueBool("Depth",true),m=a.inValueBool("Clear",true);let v=null;let h=true;p.set(CGL.Texture.getEmptyTexture(i));a.setPortGroup("Size",[n,r,o,s]);n.onChange=x;function x(){r.setUiAttribs({greyout:n.get()});o.setUiAttribs({greyout:n.get()});s.setUiAttribs({greyout:n.get()})}function b(){h=true}const T=[0,0,0,0];d.onChange=f.onChange=m.onChange=l.onChange=_.onChange=c.onChange=b;function I(){const e=i.getViewPort();T[0]=e[0];T[1]=e[1];T[2]=e[2];T[3]=e[3];if(!v||h){if(v)v.delete();let n=CGL.Texture.WRAP_REPEAT;if(_.get()=="Clamp")n=CGL.Texture.WRAP_CLAMP_TO_EDGE;else if(_.get()=="Mirror")n=CGL.Texture.WRAP_MIRRORED_REPEAT;if(d.get()&&l.get()=="mipmap")a.setUiError("fpmipmap","Don't use mipmap and HDR at the same time, many systems do not support this.");else a.setUiError("fpmipmap",null);if(i.glVersion>=2){let e=true;let t=4;if(c.get()=="none"){t=0;e=false}if(c.get()=="2x")t=2;if(c.get()=="4x")t=4;if(c.get()=="8x")t=8;v=new CGL.Framebuffer2(i,8,8,{name:"render2texture "+a.id,isFloatingPointTexture:d.get(),multisampling:e,wrap:n,depth:f.get(),multisamplingSamples:t,clear:m.get()})}else{v=new CGL.Framebuffer(i,8,8,{isFloatingPointTexture:d.get(),clear:m.get()})}if(l.get()=="nearest")v.setFilter(CGL.Texture.FILTER_NEAREST);else if(l.get()=="linear")v.setFilter(CGL.Texture.FILTER_LINEAR);else if(l.get()=="mipmap")v.setFilter(CGL.Texture.FILTER_MIPMAP);g.set(v.getTextureDepth());h=false}if(n.get()){r.set(i.getViewPort()[2]);o.set(i.getViewPort()[3])}if(v.getWidth()!=Math.ceil(r.get())||v.getHeight()!=Math.ceil(o.get())){v.setSize(Math.max(1,Math.ceil(r.get())),Math.max(1,Math.ceil(o.get())))}v.renderStart(i);if(s.get())mat4.perspective(i.pMatrix,45,r.get()/o.get(),.1,1e3);u.trigger();v.renderEnd(i);i.setViewPort(T[0],T[1],T[2],T[3]);p.set(CGL.Texture.getEmptyTexture(a.patch.cgl));p.set(v.getTextureColor())}t.onTriggered=I;a.preRender=I;x()};Ops.Gl.Render2Texture.prototype=new CABLES.Op;CABLES.OPS["d01fa820-396c-4cb5-9d78-6b14762852af"]={f:Ops.Gl.Render2Texture,objName:"Ops.Gl.Render2Texture"};Ops.Gl.TextureEffects.DrawImage_v3=function(){CABLES.Op.apply(this,arguments);const a=this;const e={drawimage_frag:"#ifdef HAS_TEXTURES\n    IN vec2 texCoord;\n    UNI sampler2D tex;\n    UNI sampler2D image;\n#endif\n\n#ifdef TEX_TRANSFORM\n    IN mat3 transform;\n#endif\n// UNI float rotate;\n\n{{CGL.BLENDMODES}}\n\n#ifdef HAS_TEXTUREALPHA\n   UNI sampler2D imageAlpha;\n#endif\n\nUNI float amount;\n\n#ifdef ASPECT_RATIO\n    UNI float aspectTex;\n    UNI float aspectPos;\n#endif\n\nvoid main()\n{\n    vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);\n\n    #ifdef HAS_TEXTURES\n        vec2 tc=texCoord;\n\n        #ifdef TEX_FLIP_X\n            tc.x=1.0-tc.x;\n        #endif\n        #ifdef TEX_FLIP_Y\n            tc.y=1.0-tc.y;\n        #endif\n\n        #ifdef ASPECT_RATIO\n            #ifdef ASPECT_AXIS_X\n                tc.y=(1.0-aspectPos)-(((1.0-aspectPos)-tc.y)*aspectTex);\n            #endif\n            #ifdef ASPECT_AXIS_Y\n                tc.x=(1.0-aspectPos)-(((1.0-aspectPos)-tc.x)/aspectTex);\n            #endif\n        #endif\n\n        #ifdef TEX_TRANSFORM\n            vec3 coordinates=vec3(tc.x, tc.y,1.0);\n            tc=(transform * coordinates ).xy;\n        #endif\n\n        blendRGBA=texture(image,tc);\n\n        vec3 blend=blendRGBA.rgb;\n        vec4 baseRGBA=texture(tex,texCoord);\n        vec3 base=baseRGBA.rgb;\n        vec3 colNew=_blend(base,blend);\n\n        #ifdef REMOVE_ALPHA_SRC\n            blendRGBA.a=1.0;\n        #endif\n\n        #ifdef HAS_TEXTUREALPHA\n            vec4 colImgAlpha=texture(imageAlpha,tc);\n            float colImgAlphaAlpha=colImgAlpha.a;\n\n            #ifdef ALPHA_FROM_LUMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef ALPHA_FROM_INV_UMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=1.0-(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef INVERT_ALPHA\n                colImgAlphaAlpha=clamp(colImgAlphaAlpha,0.0,1.0);\n                colImgAlphaAlpha=1.0-colImgAlphaAlpha;\n            #endif\n\n            blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n        #endif\n    #endif\n\n    float am=amount;\n\n    #ifdef CLIP_REPEAT\n        if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n        {\n            // colNew.rgb=vec3(0.0);\n            am=0.0;\n        }\n    #endif\n\n    #ifdef ASPECT_RATIO\n        #ifdef ASPECT_CROP\n            if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n            {\n                colNew.rgb=base.rgb;\n                am=0.0;\n            }\n\n        #endif\n    #endif\n\n    // blendRGBA.rgb=mix( colNew, base ,1.0-am);\n    // blendRGBA.a=clamp((blendRGBA.a*am),0.,1.);\n\n    blendRGBA.rgb=mix(colNew,base,1.0-(am*blendRGBA.a));\n    blendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n\n\n    outColor= blendRGBA;\n\n}\n\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=a.inTrigger("render");const n=CGL.TextureEffect.AddBlendSelect(a,"blendMode");const i=a.inValueSlider("amount",1);const r=a.inTexture("Image");const o=a.inValueBool("removeAlphaSrc",false);const s=a.inTexture("Mask");const l=a.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance");const _=a.inValueBool("Invert alpha channel");const c=a.inValueBool("Aspect Ratio",false);const u=a.inValueSelect("Stretch Axis",["X","Y"],"X");const p=a.inValueSlider("Position",0);const g=a.inValueBool("Crop",false);const d=a.outTrigger("trigger");n.set("normal");const f=a.patch.cgl;const m=new CGL.Shader(f,"drawimage");s.onLinkChanged=v;a.setPortGroup("Mask",[s,l,_]);a.setPortGroup("Aspect Ratio",[c,p,g,u]);o.onChange=E;function v(){if(s.isLinked()){o.setUiAttribs({greyout:true});l.setUiAttribs({greyout:false});_.setUiAttribs({greyout:false})}else{o.setUiAttribs({greyout:false});l.setUiAttribs({greyout:true});_.setUiAttribs({greyout:true})}}a.toWorkPortsNeedToBeLinked(r);m.setSource(e.drawimage_vert,e.drawimage_frag);const h=new CGL.Uniform(m,"t","tex",0);const x=new CGL.Uniform(m,"t","image",1);const b=new CGL.Uniform(m,"t","imageAlpha",2);const T=new CGL.Uniform(m,"f","aspectTex",1);const I=new CGL.Uniform(m,"f","aspectPos",p);_.onChange=function(){if(_.get())m.define("INVERT_ALPHA");else m.removeDefine("INVERT_ALPHA")};c.onChange=A;g.onChange=A;u.onChange=A;function A(){m.removeDefine("ASPECT_AXIS_X");m.removeDefine("ASPECT_AXIS_Y");m.removeDefine("ASPECT_CROP");p.setUiAttribs({greyout:!c.get()});g.setUiAttribs({greyout:!c.get()});u.setUiAttribs({greyout:!c.get()});if(c.get()){m.define("ASPECT_RATIO");if(g.get())m.define("ASPECT_CROP");if(u.get()=="X")m.define("ASPECT_AXIS_X");if(u.get()=="Y")m.define("ASPECT_AXIS_Y")}else{m.removeDefine("ASPECT_RATIO");if(g.get())m.define("ASPECT_CROP");if(u.get()=="X")m.define("ASPECT_AXIS_X");if(u.get()=="Y")m.define("ASPECT_AXIS_Y")}}function E(){if(o.get())m.define("REMOVE_ALPHA_SRC");else m.removeDefine("REMOVE_ALPHA_SRC")}l.onChange=function(){m.toggleDefine("ALPHA_FROM_LUMINANCE",l.get()=="luminance");m.toggleDefine("ALPHA_FROM_INV_UMINANCE",l.get()=="luminance_inv")};l.set("alpha channel");{const G=a.inValueBool("flip x");const w=a.inValueBool("flip y");G.onChange=function(){if(G.get())m.define("TEX_FLIP_X");else m.removeDefine("TEX_FLIP_X")};w.onChange=function(){if(w.get())m.define("TEX_FLIP_Y");else m.removeDefine("TEX_FLIP_Y")}}{var y=a.inValueBool("Transform");var S=a.inValueSlider("Scale X",1);var C=a.inValueSlider("Scale Y",1);var O=a.inValue("Position X",0);var N=a.inValue("Position Y",0);var L=a.inValue("Rotation",0);const V=a.inValueBool("Clip Repeat",false);V.onChange=U;function U(){if(V.get())m.define("CLIP_REPEAT");else m.removeDefine("CLIP_REPEAT")}const D=new CGL.Uniform(m,"f","scaleX",S);const B=new CGL.Uniform(m,"f","scaleY",C);const k=new CGL.Uniform(m,"f","posX",O);const F=new CGL.Uniform(m,"f","posY",N);const j=new CGL.Uniform(m,"f","rotate",L);y.onChange=P}function P(){m.toggleDefine("TEX_TRANSFORM",y.get());if(y.get()){S.setUiAttribs({greyout:false});C.setUiAttribs({greyout:false});O.setUiAttribs({greyout:false});N.setUiAttribs({greyout:false});L.setUiAttribs({greyout:false})}else{S.setUiAttribs({greyout:true});C.setUiAttribs({greyout:true});O.setUiAttribs({greyout:true});N.setUiAttribs({greyout:true});L.setUiAttribs({greyout:true})}}CGL.TextureEffect.setupBlending(a,m,n,i);const R=new CGL.Uniform(m,"f","amount",i);s.onChange=function(){if(s.get()&&s.get().tex){m.define("HAS_TEXTUREALPHA")}else{m.removeDefine("HAS_TEXTUREALPHA")}};function M(){if(!CGL.TextureEffect.checkOpInEffect(a))return;const e=r.get();if(e&&e.tex&&i.get()>0){f.pushShader(m);f.currentTextureEffect.bind();const t=f.currentTextureEffect.getCurrentSourceTexture();f.setTexture(0,t.tex);const n=1/(f.currentTextureEffect.getWidth()/f.currentTextureEffect.getHeight())*(e.width/e.height);T.setValue(n);f.setTexture(1,e.tex);if(s.get()&&s.get().tex){f.setTexture(2,s.get().tex)}f.pushBlendMode(CGL.BLEND_NONE,true);f.currentTextureEffect.finish();f.popBlendMode();f.popShader()}d.trigger()}t.onTriggered=M;P();E();v();A()};Ops.Gl.TextureEffects.DrawImage_v3.prototype=new CABLES.Op;CABLES.OPS["8f6b2f15-fcb0-4597-90c0-e5173f2969fe"]={f:Ops.Gl.TextureEffects.DrawImage_v3,objName:"Ops.Gl.TextureEffects.DrawImage_v3"};Ops.Gl.TextureEffects.ImageCompose_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={imgcomp_frag:"UNI float a;\nvoid main()\n{\n   outColor= vec4(0.0,0.0,0.0,a);\n}\n"};const n=e.inTrigger("Render"),a=e.inBool("Use viewport size",true),i=e.inValueInt("Width",640),r=e.inValueInt("Height",480),o=e.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),s=e.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),l=e.inValueBool("HDR"),_=e.inValueBool("Transparent",false),c=e.outTrigger("Next"),u=e.outTexture("texture_out"),p=e.outValue("Aspect Ratio");const g=e.patch.cgl;e.setPortGroup("Texture Size",[a,i,r]);e.setPortGroup("Texture Settings",[s,o,l,_]);u.set(CGL.Texture.getEmptyTexture(g));let d=null;let f=null;let m=8,v=8;const h=[0,0,0,0];let x=true;let b=CGL.Texture.FILTER_LINEAR;let T=CGL.Texture.WRAP_CLAMP_TO_EDGE;const I=0;const A=0;s.onChange=O;o.onChange=N;n.onTriggered=e.preRender=C;N();O();S();function E(){if(d)d.delete();if(f)f.delete();if(l.get()&&o.get()=="mipmap")e.setUiError("fpmipmap","Don't use mipmap and HDR at the same time, many systems do not support this.");else e.setUiError("fpmipmap",null);d=new CGL.TextureEffect(g,{isFloatingPointTexture:l.get()});f=new CGL.Texture(g,{name:"image_compose_v2_"+e.id,isFloatingPointTexture:l.get(),filter:b,wrap:T,width:Math.ceil(i.get()),height:Math.ceil(r.get())});d.setSourceTexture(f);u.set(CGL.Texture.getEmptyTexture(g));x=false}l.onChange=function(){x=true};function y(){if(!d)E();if(a.get()){m=g.getViewPort()[2];v=g.getViewPort()[3]}else{m=Math.ceil(i.get());v=Math.ceil(r.get())}p.set(m/v);if((m!=f.width||v!=f.height)&&(m!==0&&v!==0)){f.setSize(m,v);d.setSourceTexture(f);u.set(CGL.Texture.getEmptyTexture(g));u.set(f)}}function S(){i.setUiAttribs({greyout:a.get()});r.setUiAttribs({greyout:a.get()})}a.onChange=function(){S()};e.preRender=function(){C()};function C(){if(!d||x)E();const e=g.getViewPort();h[0]=e[0];h[1]=e[1];h[2]=e[2];h[3]=e[3];g.pushBlend(false);y();const t=g.currentTextureEffect;g.currentTextureEffect=d;g.currentTextureEffect.width=i.get();g.currentTextureEffect.height=r.get();d.setSourceTexture(f);let n=CGL.Texture.getBlackTexture(g);if(_.get())n=CGL.Texture.getEmptyTexture(g);d.startEffect(n);c.trigger();u.set(d.getCurrentSourceTexture());d.endEffect();g.setViewPort(h[0],h[1],h[2],h[3]);g.popBlend(false);g.currentTextureEffect=t}function O(){if(s.get()=="repeat")T=CGL.Texture.WRAP_REPEAT;if(s.get()=="mirrored repeat")T=CGL.Texture.WRAP_MIRRORED_REPEAT;if(s.get()=="clamp to edge")T=CGL.Texture.WRAP_CLAMP_TO_EDGE;x=true}function N(){if(o.get()=="nearest")b=CGL.Texture.FILTER_NEAREST;if(o.get()=="linear")b=CGL.Texture.FILTER_LINEAR;if(o.get()=="mipmap")b=CGL.Texture.FILTER_MIPMAP;x=true}};Ops.Gl.TextureEffects.ImageCompose_v2.prototype=new CABLES.Op;CABLES.OPS["a5b43d4c-a9ea-4eaf-9ed0-f257d222659d"]={f:Ops.Gl.TextureEffects.ImageCompose_v2,objName:"Ops.Gl.TextureEffects.ImageCompose_v2"};Ops.Gl.Meshes.FullscreenRectangle=function(){CABLES.Op.apply(this,arguments);const e=this;const t={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n\n    vec2 tc=vec2(texCoord.x,(1.0-texCoord.y));\n\n   outColor= texture(tex,tc);\n}\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=attrTexCoord;\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const n=e.inTrigger("render"),a=e.inSwitch("Scale",["Stretch","Fit"],"Stretch"),i=e.inValueBool("Flip Y"),r=e.inValueBool("Flip X"),o=e.inTexture("Texture"),s=e.outTrigger("trigger");const l=e.patch.cgl;let _=null;let c=new CGL.Geometry("fullscreen rectangle");let u=0,p=0,g=0,d=0,f=0;r.onChange=A;i.onChange=A;const m=new CGL.Shader(l,"fullscreenrectangle");m.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setSource(t.shader_vert,t.shader_frag);m.fullscreenRectUniform=new CGL.Uniform(m,"t","tex",0);m.aspectUni=new CGL.Uniform(m,"f","aspectTex",0);let v=false;let h=true;let x=false;let b=[];n.onTriggered=I;e.toWorkPortsNeedToBeLinked(n);o.onChange=function(){h=true};function T(){let e=o.get();if(e)v=true;else v=false}e.preRender=function(){T();m.bind();if(_)_.render(m);I()};a.onChange=()=>{x=a.get()=="Fit"};function I(){if(l.getViewPort()[2]!=d||l.getViewPort()[3]!=f||!_)E();if(h)T();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,d,f,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(x&&o.get()){const n=o.get().width/o.get().height;let e=f;let t=f*n;if(t>d){e=d*1/n;t=d}b[0]=l.getViewPort()[0];b[1]=l.getViewPort()[1];b[2]=l.getViewPort()[2];b[3]=l.getViewPort()[3];l.setViewPort((d-t)/2,(f-e)/2,t,e);l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT)}if(v){if(o.get())l.setTexture(0,o.get().tex);_.render(m)}else{_.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(x&&o.get())l.setViewPort(b[0],b[1],b[2],b[3]);s.trigger()}function A(){_=null}function E(){const e=l.getViewPort();if(e[2]==d&&e[3]==f&&_)return;let t=0,n=0;d=e[2];f=e[3];c.vertices=new Float32Array([t+d,n+f,0,t,n+f,0,t+d,n,0,t,n,0]);let a=null;if(i.get())a=new Float32Array([1,0,0,0,1,1,0,1]);else a=new Float32Array([1,1,0,1,1,0,0,0]);if(r.get()){a[0]=0;a[2]=1;a[4]=0;a[6]=1}c.setTexCoords(a);c.verticesIndices=new Float32Array([2,1,0,3,1,2]);c.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);c.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);c.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!_)_=new CGL.Mesh(l,c);else _.setGeom(c)}};Ops.Gl.Meshes.FullscreenRectangle.prototype=new CABLES.Op;CABLES.OPS["255bd15b-cc91-4a12-9b4e-53c710cbb282"]={f:Ops.Gl.Meshes.FullscreenRectangle,objName:"Ops.Gl.Meshes.FullscreenRectangle"};Ops.Gl.Meshes.Rectangle_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("render"),a=e.outTrigger("trigger"),I=e.inValue("width",1),A=e.inValue("height",1),E=e.inSwitch("pivot x",["left","center","right"]),y=e.inSwitch("pivot y",["top","center","bottom"]),S=e.inValueInt("num columns",1),C=e.inValueInt("num rows",1),O=e.inSwitch("axis",["xy","xz"],"xy"),i=e.inValueBool("Active",true),N=e.outObject("geometry",null,"geometry");N.ignoreValueSerialize=true;const L=e.patch.cgl;O.set("xy");E.set("center");y.set("center");e.setPortGroup("Pivot",[E,y]);e.setPortGroup("Size",[I,A]);e.setPortGroup("Structure",[S,C]);e.toWorkPortsNeedToBeLinked(n);const U=new CGL.Geometry("rectangle");let P=null;let R=false;O.onChange=E.onChange=y.onChange=I.onChange=A.onChange=C.onChange=S.onChange=r;o();function r(){R=true}e.preRender=n.onTriggered=function(){if(!CGL.TextureEffect.checkOpNotInTextureEffect(e))return;if(R)o();if(i.get()&&P)P.render(L.getShader());a.trigger()};function o(){let e=I.get();let t=parseFloat(A.get());let n=0;let a=0;if(typeof e=="string")e=parseFloat(e);if(typeof t=="string")t=parseFloat(t);if(E.get()=="center")n=0;else if(E.get()=="right")n=-e/2;else if(E.get()=="left")n=+e/2;if(y.get()=="center")a=0;else if(y.get()=="top")a=-t/2;else if(y.get()=="bottom")a=+t/2;const i=[];const r=[];const o=[];const s=[];const l=[];const _=[];const c=Math.round(C.get());const u=Math.round(S.get());const p=e/u;const g=t/c;let d,f,m;m=O.get();for(f=0;f<=c;f++){for(d=0;d<=u;d++){i.push(d*p-I.get()/2+n);if(m=="xz")i.push(0);i.push(f*g-A.get()/2+a);if(m=="xy")i.push(0);r.push(d/u);r.push(1-f/c);if(m=="xz"){o.push(0,1,0);s.push(1,0,0);l.push(0,0,1)}else if(m=="xy"){o.push(0,0,1);s.push(-1,0,0);l.push(0,-1,0)}}}for(d=0;d<u;d++){for(f=0;f<c;f++){const v=d+(u+1)*f;const h=v;const x=v+1;const b=v+u+1;const T=v+1+u+1;_.push(h);_.push(b);_.push(x);_.push(x);_.push(b);_.push(T)}}U.clear();U.vertices=i;U.texCoords=r;U.verticesIndices=_;U.vertexNormals=o;U.tangents=s;U.biTangents=l;if(u*c>64e3)U.unIndex();if(!P)P=new CGL.Mesh(L,U);else P.setGeom(U);N.set(null);N.set(U);R=false}e.onDelete=function(){if(P)P.dispose()}};Ops.Gl.Meshes.Rectangle_v2.prototype=new CABLES.Op;CABLES.OPS["fc5718d6-11a5-496e-8f16-1c78b1a2824c"]={f:Ops.Gl.Meshes.Rectangle_v2,objName:"Ops.Gl.Meshes.Rectangle_v2"};Ops.Gl.TextureEffects.Wobble=function(){CABLES.Op.apply(this,arguments);const e=this;const t={wobble_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D texMask;\nUNI float time;\nUNI float speedX;\nUNI float speedY;\nUNI float repeatX;\nUNI float repeatY;\nUNI float mul;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n\nfloat mult=mul;\n#ifdef MASK\n    mult*=texture(texMask,texCoord).r;\n#endif\n\n    vec2 tc = texCoord + cos( (time*vec2(speedX, speedY) + vec2(texCoord.s*repeatX,texCoord.t*repeatY)))*mult;\n\n    col=texture(tex,tc);\n\n    outColor= col;\n}"};const n=e.inTrigger("Render"),a=e.inValue("time",0),i=e.inValue("SpeedX",4),r=e.inValue("SpeedY",8),o=e.inValue("RepeatX",11),s=e.inValue("RepeatY",11),l=e.inValue("Multiply",.01),_=e.inTexture("Mask"),c=e.outTrigger("Trigger");const u=e.patch.cgl;const p=new CGL.Shader(u,e.name);p.setSource(p.getDefaultVertexShader(),t.wobble_frag);const g=new CGL.Uniform(p,"t","tex",0);const d=new CGL.Uniform(p,"f","time",a);const f=new CGL.Uniform(p,"f","speedX",i);const m=new CGL.Uniform(p,"f","speedY",r);const v=new CGL.Uniform(p,"f","repeatX",o);const h=new CGL.Uniform(p,"f","repeatY",s);const x=new CGL.Uniform(p,"f","mul",l);const b=new CGL.Uniform(p,"t","texMask",1);_.onChange=function(){p.toggleDefine("MASK",_.isLinked())};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;u.pushShader(p);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);if(_.get())u.setTexture(1,_.get().tex);u.currentTextureEffect.finish();u.popShader();c.trigger()}};Ops.Gl.TextureEffects.Wobble.prototype=new CABLES.Op;CABLES.OPS["c349f178-eb83-4753-829e-c9a50b7f459c"]={f:Ops.Gl.TextureEffects.Wobble,objName:"Ops.Gl.TextureEffects.Wobble"};Ops.Trigger.TimedSequence=function(){CABLES.Op.apply(this,arguments);const n=this;const e={};const t=n.inTrigger("exe");const i=n.inValueInt("current",0);const r=n.inValueBool("overwriteTime");const o=n.inValueBool("ignoreInSubPatch",false);const s=n.outTrigger("triggerAlways");const a=n.outArray("Names",[]);const l=n.outValue("currentKeyTime");const _=n.outValue("Current");let c=[];for(let t=0;t<32;t++){let e=n.outTrigger("trigger "+t);e.onLinkChanged=u;c.push(e)}function u(){let t=[];for(let e=0;e<c.length;e++)if(c[e].isLinked())t.push(c[e].links[0].getOtherPort(c[e]).parent.uiAttribs.title);else t.push("none");a.set(t)}n.onLoaded=u;let p=-1;t.onTriggered=g;function g(a){let t=0;let e=Math.round(i.get()-.5);if(window.gui){if(i.get()!=p){p=i.get();for(t=0;t<c.length;t++){if(t==p)c[t].setUiActiveState(true);else c[t].setUiActiveState(false)}}}if(i.anim){let e=a;if(a===undefined)e=i.parent.patch.timer.getTime();let t=i.anim.getKey(e);let n=0;if(t)n=t.time;l.set(e-n);if(i.isAnimated()){if(r.get()){i.parent.patch.timer.overwriteTime=l.get()}}}if(n.patch.gui&&o.get()){for(let e=0;e<c.length;e++){for(t=0;t<c[e].links.length;t++){if(c[e].links[t]){if(c[e].links[t].portIn.parent.patchId){if(CABLES.UI)if(gui.patchView.getCurrentSubPatch()==c[e].links[t].portIn.parent.patchId.get()){n.patch.timer.overwriteTime=-1;c[e].trigger();return}}}}}}if(e>=0&&e<c.length){_.set(e);c[e].trigger()}n.patch.timer.overwriteTime=-1;s.trigger()}};Ops.Trigger.TimedSequence.prototype=new CABLES.Op;CABLES.OPS["73c892c9-3e81-4ddc-952a-fbe6bf00ef2c"]={f:Ops.Trigger.TimedSequence,objName:"Ops.Trigger.TimedSequence"};Ops.Sidebar.Slider_v3=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const t=1e-5;const n=i.inObject("link");const a=i.inString("Text","Slider");const r=i.inValue("Min",0);const o=i.inValue("Max",1);const s=i.inValue("Step",t);const l=i.inString("Suffix","");const _=i.inBool("Grey Out",false);const c=i.inBool("Visible",true);const u=i.inValue("Input",.5);const p=i.inTriggerButton("Set Default");const g=i.inTriggerButton("Reset");let d=null;const f=i.inValue("Default",.5);f.setUiAttribs({hidePort:true,greyout:true});const m=i.outObject("childs");const v=i.outValue("Result",f.get());i.toWorkNeedsParent("Ops.Sidebar.Sidebar");i.setPortGroup("Range",[r,o,s]);i.setPortGroup("Display",[_,c]);const h=document.createElement("div");h.addEventListener("dblclick",function(){v.set(parseFloat(f.get()));u.set(parseFloat(f.get()))});h.dataset.op=i.id;h.classList.add("cablesEle");h.classList.add("sidebar__item");h.classList.add("sidebar__slider");h.classList.add("sidebar__reloadable");i.patch.on("sidebarStylesChanged",()=>{P()});const x=document.createElement("div");x.classList.add("sidebar__item-label");const b=document.createElement("div");b.classList.add("sidebar__greyout");h.appendChild(b);b.style.display="none";const T=document.createTextNode(a.get());x.appendChild(T);h.appendChild(x);const I=document.createElement("input");I.value=f.get();I.classList.add("sidebar__text-input-input");I.setAttribute("type","text");I.oninput=C;h.appendChild(I);const A=document.createElement("span");h.appendChild(A);l.onChange=()=>{A.innerHTML=l.get()};const E=document.createElement("div");E.classList.add("sidebar__slider-input-wrapper");h.appendChild(E);const y=document.createElement("div");y.classList.add("sidebar__slider-input-active-track");E.appendChild(y);const S=document.createElement("input");S.classList.add("sidebar__slider-input");S.setAttribute("min",r.get());S.setAttribute("max",o.get());S.setAttribute("type","range");S.setAttribute("step",s.get());S.setAttribute("value",f.get());S.style.display="block";E.appendChild(S);P();S.addEventListener("input",L);n.onChange=V;a.onChange=w;u.onChange=O;f.onChange=G;p.onTriggered=N;r.onChange=R;o.onChange=M;s.onChange=U;i.onDelete=j;i.onLoaded=i.onInit=function(){if(i.patch.config.sidebar){i.patch.config.sidebar[a.get()];v.set(i.patch.config.sidebar[a.get()])}else{v.set(parseFloat(f.get()));u.set(parseFloat(f.get()))}};g.onTriggered=function(){const e=parseFloat(f.get());v.set(e);D(e);B(e);u.set(e);P()};_.onChange=function(){b.style.display=_.get()?"block":"none"};c.onChange=function(){h.style.display=c.get()?"block":"none"};function C(e){let t=parseFloat(e.target.value);if(isNaN(t))t=0;const n=r.get();const a=o.get();if(t<n){t=n}else if(t>a){t=a}v.set(t);P();u.set(t);if(i.isCurrentUiOp())gui.opParams.show(i)}function O(){let e=parseFloat(u.get());const t=r.get();const n=o.get();if(e>n){e=n}else if(e<t){e=t}D(e);B(e);v.set(e);P()}function N(){let e=parseFloat(u.get());const t=r.get();const n=o.get();if(e>n){e=n}else if(e<t){e=t}D(e);B(e);v.set(e);f.set(e);if(i.isCurrentUiOp())gui.opParams.show(i);P()}function L(e){e.preventDefault();e.stopPropagation();D(e.target.value);const t=parseFloat(e.target.value);v.set(t);u.set(t);if(i.isCurrentUiOp())gui.opParams.show(i);P();return false}function U(){const e=s.get();S.setAttribute("step",e);P()}function P(e){let t=parseFloat(S.value);if(typeof e!=="undefined")t=e;let n=y.parentElement.getBoundingClientRect().width||220;if(d)n=parseInt(getComputedStyle(d.parentElement).getPropertyValue("--sidebar-width"))-20;const a=CABLES.map(t,parseFloat(S.min),parseFloat(S.max),0,n-16);y.style.width=a+"px"}function R(){const e=r.get();S.setAttribute("min",e);P()}function M(){const e=o.get();S.setAttribute("max",e);P()}function G(){const e=f.get();v.set(parseFloat(e));R();M();B(e);D(e);P(e)}function w(){const e=a.get();x.textContent=e;if(CABLES.UI)i.setTitle("Slider: "+e)}function V(){m.set(null);d=n.get();if(d&&d.parentElement){d.parentElement.appendChild(h);m.set(d)}else if(h.parentElement)h.parentElement.removeChild(h);P()}function D(e){I.value=e}function B(e){S.value=e}function k(e){if(e)e.style.display="block"}function F(e){if(e)e.style.display="none"}function j(){X(h)}function X(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Slider_v3.prototype=new CABLES.Op;CABLES.OPS["74730122-5cba-4d0d-b610-df334ec6220a"]={f:Ops.Sidebar.Slider_v3,objName:"Ops.Sidebar.Slider_v3"};Ops.Sidebar.Button_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link");const a=t.inString("Text","Button");const i=t.outObject("childs");const r=t.outTrigger("Pressed Trigger");const o=t.inBool("Grey Out",false);const s=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const _=document.createElement("div");_.classList.add("sidebar__button-input");l.appendChild(_);_.addEventListener("click",p);const c=document.createTextNode(a.get());_.appendChild(c);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");n.onChange=d;a.onChange=g;t.onDelete=v;const u=document.createElement("div");u.classList.add("sidebar__greyout");l.appendChild(u);u.style.display="none";o.onChange=function(){u.style.display=o.get()?"block":"none"};s.onChange=function(){l.style.display=s.get()?"block":"none"};function p(){r.trigger()}function g(){const e=a.get();_.textContent=e;if(CABLES.UI){t.setTitle("Button: "+e)}}function d(){i.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(l);i.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function f(e){if(e){e.style.display="block"}}function m(e){if(e){e.style.display="none"}}function v(){h(l)}function h(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.Button_v2.prototype=new CABLES.Op;CABLES.OPS["5e9c6933-0605-4bf7-8671-a016d917f327"]={f:Ops.Sidebar.Button_v2,objName:"Ops.Sidebar.Button_v2"};Ops.Trigger.GateTrigger=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Execute"),a=e.inValueBool("Pass Through",true),i=e.outTrigger("Trigger out");n.onTriggered=function(){if(a.get())i.trigger()}};Ops.Trigger.GateTrigger.prototype=new CABLES.Op;CABLES.OPS["65e8b8a2-ba13-485f-883a-2bcf377989da"]={f:Ops.Trigger.GateTrigger,objName:"Ops.Trigger.GateTrigger"};Ops.Boolean.ToggleBool=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("trigger"),a=e.inTriggerButton("reset"),i=e.outBool("result"),r=e.inBool("Default",false);let o=false;i.set(o);i.ignoreValueSerialize=true;n.onTriggered=function(){o=!o;i.set(o)};a.onTriggered=function(){o=r.get();i.set(o)}};Ops.Boolean.ToggleBool.prototype=new CABLES.Op;CABLES.OPS["712a25f4-3a93-4042-b8c5-2f56169186cc"]={f:Ops.Boolean.ToggleBool,objName:"Ops.Boolean.ToggleBool"};Ops.Gl.TextureEffects.Gradient=function(){CABLES.Op.apply(this,arguments);const e=this;const t={gradient_frag:"IN vec2 texCoord;\nUNI float amount;\nUNI float pos;\nUNI float width;\n\nUNI vec3 colA;\nUNI vec3 colB;\nUNI vec3 colC;\nUNI sampler2D tex;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n    vec4 col;\n    float ax=texCoord.x;\n\n    #ifdef GRAD_Y\n        ax=texCoord.y;\n    #endif\n    #ifdef GRAD_XY\n        ax=(texCoord.x+texCoord.y)/2.0;\n    #endif\n    #ifdef GRAD_RADIAL\n        ax=distance(texCoord,vec2(0.5,0.5))*2.0;\n    #endif\n\n    ax=((ax-0.5)*width)+0.5;\n\n    // ax-=0.03;\n\n    #ifndef GRAD_SMOOTHSTEP\n        if(ax<=pos) col = vec4(mix(colA, colB, ax*1.0/pos),1.0);\n        else col = vec4(mix(colB, colC, min(1.0,(ax-pos)*1.0/(1.0-pos))),1.0);\n    #endif\n\n    #ifdef GRAD_SMOOTHSTEP\n        if(ax<=pos) col = vec4(mix(colA, colB, smoothstep(0.0,1.0,ax*1.0/pos)),1.0);\n        else col = vec4(mix(colB, colC, smoothstep(0.0,1.0,min(1.0,(ax-pos)*1.0/(1.0-pos)))),1.0);\n    #endif\n\n    outColor=cgl_blend(base,col,amount);\n}"};const n=e.inTrigger("Render");const a=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const i=e.inValueSlider("Amount",1);const r=e.inValue("Width",1);const o=e.inSwitch("Type",["X","Y","XY","Radial"],"X");const s=e.inValueSlider("Pos",.5);const l=e.inValueBool("Smoothstep",true);const _=e.inValueSlider("r",Math.random());const c=e.inValueSlider("g",Math.random());const u=e.inValueSlider("b",Math.random());_.setUiAttribs({colorPick:true});const p=e.inValueSlider("r2",Math.random());const g=e.inValueSlider("g2",Math.random());const d=e.inValueSlider("b2",Math.random());p.setUiAttribs({colorPick:true});const f=e.inValueSlider("r3",Math.random());const m=e.inValueSlider("g3",Math.random());const v=e.inValueSlider("b3",Math.random());f.setUiAttribs({colorPick:true});l.onChange=N;e.setPortGroup("Blending",[a,i]);e.setPortGroup("Color A",[_,c,u]);e.setPortGroup("Color B",[p,g,d]);e.setPortGroup("Color C",[f,m,v]);const h=e.inTriggerButton("Randomize");const x=e.outTrigger("Next");const b=e.patch.cgl;const T=new CGL.Shader(b,"gradient");T.setSource(T.getDefaultVertexShader(),t.gradient_frag);const I=new CGL.Uniform(T,"f","amount",i);const A=new CGL.Uniform(T,"f","pos",s);const E=new CGL.Uniform(T,"f","width",r);const y=new CGL.Uniform(T,"t","tex",0);let S,C,O;p.onChange=g.onChange=d.onChange=U;f.onChange=m.onChange=v.onChange=P;_.onChange=c.onChange=u.onChange=L;L();U();P();N();function N(){if(l.get())T.define("GRAD_SMOOTHSTEP");else T.removeDefine("GRAD_SMOOTHSTEP")}o.onChange=function(){T.removeDefine("GRAD_X");T.removeDefine("GRAD_Y");T.removeDefine("GRAD_XY");T.removeDefine("GRAD_RADIAL");if(o.get()=="XY")T.define("GRAD_XY");if(o.get()=="X")T.define("GRAD_X");if(o.get()=="Y")T.define("GRAD_Y");if(o.get()=="Radial")T.define("GRAD_RADIAL")};CGL.TextureEffect.setupBlending(e,T,a,i);h.onTriggered=function(){_.set(Math.random());c.set(Math.random());u.set(Math.random());p.set(Math.random());g.set(Math.random());d.set(Math.random());f.set(Math.random());m.set(Math.random());v.set(Math.random())};function L(){const e=[_.get(),c.get(),u.get()];if(!O)O=new CGL.Uniform(T,"3f","colA",e);else O.setValue(e)}function U(){const e=[p.get(),g.get(),d.get()];if(!C)C=new CGL.Uniform(T,"3f","colB",e);else C.setValue(e)}function P(){const e=[f.get(),m.get(),v.get()];if(!S)S=new CGL.Uniform(T,"3f","colC",e);else S.setValue(e)}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;b.pushShader(T);b.currentTextureEffect.bind();b.setTexture(0,b.currentTextureEffect.getCurrentSourceTexture().tex);b.currentTextureEffect.finish();b.popShader();x.trigger()}};Ops.Gl.TextureEffects.Gradient.prototype=new CABLES.Op;CABLES.OPS["5ada9bd8-227a-4a1f-87ad-0f879c7aa84d"]={f:Ops.Gl.TextureEffects.Gradient,objName:"Ops.Gl.TextureEffects.Gradient"};Ops.Devices.Keyboard.KeyPressLearn=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inValueInt("key code");const a=t.inValueBool("canvas only",true);const i=t.inValueSelect("Mod Key",["none","alt"],"none");const r=t.inValueBool("Enabled",true);const o=t.inValueBool("Prevent Default");const s=t.inTriggerButton("learn");const l=t.outTrigger("on press");const _=t.outTrigger("on release");const c=t.outValue("Pressed",false);const u=t.patch.cgl;let p=false;function g(e){if(p){n.set(e.keyCode);if(CABLES.UI){gui.opParams.show(t)}p=false;m();f()}else{if(e.keyCode==n.get()){if(i.get()=="alt"){if(e.altKey===true){l.trigger();c.set(true);if(o.get())e.preventDefault()}}else{l.trigger();c.set(true);if(o.get())e.preventDefault()}}}}function d(e){if(e.keyCode==n.get()){_.trigger();c.set(false)}}t.onDelete=function(){u.canvas.removeEventListener("keyup",d,false);u.canvas.removeEventListener("keydown",g,false);document.removeEventListener("keyup",d,false);document.removeEventListener("keydown",g,false)};s.onTriggered=function(){p=true;h();setTimeout(function(){p=false;m();f()},3e3)};function f(){if(a.get())v();else h()}function m(){document.removeEventListener("keydown",g,false);document.removeEventListener("keyup",d,false);u.canvas.removeEventListener("keydown",g,false);u.canvas.removeEventListener("keyup",d,false);c.set(false)}function v(){u.canvas.addEventListener("keydown",g,false);u.canvas.addEventListener("keyup",d,false)}function h(){document.addEventListener("keydown",g,false);document.addEventListener("keyup",d,false)}r.onChange=function(){if(!r.get()){m()}else{f()}};a.onChange=function(){m();f()};v()};Ops.Devices.Keyboard.KeyPressLearn.prototype=new CABLES.Op;CABLES.OPS["f069c0db-4051-4eae-989e-6ef7953787fd"]={f:Ops.Devices.Keyboard.KeyPressLearn,objName:"Ops.Devices.Keyboard.KeyPressLearn"};Ops.Value.Number=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("value"),a=e.outNumber("result");n.onChange=i;function i(){a.set(Number(n.get()))}};Ops.Value.Number.prototype=new CABLES.Op;CABLES.OPS["8fb2bb5d-665a-4d0a-8079-12710ae453be"]={f:Ops.Value.Number,objName:"Ops.Value.Number"};Ops.Trigger.SetNumberOnTrigger=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("Set"),a=e.inValueFloat("Number"),i=e.outTrigger("Next"),r=e.outValue("Out Value");r.changeAlways=true;n.onTriggered=function(){r.set(a.get());i.trigger()}};Ops.Trigger.SetNumberOnTrigger.prototype=new CABLES.Op;CABLES.OPS["9989b1c0-1073-4d5f-bfa0-36dd98b66e27"]={f:Ops.Trigger.SetNumberOnTrigger,objName:"Ops.Trigger.SetNumberOnTrigger"};Ops.Gl.TextureEffects.ColorMap=function(){CABLES.Op.apply(this,arguments);const e=this;const t={colormap_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D gradient;\nUNI float pos;\nUNI float amount;\nUNI float vmin;\nUNI float vmax;\n\n{{CGL.BLENDMODES}}\n\n\nfloat lumi(vec3 color)\n{\n   return vec3(dot(vec3(0.2126,0.7152,0.0722), color)).r;\n}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n\n   base=clamp(base,vmin,vmax);\n\n    #ifdef METH_LUMI\n        vec4 color=texture(gradient,vec2(lumi(base.rgb),pos));\n    #endif\n\n    #ifdef METH_CHANNELS\n        vec4 color=vec4(1.0);\n        color.r=texture(gradient,vec2(base.r,pos)).r;\n        color.g=texture(gradient,vec2(base.g,pos)).g;\n        color.b=texture(gradient,vec2(base.b,pos)).b;\n    #endif\n\n//   outColor= vec4(color);\n   outColor=cgl_blend(base,color,amount);\n\n}\n"};let n=e.inTrigger("render");let a=e.outTrigger("trigger");const i=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const r=e.inValueSlider("Amount",1);let o=e.inTexture("Gradient");let s=e.inSwitch("Method",["Luminance","Channels"],"Luminance");let l=e.inFloatSlider("Min",0);let _=e.inFloatSlider("Max",1);let c=e.inValueSlider("Position",.5);let u=e.patch.cgl;let p=new CGL.Shader(u,e.name);p.define("METH_LUMI");p.setSource(p.getDefaultVertexShader(),t.colormap_frag);var g=new CGL.Uniform(p,"t","tex",0);var g=new CGL.Uniform(p,"t","gradient",1);let d=new CGL.Uniform(p,"f","pos",c);let f=new CGL.Uniform(p,"f","vmin",l);let m=new CGL.Uniform(p,"f","vmax",_);let v=new CGL.Uniform(p,"f","amount",r);CGL.TextureEffect.setupBlending(e,p,i,r);s.onChange=()=>{p.toggleDefine("METH_LUMI",s.get()=="Luminance");p.toggleDefine("METH_CHANNELS",s.get()=="Channels")};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;if(!o.get())return;u.pushShader(p);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);u.setTexture(1,o.get().tex);u.currentTextureEffect.finish();u.popShader();a.trigger()}};Ops.Gl.TextureEffects.ColorMap.prototype=new CABLES.Op;CABLES.OPS["58e302d7-4b84-4077-aa13-4f3cf0885205"]={f:Ops.Gl.TextureEffects.ColorMap,objName:"Ops.Gl.TextureEffects.ColorMap"};Ops.Gl.GradientTexture=function(){CABLES.Op.apply(this,arguments);const d=this;const e={};const f=d.inGradient("Gradient"),m=d.inValueSelect("Direction",["X","Y","Radial"],"X"),v=d.inValueBool("Smoothstep",false),h=d.inBool("Step",false),x=d.inBool("Flip",false),b=d.inValueInt("Size",256),T=d.inSwitch("filter",["nearest","linear","mipmap"],"linear"),I=d.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),A=d.inArray("Gradient Array"),E=d.outTexture("Texture");const y=d.patch.cgl;I.onChange=T.onChange=h.onChange=x.onChange=b.onChange=f.onChange=v.onChange=m.onChange=A.onChange=t;f.set('{"keys" : [{"pos":0,"r":0,"g":0,"b":0},{"pos":0.25,"r":0,"g":0,"b":0},{"pos":0.75,"r":1,"g":1,"b":1},{"pos":1,"r":1,"g":1,"b":1}]}');d.onLoaded=t;function t(){let a=Math.round(b.get());if(a<4)a=4;let t=null;d.setUiError("nodata",null);d.setUiError("parse",null);let e=0;let n=0;if(I.get()=="repeat")e=CGL.Texture.WRAP_REPEAT;else if(I.get()=="mirrored repeat")e=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(I.get()=="clamp to edge")e=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(T.get()=="nearest")n=CGL.Texture.FILTER_NEAREST;else if(T.get()=="linear")n=CGL.Texture.FILTER_LINEAR;else if(T.get()=="mipmap")n=CGL.Texture.FILTER_MIPMAP;if(Array.isArray(A.get())){t=A.get()}else{let e=null;if(!f.get()||f.get()===""){d.setUiError("nodata","gradient no data");return}try{e=JSON.parse(f.get())}catch(e){d.setUiError("parse","could not parse gradient data")}if(!e||!e.keys){d.setUiError("nodata","gradient no data");return}t=e.keys}const i=new CGL.Texture(y);if(m.get()=="X"||m.get()=="Y"){const r=new Uint8Array(a*4);for(let e=0;e<t.length-1;e++){const o=t[e];const s=t[e+1];for(let n=o.pos*a;n<s.pos*a;n++){let e=CABLES.map(n,o.pos*a,s.pos*a,0,1);if(h.get())e=Math.round(e);if(v.get())e=CABLES.smoothStep(e);n=Math.round(n);let t=n;if(x.get())t=a-n-1;r[t*4+0]=Math.round((e*s.r+(1-e)*o.r)*255);r[t*4+1]=Math.round((e*s.g+(1-e)*o.g)*255);r[t*4+2]=Math.round((e*s.b+(1-e)*o.b)*255);if(typeof o.a!=="undefined"&&typeof s.a!=="undefined"){const l=Math.round((e*s.a+(1-e)*o.a)*255);r[t*4+3]=l}else{r[t*4+3]=Math.round(255)}}}if(m.get()=="X")i.initFromData(r,a,1,n,e);if(m.get()=="Y")i.initFromData(r,1,a,n,e)}if(m.get()=="Radial"){const r=new Uint8Array(a*a*4);const _=new CABLES.Anim;const c=new CABLES.Anim;const u=new CABLES.Anim;for(let e=0;e<t.length-1;e++){_.setValue(t[e].pos,t[e].r);c.setValue(t[e].pos,t[e].g);u.setValue(t[e].pos,t[e].b)}for(let n=0;n<a;n++){for(let t=0;t<a;t++){const p=n-(a-1)/2;const g=t-(a-1)/2;let e=Math.sqrt(p*p+g*g)/a*2;if(v.get())e=CABLES.smoothStep(e);r[n*4+t*4*a+0]=_.getValue(e)*255;r[n*4+t*4*a+1]=c.getValue(e)*255;r[n*4+t*4*a+2]=u.getValue(e)*255;r[n*4+t*4*a+3]=Math.round(255)}}i.initFromData(r,a,a,n,e)}E.set(null);E.set(i)}};Ops.Gl.GradientTexture.prototype=new CABLES.Op;CABLES.OPS["01380a50-2dbb-4465-ae80-86349b0b717a"]={f:Ops.Gl.GradientTexture,objName:"Ops.Gl.GradientTexture"};Ops.Gl.TextureEffects.Mirror=function(){CABLES.Op.apply(this,arguments);const e=this;const t={mirror_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float axis;\nUNI float width;\nUNI float flip;\nUNI float offset;\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n   float tc=texCoord.x;\n   if(axis==1.0) tc=(texCoord.y);\n\n   float x=(tc);\n   if(tc>=0.5)x=1.0-tc;\n\n   x*=width*2.0;\n   if(flip==1.0)x=1.0-x;\n   x*=1.0-offset;\n\n   if(axis==1.0) col=texture(tex,vec2(texCoord.x,x) );\n       else col=texture(tex,vec2(x,texCoord.y) );\n\n   outColor= col;\n}"};const n=e.inTrigger("render"),a=e.outTrigger("trigger"),i=e.inSwitch("axis",["X","Y"],"X"),r=e.inValueFloat("width",.5),o=e.inValueFloat("offset"),s=e.inValueBool("flip");const l=e.patch.cgl;const _=new CGL.Shader(l,e.name);_.setSource(_.getDefaultVertexShader(),t.mirror_frag);const c=new CGL.Uniform(_,"t","tex",0),u=new CGL.Uniform(_,"f","axis",0),p=new CGL.Uniform(_,"f","width",r),g=new CGL.Uniform(_,"f","offset",o),d=new CGL.Uniform(_,"f","flip",0);s.onChange=function(){if(s.get())d.setValue(1);else d.setValue(0)};i.onChange=function(){if(i.get()=="X")u.setValue(0);else if(i.get()=="Y")u.setValue(1)};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;l.pushShader(_);l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);l.currentTextureEffect.finish();l.popShader();a.trigger()}};Ops.Gl.TextureEffects.Mirror.prototype=new CABLES.Op;CABLES.OPS["10d3c769-9a7f-4bd3-a849-7354d3e5f7f0"]={f:Ops.Gl.TextureEffects.Mirror,objName:"Ops.Gl.TextureEffects.Mirror"};Ops.Gl.TextureEffects.Waveform_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={wave_v2_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D tex1;\nUNI float amount;\n\nUNI float r;\nUNI float g;\nUNI float b;\n\nUNI float uAmp;\nUNI float uFreq;\nUNI float uWidth;\nUNI float uGlow;\nUNI float uWaveSelect;\nUNI bool uInvert;\nUNI bool uSolid;\n\nUNI float uOffSetX;\nUNI float uOffSetY;\nUNI float uRotate;\n\n{{CGL.BLENDMODES}}\n\n#define PI 3.14159265359\n#define TAU (2.0*PI)\n\nfloat vmax(vec2 v)\n{\n\treturn max(v.x, v.y);\n}\n\nvoid pR(inout vec2 p, float a)\n{\n    float s = sin(a),c=cos(a); p *= mat2(c,s,-s,c);\n}\n\nfloat pMod1(inout float p, float size)\n{\n\tfloat halfsize = size * 0.5;\n\tfloat c = floor((p + halfsize) / size);\n\tp = mod(p + halfsize, size) - halfsize;\n\treturn c;\n}\n\nfloat pModMirror1(inout float p, float size)\n{\n\tfloat halfsize = size * 0.5;\n\tfloat c = floor((p + halfsize) / size);\n\tp = mod(p + halfsize,size) - halfsize;\n\tp *= mod(c, 2.0) * 2.0 - 1.0;\n\treturn c;\n}\n\nfloat fCapsule2D(vec2 p, float r, float c)\n{\n\treturn mix(abs(p.x) - r, length(vec2(p.x, abs(p.y) - c)) - r, step(c, abs(p.y)));\n}\n\nfloat SineWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float v = sin(p.x * frequency * PI);\n    v *= amplitude;\n\n    float d = 0.0;\n\n    if (solid == false)\n    {\n        d = abs(v * amplitude - p.y * 0.5);\n        d -= line_width;\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n    {\n        d = v * amplitude - p.y * 0.5;\n        d -= -line_width;\n        return smoothstep(0.0, line_glow, -d);\n    }\n}\n\nfloat SawWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 2.0 / frequency;\n    vec2 p1 = p;\n    pMod1(p1.x, inverse_frequency);\n\n    float d1 = fCapsule2D(p1, 0.0, amplitude);\n    p.x += inverse_frequency * 0.5;\n    pMod1(p.x, inverse_frequency);\n    pR(p, atan(inverse_frequency, amplitude * 2.0));\n\n    float d = fCapsule2D(p, 0.0, 0.5 * length(vec2(inverse_frequency, 2.0 * amplitude)));\n\td = min(d, d1);\n    d -= line_width;\n\n    if(solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, min(d,p.x));\n}\n\nfloat TriangleWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 1.0 / frequency;\n    p.x -= inverse_frequency;\n    pModMirror1(p.x, inverse_frequency);\n    pR(p, atan(inverse_frequency, amplitude * 2.0));\n\n    float d = fCapsule2D(p, 0.0, 0.5 * length(vec2(inverse_frequency, 2.0 * amplitude)));\n    d -= line_width;\n\n    if (solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, min(d,p.x));\n}\n\nfloat SquareWave(vec2 p, float amplitude, float frequency, float line_width, float line_glow, bool solid)\n{\n    float inverse_frequency = 0.5 / frequency;\n    vec2 p1 = p;\n    pMod1(p1.x, 2.0 * inverse_frequency);\n\n    float d1 = fCapsule2D(p1, 0.0, abs(amplitude));\n    p.x -= inverse_frequency * 0.5;\n    float cell = pMod1(p.x, inverse_frequency);\n\n    if(cell < 0.0) cell = -cell + 1.0;\n    if(int(cell * 0.5) % 2 == 1) p.y -= amplitude;\n        else p.y += amplitude;\n\n    float d = fCapsule2D(p.yx, 0.0, abs(inverse_frequency));\n    d = min(d, d1);\n    d -= line_width;\n\n    if (solid == false)\n    {\n        return smoothstep(0.0, line_glow, d);\n    }\n    else\n        return smoothstep(0.0, line_glow, p.y);\n}\n\nvoid main()\n{\n    vec4 rgb = vec4(r,g,b,1.0);\n\tvec2 uv = texCoord;\n\n    uv -= 0.5;\n    pR(uv.xy,uRotate * TAU);\n    uv += 0.5;\n\n    float wave = 0.0;\n    #ifdef SINE\n        wave = 1.0 - SineWave     (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq , uWidth, uGlow, uSolid);\n    #endif\n    #ifdef SAWTOOTH\n        wave = 1.0 - SawWave      (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n    #ifdef TRIANGLE\n        wave = 1.0 - TriangleWave (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n    #ifdef SQUARE\n        wave = 1.0 - SquareWave   (uv - vec2(uOffSetX,uOffSetY), uAmp,  uFreq, uWidth, uGlow, uSolid);\n    #endif\n\n    #ifdef INVERT\n        wave = 1.0-wave;\n    #endif\n\n    vec4 col = vec4(r,g,b,1.0);\n\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blend(base,col,wave*amount);\n}\n"};const n=e.inTrigger("render"),a=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=e.inValueSlider("Amount",1),r=e.inValueSelect("Waveform",["Sine","Sawtooth","Triangle","Square"],"Sine"),o=e.inValueSlider("Amplitude",.5),s=e.inFloat("Frequency",2),l=e.inValueSlider("Line Width",.1),_=e.inValueSlider("Line Glow",.1),c=e.inValueBool("invert color",false),u=e.inValueBool("Solid fill",false),p=e.inValueSlider("Offset X",0),g=e.inValueSlider("Offset Y",.5),d=e.inValueSlider("Rotate",0),f=e.inValueSlider("r",1),m=e.inValueSlider("g",1),v=e.inValueSlider("b",1);const h=e.outTrigger("trigger");f.setUiAttribs({colorPick:true});const x=e.patch.cgl;const b=new CGL.Shader(x,e.name);b.setSource(b.getDefaultVertexShader(),t.wave_v2_frag);const T=new CGL.Uniform(b,"t","tex",0);const I=new CGL.Uniform(b,"f","amount",i);const A=new CGL.Uniform(b,"f","r",f);const E=new CGL.Uniform(b,"f","g",m);const y=new CGL.Uniform(b,"f","b",v);const S=new CGL.Uniform(b,"f","uAmp",o);const C=new CGL.Uniform(b,"f","uFreq",s);const O=new CGL.Uniform(b,"f","uWidth",l);const N=new CGL.Uniform(b,"f","uGlow",_);const L=new CGL.Uniform(b,"f","uWaveSelect",1);const U=new CGL.Uniform(b,"b","uInvert",c);const P=new CGL.Uniform(b,"b","uSolid",u);const R=new CGL.Uniform(b,"f","uOffSetX",p);const M=new CGL.Uniform(b,"f","uOffSetY",g);const G=new CGL.Uniform(b,"f","uRotate",d);r.onChange=c.onChange=w;w();function w(){b.toggleDefine("SINE",r.get()=="Sine");b.toggleDefine("SAWTOOTH",r.get()=="Sawtooth");b.toggleDefine("TRIANGLE",r.get()=="Triangle");b.toggleDefine("SQUARE",r.get()=="Square");b.toggleDefine("INVERT",c.get()==true)}CGL.TextureEffect.setupBlending(e,b,a,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;x.pushShader(b);x.currentTextureEffect.bind();x.setTexture(0,x.currentTextureEffect.getCurrentSourceTexture().tex);x.currentTextureEffect.finish();x.popShader();h.trigger()}};Ops.Gl.TextureEffects.Waveform_v2.prototype=new CABLES.Op;CABLES.OPS["46c786f1-3d60-4fa4-9c89-e785db4ac692"]={f:Ops.Gl.TextureEffects.Waveform_v2,objName:"Ops.Gl.TextureEffects.Waveform_v2"};Ops.Gl.TextureEffects.Twirl_v3=function(){CABLES.Op.apply(this,arguments);const t=this;const e={twirl_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float twistAmount;\nUNI float times;\nUNI float radius;\nUNI float centerX;\nUNI float centerY;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    vec2 center=vec2(centerX,centerY);\n    vec2 tc = texCoord;\n    tc -= center;\n    float dist = length(tc);\n    if (dist < radius)\n    {\n        float percent = (radius - dist) / radius;\n        float theta = percent * percent * twistAmount * 8.0;\n        float s = sin(theta);\n        float c = cos(theta);\n        tc = vec2(dot(tc, vec2(c, -s)), dot(tc, vec2(s, c)));\n    }\n    tc += center;\n\n    vec4 col = texture(tex, tc);\n    vec4 base=texture(tex,texCoord);\n    outColor=cgl_blend(base,col,amount);\n}\n"};const n=t.inTrigger("Render"),a=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),i=t.inValueSlider("Amount",1),r=t.inValue("Twist amount",200),o=t.inValue("Radius",.5),s=t.inValue("Center X",.5),l=t.inValue("Center Y",.5),_=t.outTrigger("Next");const c=t.patch.cgl;const u=new CGL.Shader(c,t.name);u.setSource(u.getDefaultVertexShader(),e.twirl_frag);const p=new CGL.Uniform(u,"t","tex",0),g=new CGL.Uniform(u,"f","amount",i),d=new CGL.Uniform(u,"f","twistAmount",1),f=new CGL.Uniform(u,"f","radius",o),m=new CGL.Uniform(u,"f","centerX",s),v=new CGL.Uniform(u,"f","centerY",l);CGL.TextureEffect.setupBlending(t,u,a,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t))return;let e=c.currentTextureEffect.getCurrentSourceTexture();d.setValue(r.get()*(1/e.width));c.pushShader(u);c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.currentTextureEffect.finish();c.popShader();_.trigger()}};Ops.Gl.TextureEffects.Twirl_v3.prototype=new CABLES.Op;CABLES.OPS["5c128ea4-14df-4248-a02e-b05d2783ed58"]={f:Ops.Gl.TextureEffects.Twirl_v3,objName:"Ops.Gl.TextureEffects.Twirl_v3"};Ops.Trigger.TriggerSend=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.inTriggerButton("Trigger");a.varName=a.inValueSelect("Named Trigger",[],"",true);a.varName.onChange=i;t.onTriggered=r;a.patch.addEventListener("namedTriggersChanged",n);n();function n(){if(CABLES.UI){const e=[];const t=a.patch.namedTriggers;e.push("+ create new one");for(const n in t)e.push(n);a.varName.uiAttribs.values=e}}function i(){if(CABLES.UI){if(a.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"enter a name for the new trigger",promptValue:"",promptOk:e=>{a.varName.set(e);a.patch.namedTriggers[e]=a.patch.namedTriggers[e]||[];n()}});return}if(a.isCurrentUiOp())gui.opParams.show(a)}if(!a.patch.namedTriggers[a.varName.get()]){a.patch.namedTriggers[a.varName.get()]=a.patch.namedTriggers[a.varName.get()]||[];a.patch.emitEvent("namedTriggersChanged")}a.setTitle(">"+a.varName.get());if(a.isCurrentUiOp())gui.opParams.show(a)}function r(){const t=a.patch.namedTriggers[a.varName.get()];a.patch.emitEvent("namedTriggerSent",a.varName.get());if(!t){a.setUiError("unknowntrigger","unknown trigger");a.logError("unknown trigger array!",a.varName.get());return}else a.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}}};Ops.Trigger.TriggerSend.prototype=new CABLES.Op;CABLES.OPS["ce1eaf2b-943b-4dc0-ab5e-ee11b63c9ed0"]={f:Ops.Trigger.TriggerSend,objName:"Ops.Trigger.TriggerSend"};Ops.Trigger.TriggerReceive=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.outTrigger("Triggered");a.varName=a.inValueSelect("Named Trigger",[],"",true);r();a.patch.addEventListener("namedTriggersChanged",r);let n=null;function i(){t.trigger()}function r(){if(CABLES.UI){let t=[];let n=a.patch.namedTriggers;for(let e in n)t.push(e);a.varName.uiAttribs.values=t}}a.varName.onChange=function(){if(n){let e=a.patch.namedTriggers[n];let t=e.indexOf(i);if(t!=-1)e.splice(t,1)}a.setTitle(">"+a.varName.get());a.patch.namedTriggers[a.varName.get()]=a.patch.namedTriggers[a.varName.get()]||[];let e=a.patch.namedTriggers[a.varName.get()];e.push(i);n=a.varName.get();o()};a.on("uiParamPanel",o);function o(){if(!a.varName.get()){a.setUiError("unknowntrigger","unknown trigger")}else a.setUiError("unknowntrigger",null)}};Ops.Trigger.TriggerReceive.prototype=new CABLES.Op;CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Gl.TextureEffects.RepeatTexture=function(){CABLES.Op.apply(this,arguments);const e=this;const t={repeat_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D mulTex;\nUNI float amount;\nUNI float amountX;\nUNI float amountY;\n\n{{CGL.BLENDMODES}}\n\nvoid main()\n{\n    float am=amount;\n\n    float mul=1.0;\n\n    #ifdef HAS_MASK\n        mul=texture(mulTex,texCoord).r;\n    #endif\n\n    vec2 coord = vec2(\n        mod(texCoord.x*amountX*mul,1.0),\n        mod(texCoord.y*amountY*mul,1.0));\n\n    vec4 col=texture(tex,coord);\n    vec4 base=texture(tex,texCoord);\n\n\n\n    outColor=cgl_blend(base,col,am);\n}"};const n=e.inTrigger("render");const a=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const i=e.inValueSlider("Amount",1);const r=e.inValue("x",3);const o=e.inValue("y",3);const s=e.outTrigger("trigger");const l=e.inTexture("Multiply");const _=e.patch.cgl;const c=new CGL.Shader(_,e.name);c.setSource(c.getDefaultVertexShader(),t.repeat_frag);const u=new CGL.Uniform(c,"t","tex",0);const p=new CGL.Uniform(c,"t","mulTex",2);const g=new CGL.Uniform(c,"f","amount",i);const d=new CGL.Uniform(c,"f","amountX",r);const f=new CGL.Uniform(c,"f","amountY",o);CGL.TextureEffect.setupBlending(e,c,a,i);l.onChange=()=>{c.toggleDefine("HAS_MASK",l.get())};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;_.pushShader(c);_.currentTextureEffect.bind();_.setTexture(0,_.currentTextureEffect.getCurrentSourceTexture().tex);if(l.get())_.setTexture(2,l.get().tex);_.currentTextureEffect.finish();_.popShader();s.trigger()}};Ops.Gl.TextureEffects.RepeatTexture.prototype=new CABLES.Op;CABLES.OPS["f477746c-2699-4da5-9786-04867aeae8a6"]={f:Ops.Gl.TextureEffects.RepeatTexture,objName:"Ops.Gl.TextureEffects.RepeatTexture"};Ops.Gl.TextureEffects.Shapes2d=function(){CABLES.Op.apply(this,arguments);const e=this;const t={shapes_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float aspect;\n\nUNI bool mirrorX;\nUNI bool mirrorY;\n\nUNI float xPos;\nUNI float yPos;\n\nUNI bool invertColor;\nUNI bool fillShape;\n\nUNI float width;\nUNI float height;\nUNI float lineThickness;\n\nUNI float rotate;\n\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\n\n{{CGL.BLENDMODES}}\n\n#define PI 3.14159265\n#define TAU (2.0*PI)\n\nvoid pR(inout vec2 p, float a)\n{\n\tp = cos(a)*p + sin(a)*vec2(p.y, -p.x);\n}\n\nfloat sdCircle( vec2 p, float r )\n{\n  return length(p) - r;\n}\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdEquilateralTriangle( in vec2 p , in float size )\n{\n    const float k = sqrt(3.0);\n    p/= vec2(size);\n    p.x = abs(p.x) - 1.0;\n    p.y = -p.y + 1.0/k;\n    if( p.x + k*p.y > 0.0 ) p = vec2( p.x - k*p.y, -k*p.x - p.y )/2.0;\n    p.x -= clamp( p.x, -2.0, 0.0 );\n    return (-length(p)*sign(p.y))*size;\n}\n\nfloat sdTriangleIsosceles( in vec2 p, in vec2 q )\n{\n\n    p.y +=0.5;\n    p.x = abs(p.x);\n\n    vec2 a = p - q*clamp( dot(p,q)/dot(q,q), 0.0, 1.0 );\n    vec2 b = p - q*vec2( clamp( p.x/q.x, 0.0, 1.0 ), 1.0 );\n    float s = -sign( q.y );\n    vec2 d = min( vec2( dot(a,a), s*(p.x*q.y-p.y*q.x) ),\n                  vec2( dot(b,b), s*(p.y-q.y)  ));\n\n    return -sqrt(d.x)*sign(d.y);\n}\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdRhombus( in vec2 p, in vec2 b )\n{\n    vec2 q = abs(p);\n    float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n    float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n    return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdPentagon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n    p.x = abs(p.x);\n    p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n    p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n    p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdHexagon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(-0.866025404,0.5,0.577350269);\n    p = abs(p);\n    p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdOctogon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n    p = abs(p);\n    p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n    p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdHexagram( in vec2 p, in float r )\n{\n    const vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n    p = abs(p);\n    p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n    p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n    return length(p)*sign(p.y);\n}\n\nvoid main()\n{\n    vec2 p = texCoord-0.5;\n    p.y/=aspect;\n\n    p *= 2.0;\n\n    float d =0.0;\n\n    if(mirrorX)p.x = abs(p.x);\n    if(mirrorY)p.y = abs(p.y);\n\n    p -= vec2(xPos,yPos);\n\n    pR(p,rotate * (TAU) + PI);\n\n    #ifdef IS_CIRCLE\n\n        d = sdCircle(p,width);\n    #endif\n\n    #ifdef IS_EQUI_TRIANGLE\n        d = sdEquilateralTriangle(p,width);\n    #endif\n\n    #ifdef IS_ISO_TRIANGLE\n        d = sdTriangleIsosceles(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_BOX\n        d = sdBox(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_RHOMBUS\n        d = sdRhombus(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_PENTAGON\n        d = sdPentagon(p,width);\n    #endif\n\n    #ifdef IS_HEXAGON\n        d = sdHexagon(p,width);\n    #endif\n\n    #ifdef IS_OCTOGON\n        d = sdOctogon(p,width);\n    #endif\n\n    #ifdef IS_HEXAGRAM\n        d = sdHexagram(p*2.0,width);\n    #endif\n\n    if (fillShape == false)\n    {\n        d = abs(d)-abs(lineThickness*0.01);\n    }\n    if(invertColor)\n    {\n        d = sign(d);\n    }\n    else\n    {\n        d = 1.0 - sign(d);\n    }\n\n    d = clamp(d,0.0,1.0);\n\n    //blend section\n    vec4 col = vec4(vec4(r,g,b,a)) ;\n    //original texture\n    vec4 base = texture(tex,texCoord);\n    //blend stuff\n    outColor = cgl_blend(base,col,d*amount);\n    // outColor.rgb=vec3(d);\n}\n\n\n"};const n=e.inTrigger("render");const a=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const i=e.inValueSlider("Amount",1);const r=e.inValueSelect("Shape",["circle","eqi triangle","iso triangle","box","rhombus","pentagon","hexagon","octogon","hexagram"],"circle");const o=e.inValueBool("Mirror X",false);const s=e.inValueBool("Mirror Y",false);const l=e.inValueFloat("Offset X",0);const _=e.inValueFloat("Offset Y",0);const c=e.inValueBool("fillShape",true);const u=e.inValue("Line thickness",1);const p=e.inValueBool("Invert color",false);const g=e.inValue("width",.5);const d=e.inValue("height",.5);const f=e.inValueSlider("Rotate",0);const m=e.inValueSlider("r",Math.random()),v=e.inValueSlider("g",Math.random()),h=e.inValueSlider("b",Math.random()),x=e.inValueSlider("a",1);m.setUiAttribs({colorPick:true});const b=e.outTrigger("trigger");let T=0;function I(){let e=r.get();if(e==="circle"||e==="eqi triangle"||e==="pentagon"||e==="hexagon"||e==="octogon"||e==="hexagram")T=0;else if(e==="box"||e==="iso triangle"||e==="rhombus")T=1;if(T===0){d.setUiAttribs({greyout:true});g.setUiAttribs({title:"Size"})}else if(T===1){d.setUiAttribs({greyout:false});g.setUiAttribs({title:"Width"})}}c.onChange=function(){u.setUiAttribs({greyout:c.get()})};e.init=r.onChange=function(){I();E.toggleDefine("IS_CIRCLE",r.get());E.toggleDefine("IS_EQUI_TRIANGLE",r.get()==="eqi triangle");E.toggleDefine("IS_ISO_TRIANGLE",r.get()==="iso triangle");E.toggleDefine("IS_BOX",r.get()==="box");E.toggleDefine("IS_RHOMBUS",r.get()==="rhombus");E.toggleDefine("IS_PENTAGON",r.get()==="pentagon");E.toggleDefine("IS_HEXAGON",r.get()==="hexagon");E.toggleDefine("IS_OCTOGON",r.get()==="octogon");E.toggleDefine("IS_HEXAGRAM",r.get()==="hexagram")};const A=e.patch.cgl;const E=new CGL.Shader(A,e.name);E.setSource(E.getDefaultVertexShader(),t.shapes_frag);const y=new CGL.Uniform(E,"t","tex",0);const S=new CGL.Uniform(E,"f","amount",i);const C=new CGL.Uniform(E,"b","mirrorX",o);const O=new CGL.Uniform(E,"b","mirrorY",s);const N=new CGL.Uniform(E,"f","xPos",l);const L=new CGL.Uniform(E,"f","yPos",_);const U=new CGL.Uniform(E,"b","invertColor",p);const P=new CGL.Uniform(E,"b","fillShape",c);const R=new CGL.Uniform(E,"f","width",g);const M=new CGL.Uniform(E,"f","height",d);const G=new CGL.Uniform(E,"f","lineThickness",u);const w=new CGL.Uniform(E,"f","rotate",f);let V=new CGL.Uniform(E,"f","r",m);let D=new CGL.Uniform(E,"f","g",v);let B=new CGL.Uniform(E,"f","b",h);let k=new CGL.Uniform(E,"f","a",x);let F=new CGL.Uniform(E,"f","aspect",1);CGL.TextureEffect.setupBlending(e,E,a,i);n.onTriggered=j;function j(){if(!CGL.TextureEffect.checkOpInEffect(e))return;A.pushShader(E);A.currentTextureEffect.bind();P.setValue(c.get());F.setValue(A.currentTextureEffect.getCurrentSourceTexture().width/A.currentTextureEffect.getCurrentSourceTexture().height);A.setTexture(0,A.currentTextureEffect.getCurrentSourceTexture().tex);A.currentTextureEffect.finish();A.popShader();b.trigger()}};Ops.Gl.TextureEffects.Shapes2d.prototype=new CABLES.Op;CABLES.OPS["5858bc92-3af6-45ad-8c3c-496880249b80"]={f:Ops.Gl.TextureEffects.Shapes2d,objName:"Ops.Gl.TextureEffects.Shapes2d"};Ops.Gl.TextureEffects.PolarCoords=function(){CABLES.Op.apply(this,arguments);const e=this;const t={polarcoords_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float inner;\nUNI float outer;\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    vec2 x = texCoord - vec2(0.5);\n    float radius = length(x);\n    float angle = atan(x.y, x.x);\n\n    vec2 tc;\n    tc.s = ( radius - inner) / (outer - inner);\n    tc.t = angle * 0.5 / 3.141592653589793 + 0.5;\n\n    #ifdef CROP_IMAGE\n        if(tc.s<0.0 || tc.t<0.0 || tc.s>1.0 || tc.t>1.0) discard;\n    #endif\n\n    col=texture(tex,tc);\n    outColor= col;\n}\n"};const n=e.inTrigger("render"),a=e.inValueSlider("Radius Inner",0),i=e.inValueSlider("Radius Outer",1),r=e.inValueBool("Crop",false),o=e.outTrigger("trigger"),s=e.patch.cgl;const l=new CGL.Shader(s,e.name);l.setSource(l.getDefaultVertexShader(),t.polarcoords_frag);const _=new CGL.Uniform(l,"t","tex",0),c=new CGL.Uniform(l,"f","inner",a),u=new CGL.Uniform(l,"f","outer",i);r.onChange=p;function p(){if(r.get())l.define("CROP_IMAGE");else l.removeDefine("CROP_IMAGE")}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;s.pushShader(l);s.currentTextureEffect.bind();s.setTexture(0,s.currentTextureEffect.getCurrentSourceTexture().tex);s.currentTextureEffect.finish();s.popShader();o.trigger()}};Ops.Gl.TextureEffects.PolarCoords.prototype=new CABLES.Op;CABLES.OPS["1555fefe-4eb4-4aed-84c0-ad54e0dae1c1"]={f:Ops.Gl.TextureEffects.PolarCoords,objName:"Ops.Gl.TextureEffects.PolarCoords"};Ops.Anim.SineAnim=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inTrigger("exe"),a=t.outTrigger("Trigger out"),i=t.outValue("result"),r=t.inSwitch("Mode",["Sine","Cosine"],"Sine"),o=t.inValueFloat("phase",0),s=t.inValueFloat("frequency",1),l=t.inValueFloat("amplitude",1);var _=0;const c=0;const u=1;t.toWorkPortsNeedToBeLinked(n);g();p();function p(){var e=r.get();if(e==="Sine")_=c;else if(e==="Cosine")_=u;t.setUiAttrib({extendTitle:e});g()}function g(){if(_==c)i.set(l.get()*Math.sin(t.patch.freeTimer.get()*s.get()+o.get()));else i.set(l.get()*Math.cos(t.patch.freeTimer.get()*s.get()+o.get()));a.trigger()}n.onTriggered=g;r.onChange=p};Ops.Anim.SineAnim.prototype=new CABLES.Op;CABLES.OPS["736d3d0e-c920-449e-ade0-f5ca6018fb5c"]={f:Ops.Anim.SineAnim,objName:"Ops.Anim.SineAnim"};Ops.Math.Abs=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValue("number");const a=e.outValue("result");n.onChange=function(){a.set(Math.abs(n.get()))}};Ops.Math.Abs.prototype=new CABLES.Op;CABLES.OPS["6b5af21d-065f-44d2-9442-8b7a254753f6"]={f:Ops.Math.Abs,objName:"Ops.Math.Abs"};Ops.Math.Sine=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};let n=e.inValue("value");let a=e.inValue("phase",0);let i=e.inValue("frequency",1);let r=e.inValue("amplitude",1);let o=e.inValueBool("asine",false);let s=e.outValue("result");let l=Math.sin;a.onChange=n.onChange=function(){s.set(r.get()*l(n.get()*i.get()+a.get()))};o.onChange=function(){if(o.get())l=Math.asin;else l=Math.sin}};Ops.Math.Sine.prototype=new CABLES.Op;CABLES.OPS["d24da018-9f3d-428b-85c9-6ff14d77548b"]={f:Ops.Math.Sine,objName:"Ops.Math.Sine"};Ops.Gl.TextureEffects.Noise.FBMNoise=function(){CABLES.Op.apply(this,arguments);const e=this;const t={fbmnoise_frag:"UNI sampler2D tex;\nUNI float anim;\n\nUNI float scale;\nUNI float repeat;\n\nUNI float scrollX;\nUNI float scrollY;\n\nUNI float amount;\n\nUNI bool layer1;\nUNI bool layer2;\nUNI bool layer3;\nUNI bool layer4;\nUNI vec3 color;\nUNI float aspect;\n\nIN vec2 texCoord;\n\n\n{{CGL.BLENDMODES}}\n\n// csdcsdcds\n// adapted from warp shader by inigo quilez/iq\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n// See here for a tutorial on how to make this: http://www.iquilezles.org/www/articles/warp/warp.htm\n\nconst mat2 m = mat2( 0.80,  0.60, -0.60,  0.80 );\n\nfloat noise( in vec2 x )\n{\n\treturn sin(1.5*x.x)*sin(1.5*x.y);\n}\n\nfloat fbm4( vec2 p )\n{\n    float f = 0.0;\n    f += 0.5000*noise( p ); p = m*p*2.02;\n    f += 0.2500*noise( p ); p = m*p*2.03;\n    f += 0.1250*noise( p ); p = m*p*2.01;\n    f += 0.0625*noise( p );\n    return f/0.9375;\n}\n\nfloat fbm6( vec2 p )\n{\n    float f = 0.0;\n    f += 0.500000*(0.5+0.5*noise( p )); p = m*p*2.02;\n    f += 0.250000*(0.5+0.5*noise( p )); p = m*p*2.03;\n    f += 0.125000*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.062500*(0.5+0.5*noise( p )); p = m*p*2.04;\n    f += 0.031250*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.015625*(0.5+0.5*noise( p ));\n    return f/0.96875;\n}\n\nvoid main()\n{\n    // vec4 col=texture(tex,texCoord+2.0*fbm4(texCoord+2.0*fbm6(texCoord+anim)));\n\n    vec2 tc=texCoord;\n\t#ifdef DO_TILEABLE\n\t    tc=abs(texCoord-0.5);\n\t#endif\n\n\n    vec2 p=(tc-0.5)*scale;\n\n\n    p.y/=aspect;\n    vec2 q = vec2( fbm4( p + vec2(0.3+scrollX,0.20+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q2 = vec2( fbm4( p + vec2(2.0+scrollX,1.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q3 = vec2( fbm4( p + vec2(9.0+scrollX,4.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,4.3+scrollY) ) );\n\n\n\n    float v= fbm4( ( p + 4.0*q +anim*0.1)*repeat);\n    float v2= fbm4( (p + 4.0*q2 +anim*0.1)*repeat );\n\n    float v3= fbm6( (p + 4.0*q3 +anim*0.1)*repeat );\n    float v4= fbm6( (p + 4.0*q2 +anim*0.1)*repeat );\n\n\n\n\n    vec4 base=texture(tex,texCoord);\n\n    vec4 finalColor;\n    float colVal=0.0;\n    float numLayers=0.0;\n\n    if(layer1)\n    {\n        colVal+=v;\n        numLayers++;\n    }\n\n    if(layer2)\n    {\n        colVal+=v2;\n        numLayers++;\n    }\n\n    if(layer3)\n    {\n        colVal+=v3;\n        numLayers++;\n    }\n\n    if(layer4)\n    {\n        colVal+=v4;\n        numLayers++;\n    }\n\n    finalColor=vec4( color*vec3(colVal/numLayers),1.0);\n\n\n    outColor = cgl_blend(base,finalColor,amount);;\n\n}\n"};const n=e.inTrigger("render"),a=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=e.inValueSlider("Amount",1),r=e.inValueSlider("r",1),o=e.inValueSlider("g",1),s=e.inValueSlider("b",1),l=e.outTrigger("trigger");r.setUiAttribs({colorPick:true});const _=e.patch.cgl;const c=new CGL.Shader(_,"fbmnoise");c.setSource(c.getDefaultVertexShader(),t.fbmnoise_frag);const u=new CGL.Uniform(c,"t","tex",0);const p=new CGL.Uniform(c,"f","scale",e.inValue("scale",2));const g=new CGL.Uniform(c,"f","anim",e.inValue("anim",0));const d=new CGL.Uniform(c,"f","scrollX",e.inValue("scrollX",9));const f=new CGL.Uniform(c,"f","scrollY",e.inValue("scrollY",0));const m=new CGL.Uniform(c,"f","repeat",e.inValue("repeat",1));const v=new CGL.Uniform(c,"f","aspect",e.inValue("aspect",1));const h=new CGL.Uniform(c,"b","layer1",e.inValueBool("Layer 1",true));const x=new CGL.Uniform(c,"b","layer2",e.inValueBool("Layer 2",true));const b=new CGL.Uniform(c,"b","layer3",e.inValueBool("Layer 3",true));const T=new CGL.Uniform(c,"b","layer4",e.inValueBool("Layer 4",true));const I=new CGL.Uniform(c,"3f","color",r,o,s);const A=new CGL.Uniform(c,"f","amount",i);const E=e.inValueBool("Tileable",false);E.onChange=y;function y(){if(E.get())c.define("DO_TILEABLE");else c.removeDefine("DO_TILEABLE")}CGL.TextureEffect.setupBlending(e,c,a,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;_.pushShader(c);_.currentTextureEffect.bind();v.set(_.currentTextureEffect.getCurrentSourceTexture().width/_.currentTextureEffect.getCurrentSourceTexture().height);_.setTexture(0,_.currentTextureEffect.getCurrentSourceTexture().tex);_.currentTextureEffect.finish();_.popShader();l.trigger()}};Ops.Gl.TextureEffects.Noise.FBMNoise.prototype=new CABLES.Op;CABLES.OPS["7073186c-b776-48c2-a01e-041df88ad88a"]={f:Ops.Gl.TextureEffects.Noise.FBMNoise,objName:"Ops.Gl.TextureEffects.Noise.FBMNoise"};Ops.Gl.Phong.PhongMaterial_v6=function(){CABLES.Op.apply(this,arguments);const e=this;const s={phong_frag:'IN vec3 viewDirection;\nIN vec3 normInterpolated;\nIN vec2 texCoord;\n\n#ifdef ENABLE_FRESNEL\n    IN vec4 cameraSpace_pos;\n#endif\n\n// IN mat3 normalMatrix; // when instancing...\n\n#ifdef HAS_TEXTURE_NORMAL\n    IN mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\nIN vec3 fragPos;\nIN vec3 v_viewDirection;\n\nUNI vec4 inDiffuseColor;\nUNI vec4 inMaterialProperties;\n\n#ifdef ADD_EMISSIVE_COLOR\n    UNI vec4 inEmissiveColor; // .w = intensity\n#endif\n\n#ifdef ENABLE_FRESNEL\n    UNI mat4 viewMatrix;\n    UNI vec4 inFresnel;\n    UNI vec2 inFresnelWidthExponent;\n#endif\n\n#ifdef ENVMAP_MATCAP\n    IN vec3 viewSpaceNormal;\n    IN vec3 viewSpacePosition;\n#endif\n\nstruct Light {\n    vec3 color;\n    vec3 position;\n    vec3 specular;\n\n\n    // * SPOT LIGHT * //\n    #ifdef HAS_SPOT\n        vec3 conePointAt;\n        #define COSCONEANGLE x\n        #define COSCONEANGLEINNER y\n        #define SPOTEXPONENT z\n        vec3 spotProperties;\n    #endif\n\n    #define INTENSITY x\n    #define ATTENUATION y\n    #define FALLOFF z\n    #define RADIUS w\n    vec4 lightProperties;\n\n    int castLight;\n};\n\n/* CONSTANTS */\n#define NONE -1\n#define ALBEDO x\n#define ROUGHNESS y\n#define SHININESS z\n#define SPECULAR_AMT w\n#define NORMAL x\n#define AO y\n#define SPECULAR z\n#define EMISSIVE w\nconst float PI = 3.1415926535897932384626433832795;\nconst float TWO_PI = (2. * PI);\nconst float EIGHT_PI = (8. * PI);\n\n#define RECIPROCAL_PI 1./PI\n#define RECIPROCAL_PI2 RECIPROCAL_PI/2.\n\n// TEXTURES\n// #ifdef HAS_TEXTURES\n    UNI vec4 inTextureIntensities;\n\n    #ifdef HAS_TEXTURE_ENV\n        #ifdef TEX_FORMAT_CUBEMAP\n            UNI samplerCube texEnv;\n            #ifndef WEBGL1\n                #define SAMPLETEX textureLod\n            #endif\n            #ifdef WEBGL1\n                #define SAMPLETEX textureCubeLodEXT\n            #endif\n        #endif\n\n        #ifdef TEX_FORMAT_EQUIRECT\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n            #define SAMPLETEX sampleEquirect\n\n            const vec2 invAtan = vec2(0.1591, 0.3183);\n            vec4 sampleEquirect(sampler2D tex,vec3 direction,float lod)\n            {\n                #ifndef WEBGL1\n                    vec3 newDirection = normalize(direction);\n            \t\tvec2 sampleUV;\n            \t\tsampleUV.x = -1. * (atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.75);\n            \t\tsampleUV.y = asin( clamp(direction.y, -1., 1.) ) * RECIPROCAL_PI + 0.5;\n                #endif\n\n                #ifdef WEBGL1\n                    vec3 newDirection = normalize(direction);\n                \t\tvec2 sampleUV = vec2(atan(newDirection.z, newDirection.x), asin(newDirection.y+1e-6));\n                        sampleUV *= vec2(0.1591, 0.3183);\n                        sampleUV += 0.5;\n                #endif\n                return textureLod(tex, sampleUV, lod);\n            }\n        #endif\n        #ifdef ENVMAP_MATCAP\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n\n            // * taken & modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/meshmatcap_frag.glsl.js\n            vec2 getMatCapUV(vec3 viewSpacePosition, vec3 viewSpaceNormal) {\n                vec3 viewDir = normalize(-viewSpacePosition);\n            \tvec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\n            \tvec3 y = normalize(cross(viewDir, x));\n            \tvec2 uv = vec2(dot(x, viewSpaceNormal), dot(y, viewSpaceNormal)) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n            \treturn uv;\n            }\n        #endif\n\n        UNI float inEnvMapIntensity;\n        UNI float inEnvMapWidth;\n    #endif\n\n    #ifdef HAS_TEXTURE_LUMINANCE_MASK\n        UNI sampler2D texLuminance;\n        UNI float inLuminanceMaskIntensity;\n    #endif\n\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D texDiffuse;\n    #endif\n\n    #ifdef HAS_TEXTURE_SPECULAR\n        UNI sampler2D texSpecular;\n    #endif\n\n    #ifdef HAS_TEXTURE_NORMAL\n        UNI sampler2D texNormal;\n    #endif\n\n    #ifdef HAS_TEXTURE_AO\n        UNI sampler2D texAO;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE\n        UNI sampler2D texEmissive;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE_MASK\n        UNI sampler2D texMaskEmissive;\n        UNI float inEmissiveMaskIntensity;\n    #endif\n    #ifdef HAS_TEXTURE_ALPHA\n        UNI sampler2D texAlpha;\n    #endif\n// #endif\n\n{{MODULES_HEAD}}\n\nfloat when_gt(float x, float y) { return max(sign(x - y), 0.0); } // comparator function\nfloat when_lt(float x, float y) { return max(sign(y - x), 0.0); }\nfloat when_eq(float x, float y) { return 1. - abs(sign(x - y)); } // comparator function\nfloat when_neq(float x, float y) { return abs(sign(x - y)); } // comparator function\nfloat when_ge(float x, float y) { return 1.0 - when_lt(x, y); }\nfloat when_le(float x, float y) { return 1.0 - when_gt(x, y); }\n\n#ifdef FALLOFF_MODE_A\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // * original falloff\n        float denom = distance / radius + 1.0;\n        float attenuation = 1.0 / (denom*denom);\n        float t = (attenuation - falloff) / (1.0 - falloff);\n        return max(t, 0.0);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_B\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        float distanceSquared = dot(lightDirection, lightDirection);\n        float factor = distanceSquared * falloff;\n        float smoothFactor = clamp(1. - factor * factor, 0., 1.);\n        float attenuation = smoothFactor * smoothFactor;\n\n        return attenuation * 1. / max(distanceSquared, 0.00001);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_C\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\n        float falloffNumerator = 1. - pow(distance/radius, 4.);\n        falloffNumerator = clamp(falloffNumerator, 0., 1.);\n        falloffNumerator *= falloffNumerator;\n\n        float denominator = distance*distance + falloff;\n\n        return falloffNumerator/denominator;\n    }\n#endif\n\n#ifdef FALLOFF_MODE_D\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // inverse square falloff, "physically correct"\n        return 1.0 / max(distance * distance, 0.0001);\n    }\n#endif\n\n#ifdef ENABLE_FRESNEL\n    float CalculateFresnel(vec3 direction, vec3 normal)\n    {\n        vec3 nDirection = normalize( direction );\n        vec3 nNormal = normalize( mat3(viewMatrix) * normal );\n        vec3 halfDirection = normalize( nNormal + nDirection );\n\n        float cosine = dot( halfDirection, nDirection );\n        float product = max( cosine, 0.0 );\n        float factor = pow(product, inFresnelWidthExponent.y);\n\n        return 5. * factor;\n    }\n#endif\n\n#ifdef CONSERVE_ENERGY\n    // http://www.rorydriscoll.com/2009/01/25/energy-conservation-in-games/\n    // http://www.farbrausch.de/~fg/articles/phong.pdf\n    float EnergyConservation(float shininess) {\n        #ifdef SPECULAR_PHONG\n            return (shininess + 2.)/TWO_PI;\n        #endif\n        #ifdef SPECULAR_BLINN\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_SCHLICK\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_GAUSS\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n    }\n#endif\n\n#ifdef ENABLE_OREN_NAYAR_DIFFUSE\n    float CalculateOrenNayar(vec3 lightDirection, vec3 viewDirection, vec3 normal) {\n        float LdotV = dot(lightDirection, viewDirection);\n        float NdotL = dot(lightDirection, normal);\n        float NdotV = dot(normal, viewDirection);\n\n        float albedo = inMaterialProperties.ALBEDO;\n        albedo *= 1.8;\n        float s = LdotV - NdotL * NdotV;\n        float t = mix(1., max(NdotL, NdotV), step(0., s));\n\n        float roughness = inMaterialProperties.ROUGHNESS;\n        float sigma2 = roughness * roughness;\n        float A = 1. + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n        float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n        float factor = albedo * max(0., NdotL) * (A + B * s / t) / PI;\n\n        return factor;\n\n    }\n#endif\n\nvec3 CalculateDiffuseColor(\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    vec3 lightColor,\n    vec3 materialColor,\n    inout float lambert\n) {\n    #ifndef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = clamp(dot(lightDirection, normal), 0., 1.);\n    #endif\n\n    #ifdef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = CalculateOrenNayar(lightDirection, viewDirection, normal);\n    #endif\n\n    vec3 diffuseColor = lambert * lightColor * materialColor;\n    return diffuseColor;\n}\n\nvec3 CalculateSpecularColor(\n    vec3 specularColor,\n    float specularCoefficient,\n    float shininess,\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    float lambertian\n) {\n    vec3 resultColor = vec3(0.);\n\n    #ifdef SPECULAR_PHONG\n        vec3 reflectDirection = reflect(-lightDirection, normal);\n        float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n    resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_BLINN\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = max(dot(halfDirection, normal), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_SCHLICK\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = dot(halfDirection, normal);\n        float schlickShininess = max(0., shininess);\n        float specularFactor = specularAngle / (schlickShininess - schlickShininess*specularAngle + specularAngle);\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_GAUSS\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = acos(max(dot(halfDirection, normal), 0.));\n        float exponent = specularAngle * shininess * 0.17;\n        exponent = -(exponent*exponent);\n        float specularFactor = exp(exponent);\n\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef CONSERVE_ENERGY\n        float conserveEnergyFactor = EnergyConservation(shininess);\n        resultColor = conserveEnergyFactor * resultColor;\n    #endif\n\n    return resultColor;\n}\n\n#ifdef HAS_SPOT\n    float CalculateSpotLightEffect(vec3 lightPosition, vec3 conePointAt, float cosConeAngle, float cosConeAngleInner, float spotExponent, vec3 lightDirection) {\n        vec3 spotLightDirection = normalize(lightPosition-conePointAt);\n        float spotAngle = dot(-lightDirection, spotLightDirection);\n        float epsilon = cosConeAngle - cosConeAngleInner;\n\n        float spotIntensity = clamp((spotAngle - cosConeAngle)/epsilon, 0.0, 1.0);\n        spotIntensity = pow(spotIntensity, max(0.01, spotExponent));\n\n        return max(0., spotIntensity);\n    }\n#endif\n\n\n\n{{PHONG_FRAGMENT_HEAD}}\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n\n    vec4 col=vec4(0., 0., 0., inDiffuseColor.a);\n    vec3 calculatedColor = vec3(0.);\n    vec3 normal = normalize(normInterpolated);\n    vec3 baseColor = inDiffuseColor.rgb;\n\n    {{MODULE_BASE_COLOR}}\n\n\n    vec3 viewDirection = normalize(v_viewDirection);\n\n    #ifdef DOUBLE_SIDED\n        if(!gl_FrontFacing) normal = normal * -1.0;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        #ifdef HAS_TEXTURE_DIFFUSE\n            baseColor = texture(texDiffuse, texCoord).rgb;\n\n            #ifdef COLORIZE_TEXTURE\n                baseColor *= inDiffuseColor.rgb;\n            #endif\n        #endif\n\n        #ifdef HAS_TEXTURE_NORMAL\n            normal = texture(texNormal, texCoord).rgb;\n            normal = normalize(normal * 2. - 1.);\n            float normalIntensity = inTextureIntensities.NORMAL;\n            normal = normalize(mix(vec3(0., 0., 1.), normal, 2. * normalIntensity));\n            normal = normalize(TBN_Matrix * normal);\n        #endif\n    #endif\n\n    {{PHONG_FRAGMENT_BODY}}\n\n\n\n\n\n\n    #ifdef ENABLE_FRESNEL\n        calculatedColor += inFresnel.rgb * (CalculateFresnel(vec3(cameraSpace_pos), normal) * inFresnel.w * inFresnelWidthExponent.x);\n    #endif\n\n     #ifdef HAS_TEXTURE_ALPHA\n        #ifdef ALPHA_MASK_ALPHA\n            col.a*=texture(texAlpha,texCoord).a;\n        #endif\n        #ifdef ALPHA_MASK_LUMI\n            col.a*= dot(vec3(0.2126,0.7152,0.0722), texture(texAlpha,texCoord).rgb);\n        #endif\n        #ifdef ALPHA_MASK_R\n            col.a*=texture(texAlpha,texCoord).r;\n        #endif\n        #ifdef ALPHA_MASK_G\n            col.a*=texture(texAlpha,texCoord).g;\n        #endif\n        #ifdef ALPHA_MASK_B\n            col.a*=texture(texAlpha,texCoord).b;\n        #endif\n    #endif\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n\n    #ifdef HAS_TEXTURE_ENV\n        vec3 luminanceColor = vec3(0.);\n\n        #ifndef ENVMAP_MATCAP\n            float environmentMapWidth = inEnvMapWidth;\n            float glossyExponent = inMaterialProperties.SHININESS;\n            float glossyCoefficient = inMaterialProperties.SPECULAR_AMT;\n\n            vec3 envMapNormal =  normal;\n            vec3 reflectDirection = reflect(normalize(-viewDirection), normal);\n\n            float lambertianCoefficient = dot(viewDirection, reflectDirection); //0.44; // TODO: need prefiltered map for this\n            // lambertianCoefficient = 1.;\n            float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n            float specularFactor = pow(specularAngle, max(0., inMaterialProperties.SHININESS));\n\n            glossyExponent = specularFactor;\n\n            float maxMIPLevel = 10.;\n            float MIPlevel = log2(environmentMapWidth / 1024. * sqrt(3.)) - 0.5 * log2(glossyExponent + 1.);\n\n            luminanceColor = inEnvMapIntensity * (\n                inDiffuseColor.rgb *\n                SAMPLETEX(texEnv, envMapNormal, maxMIPLevel).rgb\n                +\n                glossyCoefficient * SAMPLETEX(texEnv, reflectDirection, MIPlevel).rgb\n            );\n        #endif\n        #ifdef ENVMAP_MATCAP\n            luminanceColor = inEnvMapIntensity * (\n                texture(texEnv, getMatCapUV(viewSpacePosition, viewSpaceNormal)).rgb\n                //inDiffuseColor.rgb\n                //* textureLod(texEnv, getMatCapUV(envMapNormal), maxMIPLevel).rgb\n                //+\n                //glossyCoefficient * textureLod(texEnv, getMatCapUV(reflectDirection), MIPlevel).rgb\n            );\n        #endif\n\n\n\n        #ifdef HAS_TEXTURE_LUMINANCE_MASK\n            luminanceColor *= texture(texLuminance, texCoord).r * inLuminanceMaskIntensity;\n        #endif\n\n        #ifdef HAS_TEXTURE_AO\n            // luminanceColor *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n            luminanceColor *= texture(texAO, texCoord).g*inTextureIntensities.AO;\n        #endif\n\n        calculatedColor.rgb += luminanceColor;\n\n\n    #endif\n\n    #ifdef ADD_EMISSIVE_COLOR\n        vec3 emissiveRadiance = mix(calculatedColor, inEmissiveColor.rgb, inEmissiveColor.w); // .w = intensity of color;\n\n        #ifdef HAS_TEXTURE_EMISSIVE\n            float emissiveIntensity = inTextureIntensities.EMISSIVE;\n            emissiveRadiance = mix(calculatedColor, texture(texEmissive, texCoord).rgb, emissiveIntensity);\n        #endif\n\n        #ifdef HAS_TEXTURE_EMISSIVE_MASK\n           float emissiveMixValue = mix(1., texture(texMaskEmissive, texCoord).r, inEmissiveMaskIntensity);\n           calculatedColor = mix(calculatedColor, emissiveRadiance, emissiveMixValue);\n        #endif\n\n        #ifndef HAS_TEXTURE_EMISSIVE_MASK\n            calculatedColor = emissiveRadiance;\n        #endif\n    #endif\n\n    col.rgb = clamp(calculatedColor, 0., 1.);\n\n\n    {{MODULE_COLOR}}\n\n    outColor = col;\n}\n',phong_vert:"\n{{MODULES_HEAD}}\n\n#define NONE -1\n#define AMBIENT 0\n#define POINT 1\n#define DIRECTIONAL 2\n#define SPOT 3\n\n#define TEX_REPEAT_X x;\n#define TEX_REPEAT_Y y;\n#define TEX_OFFSET_X z;\n#define TEX_OFFSET_Y w;\n\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN float attrVertIndex;\nIN vec3 attrTangent;\nIN vec3 attrBiTangent;\n\nOUT vec2 texCoord;\nOUT vec3 normInterpolated;\nOUT vec3 fragPos;\n\n#ifdef HAS_TEXTURE_NORMAL\n    OUT mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\n#ifdef ENABLE_FRESNEL\n    OUT vec4 cameraSpace_pos;\n#endif\n\nOUT vec3 v_viewDirection;\nOUT mat3 normalMatrix;\nOUT mat4 mvMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI vec4 inTextureRepeatOffset;\n#endif\n\nUNI vec3 camPos;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\n#ifdef ENVMAP_MATCAP\n    OUT vec3 viewSpaceNormal;\n    OUT vec3 viewSpacePosition;\n#endif\n\n\nmat3 transposeMat3(mat3 m)\n{\n    return mat3(m[0][0], m[1][0], m[2][0],\n        m[0][1], m[1][1], m[2][1],\n        m[0][2], m[1][2], m[2][2]);\n}\n\nmat3 inverseMat3(mat3 m)\n{\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 = a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 = a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n        b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n        b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    vec4 pos=vec4(vPosition,  1.0);\n\n    texCoord=attrTexCoord;\n    texCoord.y = 1. - texCoord.y;\n    vec3 norm=attrVertNormal;\n\n    vec3 tangent = attrTangent;\n    vec3 bitangent = attrBiTangent;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    normalMatrix = transposeMat3(inverseMat3(mat3(mMatrix)));\n    mvMatrix = (viewMatrix * mMatrix);\n\n\n\n    #ifdef ENABLE_FRESNEL\n        cameraSpace_pos = mvMatrix * pos;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        float repeatX = inTextureRepeatOffset.TEX_REPEAT_X;\n        float offsetX = inTextureRepeatOffset.TEX_OFFSET_X;\n        float repeatY = inTextureRepeatOffset.TEX_REPEAT_Y;\n        float offsetY = inTextureRepeatOffset.TEX_OFFSET_Y;\n\n        texCoord.x *= repeatX;\n        texCoord.x += offsetX;\n        texCoord.y *= repeatY;\n        texCoord.y += offsetY;\n    #endif\n\n   normInterpolated = vec3(normalMatrix*norm);\n\n    #ifdef HAS_TEXTURE_NORMAL\n        vec3 normCameraSpace = normalize((vec4(normInterpolated, 0.0)).xyz);\n        vec3 tangCameraSpace = normalize((mMatrix * vec4(tangent, 0.0)).xyz);\n        vec3 bitangCameraSpace = normalize((mMatrix * vec4(bitangent, 0.0)).xyz);\n\n        // re orthogonalization for smoother normals\n        tangCameraSpace = normalize(tangCameraSpace - dot(tangCameraSpace, normCameraSpace) * normCameraSpace);\n        bitangCameraSpace = cross(normCameraSpace, tangCameraSpace);\n\n        TBN_Matrix = mat3(tangCameraSpace, bitangCameraSpace, normCameraSpace);\n    #endif\n\n    fragPos = vec3((mMatrix) * pos);\n    v_viewDirection = normalize(camPos - fragPos);\n    // modelPos=mMatrix*pos;\n\n    #ifdef ENVMAP_MATCAP\n        mat3 viewSpaceNormalMatrix = normalMatrix = transposeMat3(inverseMat3(mat3(mvMatrix)));\n        viewSpaceNormal = normalize(viewSpaceNormalMatrix * norm);\n        viewSpacePosition = vec3(mvMatrix * pos);\n    #endif\n    gl_Position = projMatrix * mvMatrix * pos;\n}\n",snippet_body_ambient_frag:"    // * AMBIENT LIGHT {{LIGHT_INDEX}} *\n    vec3 diffuseColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY*phongLight{{LIGHT_INDEX}}.color;\n    calculatedColor += diffuseColor{{LIGHT_INDEX}};\n",snippet_body_directional_frag:"    // * DIRECTIONAL LIGHT {{LIGHT_INDEX}} *\n\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = normalize(phongLight{{LIGHT_INDEX}}.position);\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_body_point_frag:"// * POINT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        // * get length before normalization for falloff calculation\n        phongLightDirection{{LIGHT_INDEX}} = normalize(phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }\n",snippet_body_spot_frag:"    // * SPOT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        phongLightDirection{{LIGHT_INDEX}} = normalize( phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        float spotIntensity{{LIGHT_INDEX}} = CalculateSpotLightEffect(\n            phongLight{{LIGHT_INDEX}}.position, phongLight{{LIGHT_INDEX}}.conePointAt, phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLE,\n            phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLEINNER, phongLight{{LIGHT_INDEX}}.spotProperties.SPOTEXPONENT,\n            phongLightDirection{{LIGHT_INDEX}}\n        );\n\n        combinedColor{{LIGHT_INDEX}} *= spotIntensity{{LIGHT_INDEX}};\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_head_frag:"UNI Light phongLight{{LIGHT_INDEX}};\n"};const t=e.patch.cgl;const n=s.snippet_head_frag;const a={point:s.snippet_body_point_frag,spot:s.snippet_body_spot_frag,ambient:s.snippet_body_ambient_frag,directional:s.snippet_body_directional_frag,area:s.snippet_body_area_frag};const i=new RegExp("{{LIGHT_INDEX}}","g");const l=e=>n.replace("{{LIGHT_INDEX}}",e);const _=(e,t)=>a[t].replace(i,e);function r(){const e=s.phong_vert;let t=s.phong_frag;let n="";let a="";n=n.concat(l(0));a=a.concat(_(0,at[0].type));t=t.replace(fe,n);t=t.replace(me,a);ge.setSource(e,t);ge.define("HAS_POINT");ge.removeDefine("HAS_SPOT");ge.removeDefine("HAS_DIRECTIONAL");ge.removeDefine("HAS_AMBIENT")}const o=e.inTrigger("Trigger In");const c=e.inFloat("R",Math.random());const u=e.inFloat("G",Math.random());const p=e.inFloat("B",Math.random());const g=e.inFloatSlider("A",1);const d=[c,u,p,g];e.setPortGroup("Diffuse Color",d);const f=e.inBool("Enable",false);const m=e.inFloatSlider("Albedo",.707);const v=e.inFloatSlider("Roughness",.835);f.setUiAttribs({hidePort:true});m.setUiAttribs({greyout:true});v.setUiAttribs({greyout:true});c.setUiAttribs({colorPick:true});e.setPortGroup("Oren-Nayar Diffuse",[f,m,v]);f.onChange=function(){ge.toggleDefine("ENABLE_OREN_NAYAR_DIFFUSE",f);m.setUiAttribs({greyout:!f.get()});v.setUiAttribs({greyout:!f.get()})};const h=e.inValueBool("Active",false);h.setUiAttribs({hidePort:true});const x=e.inValueSlider("Fresnel Intensity",.7);const b=e.inFloat("Fresnel Width",1);const T=e.inFloat("Fresnel Exponent",6);const I=e.inFloat("Fresnel R",1);const A=e.inFloat("Fresnel G",1);const E=e.inFloat("Fresnel B",1);I.setUiAttribs({colorPick:true});const y=[x,b,T,I,A,E];y.forEach(function(e){e.setUiAttribs({greyout:true})});e.setPortGroup("Fresnel",y.concat([h]));let S=null;let C=null;h.onChange=function(){ge.toggleDefine("ENABLE_FRESNEL",h);if(h.get()){if(!S)S=new CGL.Uniform(ge,"4f","inFresnel",I,A,E,x);if(!C)C=new CGL.Uniform(ge,"2f","inFresnelWidthExponent",b,T)}else{if(S){ge.removeUniform("inFresnel");S=null}if(C){ge.removeUniform("inFresnelWidthExponent");C=null}}y.forEach(function(e){e.setUiAttribs({greyout:!h.get()})})};const O=e.inBool("Emissive Active",false);const N=e.inFloatSlider("Color Intensity",.3);const L=e.inFloatSlider("Emissive R",Math.random());const U=e.inFloatSlider("Emissive G",Math.random());const P=e.inFloatSlider("Emissive B",Math.random());L.setUiAttribs({colorPick:true});e.setPortGroup("Emissive Color",[O,N,L,U,P]);N.setUiAttribs({greyout:!O.get()});L.setUiAttribs({greyout:!O.get()});U.setUiAttribs({greyout:!O.get()});P.setUiAttribs({greyout:!O.get()});let R=null;O.onChange=()=>{ge.toggleDefine("ADD_EMISSIVE_COLOR",O);if(O.get()){R=new CGL.Uniform(ge,"4f","inEmissiveColor",L,U,P,N);K.setUiAttribs({greyout:false});Y.setUiAttribs({greyout:false});if(K.get())re.setUiAttribs({greyout:false});if(Y.get())oe.setUiAttribs({greyout:false})}else{e.log("ayayay");K.setUiAttribs({greyout:true});Y.setUiAttribs({greyout:true});re.setUiAttribs({greyout:true});oe.setUiAttribs({greyout:true});ge.removeUniform("inEmissiveColor");R=null}if(K.get()){N.setUiAttribs({greyout:true});L.setUiAttribs({greyout:true});U.setUiAttribs({greyout:true});P.setUiAttribs({greyout:true})}else{if(O.get()){N.setUiAttribs({greyout:false});L.setUiAttribs({greyout:false});U.setUiAttribs({greyout:false});P.setUiAttribs({greyout:false})}else{N.setUiAttribs({greyout:true});L.setUiAttribs({greyout:true});U.setUiAttribs({greyout:true});P.setUiAttribs({greyout:true})}}};const M=e.inFloat("Shininess",4);const G=e.inFloatSlider("Specular Amount",.5);const w=e.inSwitch("Specular Model",["Blinn","Schlick","Phong","Gauss"],"Blinn");w.setUiAttribs({hidePort:true});const V=[M,G,w];e.setPortGroup("Specular",V);const D=e.inValueBool("Energy Conservation",false);const B=e.inBool("Double Sided Material",false);const k=e.inSwitch("Falloff Mode",["A","B","C","D"],"A");D.setUiAttribs({hidePort:true});B.setUiAttribs({hidePort:true});k.setUiAttribs({hidePort:true});k.onChange=()=>{const e=["A","B","C","D"];ge.define("FALLOFF_MODE_"+k.get());e.filter(e=>e!==k.get()).forEach(e=>ge.removeDefine("FALLOFF_MODE_"+e))};const F=[D,B,k];e.setPortGroup("Light Options",F);const j=e.inTexture("Diffuse Texture");const X=e.inTexture("Specular Texture");const z=e.inTexture("Normal Map");const H=e.inTexture("AO Texture");const K=e.inTexture("Emissive Texture");const Y=e.inTexture("Emissive Mask");const q=e.inTexture("Opacity Texture");const W=e.inTexture("Environment Map");const Q=e.inTexture("Env Map Mask");e.setPortGroup("Textures",[j,X,z,H,K,Y,q,W,Q]);const Z=e.inBool("Colorize Texture",false);const J=e.inFloat("Diffuse Repeat X",1);const $=e.inFloat("Diffuse Repeat Y",1);const ee=e.inFloat("Texture Offset X",0);const te=e.inFloat("Texture Offset Y",0);const ne=e.inFloatSlider("Specular Intensity",1);const ae=e.inFloatSlider("Normal Map Intensity",.5);const ie=e.inFloatSlider("AO Intensity",1);const re=e.inFloatSlider("Emissive Intensity",1);const oe=e.inFloatSlider("Emissive Mask Intensity",1);const se=e.inFloatSlider("Env Map Intensity",1);const le=e.inFloatSlider("Env Mask Intensity",1);Z.setUiAttribs({hidePort:true});e.setPortGroup("Texture Transforms",[Z,$,J,te,ee]);e.setPortGroup("Texture Intensities",[ae,ie,ne,re,oe,se,le]);const _e=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A"],"Luminance");_e.setUiAttribs({greyout:true});const ce=e.inValueBool("Discard Transparent Pixels");ce.setUiAttribs({hidePort:true});e.setPortGroup("Opacity Texture",[_e,ce]);const ue=e.outTrigger("Trigger Out");const pe=e.outObject("Shader",null,"shader");pe.ignoreValueSerialize=true;const ge=new CGL.Shader(t,"phongmaterial_"+e.id);ge.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_BASE_COLOR"]);ge.setSource(s.simosphong_vert,s.simosphong_frag);let de=false;ge.define("FALLOFF_MODE_A");if(t.glVersion<2){ge.enableExtension("GL_OES_standard_derivatives");if(t.gl.getExtension("OES_texture_float"))ge.enableExtension("GL_OES_texture_float");else e.log("error loading extension OES_texture_float");if(t.gl.getExtension("OES_texture_float_linear"))ge.enableExtension("GL_OES_texture_float_linear");else e.log("error loading extention OES_texture_float_linear");if(t.gl.getExtension("GL_OES_texture_half_float"))ge.enableExtension("GL_OES_texture_half_float");else e.log("error loading extention GL_OES_texture_half_float");if(t.gl.getExtension("GL_OES_texture_half_float_linear"))ge.enableExtension("GL_OES_texture_half_float_linear");else e.log("error loading extention GL_OES_texture_half_float_linear")}const fe=new RegExp("{{PHONG_FRAGMENT_HEAD}}","g");const me=new RegExp("{{PHONG_FRAGMENT_BODY}}","g");const ve={directional:false,spot:false,ambient:false,point:false};function he(t){let e=s.phong_frag;let n="";let a="";ve.directional=false;ve.spot=false;ve.ambient=false;ve.point=false;for(let e=0;e<t.length;e+=1){const i=t[e];const r=i.type;if(!ve[r]){ve[r]=true}n=n.concat(l(e));a=a.concat(_(e,i.type))}e=e.replace(fe,n);e=e.replace(me,a);ge.setSource(s.phong_vert,e);for(let e=0,t=Object.keys(ve);e<t.length;e+=1){const o=t[e];if(ve[o]){if(!ge.hasDefine("HAS_"+o.toUpperCase())){ge.define("HAS_"+o.toUpperCase())}}else{if(ge.hasDefine("HAS_"+o.toUpperCase())){ge.removeDefine("HAS_"+o.toUpperCase())}}}}pe.set(ge);let xe=null;let be=null;let Te=null;let Ie=null;let Ae=null;let Ee=null;let ye=null;let Se=null;let Ce=null;let Oe=null;let Ne=null;let Le=null;let Ue=null;Z.onChange=function(){ge.toggleDefine("COLORIZE_TEXTURE",Z.get())};function Pe(){if(j.get()){if(!ge.hasDefine("HAS_TEXTURE_DIFFUSE")){ge.define("HAS_TEXTURE_DIFFUSE");if(!xe)xe=new CGL.Uniform(ge,"t","texDiffuse",0)}}else{ge.removeUniform("texDiffuse");ge.removeDefine("HAS_TEXTURE_DIFFUSE");xe=null}}function Re(){if(X.get()){ne.setUiAttribs({greyout:false});if(!ge.hasDefine("HAS_TEXTURE_SPECULAR")){ge.define("HAS_TEXTURE_SPECULAR");if(!be)be=new CGL.Uniform(ge,"t","texSpecular",0)}}else{ne.setUiAttribs({greyout:true});ge.removeUniform("texSpecular");ge.removeDefine("HAS_TEXTURE_SPECULAR");be=null}}function Me(){if(z.get()){ae.setUiAttribs({greyout:false});if(!ge.hasDefine("HAS_TEXTURE_NORMAL")){ge.define("HAS_TEXTURE_NORMAL");if(!Te)Te=new CGL.Uniform(ge,"t","texNormal",0)}}else{ae.setUiAttribs({greyout:true});ge.removeUniform("texNormal");ge.removeDefine("HAS_TEXTURE_NORMAL");Te=null}}Ie=new CGL.Uniform(ge,"t","texAO");function Ge(){ge.toggleDefine("HAS_TEXTURE_AO",H.get());ie.setUiAttribs({greyout:!H.get()})}function we(){if(K.get()){L.setUiAttribs({greyout:true});U.setUiAttribs({greyout:true});P.setUiAttribs({greyout:true});N.setUiAttribs({greyout:true});if(O.get()){re.setUiAttribs({greyout:false})}if(!ge.hasDefine("HAS_TEXTURE_EMISSIVE")){ge.define("HAS_TEXTURE_EMISSIVE");if(!Ae)Ae=new CGL.Uniform(ge,"t","texEmissive",0)}}else{re.setUiAttribs({greyout:true});if(O.get()){L.setUiAttribs({greyout:false});U.setUiAttribs({greyout:false});P.setUiAttribs({greyout:false});N.setUiAttribs({greyout:false})}else{K.setUiAttribs({greyout:true})}ge.removeUniform("texEmissive");ge.removeDefine("HAS_TEXTURE_EMISSIVE");Ae=null}}function Ve(){if(Y.get()){if(O.get()){oe.setUiAttribs({greyout:false})}if(!ge.hasDefine("HAS_TEXTURE_EMISSIVE_MASK")){ge.define("HAS_TEXTURE_EMISSIVE_MASK");if(!Ee)Ee=new CGL.Uniform(ge,"t","texMaskEmissive",0);if(!ye)ye=new CGL.Uniform(ge,"f","inEmissiveMaskIntensity",oe)}}else{if(!O.get()){Y.setUiAttribs({greyout:true})}oe.setUiAttribs({greyout:true});ge.removeUniform("texMaskEmissive");ge.removeUniform("inEmissiveMaskIntensity");ge.removeDefine("HAS_TEXTURE_EMISSIVE_MASK");Ee=null;ye=null}}let De=false;function Be(){ge.toggleDefine("HAS_TEXTURE_ENV",W.get());se.setUiAttribs({greyout:!W.get()});if(W.get()){if(!Ce)Ce=new CGL.Uniform(ge,"t","texEnv",0);ge.toggleDefine("TEX_FORMAT_CUBEMAP",W.get().cubemap);if(W.get().cubemap){ge.removeDefine("TEX_FORMAT_EQUIRECT");ge.removeDefine("ENVMAP_MATCAP");if(!Oe)Oe=new CGL.Uniform(ge,"f","inEnvMapIntensity",se);if(!Ne)Ne=new CGL.Uniform(ge,"f","inEnvMapWidth",W.get().cubemap.width)}else{const e=W.get().width===W.get().height;ge.toggleDefine("TEX_FORMAT_EQUIRECT",!e);ge.toggleDefine("ENVMAP_MATCAP",e);if(!Oe)Oe=new CGL.Uniform(ge,"f","inEnvMapIntensity",se);if(!Ne)Ne=new CGL.Uniform(ge,"f","inEnvMapWidth",W.get().width)}}else{ge.removeUniform("inEnvMapIntensity");ge.removeUniform("inEnvMapWidth");ge.removeUniform("texEnv");ge.removeDefine("HAS_TEXTURE_ENV");ge.removeDefine("ENVMAP_MATCAP");Ce=null;Oe=null}De=false}function ke(){if(Q.get()){le.setUiAttribs({greyout:false});if(!Le){ge.define("HAS_TEXTURE_LUMINANCE_MASK");Le=new CGL.Uniform(ge,"t","texLuminance",0);Ue=new CGL.Uniform(ge,"f","inLuminanceMaskIntensity",le)}}else{le.setUiAttribs({greyout:true});ge.removeDefine("HAS_TEXTURE_LUMINANCE_MASK");ge.removeUniform("inLuminanceMaskIntensity");ge.removeUniform("texLuminance");Le=null;Ue=null}}function Fe(){if(_e.get()=="Alpha Channel")ge.define("ALPHA_MASK_ALPHA");else ge.removeDefine("ALPHA_MASK_ALPHA");if(_e.get()=="Luminance")ge.define("ALPHA_MASK_LUMI");else ge.removeDefine("ALPHA_MASK_LUMI");if(_e.get()=="R")ge.define("ALPHA_MASK_R");else ge.removeDefine("ALPHA_MASK_R");if(_e.get()=="G")ge.define("ALPHA_MASK_G");else ge.removeDefine("ALPHA_MASK_G");if(_e.get()=="B")ge.define("ALPHA_MASK_B");else ge.removeDefine("ALPHA_MASK_B")}_e.onChange=Fe;function je(){if(q.get()){if(Se!==null)return;ge.removeUniform("texAlpha");ge.define("HAS_TEXTURE_ALPHA");if(!Se)Se=new CGL.Uniform(ge,"t","texAlpha",0);_e.setUiAttribs({greyout:false});ce.setUiAttribs({greyout:false})}else{ge.removeUniform("texAlpha");ge.removeDefine("HAS_TEXTURE_ALPHA");Se=null;_e.setUiAttribs({greyout:true});ce.setUiAttribs({greyout:true})}Fe()}ce.onChange=function(){ge.toggleDefine("DISCARDTRANS",ce.get())};j.onChange=Pe;X.onChange=Re;z.onChange=Me;H.onChange=Ge;K.onChange=we;Y.onChange=Ve;q.onChange=je;W.onChange=()=>{De=true};Q.onChange=ke;const Xe=t.maxUniformsFrag;const ze=Xe===64?6:16;ge.define("MAX_LIGHTS",ze.toString());ge.define("SPECULAR_PHONG");w.onChange=function(){if(w.get()==="Phong"){ge.define("SPECULAR_PHONG");ge.removeDefine("SPECULAR_BLINN");ge.removeDefine("SPECULAR_GAUSS");ge.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Blinn"){ge.define("SPECULAR_BLINN");ge.removeDefine("SPECULAR_PHONG");ge.removeDefine("SPECULAR_GAUSS");ge.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Gauss"){ge.define("SPECULAR_GAUSS");ge.removeDefine("SPECULAR_BLINN");ge.removeDefine("SPECULAR_PHONG");ge.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Schlick"){ge.define("SPECULAR_SCHLICK");ge.removeDefine("SPECULAR_BLINN");ge.removeDefine("SPECULAR_PHONG");ge.removeDefine("SPECULAR_GAUSS")}};D.onChange=function(){ge.toggleDefine("CONSERVE_ENERGY",D.get())};B.onChange=function(){ge.toggleDefine("DOUBLE_SIDED",B.get())};const He=new CGL.Uniform(ge,"4f","inMaterialProperties",m,v,M,G);const Ke=new CGL.Uniform(ge,"4f","inDiffuseColor",c,u,p,g);const Ye=new CGL.Uniform(ge,"4f","inTextureIntensities",ae,ie,ne,re);const qe=new CGL.Uniform(ge,"4f","inTextureRepeatOffset",J,$,ee,te);ge.uniformColorDiffuse=Ke;const We=[];let Qe=0;function Ze(t){for(let e=0;e<We.length;e+=1){We[e]=null}for(let e=0;e<t;e+=1){We[e]=null;if(!We[e]){We[e]={color:new CGL.Uniform(ge,"3f","phongLight"+e+".color",[1,1,1]),position:new CGL.Uniform(ge,"3f","phongLight"+e+".position",[0,11,0]),specular:new CGL.Uniform(ge,"3f","phongLight"+e+".specular",[1,1,1]),lightProperties:new CGL.Uniform(ge,"4f","phongLight"+e+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(ge,"3f","phongLight"+e+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(ge,"3f","phongLight"+e+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(ge,"i","phongLight"+e+".castLight",1)}}}}function Je(e){tt.position.setValue(e.position);tt.color.setValue(e.color);tt.specular.setValue(e.specular);tt.lightProperties.setValue([e.intensity,e.attenuation,e.falloff,e.radius]);tt.conePointAt.setValue(e.conePointAt);tt.spotProperties.setValue([e.cosConeAngle,e.cosConeAngleInner,e.spotExponent])}function $e(t){for(let e=0;e<t.length;e+=1){const n=t[e];n.isUsed=true;We[e].position.setValue(n.position);We[e].color.setValue(n.color);We[e].specular.setValue(n.specular);We[e].lightProperties.setValue([n.intensity,n.attenuation,n.falloff,n.radius]);We[e].conePointAt.setValue(n.conePointAt);We[e].spotProperties.setValue([n.cosConeAngle,n.cosConeAngleInner,n.spotExponent]);We[e].castLight.setValue(n.castLight)}}function et(e){if(e.length!==Qe){he(e);Ze(e.length);Qe=e.length;$e(e);de=false}else{if(de){he(e);Ze(e.length);de=false}$e(e)}}let tt=null;function nt(){tt={color:new CGL.Uniform(ge,"3f","phongLight"+0+".color",[1,1,1]),specular:new CGL.Uniform(ge,"3f","phongLight"+0+".specular",[1,1,1]),position:new CGL.Uniform(ge,"3f","phongLight"+0+".position",[0,11,0]),lightProperties:new CGL.Uniform(ge,"4f","phongLight"+0+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(ge,"3f","phongLight"+0+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(ge,"3f","phongLight"+0+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(ge,"i","phongLight"+0+".castLight",1)}}const at=[{type:"point",position:[5,5,5],color:[1,1,1],specular:[1,1,1],intensity:1,attenuation:0,falloff:.5,radius:80,castLight:1}];const it=mat4.create();function rt(){if(t.frameStore.lightStack){if(t.frameStore.lightStack.length===0){e.setUiError("deflight","Default light is enabled. Please add lights to your patch to make this warning disappear.",1)}else e.setUiError("deflight",null)}if(!t.frameStore.lightStack||!t.frameStore.lightStack.length){if(!tt){r();nt()}mat4.invert(it,t.vMatrix);at[0].position=[it[12],it[13],it[14]];Je(at[0]);Qe=-1}else{if(ge){if(t.frameStore.lightStack){if(t.frameStore.lightStack.length){tt=null;et(t.frameStore.lightStack)}}}}}const ot=function(){if(!ge){e.log("NO SHADER");return}t.pushShader(ge);ge.popTextures();ue.trigger();t.popShader()};e.preRender=function(){ge.bind();ot()};const st=mat4.create();const lt=vec3.create();const _t=vec3.create();o.onTriggered=function(){if(!ge){e.log("phong has no shader...");return}if(De)Be();t.setShader(ge);ge.popTextures();if(j.get())ge.pushTexture(xe,j.get());if(X.get())ge.pushTexture(be,X.get());if(z.get())ge.pushTexture(Te,z.get());if(H.get())ge.pushTexture(Ie,H.get());if(K.get())ge.pushTexture(Ae,K.get());if(Y.get())ge.pushTexture(Ee,Y.get());if(q.get())ge.pushTexture(Se,q.get());if(W.get()){if(W.get().cubemap)ge.pushTexture(Ce,W.get().cubemap,t.gl.TEXTURE_CUBE_MAP);else ge.pushTexture(Ce,W.get())}if(Q.get()){ge.pushTexture(Le,Q.get())}rt();ue.trigger();t.setPreviousShader()};if(t.glVersion==1){if(!t.gl.getExtension("EXT_shader_texture_lod")){e.log("no EXT_shader_texture_lod texture extension")}else{ge.enableExtension("GL_EXT_shader_texture_lod");t.gl.getExtension("OES_texture_float");t.gl.getExtension("OES_texture_float_linear");t.gl.getExtension("OES_texture_half_float");t.gl.getExtension("OES_texture_half_float_linear");ge.enableExtension("GL_OES_standard_derivatives");ge.enableExtension("GL_OES_texture_float");ge.enableExtension("GL_OES_texture_float_linear");ge.enableExtension("GL_OES_texture_half_float");ge.enableExtension("GL_OES_texture_half_float_linear")}}Pe();Re();Me();Ge();je();we();Ve();Be();ke()};Ops.Gl.Phong.PhongMaterial_v6.prototype=new CABLES.Op;CABLES.OPS["0d83ed06-cdbe-4fe0-87bb-0ccece7fb6e1"]={f:Ops.Gl.Phong.PhongMaterial_v6,objName:"Ops.Gl.Phong.PhongMaterial_v6"};Ops.Geometry.GeometryToWireframeArray3=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const a=e.inObject("Geometry"),i=e.outArray("Array");a.onChange=function(){const t=a.get();i.set(null);if(!t)return;const n=[];for(let e=0;e<t.verticesIndices.length;e+=3){n.push(t.vertices[t.verticesIndices[e+0]*3+0],t.vertices[t.verticesIndices[e+0]*3+1],t.vertices[t.verticesIndices[e+0]*3+2],t.vertices[t.verticesIndices[e+1]*3+0],t.vertices[t.verticesIndices[e+1]*3+1],t.vertices[t.verticesIndices[e+1]*3+2],t.vertices[t.verticesIndices[e+1]*3+0],t.vertices[t.verticesIndices[e+1]*3+1],t.vertices[t.verticesIndices[e+1]*3+2],t.vertices[t.verticesIndices[e+2]*3+0],t.vertices[t.verticesIndices[e+2]*3+1],t.vertices[t.verticesIndices[e+2]*3+2],t.vertices[t.verticesIndices[e+2]*3+0],t.vertices[t.verticesIndices[e+2]*3+1],t.vertices[t.verticesIndices[e+2]*3+2],t.vertices[t.verticesIndices[e+0]*3+0],t.vertices[t.verticesIndices[e+0]*3+1],t.vertices[t.verticesIndices[e+0]*3+2])}i.set(n)}};Ops.Geometry.GeometryToWireframeArray3.prototype=new CABLES.Op;CABLES.OPS["d6d0f3ce-5670-49bb-893a-7c9b0262b991"]={f:Ops.Geometry.GeometryToWireframeArray3,objName:"Ops.Geometry.GeometryToWireframeArray3"};Ops.Gl.Meshes.Torus=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("render"),i=e.inValue("sides",32),r=e.inValue("rings",32),o=e.inValue("innerRadius",.5),s=e.inValue("outerRadius",1),a=e.inBool("Draw",true),l=e.outTrigger("trigger"),g=e.outObject("geometry");const d=vec3.fromValues(0,1,0),f=vec3.fromValues(1,0,0);let m=vec3.create(),v=vec3.create();g.ignoreValueSerialize=true;let h=e.patch.cgl;let x=null;let b=null;let T=0,I=0,A=0;let _=true;r.onChange=i.onChange=o.onChange=s.onChange=function(){_=true};n.onTriggered=function(){if(_)c();if(a.get()&&x!==null)x.render(h.getShader());l.trigger()};function c(){let e=Math.round(r.get());let t=Math.round(i.get());if(e<2)e=2;if(t<2)t=2;let n=o.get();let a=s.get();u(n,a,e,t);_=false}function E(e,t){let n;let a=Math.abs(e);let i=(t?1:2)*Math.PI/e;let r=[];let o=[];r[0]=0;o[0]=1;for(n=1;n<a;n++){r[n]=Math.sin(i*n);o[n]=Math.cos(i*n)}if(t){r[a]=0;o[a]=-1}else{r[a]=r[0];o[a]=o[0]}return{cost:o,sint:r}}function u(e,t,n,a){let i=E(n,false);let r=E(-a,false);let o;b=new CGL.Geometry("torus");b.glPrimitive=h.gl.TRIANGLE_STRIP;let s=[];let l=[];let _=[];let c=[];for(T=0;T<n;T++){for(I=0;I<a;I++){var u=3*(T*a+I);var p=2*(T*a+I);b.vertices[u]=i.cost[T]*(t+r.cost[I]*e);b.vertices[u+1]=i.sint[T]*(t+r.cost[I]*e);b.vertices[u+2]=r.sint[I]*e;_[u]=m[0]=i.cost[T]*r.cost[I];_[u+1]=m[1]=i.sint[T]*r.cost[I];_[u+2]=m[2]=r.sint[I];if(Math.abs(m[1])==1)o=f;else o=d;vec3.cross(v,m,o);vec3.normalize(v,v);s[u]=v[0];s[u+1]=v[1];s[u+2]=v[2];vec3.cross(v,v,m);l[u]=v[0];l[u+1]=v[1];l[u+2]=v[2];c[p]=T/(n-1);c[p+1]=I/(a-1)}}for(I=0,A=0;I<a;I++){let e=1;if(I==a-1)e=-I;for(T=0;T<n;T++,A+=2){var u=T*a+I;b.verticesIndices[A]=u;b.verticesIndices[A+1]=u+e;c[p]=T/(n+1);c[p+1]=I/(a+1)}b.verticesIndices[A]=I;b.verticesIndices[A+1]=I+e;A+=2}if(b.biTangents.length==l.length)b.biTangents.set(l);else b.biTangents=new Float32Array(l);if(b.tangents.length==s.length)b.tangents.set(s);else b.tangents=new Float32Array(s);if(b.vertexNormals.length==_.length)b.vertexNormals.set(_);else b.vertexNormals=new Float32Array(_);b.setTexCoords(c);g.set(null);g.set(b);if(!x)x=new CGL.Mesh(h,b,h.gl.TRIANGLE_STRIP);else x.setGeom(b)}};Ops.Gl.Meshes.Torus.prototype=new CABLES.Op;CABLES.OPS["d921e008-21b9-4cf5-84a2-4dedca34f0c8"]={f:Ops.Gl.Meshes.Torus,objName:"Ops.Gl.Meshes.Torus"};Ops.Gl.Meshes.PointCloudFromArray=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const t=i.inTrigger("exe"),r=i.inArray("Array",3),n=i.inValueInt("Num Points"),a=i.outTrigger("Trigger out"),o=i.outObject("Geometry"),s=i.inValueBool("Scramble Texcoords",true),l=i.inValue("Seed"),_=i.inArray("Coordinates",2),c=i.inArray("Vertex Colors",4);const u=i.patch.cgl;_.onChange=b;s.onChange=b;c.onChange=l.onChange=r.onChange=x;n.onChange=T;i.toWorkPortsNeedToBeLinked(r,t);i.setPortGroup("Texture Coordinates",[s,l,_]);let p=false;t.onTriggered=h;let g=null;const d=new CGL.Geometry("pointcloudfromarray");let f=[];let m=true;let v=false;function h(){a.trigger();if(CABLES.UI){let e=u.getShader();if(e.glPrimitive!=u.gl.POINTS)i.setUiError("nopointmat","Using a Material not made for point rendering. Try to use PointMaterial.");else i.setUiError("nopointmat",null)}if(m||!g)I();if(!p&&g)g.render(u.getShader())}function x(){p=r.get()==null;if(!p)m=true;else m=false}function b(){if(_.isLinked()){l.setUiAttribs({greyout:true});s.setUiAttribs({greyout:true})}else{s.setUiAttribs({greyout:false});if(!s.get())l.setUiAttribs({greyout:true});else l.setUiAttribs({greyout:false})}g=null;m=true}function T(){if(g){g.setNumVertices(Math.min(d.vertices.length/3,n.get()));if(n.get()==0)g.setNumVertices(d.vertices.length/3)}}function I(){let t=r.get();if(!t||t.length==0){return}if(t.length%3!==0){i.setUiError("div3","Array length not multiple of 3");return}else i.setUiError("div3",null);if(d.vertices.length==t.length&&g&&!_.isLinked()&&!c.isLinked()){g.setAttribute(CGL.SHADERVAR_VERTEX_POSITION,t,3);d.vertices=t;m=false;return}d.clear();let n=t.length/3;n=Math.abs(Math.floor(n));if(n==0)return;if(!f||f.length!=n*2)f=new Float32Array(n*2);let e=true;let a=s.get();if(!_.isLinked()){Math.randomSeed=l.get();f=[];for(let e=0;e<n;e++){if(d.vertices[e*3]!=t[e*3]||d.vertices[e*3+1]!=t[e*3+1]||d.vertices[e*3+2]!=t[e*3+2]){if(a){f[e*2]=Math.seededRandom();f[e*2+1]=Math.seededRandom()}else{f[e*2]=e/n;f[e*2+1]=e/n}}}}if(c.get()){if(!v&&c.get().length!=n*4){i.uiAttr({error:"Color array does not have the correct length! (should be "+n*4+")"});v=true;g=null;return}d.vertexColors=c.get()}else d.vertexColors=[];console.log("changed",e);if(e){if(_.isLinked())f=_.get();d.setPointVertices(t);d.setTexCoords(f);d.verticesIndices=[];if(g)g.dispose();g=new CGL.Mesh(u,d,u.gl.POINTS);g.addVertexNumbers=true;g.setGeom(d);o.set(d)}T();m=false}};Ops.Gl.Meshes.PointCloudFromArray.prototype=new CABLES.Op;CABLES.OPS["0a6d9c6f-6459-45ca-88ad-268a1f7304db"]={f:Ops.Gl.Meshes.PointCloudFromArray,objName:"Ops.Gl.Meshes.PointCloudFromArray"};Ops.Gl.Shader.PointMaterial_v4=function(){CABLES.Op.apply(this,arguments);const e=this;const t={pointmat_frag:"\n{{MODULES_HEAD}}\n\nUNI vec4 color;\nIN vec2 texCoord;\nIN vec2 pointCoord;\nIN float ps;\n\n#ifdef HAS_TEXTURE_DIFFUSE\n    UNI sampler2D diffTex;\n#endif\n#ifdef HAS_TEXTURE_MASK\n    UNI sampler2D texMask;\n#endif\n#ifdef HAS_TEXTURE_COLORIZE\n    IN vec4 colorize;\n#endif\n#ifdef HAS_TEXTURE_OPACITY\n    IN float opacity;\n#endif\n#ifdef VERTEX_COLORS\n    IN vec4 vertexColor;\n#endif\n\nvoid main()\n{\n    #ifdef FLIP_TEX\n        vec2 pointCoord=vec2(gl_PointCoord.x,(1.0-gl_PointCoord.y));\n    #endif\n    #ifndef FLIP_TEX\n        vec2 pointCoord=gl_PointCoord;\n    #endif\n    {{MODULE_BEGIN_FRAG}}\n\n    if(ps<1.0)discard;\n\n    vec4 col=color;\n\n\n    #ifdef HAS_TEXTURE_MASK\n        float mask;\n        #ifdef TEXTURE_MASK_R\n            mask=texture(texMask,pointCoord).r;\n        #endif\n        #ifdef TEXTURE_MASK_A\n            mask=texture(texMask,pointCoord).a;\n        #endif\n        #ifdef TEXTURE_MASK_LUMI\n        \tvec3 lumcoeff = vec3(0.299,0.587,0.114);\n        \tmask = dot(texture(texMask,pointCoord).rgb, lumcoeff);\n        #endif\n\n    #endif\n\n    #ifdef HAS_TEXTURE_DIFFUSE\n        col=texture(diffTex,pointCoord);\n        #ifdef COLORIZE_TEXTURE\n          col.rgb*=color.rgb;\n        #endif\n    #endif\n    col.a*=color.a;\n\n    {{MODULE_COLOR}}\n\n    #ifdef MAKE_ROUND\n\n        #ifndef MAKE_ROUNDAA\n            if ((gl_PointCoord.x-0.5)*(gl_PointCoord.x-0.5) + (gl_PointCoord.y-0.5)*(gl_PointCoord.y-0.5) > 0.25) discard; //col.a=0.0;\n        #endif\n\n        #ifdef MAKE_ROUNDAA\n            float circ=(gl_PointCoord.x-0.5)*(gl_PointCoord.x-0.5) + (gl_PointCoord.y-0.5)*(gl_PointCoord.y-0.5);\n\n            float a=smoothstep(0.25,0.25-fwidth(gl_PointCoord.x),circ);\n            if(a==0.0)discard;\n            col.a=a*color.a;\n            // col.r=0.0;\n        #endif\n    #endif\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        col*=colorize;\n    #endif\n\n    #ifdef TEXTURE_COLORIZE_MUL\n        col*=color;\n    #endif\n\n    #ifdef HAS_TEXTURE_MASK\n        col.a*=mask;\n    #endif\n\n    #ifdef HAS_TEXTURE_OPACITY\n        col.a*=opacity;\n    #endif\n\n\n    #ifdef VERTEX_COLORS\n        col.rgb = vertexColor.rgb;\n        col.a *= vertexColor.a;\n    #endif\n\n    if (col.a <= 0.0) discard;\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        col*=colorize;\n    #endif\n\n    outColor = col;\n}\n",pointmat_vert:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent;\nIN vec3 attrBiTangent;\n\n#ifdef VERTEX_COLORS\n    IN vec4 attrVertColor;\n    OUT vec4 vertexColor;\n#endif\n\nOUT vec3 norm;\nOUT float ps;\n\nOUT vec2 texCoord;\n\n\n#ifdef HAS_TEXTURES\n#endif\n\n#ifdef HAS_TEXTURE_COLORIZE\n   UNI sampler2D texColorize;\n   OUT vec4 colorize;\n#endif\n#ifdef HAS_TEXTURE_OPACITY\n    UNI sampler2D texOpacity;\n    OUT float opacity;\n#endif\n\n#ifdef HAS_TEXTURE_POINTSIZE\n   UNI sampler2D texPointSize;\n   UNI float texPointSizeMul;\n#endif\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nUNI float pointSize;\nUNI vec3 camPos;\n\nUNI float canvasWidth;\nUNI float canvasHeight;\nUNI float camDistMul;\nUNI float randomSize;\n\nIN float attrVertIndex;\n\n\n\nfloat rand(float n){return fract(sin(n) * 5711.5711123);}\n\n#define POINTMATERIAL\n\nvoid main()\n{\n    norm=attrVertNormal;\n    #ifdef PIXELSIZE\n        float psMul=1.0;\n    #endif\n\n    #ifndef PIXELSIZE\n        float psMul=sqrt(canvasWidth/canvasHeight)+0.00000000001;\n    #endif\n\n    // float sizeMultiply=1.0;\n\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n\n\n    #ifdef VERTEX_COLORS\n        vertexColor=attrVertColor;\n    #endif\n\n    // #ifdef HAS_TEXTURES\n        texCoord=attrTexCoord;\n    // #endif\n\n    #ifdef HAS_TEXTURE_OPACITY\n        // opacity=texture(texOpacity,vec2(rand(attrVertIndex+texCoord.x*texCoord.y+texCoord.y+texCoord.x),rand(texCoord.y*texCoord.x-texCoord.x-texCoord.y-attrVertIndex))).r;\n        opacity=texture(texOpacity,texCoord).r;\n    #endif\n\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        #ifdef RANDOM_COLORIZE\n            colorize=texture(texColorize,vec2(rand(attrVertIndex+texCoord.x*texCoord.y+texCoord.y+texCoord.x),rand(texCoord.y*texCoord.x-texCoord.x-texCoord.y-attrVertIndex)));\n        #endif\n        #ifndef RANDOM_COLORIZE\n            colorize=texture(texColorize,texCoord);\n        #endif\n    #endif\n\n\n\n\n\n    mat4 mMatrix=modelMatrix;\n    vec4 pos = vec4( vPosition, 1. );\n\n    gl_PointSize=0.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    vec4 model=mMatrix * pos;\n\n    psMul+=rand(texCoord.x*texCoord.y+texCoord.y*3.0+texCoord.x*2.0+attrVertIndex)*randomSize;\n    // psMul*=sizeMultiply;\n\n    float addPointSize=0.0;\n    #ifdef HAS_TEXTURE_POINTSIZE\n\n        #ifdef POINTSIZE_CHAN_R\n            addPointSize=texture(texPointSize,texCoord).r;\n        #endif\n        #ifdef POINTSIZE_CHAN_G\n            addPointSize=texture(texPointSize,texCoord).g;\n        #endif\n        #ifdef POINTSIZE_CHAN_B\n            addPointSize=texture(texPointSize,texCoord).b;\n        #endif\n\n\n        #ifdef DOTSIZEREMAPABS\n            // addPointSize=(( (texture(texPointSize,texCoord).r) * texPointSizeMul)-0.5)*2.0;\n\n            addPointSize=1.0-(distance(addPointSize,0.5)*2.0);\n            // addPointSize=abs(1.0-(distance(addPointSize,0.5)*2.0));\n            addPointSize=addPointSize*addPointSize*addPointSize*2.0;\n\n            // addPointSize=(( (texture(texPointSize,texCoord).r) * texPointSizeMul)-0.5)*2.0;\n        #endif\n\n        addPointSize*=texPointSizeMul;\n\n    #endif\n\n    ps=0.0;\n    #ifndef SCALE_BY_DISTANCE\n        ps = (pointSize+addPointSize) * psMul;\n    #endif\n    #ifdef SCALE_BY_DISTANCE\n        float cameraDist = distance(model.xyz, camPos);\n        ps = ( (pointSize+addPointSize) / cameraDist) * psMul;\n    #endif\n\n    gl_PointSize += ps;\n\n\n    gl_Position = projMatrix * viewMatrix * model;\n}\n"};const n=e.patch.cgl;const a=e.inTrigger("render"),i=e.inValueFloat("PointSize",3),r=e.inBool("Size in Pixels",false),o=e.inValue("Random Size",0),s=e.inValueBool("Round",true),l=e.inValueBool("Round Antialias",false),_=e.inValueBool("Scale by Distance",false),c=e.inValueSlider("r",Math.random()),u=e.inValueSlider("g",Math.random()),p=e.inValueSlider("b",Math.random()),g=e.inValueSlider("a",1),d=e.inBool("Vertex Colors",false),f=e.inTexture("texture"),m=e.inBool("Colorize Texture"),v=e.inTexture("Texture Mask"),h=e.inSwitch("Mask Channel",["R","A","Luminance"],"R"),x=e.inTexture("Texture Colorize"),b=e.inValueBool("Colorize Randomize",true),T=e.inTexture("Texture Opacity"),I=e.inTexture("Texture Point Size"),A=e.inSwitch("Point Size Channel",["R","G","B"],"R"),E=e.inFloat("Texture Point Size Mul",1),y=e.inSwitch("Map Size 0",["Black","Grey"],"Black"),S=e.inValueBool("Flip Texture",false),C=e.outTrigger("trigger"),O=e.outObject("shader");e.setPortGroup("Texture",[f,m,v,h,x,T,b]);e.setPortGroup("Color",[c,u,p,g,d]);e.setPortGroup("Size",[i,o,s,l,_,r,I,E,A]);c.setUiAttribs({colorPick:true});const N=new CGL.Shader(n,"PointMaterial");N.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);N.define("MAKE_ROUND");const L=new CGL.Uniform(N,"f","pointSize",i),U=new CGL.Uniform(N,"f","texPointSizeMul",E),P=new CGL.Uniform(N,"f","randomSize",o),R=new CGL.Uniform(N,"4f","color",c,u,p,g),M=new CGL.Uniform(N,"f","canvasWidth",n.canvasWidth),G=new CGL.Uniform(N,"f","canvasHeight",n.canvasHeight),w=new CGL.Uniform(N,"t","diffTex"),V=new CGL.Uniform(N,"t","texColorize"),D=new CGL.Uniform(N,"t","texOpacity"),B=new CGL.Uniform(N,"t","texPointSize"),k=new CGL.Uniform(N,"t","texPointSize"),F=new CGL.Uniform(N,"t","texMask");N.setSource(t.pointmat_vert,t.pointmat_frag);N.glPrimitive=n.gl.POINTS;O.set(N);O.ignoreValueSerialize=true;a.onTriggered=j;_.onChange=s.onChange=l.onChange=f.onChange=x.onChange=v.onChange=b.onChange=S.onChange=h.onChange=r.onChange=T.onChange=I.onChange=y.onChange=A.onChange=m.onChange=d.onChange=X;e.preRender=function(){if(N)N.bind();j()};function j(){M.setValue(n.canvasWidth);G.setValue(n.canvasHeight);n.pushShader(N);N.popTextures();if(f.get()&&!f.get().deleted)N.pushTexture(w,f.get());if(v.get())N.pushTexture(F,v.get());if(x.get())N.pushTexture(V,x.get());if(T.get())N.pushTexture(D,T.get());if(I.get())N.pushTexture(k,I.get());C.trigger();n.popShader()}function X(){N.toggleDefine("SCALE_BY_DISTANCE",_.get());N.toggleDefine("MAKE_ROUND",s.get());N.toggleDefine("MAKE_ROUNDAA",l.get());N.toggleDefine("VERTEX_COLORS",d.get());N.toggleDefine("RANDOM_COLORIZE",b.get());N.toggleDefine("HAS_TEXTURE_DIFFUSE",f.get());N.toggleDefine("HAS_TEXTURE_MASK",v.get());N.toggleDefine("HAS_TEXTURE_COLORIZE",x.get());N.toggleDefine("HAS_TEXTURE_OPACITY",T.get());N.toggleDefine("HAS_TEXTURE_POINTSIZE",I.get());N.toggleDefine("TEXTURE_COLORIZE_MUL",m.get());N.toggleDefine("FLIP_TEX",S.get());N.toggleDefine("TEXTURE_MASK_R",h.get()=="R");N.toggleDefine("TEXTURE_MASK_A",h.get()=="A");N.toggleDefine("TEXTURE_MASK_LUMI",h.get()=="Luminance");N.toggleDefine("PIXELSIZE",r.get());N.toggleDefine("POINTSIZE_CHAN_R",A.get()=="R");N.toggleDefine("POINTSIZE_CHAN_G",A.get()=="G");N.toggleDefine("POINTSIZE_CHAN_B",A.get()=="B");N.toggleDefine("DOTSIZEREMAPABS",y.get()=="Grey")}};Ops.Gl.Shader.PointMaterial_v4.prototype=new CABLES.Op;CABLES.OPS["a7cb5d1c-cd4a-4c28-bb13-7bb9bda187ed"]={f:Ops.Gl.Shader.PointMaterial_v4,objName:"Ops.Gl.Shader.PointMaterial_v4"};Ops.Gl.TextureToPointArray3=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const p=e.patch.cgl,n=e.inTrigger("update"),g=e.inBool("Center",true),d=e.inFloatSlider("Threshold Remove",0),f=e.inFloat("Z Multiply",1),m=e.inObject("texture"),v=e.inFloat("Width",2),h=e.inFloat("Height",2),x=e.outTrigger("trigger"),b=e.outArray("Points"),T=e.outNumber("Total Points"),I=e.outNumber("Min Z"),A=e.outNumber("Max Z");e.setPortGroup("Size",[v,h]);var E=null,y=null,S=null,C=false;m.onChange=function(){C=true};e.toWorkPortsNeedToBeLinked(m,b);var a=false;var O=e.patch.cgl.gl.UNSIGNED_BYTE;n.onTriggered=function(){var n=m.get(),e=p.gl;if(!n){b.set(null);A.set(0);T.set(0);return}if(!E)E=e.createFramebuffer();if(!S)S=[];e.bindFramebuffer(e.FRAMEBUFFER,E);if(C){e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n.tex,0);O=e.UNSIGNED_BYTE;const t=n.width*n.height*4;y=new Uint8Array(t);C=false}e.bindFramebuffer(e.FRAMEBUFFER,E);e.readPixels(0,0,n.width,n.height,e.RGBA,O,y);e.bindFramebuffer(e.FRAMEBUFFER,null);S.length=0;let a=0;let i=0;let r=v.get();let o=h.get();const s=d.get()*256;const l=f.get()/256;let _=0;let c=99999999;if(g.get()){a=n.width/2;i=n.height/2}for(let t=0;t<n.width;t++){for(let e=0;e<n.height;e++){if(y[(t+e*n.width)*4+0]>=s||y[(t+e*n.width)*4+1]>=s||y[(t+e*n.width)*4+2]>=s){const u=y[(t+e*n.width)*4+0]*l;S.push((t-a)/n.width*r,(e-i)/n.height*o,u);_=Math.max(u,_);c=Math.min(u,c)}}}I.set(c);A.set(_);b.set(null);T.set(S.length/3);b.set(S);e.bindFramebuffer(e.FRAMEBUFFER,null);x.trigger()}};Ops.Gl.TextureToPointArray3.prototype=new CABLES.Op;CABLES.OPS["93f03721-4b1e-4dee-aef9-7ef17c9cd6c1"]={f:Ops.Gl.TextureToPointArray3,objName:"Ops.Gl.TextureToPointArray3"};Ops.Gl.Textures.TextureToCoordinateGrid=function(){CABLES.Op.apply(this,arguments);const e=this;const t={rgbe2fp_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\nUNI float aspect;\nUNI float threshold;\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n    vec4 outCol=vec4(111111110.0);\n\n    if(col.r>threshold)\n    {\n        outCol=vec4(vec2((texCoord.x-0.5)*aspect,texCoord.y-0.5),0.0,1.0);\n        // outCol=vec4(texCoord,0.0,1.0);\n    }\n\n\n    outColor = outCol;\n}"};const n=e.inTrigger("Execute"),a=e.inTexture("RGBE Texture"),i=e.inFloat("Aspect",1),r=e.inFloatSlider("Threshold",.2),o=e.outTrigger("Next"),s=e.outTexture("HDR Texture");const l=new CGL.CopyTexture(e.patch.cgl,"rgbe2hdr",{shader:t.rgbe2fp_frag,isFloatingPointTexture:true});const _=new CGL.Uniform(l.bgShader,"f","aspect",i);const c=new CGL.Uniform(l.bgShader,"f","threshold",r);n.onTriggered=()=>{if(!a.get())return;s.set(CGL.Texture.getEmptyTexture(e.patch.cgl));s.set(l.copy(a.get()));o.trigger()}};Ops.Gl.Textures.TextureToCoordinateGrid.prototype=new CABLES.Op;CABLES.OPS["91f30465-4a4c-4447-9b16-072252f0a977"]={f:Ops.Gl.Textures.TextureToCoordinateGrid,objName:"Ops.Gl.Textures.TextureToCoordinateGrid"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});this.CGL=this.CGL||{},this.CGL.COREMODULES=this.CGL.COREMODULES||{},this.CGL.COREMODULES.Copytexture=function(n){var a={};function i(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,n){"use strict";n.r(t);class c{constructor(e){this._logs=[],this.initiator=e}stack(e){console.error("["+this.initiator+"] ",e),console.log((new Error).stack)}groupCollapsed(e){console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(e){console.error("["+this.initiator+"]",...arguments)}info(e){console.error("["+this.initiator+"]",...arguments)}warn(e){console.warn("["+this.initiator+"]",...arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments)}log(e){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments)}userInteraction(e){}}const i=function(){this._log=new c("eventtaget"),this._eventCallbacks={},this._logName="",this._logEvents=!1,this._listeners={},this.addEventListener=this.on=function(e,t,n){const a={id:(n||"")+CABLES.uuid(),name:e,cb:t};return this._eventCallbacks[e]?this._eventCallbacks[e].push(a):this._eventCallbacks[e]=[a],this._listeners[a.id]=a,a.id},this.hasEventListener=function(e,t){if(e&&!t)return!!this._listeners[e];if(this._log.warn("old eventtarget function haseventlistener!"),e&&t&&this._eventCallbacks[e]){return-1!=this._eventCallbacks[e].indexOf(t)}},this.removeEventListener=this.off=function(a,i){if(null==a)return;if(!i){const i=this._listeners[a];if(!i)return;let n=!0;for(;n;){n=!1;let t=-1;for(let e=0;e<this._eventCallbacks[i.name].length;e++)0===this._eventCallbacks[i.name][e].id.indexOf(a)&&(n=!0,t=e);-1!==t&&(this._eventCallbacks[i.name].splice(t,1),delete this._listeners[a])}return}this._log.stack(" old function signature: removeEventListener! use listener id");let t=null;for(let e=0;e<this._eventCallbacks[a].length;e++)this._eventCallbacks[a][e].cb==i&&(t=e);null!==t?delete this._eventCallbacks[t]:this._log.warn("removeEventListener not found "+a)},this.logEvents=function(e,t){this._logEvents=e,this._logName=t},this.emitEvent=function(t,n,a,i,r,o,s){if(this._logEvents&&console.log("[event] ",this._logName,t,this._eventCallbacks),this._eventCallbacks[t])for(let e=0;e<this._eventCallbacks[t].length;e++)this._eventCallbacks[t][e]&&this._eventCallbacks[t][e].cb(n,a,i,r,o,s);else this._logEvents&&console.log("[event] has no event callback",t,this._eventCallbacks)}},r={float32Concat:function(e,t){e instanceof Float32Array||(e=new Float32Array(e)),t instanceof Float32Array||(t=new Float32Array(t));const n=new Float32Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}},a=function(){let n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},o=a;Math.randomSeed=1,Math.seededRandom=function(e,t){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),e=e||1,t=t||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return t+Math.randomSeed/233280*(e-t)},r.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},r.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(e){return 0===this.indexOf(e)},String.prototype.endsWith=function(e){return this.match(e+"$")==e};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};const s={EASINGS:["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out"],EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27},l={OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},_={PORT_DIR_IN:0,PORT_DIR_OUT:1},u={Key:function(e){this.time=0,this.value=0,this.ui=null,this.onChange=null,this._easing=0,this.bezTangIn=0,this.bezTangOut=0,this.cb=null,this.cbTriggered=!1;this.setEasing(s.EASING_LINEAR),this.set(e)}};u.Key.cubicSpline=function(e,t,n){let a=e*e,i=a*e;return(2*i-3*a+1)*t.value+(i-2*a+e)*t.bezTangOut+(-2*i+3*a)*n.value+(i-a)*n.bezTangIn},u.Key.easeCubicSpline=function(e,t){return u.Key.cubicSpline(e,this,t)},u.Key.linear=function(e,t,n){return parseFloat(t.value)+parseFloat(n.value-t.value)*e},u.Key.easeLinear=function(e,t){return u.Key.linear(e,this,t)},u.Key.easeAbsolute=function(e,t){return this.value};u.Key.easeExpoIn=function(e,t){return e=function(e){return Math.pow(2,10*(e-1))}(e),u.Key.linear(e,this,t)};u.Key.easeExpoOut=function(e,t){return e=function(e){return e=1-Math.pow(2,-10*e)}(e),u.Key.linear(e,this,t)};u.Key.easeExpoInOut=function(e,t){return e=function(e){return(e*=2)<1?e=.5*Math.pow(2,10*(e-1)):(e--,e=.5*(2-Math.pow(2,-10*e))),e}(e),u.Key.linear(e,this,t)},u.Key.easeSinIn=function(e,t){return e=-1*Math.cos(e*Math.PI/2)+1,u.Key.linear(e,this,t)},u.Key.easeSinOut=function(e,t){return e=Math.sin(e*Math.PI/2),u.Key.linear(e,this,t)},u.Key.easeSinInOut=function(e,t){return e=-.5*(Math.cos(Math.PI*e)-1),u.Key.linear(e,this,t)};u.Key.easeCubicIn=function(e,t){return e=function(e){return e*=e*e}(e),u.Key.linear(e,this,t)},u.Key.easeInQuint=function(e,t){return e*=e*e*e*e,u.Key.linear(e,this,t)},u.Key.easeOutQuint=function(e,t){return e=(e-=1)*e*e*e*e+1,u.Key.linear(e,this,t)},u.Key.easeInOutQuint=function(e,t){return(e/=.5)<1?e*=.5*e*e*e*e:e=.5*((e-=2)*e*e*e*e+2),u.Key.linear(e,this,t)},u.Key.easeInQuart=function(e,t){return e*=e*e*e,u.Key.linear(e,this,t)},u.Key.easeOutQuart=function(e,t){return e=-1*((e-=1)*e*e*e-1),u.Key.linear(e,this,t)},u.Key.easeInOutQuart=function(e,t){return(e/=.5)<1?e*=.5*e*e*e:e=-.5*((e-=2)*e*e*e-2),u.Key.linear(e,this,t)},u.Key.bounce=function(e){return(e/=1)<1/2.75?e*=7.5625*e:e=e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,e},u.Key.easeInBounce=function(e,t){return u.Key.linear(u.Key.bounce(e),this,t)},u.Key.easeOutBounce=function(e,t){return u.Key.linear(u.Key.bounce(e),this,t)},u.Key.easeInElastic=function(e,t){let n=1.70158,a=0,i=1;return 0===e?e=0:1==(e/=1)?e=1:(a||(a=.3),i<Math.abs(1)?(i=1,n=a/4):n=a/(2*Math.PI)*Math.asin(1/i),e=-i*Math.pow(2,10*(e-=1))*Math.sin((1*e-n)*(2*Math.PI)/a)+0),u.Key.linear(e,this,t)},u.Key.easeOutElastic=function(e,t){let n=1.70158,a=0,i=1;return 0===e?e=0:1==(e/=1)?e=1:(a||(a=.3),i<Math.abs(1)?(i=1,n=a/4):n=a/(2*Math.PI)*Math.asin(1/i),e=i*Math.pow(2,-10*e)*Math.sin((1*e-n)*(2*Math.PI)/a)+1+0),u.Key.linear(e,this,t)},u.Key.easeInBack=function(e,t){const n=1.70158;return e=e*e*((n+1)*e-n),u.Key.linear(e,this,t)},u.Key.easeOutBack=function(e,t){const n=1.70158;return e=(e=e/1-1)*e*((n+1)*e+n)+1,u.Key.linear(e,this,t)},u.Key.easeInOutBack=function(e,t){let n=1.70158;return e=(e/=.5)<1?e*e*((1+(n*=1.525))*e-n)*.5:.5*((e-=2)*e*((1+(n*=1.525))*e+n)+2),u.Key.linear(e,this,t)};u.Key.easeCubicOut=function(e,t){return e=function(e){return e=--e*e*e+1}(e),u.Key.linear(e,this,t)};u.Key.easeCubicInOut=function(e,t){return e=function(e){return(e*=2)<1?e*=.5*e*e:e=.5*((e-=2)*e*e+2),e}(e),u.Key.linear(e,this,t)},u.Key.easeSmoothStep=function(e,t){const n=Math.max(0,Math.min(1,e));return e=n*n*(3-2*n),u.Key.linear(e,this,t)},u.Key.easeSmootherStep=function(e,t){const n=Math.max(0,Math.min(1,(e-0)/1));return e=n*n*n*(n*(6*n-15)+10),u.Key.linear(e,this,t)},u.Key.prototype.setEasing=function(e){this._easing=e,this._easing==s.EASING_LINEAR?this.ease=u.Key.easeLinear:this._easing==s.EASING_ABSOLUTE?this.ease=u.Key.easeAbsolute:this._easing==s.EASING_SMOOTHSTEP?this.ease=u.Key.easeSmoothStep:this._easing==s.EASING_SMOOTHERSTEP?this.ease=u.Key.easeSmootherStep:this._easing==s.EASING_CUBIC_IN?this.ease=u.Key.easeCubicIn:this._easing==s.EASING_CUBIC_OUT?this.ease=u.Key.easeCubicOut:this._easing==s.EASING_CUBIC_INOUT?this.ease=u.Key.easeCubicInOut:this._easing==s.EASING_EXPO_IN?this.ease=u.Key.easeExpoIn:this._easing==s.EASING_EXPO_OUT?this.ease=u.Key.easeExpoOut:this._easing==s.EASING_EXPO_INOUT?this.ease=u.Key.easeExpoInOut:this._easing==s.EASING_SIN_IN?this.ease=u.Key.easeSinIn:this._easing==s.EASING_SIN_OUT?this.ease=u.Key.easeSinOut:this._easing==s.EASING_SIN_INOUT?this.ease=u.Key.easeSinInOut:this._easing==s.EASING_BACK_OUT?this.ease=u.Key.easeOutBack:this._easing==s.EASING_BACK_IN?this.ease=u.Key.easeInBack:this._easing==s.EASING_BACK_INOUT?this.ease=u.Key.easeInOutBack:this._easing==s.EASING_ELASTIC_IN?this.ease=u.Key.easeInElastic:this._easing==s.EASING_ELASTIC_OUT?this.ease=u.Key.easeOutElastic:this._easing==s.EASING_ELASTIC_INOUT?this.ease=u.Key.easeElasticInOut:this._easing==s.EASING_BOUNCE_IN?this.ease=u.Key.easeInBounce:this._easing==s.EASING_BOUNCE_OUT?this.ease=u.Key.easeOutBounce:this._easing==s.EASING_QUART_OUT?this.ease=u.Key.easeOutQuart:this._easing==s.EASING_QUART_IN?this.ease=u.Key.easeInQuart:this._easing==s.EASING_QUART_INOUT?this.ease=u.Key.easeInOutQuart:this._easing==s.EASING_QUINT_OUT?this.ease=u.Key.easeOutQuint:this._easing==s.EASING_QUINT_IN?this.ease=u.Key.easeInQuint:this._easing==s.EASING_QUINT_INOUT?this.ease=u.Key.easeInOutQuint:this._easing==s.EASING_CUBICSPLINE?this.ease=u.Key.easeCubicSpline:(this._easing=s.EASING_LINEAR,this.ease=u.Key.easeLinear)},u.Key.prototype.trigger=function(){this.cb(),this.cbTriggered=!0},u.Key.prototype.setValue=function(e){this.value=e,null!==this.onChange&&this.onChange()},u.Key.prototype.set=function(e){e&&(e.e&&this.setEasing(e.e),e.cb&&(this.cb=e.cb,this.cbTriggered=!1),e.b,e.hasOwnProperty("t")&&(this.time=e.t),e.hasOwnProperty("time")&&(this.time=e.time),e.hasOwnProperty("v")?this.value=e.v:e.hasOwnProperty("value")&&(this.value=e.value)),null!==this.onChange&&this.onChange()},u.Key.prototype.getSerialized=function(){const e={};return e.t=this.time,e.v=this.value,e.e=this._easing,e},u.Key.prototype.getEasing=function(){return this._easing};const p=function(e){e=e||{},this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this._log=new c("Anim"),this.defaultEasing=e.defaultEasing||s.EASING_LINEAR,this.onLooped=null,this._timesLooped=0,this._needsSort=!1};p.prototype.forceChangeCallback=function(){null!==this.onChange&&this.onChange()},p.prototype.hasEnded=function(e){return 0===this.keys.length||this.keys[this.keys.length-1].time<=e},p.prototype.isRising=function(e){if(this.hasEnded(e))return!1;const t=this.getKeyIndex(e);return this.keys[t].value<this.keys[t+1].value},p.prototype.clearBefore=function(e){const t=this.getValue(e),n=this.getKeyIndex(e);this.setValue(e,t),n>1&&this.keys.splice(0,n)},p.prototype.clear=function(e){let t=0;e&&(t=this.getValue(e)),this.keys.length=0,e&&this.setValue(e,t),null!==this.onChange&&this.onChange()},p.prototype.sortKeys=function(){this.keys.sort((e,t)=>parseFloat(e.time)-parseFloat(t.time)),this._needsSort=!1},p.prototype.getLength=function(){return 0===this.keys.length?0:this.keys[this.keys.length-1].time},p.prototype.getKeyIndex=function(t){let n=0;for(let e=0;e<this.keys.length;e++)if(t>=this.keys[e].time&&(n=e),this.keys[e].time>t)return n;return n},p.prototype.setValue=function(t,n,a){let i=null;for(const e in this.keys)if(this.keys[e].time==t){i=this.keys[e],this.keys[e].setValue(n),this.keys[e].cb=a;break}return i||(i=new u.Key({time:t,value:n,e:this.defaultEasing,cb:a}),this.keys.push(i)),this.onChange&&this.onChange(),this._needsSort=!0,i},p.prototype.getSerialized=function(){const t={keys:[]};t.loop=this.loop;for(const e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},p.prototype.getKey=function(e){const t=this.getKeyIndex(e);return this.keys[t]},p.prototype.getNextKey=function(e){let t=this.getKeyIndex(e)+1;return t>=this.keys.length&&(t=this.keys.length-1),this.keys[t]},p.prototype.isFinished=function(e){return this.keys.length<=0||e>this.keys[this.keys.length-1].time},p.prototype.isStarted=function(e){return!(this.keys.length<=0)&&e>=this.keys[0].time},p.prototype.getValue=function(e){if(0===this.keys.length)return 0;if(this._needsSort&&this.sortKeys(),e<this.keys[0].time)return this.keys[0].value;const t=this.keys.length-1;if(this.loop&&e>this.keys[t].time){e/this.keys[t].time>this._timesLooped&&(this._timesLooped++,this.onLooped&&this.onLooped()),e=(e-this.keys[0].time)%(this.keys[t].time-this.keys[0].time),e+=this.keys[0].time}const n=this.getKeyIndex(e);if(n>=t)return this.keys[t].cb&&!this.keys[t].cbTriggered&&this.keys[t].trigger(),this.keys[t].value;const a=parseInt(n,10)+1,i=this.keys[n],r=this.keys[a];if(i.cb&&!i.cbTriggered&&i.trigger(),!r)return-1;const o=(e-i.time)/(r.time-i.time);return i.ease||this.log._warn("has no ease",i,r),i.ease(o,r)},p.prototype.addKey=function(e){void 0===e.time?this.log.warn("key time undefined, ignoring!"):(this.keys.push(e),null!==this.onChange&&this.onChange())},p.prototype.easingFromString=function(e){return"linear"==e?s.EASING_LINEAR:"absolute"==e?s.EASING_ABSOLUTE:"smoothstep"==e?s.EASING_SMOOTHSTEP:"smootherstep"==e?s.EASING_SMOOTHERSTEP:"Cubic In"==e?s.EASING_CUBIC_IN:"Cubic Out"==e?s.EASING_CUBIC_OUT:"Cubic In Out"==e?s.EASING_CUBIC_INOUT:"Expo In"==e?s.EASING_EXPO_IN:"Expo Out"==e?s.EASING_EXPO_OUT:"Expo In Out"==e?s.EASING_EXPO_INOUT:"Sin In"==e?s.EASING_SIN_IN:"Sin Out"==e?s.EASING_SIN_OUT:"Sin In Out"==e?s.EASING_SIN_INOUT:"Back In"==e?s.EASING_BACK_IN:"Back Out"==e?s.EASING_BACK_OUT:"Back In Out"==e?s.EASING_BACK_INOUT:"Elastic In"==e?s.EASING_ELASTIC_IN:"Elastic Out"==e?s.EASING_ELASTIC_OUT:"Bounce In"==e?s.EASING_BOUNCE_IN:"Bounce Out"==e?s.EASING_BOUNCE_OUT:"Quart Out"==e?s.EASING_QUART_OUT:"Quart In"==e?s.EASING_QUART_IN:"Quart In Out"==e?s.EASING_QUART_INOUT:"Quint Out"==e?s.EASING_QUINT_OUT:"Quint In"==e?s.EASING_QUINT_IN:"Quint In Out"==e?s.EASING_QUINT_INOUT:void 0},p.prototype.createPort=function(e,t,n){const a=e.inDropDown(t,s.EASINGS);return a.set("linear"),a.defaultValue="linear",a.onChange=function(){this.defaultEasing=this.easingFromString(a.get()),n&&n()}.bind(this),a},p.slerpQuaternion=function(n,a,i,r,o,s){p.slerpQuaternion.q1||(p.slerpQuaternion.q1=quat.create(),p.slerpQuaternion.q2=quat.create());const l=i.getKeyIndex(n);let _=l+1;if(_>=i.keys.length&&(_=i.keys.length-1),l==_)quat.set(a,i.keys[l].value,r.keys[l].value,o.keys[l].value,s.keys[l].value);else{const e=i.keys[l].time,t=(n-e)/(i.keys[_].time-e);quat.set(p.slerpQuaternion.q1,i.keys[l].value,r.keys[l].value,o.keys[l].value,s.keys[l].value),quat.set(p.slerpQuaternion.q2,i.keys[_].value,r.keys[_].value,o.keys[_].value,s.keys[_].value),quat.slerp(a,p.slerpQuaternion.q1,p.slerpQuaternion.q2,t)}return a};u.Anim=p;const g=function(e,t,n,a){i.apply(this),this.data={},this._log=new c("core_port"),this.direction=_.PORT_DIR_IN,this.id=o(),this.parent=e,this.links=[],this.value=0,this.name=t,this.type=n||l.OP_PORT_TYPE_VALUE,this.uiAttribs=a||{},this.anim=null,this._oldAnimVal=-5711,this.defaultValue=null,this._uiActiveState=!0,this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.crashed=!1,this._valueBeforeLink=null,this._lastAnimFrame=-1,this._animated=!1,this.onValueChanged=null,this.onTriggered=null,this.onUiActiveStateChange=null,this.changeAlways=!1,this._warnedDeprecated=!1,this._useVariableName=null,this.activityCounter=0,this._tempLastUiValue=null,Object.defineProperty(this,"val",{get(){return this._log.warn("val getter deprecated!",this),this._log.stack("val getter deprecated"),this._warnedDeprecated=!0,this.get()},set(e){this._log.warn("val setter deprecated!",this),this._log.stack("val setter deprecated"),this.setValue(e),this._warnedDeprecated=!0}})};g.prototype.getValueForDisplay=function(){let e=String(this.value);return e.length>100&&(e=e.substring(0,100)),e},g.prototype.onAnimToggle=function(){},g.prototype._onAnimToggle=function(){this.onAnimToggle()},g.prototype.remove=function(){this.removeLinks(),this.parent.removePort(this)},g.prototype.setUiAttribs=function(t){let n=!1;this.uiAttribs||(this.uiAttribs={});for(const e in t)this.uiAttribs[e]!=t[e]&&(n=!0),this.uiAttribs[e]=t[e],"group"==e&&this.indexPort&&this.indexPort.setUiAttribs({group:t[e]});n&&this.emitEvent("onUiAttrChange",t)},g.prototype.getUiAttribs=function(){return this.uiAttribs},g.prototype.getUiAttrib=function(e){return this.uiAttribs&&this.uiAttribs.hasOwnProperty(e)?this.uiAttribs[e]:null},g.prototype.get=function(){return this._animated&&this._lastAnimFrame!=this.parent.patch.getFrameNum()&&(this._lastAnimFrame=this.parent.patch.getFrameNum(),this.value=this.anim.getValue(this.parent.patch.timer.getTime()),this._oldAnimVal=this.value,this.forceChange()),this.value},g.prototype.set=g.prototype.setValue=function(e){if(void 0!==e&&this.parent.enabled&&!this.crashed&&(e!==this.value||this.changeAlways||this.type==l.OP_PORT_TYPE_TEXTURE||this.type==l.OP_PORT_TYPE_ARRAY)){if(this._animated)this.anim.setValue(this.parent.patch.timer.getTime(),e);else{try{this.value=e,this.forceChange()}catch(e){this.crashed=!0,this.setValue=function(e){},this.onTriggered=function(){},this._log.error("onvaluechanged exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+this.parent.name),this.parent.patch.isEditorMode()&&gui.showOpCrash(this.parent),this.parent.patch.emitEvent("exception".ex,this.parent),this.parent.onError&&this.parent.onError(e)}this.parent&&this.parent.patch&&this.parent.patch.isEditorMode()&&this.type==l.OP_PORT_TYPE_TEXTURE&&gui.texturePreview().updateTexturePort(this)}if(this.direction==_.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}},g.prototype.updateAnim=function(){this._animated&&(this.value=this.get(),(this._oldAnimVal!=this.value||this.changeAlways)&&(this._oldAnimVal=this.value,this.forceChange()),this._oldAnimVal=this.value)},g.args=function(e){return(e+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},g.prototype.forceChange=function(){this.onValueChanged||this.onChange,this._activity(),this.emitEvent("change",this.value,this),this.onChange?this.onChange(this,this.value):this.onValueChanged&&this.onValueChanged(this,this.value)},g.prototype.getTypeString=function(){return this.type==l.OP_PORT_TYPE_VALUE?"Number":this.type==l.OP_PORT_TYPE_FUNCTION?"Trigger":this.type==l.OP_PORT_TYPE_OBJECT?"Object":this.type==l.OP_PORT_TYPE_DYNAMIC?"Dynamic":this.type==l.OP_PORT_TYPE_ARRAY?"Array":this.type==l.OP_PORT_TYPE_STRING?"String":"Unknown"},g.prototype.deSerializeSettings=function(t){if(t&&(t.animated&&this.setAnimated(t.animated),t.useVariable&&this.setVariableName(t.useVariable),t.anim)){this.anim||(this.anim=new p),t.anim.loop&&(this.anim.loop=t.anim.loop);for(const e in t.anim.keys)this.anim.keys.push(new u.Key(t.anim.keys[e]))}},g.prototype.getSerialized=function(){const t={};if(t.name=this.getName(),this.ignoreValueSerialize||0!==this.links.length||this.type==l.OP_PORT_TYPE_OBJECT&&this.value&&this.value.tex||(t.value=this.value),this._useVariableName&&(t.useVariable=this._useVariableName),this._animated&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),"file"==this.uiAttribs.display&&(t.display=this.uiAttribs.display),this.direction==_.PORT_DIR_OUT&&this.links.length>0){t.links=[];for(const e in this.links)!this.links[e].ignoreInSerialize&&this.links[e].portIn&&this.links[e].portOut&&t.links.push(this.links[e].getSerialized())}return t},g.prototype.shouldLink=function(){return!0},g.prototype.removeLinks=function(){let e=0;for(;this.links.length>0;){if(e++,e>5e3){this._log.warn("could not delete links... / infinite loop"),this.links.length=0;break}this.links[0].remove()}},g.prototype.removeLink=function(t){for(const e in this.links)this.links[e]==t&&this.links.splice(e,1);this.direction==_.PORT_DIR_IN&&(this.type==l.OP_PORT_TYPE_VALUE?this.setValue(this._valueBeforeLink||0):this.setValue(this._valueBeforeLink||null)),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},g.prototype.getName=function(){return this.name},g.prototype.addLink=function(e){this._valueBeforeLink=this.value,this.links.push(e),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},g.prototype.getLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]},g.prototype.removeLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e].remove(),this.onLinkChanged&&this.onLinkChanged(),void this.emitEvent("onLinkChanged")},g.prototype.isLinkedTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},g.prototype._activity=function(){this.activityCounter++},g.prototype.trigger=function(){if(this._activity(),0===this.links.length)return;if(!this.parent.enabled)return;let t=null;try{for(let e=0;e<this.links.length;++e)this.links[e].portIn&&(t=this.links[e].portIn,t.parent.patch.pushTriggerStack(t),t._onTriggered(),t.parent.patch.popTriggerStack()),this.links[e]&&this.links[e].activity()}catch(e){this.parent.enabled=!1,this.parent.patch.isEditorMode()&&(this.parent.patch.emitEvent("exception",e,t.parent),this.parent.patch.emitEvent("opcrash",t),t.parent.onError&&t.parent.onError(e)),this._log.warn("exception!"),this._log.error("ontriggered exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+t.parent.name)}},g.prototype.call=function(){this._log.warn("call deprecated - use trigger() "),this.trigger()},g.prototype.execute=function(){this._log.warn("### execute port: "+this.getName(),this.goals.length)},g.prototype.setVariableName=function(e){this._useVariableName=e},g.prototype.getVariableName=function(){return this._useVariableName},g.prototype.setVariable=function(e){this.setAnimated(!1);const t={useVariable:!1};this._variableIn&&(this._variableIn.removeListener(this.set.bind(this)),this._variableIn=null),e?(this._variableIn=this.parent.patch.getVar(e),this._variableIn?(this.type==l.OP_PORT_TYPE_OBJECT?this._variableIn.addListener(()=>{this.set(null),this.set(this._variableIn.getValue())}):this._variableIn.addListener(this.set.bind(this)),this.set(this._variableIn.getValue())):this._log.warn("PORT VAR NOT FOUND!!!",e),this._useVariableName=e,t.useVariable=!0,t.variableName=this._useVariableName):(t.variableName=this._useVariableName=null,t.useVariable=!1),this.setUiAttribs(t)},g.prototype._handleNoTriggerOpAnimUpdates=function(e){let t=!1;for(let e=0;e<this.parent.portsIn.length;e++)if(this.parent.portsIn.type==l.OP_PORT_TYPE_FUNCTION){t=!0;break}t||(e?this._notriggerAnimUpdate=this.parent.patch.on("onRenderFrame",()=>{this.updateAnim()}):this.parent.patch.removeEventListener(this._notriggerAnimUpdate))},g.prototype.setAnimated=function(e){this._animated!=e&&(this._animated=e,this._animated&&!this.anim&&(this.anim=new p),this._onAnimToggle()),this._handleNoTriggerOpAnimUpdates(e),this.setUiAttribs({isAnimated:this._animated})},g.prototype.toggleAnim=function(e){this._animated=!this._animated,this._animated&&!this.anim&&(this.anim=new p),this.setAnimated(this._animated),this._onAnimToggle(),this.setUiAttribs({isAnimated:this._animated})},g.prototype.getType=function(){return this.type},g.prototype.isLinked=function(){return this.links.length>0},g.prototype.isBoundToVar=function(){return null!=this._useVariableName},g.prototype.isAnimated=function(){return this._animated},g.prototype.isHidden=function(){return this.uiAttribs.hidePort},g.prototype._onTriggered=function(e){this._activity(),this.parent.updateAnims(),this.parent.enabled&&this.onTriggered&&this.onTriggered(e)},g.prototype._onSetProfiling=function(e){this.parent.patch.profiler.add("port",this),this.setValue(e),this.parent.patch.profiler.add("port",null)},g.prototype._onTriggeredProfiling=function(){this.parent.enabled&&this.onTriggered&&(this.parent.patch.profiler.add("port",this),this.onTriggered(),this.parent.patch.profiler.add("port",null))},g.prototype.onValueChange=function(e){this.onChange=e},g.prototype.getUiActiveState=function(){return this._uiActiveState},g.prototype.setUiActiveState=function(e){this._uiActiveState=e,this.onUiActiveStateChange&&this.onUiActiveStateChange()},g.prototype.hidePort=function(){this._log.warn("op.hideport() is deprecated, do not use it!")},g.portTypeNumberToString=function(e){return e==l.OP_PORT_TYPE_VALUE?"value":e==l.OP_PORT_TYPE_FUNCTION?"function":e==l.OP_PORT_TYPE_OBJECT?"object":e==l.OP_PORT_TYPE_ARRAY?"array":e==l.OP_PORT_TYPE_STRING?"string":e==l.OP_PORT_TYPE_DYNAMIC?"dynamic":"unknown"};const d=function(e,t,n,a,i,r,o,s,l,_){if(this._loc=-1,this._log=new c("cgl_uniform"),this._type=t,this._cgl=e._cgl,this._name=n,this._shader=e,this._value=1e-5,this._oldValue=null,this._port=null,this._structName=l,this._structUniformName=s,this._propertyName=_,this._shader._addUniform(this),this.needsUpdate=!0,this.shaderType=null,this.comment=null,"f"==t)this.set=this.setValue=this.setValueF.bind(this),this.updateValue=this.updateValueF.bind(this);else if("f[]"==t)this.set=this.setValue=this.setValueArrayF.bind(this),this.updateValue=this.updateValueArrayF.bind(this);else if("2f[]"==t)this.set=this.setValue=this.setValueArray2F.bind(this),this.updateValue=this.updateValueArray2F.bind(this);else if("3f[]"==t)this.set=this.setValue=this.setValueArray3F.bind(this),this.updateValue=this.updateValueArray3F.bind(this);else if("4f[]"==t)this.set=this.setValue=this.setValueArray4F.bind(this),this.updateValue=this.updateValueArray4F.bind(this);else if("i"==t)this.set=this.setValue=this.setValueI.bind(this),this.updateValue=this.updateValueI.bind(this);else if("2i"==t)this.set=this.setValue=this.setValue2I.bind(this),this.updateValue=this.updateValue2I.bind(this);else if("3i"==t)this.set=this.setValue=this.setValue3I.bind(this),this.updateValue=this.updateValue3I.bind(this);else if("4i"==t)this.set=this.setValue=this.setValue4I.bind(this),this.updateValue=this.updateValue4I.bind(this);else if("b"==t)this.set=this.setValue=this.setValueBool.bind(this),this.updateValue=this.updateValueBool.bind(this);else if("4f"==t)this.set=this.setValue=this.setValue4F.bind(this),this.updateValue=this.updateValue4F.bind(this);else if("3f"==t)this.set=this.setValue=this.setValue3F.bind(this),this.updateValue=this.updateValue3F.bind(this);else if("2f"==t)this.set=this.setValue=this.setValue2F.bind(this),this.updateValue=this.updateValue2F.bind(this);else if("t"==t)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("tc"==t)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("t[]"==t)this.set=this.setValue=this.setValueArrayT.bind(this),this.updateValue=this.updateValueArrayT.bind(this);else{if("m4"!=t&&"m4[]"!=t)throw new Error("Unknown uniform type");this.set=this.setValue=this.setValueM4.bind(this),this.updateValue=this.updateValueM4.bind(this)}"object"==typeof a&&a instanceof g?(this._port=a,this._value=this._port.get(),i&&r&&o?(i instanceof g&&r instanceof g&&o instanceof g||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0,0],this._port2=i,this._port3=r,this._port4=o,this._port.on("change",this.updateFromPort4f.bind(this)),this._port2.on("change",this.updateFromPort4f.bind(this)),this._port3.on("change",this.updateFromPort4f.bind(this)),this._port4.on("change",this.updateFromPort4f.bind(this)),this.updateFromPort4f()):i&&r?(i instanceof g&&r instanceof g||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0],this._port2=i,this._port3=r,this._port.on("change",this.updateFromPort3f.bind(this)),this._port2.on("change",this.updateFromPort3f.bind(this)),this._port3.on("change",this.updateFromPort3f.bind(this)),this.updateFromPort3f()):i?(i instanceof g||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0],this._port2=i,this._port.on("change",this.updateFromPort2f.bind(this)),this._port2.on("change",this.updateFromPort2f.bind(this)),this.updateFromPort2f()):this._port.on("change",this.updateFromPort.bind(this))):this._value=a,this.setValue(this._value),this.needsUpdate=!0};d.prototype.copy=function(e){const t=new d(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);return t.shaderType=this.shaderType,t},d.prototype.getGlslTypeString=function(){return"f"==this._type?"float":"i"==this._type?"int":"2i"==this._type?"ivec2":"2f"==this._type?"vec2":"3f"==this._type?"vec3":"4f"==this._type?"vec4":"m4"==this._type?"mat4":"t"==this._type?"sampler2D":"tc"==this._type?"samplerCube":"3f[]"==this._type||"m4[]"==this._type?null:void this._log.warn("[CGL UNIFORM] unknown glsl type string ",this._type)},d.prototype._isValidLoc=function(){return-1!=this._loc},d.prototype.getType=function(){return this._type},d.prototype.getName=function(){return this._name},d.prototype.getValue=function(){return this._value},d.prototype.getShaderType=function(){return this.shaderType},d.prototype.isStructMember=function(){return!!this._structName},d.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},d.prototype.bindTextures=function(){return this._value},d.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},d.prototype.bindTextures=function(){},d.prototype.getLoc=function(){return this._loc},d.prototype.updateFromPort4f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this._value[3]=this._port4.get(),this.setValue(this._value)},d.prototype.updateFromPort3f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this.setValue(this._value)},d.prototype.updateFromPort2f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this.setValue(this._value)},d.prototype.updateFromPort=function(){this.setValue(this._port.get())},d.prototype.updateValueF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1f(this._loc,this._value),this._cgl.profileData.profileUniformCount++},d.prototype.setValueF=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},d.prototype.updateValueI=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value),this._cgl.profileData.profileUniformCount++},d.prototype.updateValue2I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},d.prototype.updateValue3I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},d.prototype.updateValue4I=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},d.prototype.setValueI=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},d.prototype.setValue2I=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1],this.needsUpdate=!0),this._value=e)},d.prototype.setValue3I=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2],this.needsUpdate=!0),this._value=e)},d.prototype.setValue4I=function(e){this.needsUpdate=!0,this._value=e||vec4.create()},d.prototype.updateValueBool=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0),this._cgl.profileData.profileUniformCount++},d.prototype.setValueBool=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},d.prototype.setValueArray4F=function(e){this.needsUpdate=!0,this._value=e},d.prototype.updateValueArray4F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform4fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},d.prototype.setValueArray3F=function(e){this.needsUpdate=!0,this._value=e},d.prototype.updateValueArray3F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform3fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},d.prototype.setValueArray2F=function(e){this.needsUpdate=!0,this._value=e},d.prototype.updateValueArray2F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform2fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},d.prototype.setValueArrayF=function(e){this.needsUpdate=!0,this._value=e},d.prototype.updateValueArrayF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},d.prototype.setValueArrayT=function(e){this.needsUpdate=!0,this._value=e},d.prototype.updateValue3F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},d.prototype.setValue3F=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2],this.needsUpdate=!0),this._value=e)},d.prototype.updateValue2F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},d.prototype.setValue2F=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1],this.needsUpdate=!0),this._value=e)},d.prototype.updateValue4F=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||(this._log.warn("no value for uniform",this._name,this),this._value=[0,0,0,0]),this.needsUpdate=!1,this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},d.prototype.setValue4F=function(e){"number"==typeof this.value&&(this.value=vec4.create()),e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]&&e[3]==this._oldValue[3]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2,3],this.needsUpdate=!0),this._value=e)},d.prototype.updateValueM4=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||console.log("this.name",this.name,this._value),this._shader.getCgl().gl.uniformMatrix4fv(this._loc,!1,this._value),this._cgl.profileData.profileUniformCount++},d.prototype.setValueM4=function(e){this.needsUpdate=!0,this._value=e||mat4.create()},d.prototype.updateValueArrayT=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1iv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},d.prototype.updateValueT=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._cgl.profileData.profileUniformCount++,this._shader.getCgl().gl.uniform1i(this._loc,this._value),this.needsUpdate=!1},d.prototype.setValueT=function(e){this.needsUpdate=!0,this._value=e};const f=180/Math.PI,m=(Math.PI,{SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_VIEWPOS:"camPos"});const v={lastMesh:null},h=function(e,t,n){this._cgl=e,this._log=new c("cgl_mesh"),this._bufVertexAttrib=null,this._bufVerticesIndizes=this._cgl.gl.createBuffer(),this._attributes=[],this._attribLocs={},this._geom=null,this._lastShader=null,this._numInstances=0,this._glPrimitive=n,this._preWireframeGeom=null,this.addVertexNumbers=!1,this.feedBackAttributes=[],this.setGeom(t),this._feedBacks=[],this._feedBacksChanged=!1,this._transformFeedBackLoc=-1,this._lastAttrUpdate=0,this._name="unknown",this._cgl.profileData.addHeavyEvent("mesh constructed",this._name),this._queryExt=null,Object.defineProperty(this,"numInstances",{get(){return this._numInstances},set(e){this.setNumInstances(e)}})};h.prototype.updateVertices=function(e){this.setAttribute(m.SHADERVAR_VERTEX_POSITION,e.vertices,3),this._numVerts=e.vertices.length/3},h.prototype.setAttributePointer=function(t,n,a,i){for(let e=0;e<this._attributes.length;e++)this._attributes[e].name==t&&(this._attributes[e].pointer||(this._attributes[e].pointer=[]),this._attributes[e].pointer.push({loc:-1,name:n,stride:a,offset:i,instanced:t==m.SHADERVAR_INSTANCE_MMATRIX}))},h.prototype.getAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]},h.prototype.setAttributeRange=function(e,t,n,a){e&&(n||a)&&(e.name||(console.log(e),this._log.stack("no attrname?!")),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,e.buffer),this._cgl.profileData.profileMeshAttributes+=a-n||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]=this._cgl.profileData.profileSingleMeshAttribute[this._name]||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]+=a-n||0,e.numItems<t.length/e.itemSize&&this._resizeAttr(t,e),a>=t.length-1&&this._log.log(this._cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,a,n,e),1==this._cgl.glVersion?this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,0,t):this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,4*n,t,n,a-n))},h.prototype._resizeAttr=function(e,t){t.buffer&&this._cgl.gl.deleteBuffer(t.buffer),t.buffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,t.buffer),this._bufferArray(e,t),t.numItems=e.length/t.itemSize},h.prototype._bufferArray=function(e,t){let n=null;e&&(this._cgl.debugOneFrame&&console.log("_bufferArray",e.length,t.name),e instanceof Float32Array?n=e:t&&n&&n.length==e.length?n.set(e):(n=new Float32Array(e),this._cgl.debugOneFrame&&console.log("_bufferArray create new float32array",e.length,t.name),this._cgl.profileData.profileNonTypedAttrib++,this._cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"),t.arrayLength=n.length,this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,n,this._cgl.gl.DYNAMIC_DRAW))},h.prototype.addAttribute=h.prototype.updateAttribute=h.prototype.setAttribute=function(e,t,n,a){if(!t)throw this._log.error("mesh addAttribute - no array given! "+e),new Error;let i=null,r=!1,o=0;const s=t.length/n;for(this._cgl.profileData.profileMeshAttributes+=s||0,"function"==typeof a&&(i=a),"object"==typeof a&&(a.cb&&(i=a.cb),a.instanced&&(r=a.instanced)),e==m.SHADERVAR_INSTANCE_MMATRIX&&(r=!0),o=0;o<this._attributes.length;o++){const n=this._attributes[o];if(n.name==e)return n.numItems===s||this._resizeAttr(t,n),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,n.buffer),this._bufferArray(t,n),n}const l=this._cgl.gl.createBuffer();this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,l);let _=this._cgl.gl.FLOAT;a&&a.type&&(_=a.type);const c={buffer:l,name:e,cb:i,itemSize:n,numItems:s,startItem:0,instanced:r,type:_};return this._bufferArray(t,c),e==m.SHADERVAR_VERTEX_POSITION&&(this._bufVertexAttrib=c),this._attributes.push(c),this._attribLocs={},c},h.prototype.getAttributes=function(){return this._attributes},h.prototype.updateTexCoords=function(t){if(t.texCoords&&t.texCoords.length>0)this.setAttribute(m.SHADERVAR_VERTEX_TEXCOORD,t.texCoords,2);else{const e=new Float32Array(Math.round(t.vertices.length/3*2));this.setAttribute(m.SHADERVAR_VERTEX_TEXCOORD,e,2)}},h.prototype.updateNormals=function(t){if(t.vertexNormals&&t.vertexNormals.length>0)this.setAttribute("attrVertNormal",t.vertexNormals,3);else{const e=new Float32Array(Math.round(t.vertices.length));this.setAttribute("attrVertNormal",e,3)}},h.prototype._setVertexNumbers=function(e){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(m.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,n)=>{n.uniformNumVertices||(n.uniformNumVertices=new d(n,"f","numVertices",this._numVerts)),n.uniformNumVertices.setValue(this._numVerts)})}},h.prototype.setVertexIndices=function(t){if(this._bufVerticesIndizes)if(t.length>0){for(let e=0;e<t.length;e++)if(t[e]>=this._numVerts)return void this._log.warn("invalid index in "+this._name);this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes),t instanceof Uint16Array?this.vertIndicesTyped=t:this.vertIndicesTyped=new Uint16Array(t),this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this._cgl.gl.DYNAMIC_DRAW),this._bufVerticesIndizes.itemSize=1,this._bufVerticesIndizes.numItems=t.length}else this._bufVerticesIndizes.numItems=0;else this._log.warn("no bufVerticesIndizes")},h.prototype.setGeom=function(e,t){this._geom=e,null!=e.glPrimitive&&(this._glPrimitive=e.glPrimitive),this._geom&&this._geom.name&&(this._name="mesh "+this._geom.name),v.lastMesh=null,this._cgl.profileData.profileMeshSetGeom++,this._disposeAttributes(),this.updateVertices(this._geom),this.setVertexIndices(this._geom.verticesIndices),this.updateTexCoords(this._geom),this.updateNormals(this._geom),this._geom.hasOwnProperty("tangents")&&this._geom.tangents&&this._geom.tangents.length>0&&this.setAttribute("attrTangent",this._geom.tangents,3),this._geom.hasOwnProperty("biTangents")&&this._geom.biTangents&&this._geom.biTangents.length>0&&this.setAttribute("attrBiTangent",this._geom.biTangents,3),this._geom.vertexColors.length>0&&(this._geom.vertexColors.flat&&this._geom.vertexColors.flat(100),this.setAttribute("attrVertColor",this._geom.vertexColors,4)),this.addVertexNumbers&&this._setVertexNumbers();const n=this._geom.getAttributes();for(const e in n)this.setAttribute(e,n[e].data,n[e].itemSize);t&&(this._geom=null)},h.prototype._preBind=function(t){for(let e=0;e<this._attributes.length;e++)this._attributes[e].cb&&this._attributes[e].cb(this._attributes[e],this._geom,t)},h.prototype._checkAttrLengths=function(){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";this._geom&&(e=this._geom.name)}},h.prototype._bind=function(a){if(!a.isValid())return;let t=[];if(this._attribLocs[a.id]?t=this._attribLocs[a.id]:this._attribLocs[a.id]=t,this._lastShader=a,a.lastCompile>this._lastAttrUpdate||t.length!=this._attributes.length){this._lastAttrUpdate=a.lastCompile;for(let e=0;e<this._attributes.length;e++)t[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(-1==t[e]&&n._attrLocationLastShaderTime!=a.lastCompile&&(n._attrLocationLastShaderTime=a.lastCompile,t[e]=this._cgl.glGetAttribLocation(a.getProgram(),n.name),this._cgl.profileData.profileAttrLoc++),-1!=t[e])if(this._cgl.gl.enableVertexAttribArray(t[e]),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,n.buffer),n.instanced)if(n.itemSize<=4)n.itemSize&&0!=n.itemSize||this._log.warn("instanced attrib itemsize error",this._geom.name,n),this._cgl.gl.vertexAttribPointer(t[e],n.itemSize,n.type,!1,4*n.itemSize,0),this._cgl.gl.vertexAttribDivisor(t[e],1);else if(16==n.itemSize){const a=64;this._cgl.gl.vertexAttribPointer(t[e],4,n.type,!1,a,0),this._cgl.gl.enableVertexAttribArray(t[e]+1),this._cgl.gl.vertexAttribPointer(t[e]+1,4,n.type,!1,a,16),this._cgl.gl.enableVertexAttribArray(t[e]+2),this._cgl.gl.vertexAttribPointer(t[e]+2,4,n.type,!1,a,32),this._cgl.gl.enableVertexAttribArray(t[e]+3),this._cgl.gl.vertexAttribPointer(t[e]+3,4,n.type,!1,a,48),this._cgl.gl.vertexAttribDivisor(t[e],1),this._cgl.gl.vertexAttribDivisor(t[e]+1,1),this._cgl.gl.vertexAttribDivisor(t[e]+2,1),this._cgl.gl.vertexAttribDivisor(t[e]+3,1)}else this._log.warn("unknown instance attrib size",n.name);else{if(n.itemSize&&0!=n.itemSize||this._log.warn("attrib itemsize error",this._name,n),this._cgl.gl.vertexAttribPointer(t[e],n.itemSize,n.type,!1,4*n.itemSize,0),n.pointer)for(let t=0;t<n.pointer.length;t++){const e=n.pointer[t];-1==e.loc&&(e.loc=this._cgl.glGetAttribLocation(a.getProgram(),e.name)),this._cgl.profileData.profileAttrLoc++,this._cgl.gl.enableVertexAttribArray(e.loc),this._cgl.gl.vertexAttribPointer(e.loc,n.itemSize,n.type,!1,e.stride,e.offset)}this.bindFeedback(n)}}0!==this._bufVerticesIndizes.numItems&&this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes)},h.prototype.unBind=function(){const e=this._lastShader;if(this._lastShader=null,!e)return;let t=[];this._attribLocs[e.id]?t=this._attribLocs[e.id]:this._attribLocs[e.id]=t,v.lastMesh=null;for(let e=0;e<this._attributes.length;e++)this._attributes[e].instanced&&(this._attributes[e].itemSize<=4?(-1!=t[e]&&this._cgl.gl.vertexAttribDivisor(t[e],0),t[e]>=0&&this._cgl.gl.disableVertexAttribArray(t[e])):(this._cgl.gl.vertexAttribDivisor(t[e],0),this._cgl.gl.vertexAttribDivisor(t[e]+1,0),this._cgl.gl.vertexAttribDivisor(t[e]+2,0),this._cgl.gl.vertexAttribDivisor(t[e]+3,0),this._cgl.gl.disableVertexAttribArray(t[e]+1),this._cgl.gl.disableVertexAttribArray(t[e]+2),this._cgl.gl.disableVertexAttribArray(t[e]+3))),-1!=t[e]&&this._cgl.gl.disableVertexAttribArray(t[e])},h.prototype.meshChanged=function(){return this._cgl.lastMesh&&this._cgl.lastMesh!=this},h.prototype.printDebug=function(e){console.log("--attributes");for(let e=0;e<this._attributes.length;e++)console.log("attribute "+e+" "+this._attributes[e].name)},h.prototype.setNumVertices=function(e){this._bufVertexAttrib.numItems=e},h.prototype.getNumVertices=function(){return this._bufVertexAttrib.numItems},h.prototype.render=function(n){if(!n||!n.isValid())return;this._checkAttrLengths(),this._geom&&(n.wireframe||this._geom.isIndexed()||!this._preWireframeGeom||this.setGeom(this._preWireframeGeom),n.wireframe&&this._geom.isIndexed()&&(this._preWireframeGeom=this._geom,this._geom=this._geom.copy(),this._geom.unIndex(),this._geom.calcBarycentric(),this.setGeom(this._geom),this.setAttribute("attrBarycentric",this._geom.barycentrics,3)));let e=!1;v.lastMesh!=this&&(v.lastMesh&&v.lastMesh.unBind(),e=!0),e&&this._preBind(n),n.bind(),n.bindTextures&&n.bindTextures(),this._bind(n),this.addVertexNumbers&&this._setVertexNumbers(),v.lastMesh=this;let t=this._cgl.gl.TRIANGLES;void 0!==this._glPrimitive&&(t=this._glPrimitive),null!==n.glPrimitive&&(t=n.glPrimitive);let a=1,i=this._cgl.profileData.doProfileGlQuery,r=!1;if(i){let e=this._name+" "+n.getName()+" #"+n.id;this._numInstances&&(e+=" instanced "+this._numInstances+"x");let t=this._cgl.profileData.glQueryData[e];if(t||(t={id:e,num:0},this._cgl.profileData.glQueryData[e]=t),this._queryExt||(this._queryExt=this._cgl.gl.getExtension("EXT_disjoint_timer_query_webgl2")),this._queryExt){if(t._drawQuery){if(this._cgl.gl.getQueryParameter(t._drawQuery,this._cgl.gl.QUERY_RESULT_AVAILABLE)){const n=this._cgl.gl.getQueryParameter(t._drawQuery,this._cgl.gl.QUERY_RESULT)/1e6;t._times+=n,t._numcount++,t.when=performance.now(),t._drawQuery=null,t.queryStarted=!1}}t.queryStarted||(t._drawQuery=this._cgl.gl.createQuery(),this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery),r=t.queryStarted=!0)}}if(this.hasFeedbacks()?this.drawFeedbacks(n,t):0===this._bufVerticesIndizes.numItems?(t==this._cgl.gl.TRIANGLES&&(a=3),0===this._numInstances?this._cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem):this._cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)):0===this._numInstances?this._cgl.gl.drawElements(t,this._bufVerticesIndizes.numItems,this._cgl.gl.UNSIGNED_SHORT,0):this._cgl.gl.drawElementsInstanced(t,this._bufVerticesIndizes.numItems,this._cgl.gl.UNSIGNED_SHORT,0,this._numInstances),this._cgl.debugOneFrame&&this._cgl.gl.getError()!=this._cgl.gl.NO_ERROR){this._log.error("mesh draw gl error"),this._log.error("mesh",this),this._log.error("shader",n);for(let e=0;e<this._cgl.gl.getProgramParameter(n.getProgram(),this._cgl.gl.ACTIVE_ATTRIBUTES);e++){const t=this._cgl.gl.getActiveAttrib(n.getProgram(),e).name;this._log.error("attrib ",t)}}this._cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/a*(this._numInstances||1),this._cgl.profileData.profileMeshDraw++,i&&r&&this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT),this.unBind()},h.prototype.setNumInstances=function(n){if(n=Math.max(0,n),this._numInstances!=n){this._numInstances=n;const t=new Float32Array(n);for(let e=0;e<n;e++)t[e]=e;this.setAttribute("instanceIndex",t,1,{instanced:!0})}},h.prototype._disposeAttributes=function(){if(this._attributes){for(let e=0;e<this._attributes.length;e++)this._attributes[e].buffer&&(this._cgl.gl.deleteBuffer(this._attributes[e].buffer),this._attributes[e].buffer=null);this._attributes.length=0}},h.prototype.dispose=function(){this._bufVertexAttrib&&this._bufVertexAttrib.buffer&&this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer),this._bufVerticesIndizes&&this._cgl.gl.deleteBuffer(this._bufVerticesIndizes),this._disposeAttributes()},function(e){e.prototype.hasFeedbacks=function(){return this._feedBacks.length>0},e.prototype.removeFeedbacks=function(e){this._feedbacks&&(this._feedbacks.length=0,this._feedBacksChanged=!0)},e.prototype.setAttributeFeedback=function(){},e.prototype.setFeedback=function(e,t,n){let a={nameOut:t},i=!1;this.unBindFeedbacks();for(let e=0;e<this._feedBacks.length;e++)this._feedBacks[e].nameOut==t&&(a=this._feedBacks[e],i=!0);return i||(this._feedBacksChanged=!0),a.initialArr=n,a.attrib=e,a.outBuffer&&this._cgl.gl.deleteBuffer(a.outBuffer),a.outBuffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,a.outBuffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,a.initialArr,this._cgl.gl.STATIC_DRAW),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,a.attrib.buffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,a.initialArr,this._cgl.gl.STATIC_DRAW),i||this._feedBacks.push(a),a},e.prototype.bindFeedback=function(n){if(!this._feedBacks||0===this._feedBacks.length)return;-1==this._transformFeedBackLoc&&(this._transformFeedBackLoc=this._cgl.gl.createTransformFeedback()),this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc);let a=!1;for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t];e.attrib==n&&(a=!0,this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,t,e.outBuffer))}},e.prototype.drawFeedbacks=function(e,t){let n=0;if(this._feedBacksChanged){const t=[];for(this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc),n=0;n<this._feedBacks.length;n++)t.push(this._feedBacks[n].nameOut);return e.setFeedbackNames(t),console.log("feedbacknames",t),e.compile(),this._feedBacksChanged=!1,this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null),void console.log("changed finished")}this._cgl.gl.beginTransformFeedback(this.glPrimitive),this._cgl.gl.drawArrays(t,0,this._feedBacks[0].attrib.numItems),this._cgl.gl.endTransformFeedback(),this.unBindFeedbacks(),this.feedBacksSwapBuffers()},e.prototype.unBindFeedbacks=function(){for(let e=0;e<this._feedBacks.length;e++)this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,e,null);this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null)},e.prototype.feedBacksSwapBuffers=function(){for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t].attrib.buffer;this._feedBacks[t].attrib.buffer=this._feedBacks[t].outBuffer,this._feedBacks[t].outBuffer=e}}}(h);const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=new Uint8Array(256);for(let e=0;e<x.length;e++)b[x.charCodeAt(e)]=e;const T=b,I=function(e){let t,n,a,i,r,o=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);let _=new ArrayBuffer(o),c=new Uint8Array(_);for(t=0;t<s;t+=4)n=T[e.charCodeAt(t)],a=T[e.charCodeAt(t+1)],i=T[e.charCodeAt(t+2)],r=T[e.charCodeAt(t+3)],c[l++]=n<<2|a>>4,c[l++]=(15&a)<<4|i>>2,c[l++]=(3&i)<<6|63&r;return _};class A{constructor(e){this._init(),this._first=!0,this._wireMesh=null,e&&this.apply(e)}_init(){this._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],this._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this._center=[0,0,0],this._size=[0,0,0],this._maxAxis=0,this._first=!0}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(t,e){if(t){if(t instanceof A){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ),this.applyPos(e.minX,e.minY,e.minZ)}else for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);this.calcCenterSize()}}copy(){return new A(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,n){if(e!=Number.MAX_VALUE&&e!=-Number.MAX_VALUE&&t!=Number.MAX_VALUE&&t!=-Number.MAX_VALUE&&n!=Number.MAX_VALUE&&n!=-Number.MAX_VALUE&&CABLES.UTILS.isNumeric(e)&&CABLES.UTILS.isNumeric(t)&&CABLES.UTILS.isNumeric(n)){if(this._first)return this._max[0]=e,this._max[1]=t,this._max[2]=n,this._min[0]=e,this._min[1]=t,this._min[2]=n,void(this._first=!1);this._max[0]=Math.max(this._max[0],e),this._max[1]=Math.max(this._max[1],t),this._max[2]=Math.max(this._max[2],n),this._min[0]=Math.min(this._min[0],e),this._min[1]=Math.min(this._min[1],t),this._min[2]=Math.min(this._min[2],n)}}calcCenterSize(){this._first||(this._size[0]=this._max[0]-this._min[0],this._size[1]=this._max[1]-this._min[1],this._size[2]=this._max[2]-this._min[2],this._center[0]=(this._min[0]+this._max[0])/2,this._center[1]=(this._min[1]+this._max[1])/2,this._center[2]=(this._min[2]+this._max[2])/2,this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1])))}mulMat4(e){this._first&&(this._max[0]=0,this._max[1]=0,this._max[2]=0,this._min[0]=0,this._min[1]=0,this._min[2]=0,this._first=!1),vec3.transformMat4(this._max,this._max,e),vec3.transformMat4(this._min,this._min,e),this.calcCenterSize()}render(e,t){this._wireMesh||(this._wireMesh=new CGL.WireCube(e)),e.pushModelMatrix(),mat4.translate(e.mMatrix,e.mMatrix,this._center),this._wireMesh.render(e,this._size[0]/2,this._size[1]/2,this._size[2]/2),e.popModelMatrix()}}const E=function(e){this.name=e||"unknown",this._log=new c("cgl_geometry"),this.faceVertCount=3,this._vertices=[],this.verticesIndices=[],this.texCoords=new Float32Array,this.texCoordsIndices=[],this.vertexNormals=[],this.tangents=[],this.biTangents=[],this.barycentrics=[],this.morphTargets=[],this.vertexColors=[],this._attributes={},this.glPrimitive=null,Object.defineProperty(this,"vertices",{get(){return this._vertices},set(e){this.setVertices(e)}})};E.prototype.clear=function(){this.vertices=new Float32Array([]),this.verticesIndices.length=0,this.texCoords=new Float32Array([]),this.texCoordsIndices.length=0,this.vertexNormals=new Float32Array([])},E.prototype.getAttributes=function(){return this._attributes},E.prototype.getAttribute=function(t){for(const e in this._attributes)if(this._attributes[e].name==t)return this._attributes[e];return null},E.prototype.setAttribute=function(e,t,n){let a="";1==n?a="float":2==n?a="vec2":3==n?a="vec3":4==n&&(a="vec4");const i={name:e,data:t,itemSize:n,type:a};this._attributes[e]=i},E.prototype.setVertices=function(e){e instanceof Float32Array?this._vertices=e:this._vertices=new Float32Array(e)},E.prototype.setTexCoords=function(e){e instanceof Float32Array?this.texCoords=e:this.texCoords=new Float32Array(e)},E.prototype.calcNormals=function(e){e||this.unIndex(),this.calculateNormals({})},E.prototype.setPointVertices=function(t){if(t.length%3==0){t instanceof Float32Array?this.vertices=t:this.vertices=new Float32Array(t),this.texCoords instanceof Float32Array||(this.texCoords=new Float32Array(t.length/3*2)),this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++)this.verticesIndices[e]=e,this.texCoords[2*e]=0,this.texCoords[2*e+1]=0}else this._log.error("SetPointVertices: Array must be multiple of three.")},E.prototype.merge=function(t){if(!t)return;const n=this.verticesIndices.length,a=this.vertices.length/3;this.verticesIndices.length=this.verticesIndices.length+t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[n+e]=t.verticesIndices[e]+a;this.vertices=r.float32Concat(this.vertices,t.vertices),this.texCoords=r.float32Concat(this.texCoords,t.texCoords),this.vertexNormals=r.float32Concat(this.vertexNormals,t.vertexNormals),this.tangents=r.float32Concat(this.tangents,t.tangents),this.biTangents=r.float32Concat(this.biTangents,t.biTangents)},E.prototype.copy=function(){let e=0;const t=new E(this.name+" copy");if(t.faceVertCount=this.faceVertCount,t.setVertices(this._vertices.slice(0)),this.verticesIndices)for(t.verticesIndices.length=this.verticesIndices.length,e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e];for(t.texCoords=new Float32Array(this.texCoords.length),e=0;e<this.texCoords.length;e++)t.texCoords[e]=this.texCoords[e];for(t.texCoordsIndices.length=this.texCoordsIndices.length,e=0;e<this.texCoordsIndices.length;e++)t.texCoordsIndices[e]=this.texCoordsIndices[e];for(t.vertexNormals=new Float32Array(this.vertexNormals.length),e=0;e<this.vertexNormals.length;e++)t.vertexNormals[e]=this.vertexNormals[e];if(this.tangents)for(t.tangents=[],t.tangents.length=this.tangents.length,e=0;e<this.tangents.length;e++)t.tangents[e]=this.tangents[e];if(this.biTangents)for(t.biTangents=[],t.biTangents.length=this.biTangents.length,e=0;e<this.biTangents.length;e++)t.biTangents[e]=this.biTangents[e];for(t.barycentrics.length=this.barycentrics.length,e=0;e<this.barycentrics.length;e++)t.barycentrics[e]=this.barycentrics[e];for(t.morphTargets.length=this.morphTargets.length,e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];for(t.vertexColors.length=this.vertexColors.length,e=0;e<this.vertexColors.length;e++)t.vertexColors[e]=this.vertexColors[e];return t},E.prototype.calculateNormals=function(t){const n=vec3.create(),a=vec3.create(),i=vec3.create();function r(e){return vec3.subtract(n,e[0],e[1]),vec3.subtract(a,e[0],e[2]),vec3.cross(i,n,a),vec3.normalize(i,i),t&&t.forceZUp&&i[2]<0&&(i[0]*=-1,i[1]*=-1,i[2]*=-1),i}this.getVertexVec=function(e){const t=[0,0,0];return t[0]=this.vertices[3*e+0],t[1]=this.vertices[3*e+1],t[2]=this.vertices[3*e+2],t},this.vertexNormals instanceof Float32Array&&this.vertexNormals.length==this.vertices.length||(this.vertexNormals=new Float32Array(this.vertices.length));for(let e=0;e<this.vertices.length;e++)this.vertexNormals[e]=0;if(this.isIndexed()){const t=[];t.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const a=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];t[e/3]=r(a),this.vertexNormals[3*this.verticesIndices[e+0]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+0]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+0]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+1]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+1]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+1]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+2]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+2]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+2]+2]+=t[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3)for(let e=0;e<3;e++){const a=[this.vertexNormals[3*this.verticesIndices[t+e]+0],this.vertexNormals[3*this.verticesIndices[t+e]+1],this.vertexNormals[3*this.verticesIndices[t+e]+2]];vec3.normalize(a,a),this.vertexNormals[3*this.verticesIndices[t+e]+0]=a[0],this.vertexNormals[3*this.verticesIndices[t+e]+1]=a[1],this.vertexNormals[3*this.verticesIndices[t+e]+2]=a[2]}}else{const t=[];for(let e=0;e<this.vertices.length;e+=9){const a=r([[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]]);t.push(a[0],a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2])}this.vertexNormals=t}},E.prototype.calcTangentsBitangents=function(){if(!this.vertices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertices.");if(!this.vertexNormals.length)return void this._log.error("Cannot calculate tangents/bitangents without normals.");if(!this.texCoords.length){const s=this.vertices.length/3*2;this.texCoords=new Float32Array(s);for(let e=0;e<s;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertex indices.");if(this.verticesIndices.length%3!=0)return void this._log.error("Vertex indices mismatch!");const s=this.verticesIndices.length/3,l=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length),this.biTangents=new Float32Array(this.vertexNormals.length);const _=[];_.length=2*l;const c=vec3.create(),u=vec3.create(),p=vec3.create(),g=vec2.create(),d=vec2.create(),f=vec2.create(),m=vec3.create(),v=vec3.create();for(let o=0;o<s;o+=1){const s=this.verticesIndices[3*o],h=this.verticesIndices[3*o+1],x=this.verticesIndices[3*o+2];vec3.set(c,this.vertices[3*s],this.vertices[3*s+1],this.vertices[3*s+2]),vec3.set(u,this.vertices[3*h],this.vertices[3*h+1],this.vertices[3*h+2]),vec3.set(p,this.vertices[3*x],this.vertices[3*x+1],this.vertices[3*x+2]),vec2.set(g,this.texCoords[2*s],this.texCoords[2*s+1]),vec2.set(d,this.texCoords[2*h],this.texCoords[2*h+1]),vec2.set(f,this.texCoords[2*x],this.texCoords[2*x+1]);const b=u[0]-c[0],T=p[0]-c[0],I=u[1]-c[1],A=p[1]-c[1],E=u[2]-c[2],e=p[2]-c[2],t=d[0]-g[0],n=f[0]-g[0],a=d[1]-g[1],i=f[1]-g[1],r=1/(t*i-n*a);vec3.set(m,(i*b-a*T)*r,(i*I-a*A)*r,(i*E-a*e)*r),vec3.set(v,(t*T-n*b)*r,(t*A-n*I)*r,(t*e-n*E)*r),_[s]=m,_[h]=m,_[x]=m,_[s+l]=v,_[h+l]=v,_[x+l]=v}const t=vec3.create(),h=vec3.create(),x=vec3.create(),b=vec3.create(),T=vec3.create(),I=vec3.create(),A=vec3.create(),E=vec3.create();for(let e=0;e<l;e+=1){if(!_[e])continue;vec3.set(t,this.vertexNormals[3*e],this.vertexNormals[3*e+1],this.vertexNormals[3*e+2]),vec3.set(h,_[e][0],_[e][1],_[e][2]);const c=vec3.dot(t,h);vec3.scale(T,t,c),vec3.subtract(I,h,T),vec3.normalize(E,I),vec3.cross(A,t,h);vec3.dot(A,_[e+l]);const u=1;vec3.scale(x,E,1/u),vec3.cross(b,t,x),this.tangents[3*e+0]=x[0],this.tangents[3*e+1]=x[1],this.tangents[3*e+2]=x[2],this.biTangents[3*e+0]=b[0],this.biTangents[3*e+1]=b[1],this.biTangents[3*e+2]=b[2]}},E.prototype.isIndexed=function(){return 0!=this.verticesIndices.length},E.prototype.unIndex=function(e,t){const n=[],a=[],i=[],r=[],o=[],s=[];let l=0,_=0;for(_=0;_<this.verticesIndices.length;_+=3)n.push(this.vertices[3*this.verticesIndices[_+0]+0],this.vertices[3*this.verticesIndices[_+0]+1],this.vertices[3*this.verticesIndices[_+0]+2]),r.push(this.vertexNormals[3*this.verticesIndices[_+0]+0],this.vertexNormals[3*this.verticesIndices[_+0]+1],this.vertexNormals[3*this.verticesIndices[_+0]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[_+0]+0],this.tangents[3*this.verticesIndices[_+0]+1],this.tangents[3*this.verticesIndices[_+0]+2]),this.biTangents.length>0&&s.push(this.biTangents[3*this.verticesIndices[_+0]+0],this.biTangents[3*this.verticesIndices[_+0]+1],this.biTangents[3*this.verticesIndices[_+0]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[_+0]+0],this.texCoords[2*this.verticesIndices[_+0]+1]):i.push(0,0),a.push(l),l++,n.push(this.vertices[3*this.verticesIndices[_+1]+0],this.vertices[3*this.verticesIndices[_+1]+1],this.vertices[3*this.verticesIndices[_+1]+2]),r.push(this.vertexNormals[3*this.verticesIndices[_+1]+0],this.vertexNormals[3*this.verticesIndices[_+1]+1],this.vertexNormals[3*this.verticesIndices[_+1]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[_+1]+0],this.tangents[3*this.verticesIndices[_+1]+1],this.tangents[3*this.verticesIndices[_+1]+2]),this.biTangents.length>0&&s.push(this.biTangents[3*this.verticesIndices[_+1]+0],this.biTangents[3*this.verticesIndices[_+1]+1],this.biTangents[3*this.verticesIndices[_+1]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[_+1]+0],this.texCoords[2*this.verticesIndices[_+1]+1]):i.push(0,0),a.push(l),l++,n.push(this.vertices[3*this.verticesIndices[_+2]+0],this.vertices[3*this.verticesIndices[_+2]+1],this.vertices[3*this.verticesIndices[_+2]+2]),r.push(this.vertexNormals[3*this.verticesIndices[_+2]+0],this.vertexNormals[3*this.verticesIndices[_+2]+1],this.vertexNormals[3*this.verticesIndices[_+2]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[_+2]+0],this.tangents[3*this.verticesIndices[_+2]+1],this.tangents[3*this.verticesIndices[_+2]+2]),this.biTangents.length>0&&s.push(this.biTangents[3*this.verticesIndices[_+2]+0],this.biTangents[3*this.verticesIndices[_+2]+1],this.biTangents[3*this.verticesIndices[_+2]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[_+2]+0],this.texCoords[2*this.verticesIndices[_+2]+1]):i.push(0,0),a.push(l),l++;this.vertices=n,this.texCoords=i,this.vertexNormals=r,o.length>0&&(this.tangents=o),s.length>0&&(this.biTangents=s),this.verticesIndices.length=0,e&&(this.verticesIndices=a),t||this.calculateNormals()},E.prototype.calcBarycentric=function(){this.barycentrics.length=this.vertices.length;let e=0;for(e=0;e<this.vertices.length;e++)this.barycentrics[e]=0;let t=0;for(e=0;e<this.vertices.length;e+=3)this.barycentrics[e+t]=1,t++,3==t&&(t=0)},E.prototype.getBounds=function(){return new A(this)},E.prototype.center=function(e,t,n){void 0===e&&(e=!0,t=!0,n=!0);let a=0;const i=this.getBounds(),r=[i.minX+(i.maxX-i.minX)/2,i.minY+(i.maxY-i.minY)/2,i.minZ+(i.maxZ-i.minZ)/2];for(a=0;a<this.vertices.length;a+=3)this.vertices[a+0]==this.vertices[a+0]&&(e&&(this.vertices[a+0]-=r[0]),t&&(this.vertices[a+1]-=r[1]),n&&(this.vertices[a+2]-=r[2]));return r},E.prototype.mapTexCoords2d=function(){const n=this.getBounds(),a=this.vertices.length/3;this.texCoords=new Float32Array(2*a);for(let t=0;t<a;t++){const a=this.vertices[3*t+0],e=this.vertices[3*t+1];this.texCoords[2*t+0]=a/(n.maxX-n.minX)+.5,this.texCoords[2*t+1]=1-e/(n.maxY-n.minY)+.5}},E.buildFromFaces=function(i,e){const r=[],o=[];for(let e=0;e<i.length;e+=3){const s=i[e+0],t=i[e+1],n=i[e+2],a=[-1,-1,-1];for(let e=0;e<r;e+=3)r[e+0]==s[0]&&r[e+1]==s[1]&&r[e+2]==s[2]&&(a[0]=e/3),r[e+0]==t[0]&&r[e+1]==t[1]&&r[e+2]==t[2]&&(a[1]=e/3),r[e+0]==n[0]&&r[e+1]==n[1]&&r[e+2]==n[2]&&(a[2]=e/3);-1==a[0]&&(r.push(s[0],s[1],s[2]),a[0]=(r.length-1)/3),-1==a[1]&&(r.push(t[0],t[1],t[2]),a[1]=(r.length-1)/3),-1==a[2]&&(r.push(n[0],n[1],n[2]),a[2]=(r.length-1)/3),o.push(parseInt(a[0],10)),o.push(parseInt(a[1],10)),o.push(parseInt(a[2],10))}const s=new E(this.name);return s.name=e,s.vertices=r,s.verticesIndices=o,s},E.json2geom=function(t){const n=new E("jsonMeshGeom");if(n.verticesIndices=[],n.vertices=t.vertices||[],n.vertexNormals=t.normals||[],n.vertexColors=t.colors||[],n.tangents=t.tangents||[],n.biTangents=t.bitangents||[],t.texturecoords&&n.setTexCoords(t.texturecoords[0]),t.vertices_b64&&(n.vertices=new Float32Array(I(t.vertices_b64))),t.normals_b64&&(n.vertexNormals=new Float32Array(I(t.normals_b64))),t.tangents_b64&&(n.tangents=new Float32Array(I(t.tangents_b64))),t.bitangents_b64&&(n.biTangents=new Float32Array(I(t.bitangents_b64))),t.texturecoords_b64&&n.setTexCoords(new Float32Array(I(t.texturecoords_b64[0]))),t.faces_b64)n.verticesIndices=new Uint32Array(I(t.faces_b64));else{n.verticesIndices.length=3*t.faces.length;for(let e=0;e<t.faces.length;e++)n.verticesIndices[3*e]=t.faces[e][0],n.verticesIndices[3*e+1]=t.faces[e][1],n.verticesIndices[3*e+2]=t.faces[e][2]}return n};const y={getSimpleRect:function(e,t){const n=new E(t);return n.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],n.texCoords=[1,1,0,1,1,0,0,0],n.verticesIndices=[0,1,2,2,1,3],n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0],new h(e,n)}};CGL.CopyTexture=class{constructor(e,t,n){this.cgl=e,this._options=n,this._fb=null;const a=n.shader||"".endl()+"UNI sampler2D tex;".endl()+"IN vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"    vec4 col=texture(tex,texCoord);".endl()+"    outColor= col;".endl()+"}",i="".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new CGL.Shader(e,"corelib copytexture "+t),this.bgShader.setSource(i,a);new CGL.Uniform(this.bgShader,"t","tex",0);this.mesh=y.getSimpleRect(this.cgl,"texEffectRect")}copy(e){const a=this._options.width||e.width,i=this._options.height||e.height,r=this.cgl;if(this._fb)this._fb.getWidth()==a&&this._fb.getHeight()==i||this._fb.setSize(a,i);else{let e=CGL.Texture.FILTER_LINEAR,t=CGL.Texture.WRAP_CLAMP_TO_EDGE;this._options.hasOwnProperty("filter")&&(e=this._options.filter),this._options.hasOwnProperty("wrap")&&(t=this._options.wrap);const n={isFloatingPointTexture:this._options.isFloatingPointTexture,filter:e,wrap:t};1==r.glVersion?this._fb=new CGL.Framebuffer(r,a,i,n):this._fb=new CGL.Framebuffer2(r,a,i,n)}return r.frameStore.renderOffscreen=!0,this._fb.renderStart(r),r.setTexture(0,e.tex),r.pushShader(this.bgShader),this.mesh.render(this.bgShader),r.popShader(),this._fb.renderEnd(),r.frameStore.renderOffscreen=!1,this._fb.getTextureColor()}dispose(){this._fb&&this._fb.dispose(),this.bgShader&&this.bgShader.dispose(),this.mesh&&this.mesh.dispose()}}}]).Copytexture;